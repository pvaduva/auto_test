WASSP_WORKSPACE_HOME=/home/jjia/wassp-repos/Workspace
WASSP_USER_CONFIG_FILE=/home/jjia/.wassp/wasspuserconfig.ini
GNOME_KEYRING_PID=2285
WASSP_TESTRUN_WC_FILE=/home/jjia/wassp-repos/Logs/hp380/CGCS_2Cont_2Comp/test_us49035_ts1_vcpu_scale_up_down/testRunWorkingCopy.xml
USER=jjia
LANGUAGE=en_CA:en
WASSP_VSB_BASE=/home/jjia/wassp-repos/Workspace/vsb
PUBLIC_ROUTER=tenant1-router
noseTestTimeout=1000
WASSP_TC_NAME=test_us49035_ts1_vcpu_scale_up_down
WASSP_TC_USER_LOG=/home/jjia/wassp-repos/Logs/hp380/CGCS_2Cont_2Comp/test_us49035_ts1_vcpu_scale_up_down/user
HOST_IP=128.224.252.2
XDG_SEAT=seat0
WASSP_NEST_BASE=/home/jjia/wassp-repos/wassp-nest
TEXTDOMAIN=im-config
SSH_AGENT_PID=2375
COMPIZ_CONFIG_PROFILE=ubuntu
SESSION=ubuntu
LD_LIBRARY_PATH=/home/jjia/wassp-repos/.venv_wassp/lib:
SHLVL=3
WRSPASS=li69nux
QT4_IM_MODULE=xim
HOME=/home/jjia
WASSP_PRODUCT_NAME=cgcs
WASSP_TC_RUN_LOG=/home/jjia/wassp-repos/Logs/hp380/CGCS_2Cont_2Comp/test_us49035_ts1_vcpu_scale_up_down/
DESKTOP_SESSION=ubuntu
wrift_synchronisation_tag=B2E1R0
XDG_SEAT_PATH=/org/freedesktop/DisplayManager/Seat0
GTK_MODULES=overlay-scrollbar:unity-gtk-module
WASSP_WIND_HOME=/WindRiver
_wr_htee_execDir=/home/jjia/wassp-repos/wassp/host/htee
PS1=(.venv_wassp) 
WASSP_CONFIG_BASE=/home/jjia/wassp-repos/systems
INSTANCE=
WASSP_DATA_BASE=/home/jjia/wassp-repos/wassp-data
WASSP_TESTMATRIX_BASE=/home/jjia/wassp-repos/testmatrices
testCaseId=us49035_ts1
DBUS_SESSION_BUS_ADDRESS=unix:abstract=/tmp/dbus-aqf20KfIDP
LOADPATH=${LP}
COLORTERM=gnome-terminal
WASSP_LOGS_HOME=/home/jjia/wassp-repos/Logs
UBUNTU_MENUPROXY=1
GNOME_KEYRING_CONTROL=/run/user/19059/keyring-YEpf6D
WASSP_LOGGING_OPTIONS=all
WRSUSER=wrsroot
QT_QPA_PLATFORMTHEME=appmenu-qt5
MANDATORY_PATH=/usr/share/gconf/ubuntu.mandatory.path
IM_CONFIG_PHASE=1
SESSIONTYPE=gnome-session
BUILDSDIR=/localdisk/loadbuild/jenkins/CGCS_1.0_Unified_Daily_Build
WASSP_TC_PATH=/home/jjia/wassp-repos/testcases/cgcs/cgcs2.0/sprint/us49035_vcpu_scale_up_down/test_us49035_ts1_vcpu_scale_up_down
WASSP_TARGET_LOGS={'Com1': ['/home/jjia/wassp-repos/Logs/hp380/CGCS_2Cont_2Comp/test_us49035_ts1_vcpu_scale_up_down/target_21770.Com1_B2E1R0_20150205_153251.log'], 'Com2': ['/home/jjia/wassp-repos/Logs/hp380/CGCS_2Cont_2Comp/test_us49035_ts1_vcpu_scale_up_down/target_21771.Com2_B2E1R0_20150205_153251.log'], 'Con1': ['/home/jjia/wassp-repos/Logs/hp380/CGCS_2Cont_2Comp/test_us49035_ts1_vcpu_scale_up_down/target_21768.Con1_B2E1R0_20150205_153251.log'], 'Con2': ['/home/jjia/wassp-repos/Logs/hp380/CGCS_2Cont_2Comp/test_us49035_ts1_vcpu_scale_up_down/target_21769.Con2_B2E1R0_20150205_153251.log'], 'SHELL': ['/home/jjia/wassp-repos/Logs/hp380/CGCS_2Cont_2Comp/test_us49035_ts1_vcpu_scale_up_down/target_host:localshell.SHELL_B2E1R0_20150205_153251.log'], 'Con1SSH': ['/home/jjia/wassp-repos/Logs/hp380/CGCS_2Cont_2Comp/test_us49035_ts1_vcpu_scale_up_down/target_21768.Con1SSH_B2E1R0_20150205_153251.log']}
GTK_IM_MODULE=ibus
LOGNAME=jjia
wrift_htee_data_file=/tmp/tmpfidla7.tmp
WINDOWID=98566155
_=/home/jjia/wassp-repos/.venv_wassp/bin/python3
DEFAULTS_PATH=/usr/share/gconf/ubuntu.default.path
WASSP_RUNTIMECONFIGS_BASE=/home/jjia/wassp-repos/runtimeconfigs/cgcs
WASSP_SYSTEMS_RUNTIMECONFIGS_BASE=/home/jjia/wassp-repos/systems/cgcs/runtimeconfigs/cgcs2.0/sprint/us49035_vcpu_scale_up_down
TERM=xterm
XDG_SESSION_ID=c3
WASSP_LOCAL_CONFIG_DIR=/home/jjia/.wassp
GNOME_DESKTOP_SESSION_ID=this-is-deprecated
WASSP_TESTCASE_BASE=/home/jjia/wassp-repos/testcases/cgcs
WASSP_TARGET_CONTROL_FILES_DIR=/home/jjia/wassp-repos/wassp-data/Data
PATH=/home/jjia/wassp-repos/.venv_wassp/bin:/home/jjia/wassp-repos/wassp-nest/tools/bin:/home/jjia/wassp-repos/wassp/host/tools/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/games:/usr/local/games
GDM_LANG=en_CA
SELINUX_INIT=YES
SESSION_MANAGER=local/yow-jjia-lx:@/tmp/.ICE-unix/2445,unix/yow-jjia-lx:/tmp/.ICE-unix/2445
XDG_MENU_PREFIX=gnome-
XDG_RUNTIME_DIR=/run/user/19059
XDG_SESSION_PATH=/org/freedesktop/DisplayManager/Session0
WASSP_CONSOLELOGS_BASE=/home/jjia/wassp-repos/Logs/consolelogs
DISPLAY=:0
COMPIZ_BIN_PATH=/usr/bin/
WASSP_SYSTEMS_BASE=/home/jjia/wassp-repos/systems/cgcs
BUILDSERVER=${BS}
WASSP_BASE=/home/jjia/wassp-repos/wassp/host
LANG=en_CA.UTF-8
XDG_CURRENT_DESKTOP=Unity
XAUTHORITY=/folk/jjia/.Xauthority
XMODIFIERS=@im=ibus
WASSP_TESTRUN_FILE=/home/jjia/wassp-repos/Logs/hp380/CGCS_2Cont_2Comp/test_us49035_ts1_vcpu_scale_up_down/testRun.xml
XDG_GREETER_DATA_DIR=/var/lib/lightdm-data/jjia
SSH_AUTH_SOCK=/run/user/19059/keyring-YEpf6D/ssh
SSH_AGENT_LAUNCHER=upstart
CGCS_TEST_DIR=/home/jjia/wassp-repos
SHELL=/bin/bash
GDMSESSION=ubuntu
WASSP_CONFIG_DIR=/home/jjia/wassp-repos/systems/cgcs/platforms/cgcs2.0/sprint/us49035_vcpu_scale_up_down
WASSP_TESTMATRIX_DIR=/home/jjia/wassp-repos/testmatrices/cgcs/cgcs2.0/sprint/us49035_vcpu_scale_up_down
CGCS_BUILD=2015-01-18_22-05-32-scale_up_down
WASSP_PYTHON_HOME=/home/jjia/wassp-repos/.venv_wassp/bin/python3
UPSTART_SESSION=unix:abstract=/com/ubuntu/upstart-session/19059/2297
GPG_AGENT_INFO=/run/user/19059/keyring-YEpf6D/gpg:0:1
TEXTDOMAINDIR=/usr/share/locale/
VIRTUAL_ENV=/home/jjia/wassp-repos/.venv_wassp
QT_IM_MODULE=ibus
XDG_VTNR=7
PWD=/home/jjia/wassp-repos/testcases/cgcs/cgcs2.0/sprint/us49035_vcpu_scale_up_down/test_us49035_ts1_vcpu_scale_up_down
WASSP_TDK_BASE=/home/jjia/wassp-repos/target
WASSP_SYSTEMS_TOPOLOGIES_BASE=/home/jjia/wassp-repos/systems/cgcs/topologies/cgcs2.0/sprint/us49035_vcpu_scale_up_down
XDG_CONFIG_DIRS=/etc/xdg/xdg-ubuntu:/usr/share/upstart/xdg:/etc/xdg
CLUTTER_IM_MODULE=xim
XDG_DATA_DIRS=/usr/share/ubuntu:/usr/share/gnome:/usr/local/share/:/usr/share/
WASSP_SYSTEMS_PLATFORMS_BASE=/home/jjia/wassp-repos/systems/cgcs/platforms/cgcs2.0/sprint/us49035_vcpu_scale_up_down
WRSDIR=/home/wrsroot
WASSP_TC_USER_WORKSPACE=/home/jjia/wassp-repos/Workspace/hp380/CGCS_2Cont_2Comp/test_us49035_ts1_vcpu_scale_up_down/user
WASSP_RUNTIMECONFIGS_DIR=/home/jjia/wassp-repos/runtimeconfigs/cgcs/cgcs2.0/sprint/us49035_vcpu_scale_up_down
GUESTPATH=${GP}
DBREPORT_SWITCH=True
PUBLIC_NETWORK=tenant1-net1
WASSP_FEATURE_DIR=cgcs2.0/sprint/us49035_vcpu_scale_up_down
WASSP_SYSTEMS_HOME=/home/jjia/wassp-repos/systems
VTE_VERSION=3409
WASSP_HOME=/home/jjia/wassp-repos
WRSPASSORIG=wrsroot
JOB=dbus
WASSP_TESTCASE_DIR=/home/jjia/wassp-repos/testcases/cgcs/cgcs2.0/sprint/us49035_vcpu_scale_up_down
hteeCleanWorkDir=True
WASSP_TC_RUN_WORKSPACE=/home/jjia/wassp-repos/Workspace/hp380/CGCS_2Cont_2Comp/test_us49035_ts1_vcpu_scale_up_down/
Const: HOST_IP = 128.224.150.199
[0;32m
expect-lite directive: *NOINTERACT [0m
[0;33mWarning: Remote Host=none, using Localhost[0m
spawn bash
 

jjia@yow-jjia-lx:~/wassp-repos/testcases/cgcs/cgcs2.0/sprint/us49035_vcpu_scale_up_down/test_us49035_ts1_vcpu_scale_up_down$  
jjia@yow-jjia-lx:~/wassp-repos/testcases/cgcs/cgcs2.0/sprint/us49035_vcpu_scale_up_down/test_us49035_ts1_vcpu_scale_up_down$ 
jjia@yow-jjia-lx:~/wassp-repos/testcases/cgcs/cgcs2.0/sprint/us49035_vcpu_scale_up_down/test_us49035_ts1_vcpu_scale_up_down$ 
jjia@yow-jjia-lx:~/wassp-repos/testcases/cgcs/cgcs2.0/sprint/us49035_vcpu_scale_up_down/test_us49035_ts1_vcpu_scale_up_down$ PS1="[0;32m
expect-lite directive: *NOFAIL [0m
[0;32m
expect-lite directive: *EXP_INFO [0m
[\u@\h:\w]\$ "
[jjia@yow-jjia-lx:~/wassp-repos/testcases/cgcs/cgcs2.0/sprint/us49035_vcpu_scale_up_down/test_us49035_ts1_vcpu_scale_up_down]$ 
[jjia@yow-jjia-lx:~/wassp-repos/testcases/cgcs/cgcs2.0/sprint/us49035_vcpu_scale_up_down/test_us49035_ts1_vcpu_scale_up_down]$ date +%F_%T
2015-02-05_10:33:28
[jjia@yow-jjia-lx:~/wassp-repos/testcases/cgcs/cgcs2.0/sprint/us49035_vcpu_scale_up_down/test_us49035_ts1_vcpu_scale_up_down]$ [0;32m
Assigned Var:DATE=2015-02-05_10:33:28 
[0m
[0;32m

Setting Expect Timeout to: 2 

[0m
[0;32mINFO: CONST FOUND: HOST_IP = 128.224.150.199[0m
[1;34m
 === connecting to controller
[0m
ssh -X -o UserKnownHostsFIle=/dev/null -o Stric tHostKeyChecking=no wrsroot@128.224.150.199
ssh: /home/jjia/wassp-repos/.venv_wassp/lib/libcrypto.so.1.0.0: no version information available (required by ssh)
ssh: /home/jjia/wassp-repos/.venv_wassp/lib/libcrypto.so.1.0.0: no version information available (required by ssh)
Warning: Permanently added '128.224.150.199' (ECDSA) to the list of known hosts.
Wind River Linux 5.0.1.0
------------------------------------------------------------------------
W A R N I N G *** W A R N I N G *** W A R N I N G *** W A R N I N G *** 
------------------------------------------------------------------------
THIS IS A PRIVATE COMPUTER SYSTEM.
This computer system including all related equipment, network devices
(specifically including Internet access), are provided only for authorized use.
All computer systems may be monitored for all lawful purposes, including to
ensure that their use is authorized, for management of the system, to
facilitate protection against unauthorized access, and to verify security
procedures, survivability and operational security. Monitoring includes active
attacks by authorized personnel and their entities to test or verify the
security of the system. During monitoring, information may be examined,
recorded, copied and used for authorized purposes. All information including
personal information, placed on or sent over this system may be monitored. Uses
of this system, authorized or unauthorized, constitutes consent to monitoring
of this system. Unauthorized use may subject you to criminal prosecution.
Evidence of any such unauthorized use collected during monitoring may be used
for administrative, criminal or other adverse action. Use of this system
constitutes consent to monitoring for these purposes.

Password: [0;32m<ssword:[0m

Warning: No xauth data; using fake authentication data for X11 forwarding.
X11 forwarding request failed on channel 0
Last login: Thu Feb  5 15:32:42 2015 from 128.224.144.162
[H[2J
WARNING: Unauthorized access to this system is forbidden and will be
prosecuted by law. By accessing this system, you agree that your
actions may be monitored if unauthorized usage is suspected.


====================================================================
         SYSTEM: yow-cgcs-hp380-1_4
====================================================================

Thu Feb  5 15:33:16 UTC 2015
controller-0:~$ export TMOUT=0
Thu Feb  5 15:33:16 UTC 2015
controller-0:~$ [1;34m
 === become admin
[0m
source /etc/nova/openrc
Thu Feb  5 15:33:16 UTC 2015
[wrsroot@controller-0 ~(keystone_admin)]$ [1;34m
 === show version
[0m
system show
+------------------+-------------------------------------------+
| Property         | Value                                     |
+------------------+-------------------------------------------+
| name             | yow-cgcs-hp380-1_4                        |
| description      | yow-cgcs-hp380-1_4: setup by lab_setup.sh |
| location         | None                                      |
| contact          | None                                      |
| software_version | 14.10 3.4.103-ovp-ga2-rt120-r5_standard   |
| uuid             | 447008ec-d4cb-443e-abfc-abc15fa7bc05      |
| created_at       | 2015-02-04T02:28:21.217852+00:00          |
| updated_at       | 2015-02-05T15:19:49.673571+00:00          |
+------------------+-------------------------------------------+
Thu Feb  5 15:33:17 UTC 2015
[wrsroot@controller-0 ~(keystone_admin)]$ cat /etc/build.info
###
### Wind River Titanium Server
###     Release 14.10
###
###     Wind River Systems, Inc.
###

SW_VERSION="14.10"
BUILD_TARGET="Host Installer"
BUILD_TYPE="Formal"
BUILD_ID="2015-01-18_21-04-50"

JOB="CGCS_1.0_Unified_Daily_Build"
BUILD_BY="jenkins"
BUILD_NUMBER="471"
BUILD_HOST="yow-cgts2-lx"
BUILD_DATE="2015-01-18 21:04:53 -0500"
Thu Feb  5 15:33:17 UTC 2015
[wrsroot@controller-0 ~(keystone_admin)]$ [1;34m
 === show system status
[0m
nova service-list
+------------------+--------------+----------+---------+------------+-------+----------------------------+-----------------+
| Binary           | Host         | Zone     | Status  | Maint Mode | State | Updated_at                 | Disabled Reason |
+------------------+--------------+----------+---------+------------+-------+----------------------------+-----------------+
| nova-conductor   | controller-1 | internal | enabled | disabled   | down  | 2015-02-05T04:16:39.168025 | -               |
| nova-scheduler   | controller-1 | internal | enabled | disabled   | down  | 2015-02-05T04:16:39.203819 | -               |
| nova-consoleauth | controller-1 | internal | enabled | disabled   | down  | 2015-02-05T04:16:39.271516 | -               |
| nova-cert        | controller-1 | internal | enabled | disabled   | down  | 2015-02-05T04:16:39.301624 | -               |
| nova-compute     | compute-0    | nova     | enabled | disabled   | up    | 2015-02-05T15:33:10.058064 | -               |
| nova-scheduler   | controller-0 | internal | enabled | disabled   | up    | 2015-02-05T15:33:10.106673 | -               |
| nova-conductor   | controller-0 | internal | enabled | disabled   | up    | 2015-02-05T15:33:10.328665 | -               |
| nova-compute     | compute-1    | nova     | enabled | disabled   | up    | 2015-02-05T15:33:10.458810 | -               |
| nova-consoleauth | controller-0 | internal | enabled | disabled   | up    | 2015-02-05T15:33:11.536116 | -               |
| nova-cert        | controller-0 | internal | enabled | disabled   | up    | 2015-02-05T15:33:11.564102 | -               |
+------------------+--------------+----------+---------+------------+-------+----------------------------+-----------------+
Thu Feb  5 15:33:18 UTC 2015
[wrsroot@controller-0 ~(keystone_admin)]$ [1;34m
 === validate that controllers and computes are present
[0m
system host-list
+----+--------------+-------------+----------------+-------------+--------------+
| id | hostname     | personality | administrative | operational | availability |
+----+--------------+-------------+----------------+-------------+--------------+
| 1  | controller-0 | controller  | unlocked       | enabled     | available    |
| 2  | controller-1 | controller  | unlocked       | enabled     | available    |
| 3  | compute-0    | compute     | unlocked       | enabled     | available    |
| 4  | compute-1    | compute     | unlocked       | enabled     | available    |
+----+--------------+-------------+----------------+-------------+--------------+
[0;32m<controller-0[0m
[0;32m<controller-1[0m
[0;32m<compute-0[0m
[0;32m<compute-1[0m
Thu Feb  5 15:33:19 UTC 2015
[wrsroot@controller-0 ~(keystone_admin)]$ [0;32m
Assigned Var:last_compute=compute
[0m
[0;32m
If: expr { "compute" != "compute" } |then   [|result=FALSE
[0m
[1;34m
 === Do valid lab_Setup
[0m
[0;32m
If: expr { "yes" == "yes" } |then   [|result=TRUE
[0m
[1;34m
 === validate lab_setup script
[0m
ls lab_setup.sh
lab_setup.sh
Thu Feb  5 15:33:19 UTC 2015
[wrsroot@controller-0 ~(keystone_admin)]$ [0;32m<
lab_setup.sh[0m
ls lab_setup.conf
lab_setup.conf
Thu Feb  5 15:33:19 UTC 2015
[wrsroot@controller-0 ~(keystone_admin)]$ [0;32m<
lab_setup.conf[0m
[1;34m
 === use lab_setup to configure compute nodes, interfaces, provider networks, tenant networks, images, flavors. Ready to boot VMs
[0m
[0;32m

Setting Expect Timeout to: 600 

[0m
time ./lab_setup.sh
Checking for required files
Setting system name
+------------------+-------------------------------------------+
| Property         | Value                                     |
+------------------+-------------------------------------------+
| name             | yow-cgcs-hp380-1_4                        |
| description      | yow-cgcs-hp380-1_4: setup by lab_setup.sh |
| location         | None                                      |
| contact          | None                                      |
| software_version | 14.10 3.4.103-ovp-ga2-rt120-r5_standard   |
| uuid             | 447008ec-d4cb-443e-abfc-abc15fa7bc05      |
| created_at       | 2015-02-04T02:28:21.217852+00:00          |
| updated_at       | 2015-02-05T15:19:49.673571+00:00          |
+------------------+-------------------------------------------+
Adding tenants
Adding tenant credentials
Adding tenant quotas
+---------------------+-------+
| Field               | Value |
+---------------------+-------+
| floatingip          | 50    |
| network             | 5     |
| port                | 19    |
| router              | 10    |
| security_group      | 10    |
| security_group_rule | 100   |
| subnet              | 5     |
+---------------------+-------+
ERROR (BadRequest): Quota value 6 for cores are greater than already used and reserved 7 (HTTP 400) (Request-ID: req-8dcdefab-5ddd-41ed-9b08-94d5becea40f)

real	0m12.714s
user	0m7.549s
sys	0m1.539s
[0;32m<
real[0m
[0;32m

Setting Expect Timeout to: 10 

[0m
Thu Feb  5 15:33:32 UTC 2015
[wrsroot@controller-0 ~(keystone_admin)]$ [1;34m
 === unlock computes
[0m
system host-unlock compute-0
Avoiding 'unlock' action on already 'unlocked' host compute-0
Thu Feb  5 15:33:33 UTC 2015
[wrsroot@controller-0 ~(keystone_admin)]$ system host-unlock compute-1
Avoiding 'unlock' action on already 'unlocked' host compute-1
Thu Feb  5 15:33:34 UTC 2015
[wrsroot@controller-0 ~(keystone_admin)]$ system host-list | grep compute-1
| 4  | compute-1    | compute     | unlocked       | enabled     | available    |
Thu Feb  5 15:33:35 UTC 2015
[wrsroot@controller-0 ~(keystone_admin)]$ [0;32m
Assigned Var:avail=available
[0m
[0;32m
While: expr { "available" != "available" } |result=FALSE
[0m
system host-list
+----+--------------+-------------+----------------+-------------+--------------+
| id | hostname     | personality | administrative | operational | availability |
+----+--------------+-------------+----------------+-------------+--------------+
| 1  | controller-0 | controller  | unlocked       | enabled     | available    |
| 2  | controller-1 | controller  | unlocked       | enabled     | available    |
| 3  | compute-0    | compute     | unlocked       | enabled     | available    |
| 4  | compute-1    | compute     | unlocked       | enabled     | available    |
+----+--------------+-------------+----------------+-------------+--------------+
Thu Feb  5 15:33:36 UTC 2015
[wrsroot@controller-0 ~(keystone_admin)]$ [1;34m
 === Create necessary flavors and set minimum vcpu value
[0m
nova flavor-create --dedicated-cpus True vcpu4-1 5f0d748b-1c8b-4a70-1985-4d57e25ac137 512 0 4
+--------------------------------------+---------+-----------+------+-----------+------+-------+-------------+-----------+------------+
| ID                                   | Name    | Memory_MB | Disk | Ephemeral | Swap | VCPUs | RXTX_Factor | Is_Public | VCPU_Model |
+--------------------------------------+---------+-----------+------+-----------+------+-------+-------------+-----------+------------+
| 5f0d748b-1c8b-4a70-1985-4d57e25ac137 | vcpu4-1 | 512       | 0    | 0         |      | 4     | 1.0         | True      | -          |
+--------------------------------------+---------+-----------+------+-----------+------+-------+-------------+-----------+------------+
Thu Feb  5 15:33:37 UTC 2015
[wrsroot@controller-0 ~(keystone_admin)]$ echo $?
0
Thu Feb  5 15:33:37 UTC 2015
[wrsroot@controller-0 ~(keystone_admin)]$ [0;32m<
0[0m
nova flavor-create --dedicated-cpus True vcpu5-2 db9b37f5-cba5-1985-a264-a6c1375a4ff7 512 0 5
+--------------------------------------+---------+-----------+------+-----------+------+-------+-------------+-----------+------------+
| ID                                   | Name    | Memory_MB | Disk | Ephemeral | Swap | VCPUs | RXTX_Factor | Is_Public | VCPU_Model |
+--------------------------------------+---------+-----------+------+-----------+------+-------+-------------+-----------+------------+
| db9b37f5-cba5-1985-a264-a6c1375a4ff7 | vcpu5-2 | 512       | 0    | 0         |      | 5     | 1.0         | True      | -          |
+--------------------------------------+---------+-----------+------+-----------+------+-------+-------------+-----------+------------+
Thu Feb  5 15:33:38 UTC 2015
[wrsroot@controller-0 ~(keystone_admin)]$ echo $?
0
Thu Feb  5 15:33:38 UTC 2015
[wrsroot@controller-0 ~(keystone_admin)]$ [0;32m<
0[0m
[1;34m
 === flavor created
[0m
nova flavor-list | grep vcpu4-1
| 5f0d748b-1c8b-4a70-1985-4d57e25ac137 | vcpu4-1                               | 512       | 0    | 0         |      | 4     | 1.0         | True      | -           |
Thu Feb  5 15:33:39 UTC 2015
[wrsroot@controller-0 ~(keystone_admin)]$ nova flavor-list | grep vcpu5-2
| db9b37f5-cba5-1985-a264-a6c1375a4ff7 | vcpu5-2                               | 512       | 0    | 0         |      | 5     | 1.0         | True      | -           |
Thu Feb  5 15:33:40 UTC 2015
[wrsroot@controller-0 ~(keystone_admin)]$ [1;34m
 === set minimum value for the cpu created
[0m
nova flavor-key vcpu4-1 set wrs:min_vcpus=1 processor:node=0
Thu Feb  5 15:33:41 UTC 2015
[wrsroot@controller-0 ~(keystone_admin)]$ nova flavor-list --extra-specs | grep vcpu4-1
| 5f0d748b-1c8b-4a70-1985-4d57e25ac137 | vcpu4-1                               | 512       | 0    | 0         |      | 4     | 1.0         | True      | -           | {u'dedicated:cpus': u'True', u'guest:heartbeat': u'False', u'processor:node': u'0', u'wrs:min_vcpus': u'1'} |
Thu Feb  5 15:33:42 UTC 2015
[wrsroot@controller-0 ~(keystone_admin)]$ [0;32m
Assigned Var:result=1
[0m
[1;34m
 === Minimum CPU value set for vcpu4-1 is 1
[0m
nova flavor-key vcpu5-2 set wrs:min_vcpus=2
Thu Feb  5 15:33:43 UTC 2015
[wrsroot@controller-0 ~(keystone_admin)]$ nova flavor-list --extra-specs | grep vcpu5-2
| db9b37f5-cba5-1985-a264-a6c1375a4ff7 | vcpu5-2                               | 512       | 0    | 0         |      | 5     | 1.0         | True      | -           | {u'dedicated:cpus': u'True', u'guest:heartbeat': u'False', u'wrs:min_vcpus': u'2'}                          |
Thu Feb  5 15:33:44 UTC 2015
[wrsroot@controller-0 ~(keystone_admin)]$ [0;32m
Assigned Var:result=2
[0m
[1;34m
 === Minimum CPU value set for vcpu5-2 is 2
[0m
[1;34m
 === get tenant uuids
[0m
keystone tenant-list
+----------------------------------+----------+---------+
|                id                |   name   | enabled |
+----------------------------------+----------+---------+
| 1e17286a61104702bc2a3b6ef5467af9 |  admin   |   True  |
| a318972360584e319782fcc2282c8bee | services |   True  |
| a4e3a58f85e344c9b238f99045ee9e4e | tenant1  |   True  |
| e2a088214fe747c59a24256d3e02eb7f | tenant2  |   True  |
+----------------------------------+----------+---------+
[0;32m<name[0m
Thu Feb  5 15:33:45 UTC 2015
[wrsroot@controller-0 ~(keystone_admin)]$ [0;32m
Assigned Var:tenant_uuid=a4e3a58f85e344c9b238f99045ee9e4e
[0m
[1;34m
 === get tenant id
[0m
keystone user-list
+----------------------------------+------------+---------+----------------------+
|                id                |    name    | enabled |        email         |
+----------------------------------+------------+---------+----------------------+
| 5889d8c0e6274cb3923e9aac43d216c3 |   admin    |   True  |   admin@localhost    |
| db6f987048614bfeaa580cdd9f9baa7e | ceilometer |   True  | ceilometer@localhost |
| 4ed222a140204e6fa5a5f17af72f1877 |   cinder   |   True  |   cinder@localhost   |
| c992eed28b814f998e67dbc4322ee138 |   glance   |   True  |   glance@localhost   |
| 92b10c41dcae4a6280ab675c657a1e4a |    heat    |   True  |    heat@localhost    |
| b2e344598b624f12ab516d300556f71a |  neutron   |   True  |  neutron@localhost   |
| 6425a7a5c9b54761a81aaa71a18de55e |    nova    |   True  |    nova@localhost    |
| c550b3e687544b4c9a90380754ac659f |  patching  |   True  |  patching@localhost  |
| 1a105c6520364f29b40e8a01a8ae2ff3 | power_mgmt |   True  | power_mgmt@localhost |
| bd504f2f6f254d5f9d075cd079926ada |   sysinv   |   True  |   sysinv@localhost   |
| 49be897e674a4456af937371ecfa936d |  tenant1   |   True  | tenant1@noreply.com  |
| 52389e4935fc49f39699d21cd188dc09 |  tenant2   |   True  | tenant2@noreply.com  |
+----------------------------------+------------+---------+----------------------+
Thu Feb  5 15:33:46 UTC 2015
[wrsroot@controller-0 ~(keystone_admin)]$ keystone user-list | grep tenant1
| 49be897e674a4456af937371ecfa936d |  tenant1   |   True  | tenant1@noreply.com  |
Thu Feb  5 15:33:47 UTC 2015
[wrsroot@controller-0 ~(keystone_admin)]$ [0;32m
Assigned Var:tenant_user_id=49be897e674a4456af937371ecfa936d
[0m
[1;34m
 === increase quotas for test
[0m
nova quota-update --instances 30 a4e3a58f85e344c9b238f99045ee9e4e
Thu Feb  5 15:33:48 UTC 2015
[wrsroot@controller-0 ~(keystone_admin)]$ nova quota-update --cores 60 a4e3a58f85e344c9b238f99045ee9e4e
Thu Feb  5 15:33:49 UTC 2015
[wrsroot@controller-0 ~(keystone_admin)]$ nova quota-show --tenant a4e3a58f85e344c9b238f99045ee9e4e
+-----------------------------+-------+
| Quota                       | Limit |
+-----------------------------+-------+
| instances                   | 30    |
| cores                       | 60    |
| ram                         | 51200 |
| floating_ips                | 3     |
| fixed_ips                   | -1    |
| metadata_items              | 128   |
| injected_files              | 5     |
| injected_file_content_bytes | 10240 |
| injected_file_path_bytes    | 255   |
| key_pairs                   | 100   |
| security_groups             | 10    |
| security_group_rules        | 20    |
+-----------------------------+-------+
Thu Feb  5 15:33:50 UTC 2015
[wrsroot@controller-0 ~(keystone_admin)]$ neutron quota-update --port 60 --tenant-id a4e3a58f85e344c9b238f99045ee9e4e
+---------------------+-------+
| Field               | Value |
+---------------------+-------+
| floatingip          | 50    |
| network             | 5     |
| port                | 60    |
| router              | 10    |
| security_group      | 10    |
| security_group_rule | 100   |
| subnet              | 5     |
+---------------------+-------+
Thu Feb  5 15:33:50 UTC 2015
[wrsroot@controller-0 ~(keystone_admin)]$ cinder quota-update --volumes 30 a4e3a58f85e344c9b238f99045ee9e4e
Thu Feb  5 15:33:51 UTC 2015
[wrsroot@controller-0 ~(keystone_admin)]$ cinder quota-show a4e3a58f85e344c9b238f99045ee9e4e
+-----------+-------+
|  Property | Value |
+-----------+-------+
| gigabytes |  1000 |
| snapshots |   3   |
|  volumes  |   30  |
+-----------+-------+
Thu Feb  5 15:33:52 UTC 2015
[wrsroot@controller-0 ~(keystone_admin)]$ [1;34m
 === switch to tenant mode
[0m
source /home/wrsroot/openrc.tenant1
Thu Feb  5 15:33:52 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ [1;34m
 === copy heat template to /home/wrsroot/ 
[0m
find . -iname VMAutoScaling.yaml
./VMAutoScaling.yaml
./wrs-heat-templates-1.1.0/hot/scenarios/VMAutoScaling.yaml
./heat/product/hot/scenarios/VMAutoScaling.yaml
./heat/hot/scenarios/VMAutoScaling.yaml
./heat/wrs-heat-templates-1.1.0/hot/scenarios/VMAutoScaling.yaml
Thu Feb  5 15:33:52 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ [0;32m
Assigned Var:result= ./wrs-heat-templates-1.1.0/hot/scenarios/VMAutoScaling.yaml
[0m
cp  ./wrs-heat-templates-1.1.0/hot/scenarios/VMAutoScaling.yaml .
Thu Feb  5 15:33:52 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ [1;34m
 === change the cool down period to 20 secs from 60 secs
[0m
sed -i "s/Cooldown: '60'/Cooldown: '20'/g" VMAutoScaling.yaml
Thu Feb  5 15:33:52 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ [1;34m
 === Scale UP with No available host cpu on NUMA node
[0m
sed -i "s/period: '60'/period: '120'/g" VMAutoScaling.yaml
Thu Feb  5 15:33:52 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ [1;34m
 === State of NUMA0 before launching heat stack
[0m
vm-topology -s computes 
libnuma: Warning: Cannot parse sysfs meminfo (3)
vm-topology: 2015-02-05T15:33:52.947625  options: show:['computes']

COMPUTE HOSTS:  Legend: U = Used, F = Free, list = [node[i], ...], C = cpulist
+-----------+----------------------------------------------+-------------+-----------+------+------+---------+-------+---------+----------+----------+---------+------------+--------+----------+--------------+---------+
| Host      | Aggregate                                    | model       | topology  | numa | cpus | servers | pcpus | U:vcpus | F:pinned | F:float  | C:float | C:reserved | memory | U:memory | F:memory     | status  |
+-----------+----------------------------------------------+-------------+-----------+------+------+---------+-------+---------+----------+----------+---------+------------+--------+----------+--------------+---------+
| compute-0 | provider_group0-data1, provider_group0-data0 | SandyBridge | 1s,10c,1t |    2 |   20 |       0 |    17 |       0 | 7, 10    | 112, 160 | 3-19    | -          | 118802 |      300 | 58042, 60460 | enabled |
| compute-1 | provider_group0-data1, provider_group0-data0 | SandyBridge | 1s,10c,1t |    2 |   20 |       0 |    17 |       0 | 7, 10    | 112, 160 | 3-19    | -          | 118802 |      300 | 58042, 60460 | enabled |
| count: 2  | -                                            | -           | -         |    - |    - |       0 |    34 |       0 | -        | -        | -       | -          | 237604 |      600 | -            | -       |
+-----------+----------------------------------------------+-------------+-----------+------+------+---------+-------+---------+----------+----------+---------+------------+--------+----------+--------------+---------+
[0;32m<compute-0[0m
Thu Feb  5 15:33:54 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ [0;32m
Assigned Var:compute0_numa0=7
[0m
[0;32m<compute-1[0m
[0;32m
Assigned Var:compute1_numa0=7
[0m
[1;34m
 === create STACK1 heat stack on same NUMA0
[0m
heat stack-create -f VMAutoScaling.yaml -P TenantUserId=49be897e674a4456af937371ecfa936d -P PrivateNetName=tenant1-mgmt-net -P Ins tanceName=guest1 -P FlavorName=vcpu4-1 -P ImageName=cgcs-guest -P CustomMeterName=vote -P KeyName=keypair-tenant1 STACK1
+--------------------------------------+------------+--------------------+----------------------+
| id                                   | stack_name | stack_status       | creation_time        |
+--------------------------------------+------------+--------------------+----------------------+
| 95fbb906-3b78-42bd-bd72-6273c09a1979 | STACK1     | CREATE_IN_PROGRESS | 2015-02-05T15:33:55Z |
+--------------------------------------+------------+--------------------+----------------------+
Thu Feb  5 15:33:55 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ [1;34m
 === wait and check if heat stack1 create_complete
[0m
heat stack-show STACK1
+----------------------+-------------------------------------------------------------------------------------------------------------------------------+
| Property             | Value                                                                                                                         |
+----------------------+-------------------------------------------------------------------------------------------------------------------------------+
| capabilities         | []                                                                                                                            |
| creation_time        | 2015-02-05T15:33:55Z                                                                                                          |
| description          | Creates a HEAT autoscaling stack and a VM instance                                                                            |
|                      | which is able to scale up/down the number of guest                                                                            |
|                      | vpcu's based on vcpu_util on the guest instance. Note:                                                                        |
|                      | This uses the HOT template                                                                                                    |
| disable_rollback     | True                                                                                                                          |
| id                   | 95fbb906-3b78-42bd-bd72-6273c09a1979                                                                                          |
| links                | http://128.224.150.189:8004/v1/a4e3a58f85e344c9b238f99045ee9e4e/stacks/STACK1/95fbb906-3b78-42bd-bd72-6273c09a1979            |
| notification_topics  | []                                                                                                                            |
| outputs              | []                                                                                                                            |
| parameters           | {                                                                                                                             |
|                      |   "PrivateNetName": "tenant1-mgmt-net",                                                                                       |
|                      |   "InstanceName": "guest1",                                                                                                   |
|                      |   "AWS::StackName": "STACK1",                                                                                                 |
|                      |   "CustomMeterName": "vote",                                                                                                  |
|                      |   "FlavorName": "vcpu4-1",                                                                                                    |
|                      |   "KeyName": "keypair-tenant1",                                                                                               |
|                      |   "AWS::StackId": "arn:openstack:heat::a4e3a58f85e344c9b238f99045ee9e4e:stacks/STACK1/95fbb906-3b78-42bd-bd72-6273c09a1979",  |
|                      |   "ImageName": "cgcs-guest",                                                                                                  |
|                      |   "MetricLowWaterMark": "5",                                                                                                  |
|                      |   "AWS::Region": "ap-southeast-1",                                                                                            |
|                      |   "TenantUserId": "49be897e674a4456af937371ecfa936d",                                                                         |
|                      |   "MetricHighWaterMark": "60"                                                                                                 |
|                      | }                                                                                                                             |
| stack_name           | STACK1                                                                                                                        |
| stack_status         | CREATE_COMPLETE                                                                                                               |
| stack_status_reason  | Stack create completed successfully                                                                                           |
| template_description | Creates a HEAT autoscaling stack and a VM instance                                                                            |
|                      | which is able to scale up/down the number of guest                                                                            |
|                      | vpcu's based on vcpu_util on the guest instance. Note:                                                                        |
|                      | This uses the HOT template                                                                                                    |
| timeout_mins         | 60                                                                                                                            |
| updated_time         | 2015-02-05T15:34:09Z                                                                                                          |
+----------------------+-------------------------------------------------------------------------------------------------------------------------------+
[0;32m<stack_status[0m
[0;32m<CREATE_COMPLETE[0m
[1;34m
 === find the compute on which guest1 booted
[0m
Thu Feb  5 15:34:41 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ [0;32m

Setting Expect Timeout to: 25 

[0m
time vm-topology -s servers | grep guest1
[0;32m<guest1[0m
libnuma: Warning: Cannot parse sysfs meminfo (3)
| tenant1 | 6eabdf2e-d81f-4f9f-87f7-9eebf14ccd38 | instance-0000006e | guest1 | compute-1 | active   | None       | Running     | -            | vcpu4-1 | pinned |        None | 1,4,4 |    512 |        0 | 3-6     |    yes     |

real	0m1.365s
user	0m0.779s
sys	0m0.175s
Thu Feb  5 15:34:43 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ [0;32m
Assigned Var:guest1_compute=compute-1
[0m
[1;34m
 scale down guest1 to the minimum cpu value
[0m
[1;34m
 === save the current state of guest1 cpu
[0m
vm-topology -s servers
libnuma: Warning: Cannot parse sysfs meminfo (3)
vm-topology: 2015-02-05T15:34:43.705017  options: show:['servers']

SERVERS (nova view):  Legend: cpulist = [cpu_id[i], ...], S = siblings, R = reserved
+---------+--------------------------------------+-------------------+--------+-----------+----------+------------+-------------+--------------+---------+--------+-------------+-------+--------+----------+---------+------------+
| tenant  | ID                                   | instance_name     | name   | host      | vm_state | task_state | power_state | server_group | flavor  | pinned | shared_vcpu | vcpus | memory | numanode | cpulist | in_libvirt |
+---------+--------------------------------------+-------------------+--------+-----------+----------+------------+-------------+--------------+---------+--------+-------------+-------+--------+----------+---------+------------+
| tenant1 | 6eabdf2e-d81f-4f9f-87f7-9eebf14ccd38 | instance-0000006e | guest1 | compute-1 | active   | None       | Running     | -            | vcpu4-1 | pinned |        None | 1,4,4 |    512 |        0 | 3-6     |    yes     |
+---------+--------------------------------------+-------------------+--------+-----------+----------+------------+-------------+--------------+---------+--------+-------------+-------+--------+----------+---------+------------+
[0;32m<guest1[0m
Thu Feb  5 15:34:44 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ [0;32m
Assigned Var:min_cpu=1
[0m
[0;32m
Assigned Var:cur_cpu=4
[0m
[0;32m
Assigned Var:max_cpu=4
[0m
[1;34m
=== scale down guest1 cpu to the minimum value:1
[0m
[0;32m
While: expr { "1" < "4" } |result=TRUE
[0m
[0;32m

Setting Expect Timeout to: 25 

[0m
nova scale guest1 cpu down
Thu Feb  5 15:34:48 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ echo $?
0
Thu Feb  5 15:34:48 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ [0;32m<
0[0m
[0;32m
While: expr { "1" < "3" } |result=TRUE
[0m
[0;32m

Setting Expect Timeout to: 25 

[0m
nova scale guest1 cpu down
Thu Feb  5 15:34:51 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ echo $?
0
Thu Feb  5 15:34:51 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ [0;32m<
0[0m
[0;32m
While: expr { "1" < "2" } |result=TRUE
[0m
[0;32m

Setting Expect Timeout to: 25 

[0m
nova scale guest1 cpu down
Thu Feb  5 15:34:55 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ echo $?
0
Thu Feb  5 15:34:55 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ [0;32m<
0[0m
[0;32m
While: expr { "1" < "1" } |result=FALSE
[0m
[1;34m
 === check if guest1 current cpu value reached minimum cpu value:1
[0m
nova show guest1
+--------------------------------------+----------------------------------------------------------------------------------------------------------------------------------+
| Property                             | Value                                                                                                                            |
+--------------------------------------+----------------------------------------------------------------------------------------------------------------------------------+
| OS-DCF:diskConfig                    | MANUAL                                                                                                                           |
| OS-EXT-AZ:availability_zone          | nova                                                                                                                             |
| OS-EXT-STS:power_state               | 1                                                                                                                                |
| OS-EXT-STS:task_state                | -                                                                                                                                |
| OS-EXT-STS:vm_state                  | active                                                                                                                           |
| OS-SRV-USG:launched_at               | 2015-02-05T15:34:05.103881                                                                                                       |
| OS-SRV-USG:terminated_at             | -                                                                                                                                |
| accessIPv4                           |                                                                                                                                  |
| accessIPv6                           |                                                                                                                                  |
| config_drive                         |                                                                                                                                  |
| created                              | 2015-02-05T15:33:56Z                                                                                                             |
| extended                             | {"cpuset": 8, "numanode": 0, "siblings_cpuset": null}                                                                            |
| flavor                               | vcpu4-1 (5f0d748b-1c8b-4a70-1985-4d57e25ac137)                                                                                   |
| hostId                               | 1ea8da9884e6179694739654aaa506b2817ea351d58559c80c37d716                                                                         |
| id                                   | 6eabdf2e-d81f-4f9f-87f7-9eebf14ccd38                                                                                             |
| image                                | cgcs-guest (7aeabc04-8b05-44fa-bfe6-07d6dfbfc6ea)                                                                                |
| key_name                             | keypair-tenant1                                                                                                                  |
| metadata                             | {}                                                                                                                               |
| name                                 | guest1                                                                                                                           |
| nics                                 | {"nic1": {"vif_model": "virtio", "port_id": "430c73c2-efa5-4bad-99ba-f3e4aeb92191", "network": "tenant1-mgmt-net", "mtu": 1500}} |
| os-extended-volumes:volumes_attached | []                                                                                                                               |
| pinned                               | True                                                                                                                             |
| progress                             | 0                                                                                                                                |
| server_group                         |                                                                                                                                  |
| status                               | ACTIVE                                                                                                                           |
| tenant1-mgmt-net network             | 192.168.109.17                                                                                                                   |
| tenant_id                            | a4e3a58f85e344c9b238f99045ee9e4e                                                                                                 |
| updated                              | 2015-02-05T15:34:54Z                                                                                                             |
| user_id                              | 49be897e674a4456af937371ecfa936d                                                                                                 |
| vcpus (min/cur/max)                  | [1, 1, 4]                                                                                                                        |
+--------------------------------------+----------------------------------------------------------------------------------------------------------------------------------+
[0;32m<min/cur/max[0m
Thu Feb  5 15:34:56 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ [0;32m
Assigned Var:min_cpu=1
[0m
[0;32m
Assigned Var:cur_cpu=1
[0m
[0;32m
Assigned Var:max_cpu=4
[0m
[0;32m
If: expr { "1" != "1" } |then   [|result=FALSE
[0m
[1;34m
 === guest1 scale down should fail beyond minimum limit: 1
[0m
vm-topology -s servers
libnuma: Warning: Cannot parse sysfs meminfo (3)
vm-topology: 2015-02-05T15:34:57.353831  options: show:['servers']

SERVERS (nova view):  Legend: cpulist = [cpu_id[i], ...], S = siblings, R = reserved
+---------+--------------------------------------+-------------------+--------+-----------+----------+------------+-------------+--------------+---------+--------+-------------+-------+--------+----------+---------+------------+
| tenant  | ID                                   | instance_name     | name   | host      | vm_state | task_state | power_state | server_group | flavor  | pinned | shared_vcpu | vcpus | memory | numanode | cpulist | in_libvirt |
+---------+--------------------------------------+-------------------+--------+-----------+----------+------------+-------------+--------------+---------+--------+-------------+-------+--------+----------+---------+------------+
| tenant1 | 6eabdf2e-d81f-4f9f-87f7-9eebf14ccd38 | instance-0000006e | guest1 | compute-1 | active   | None       | Running     | -            | vcpu4-1 | pinned |        None | 1,1,4 |    512 |        0 | 3       |    yes     |
+---------+--------------------------------------+-------------------+--------+-----------+----------+------------+-------------+--------------+---------+--------+-------------+-------+--------+----------+---------+------------+
Thu Feb  5 15:34:58 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ nova scale guest1 cpu down
ERROR (BadRequest): When scaling, cannot scale beyond limits! (HTTP 400) (Request-ID: req-32736155-75fd-4d24-88bd-f90e0c604f14)
Thu Feb  5 15:34:59 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ echo $?
1
Thu Feb  5 15:34:59 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ [0;32m<
1[0m
[1;34m
 === scale down of guest1 completed
[0m
heat stack-create -f VMAutoScaling.yaml -P TenantUserId=49be897e674a4456af937371ecfa936d -P PrivateNetName=tenant1-mgmt-net -P Ins tanceName=guest2 -P FlavorName=vcpu4-1 -P ImageName=cgcs-guest -P CustomMeterName=vote -P KeyName=keypair-tenant1 STACK2
+--------------------------------------+------------+--------------------+----------------------+
| id                                   | stack_name | stack_status       | creation_time        |
+--------------------------------------+------------+--------------------+----------------------+
| 95fbb906-3b78-42bd-bd72-6273c09a1979 | STACK1     | CREATE_COMPLETE    | 2015-02-05T15:33:55Z |
| 7589f8e2-89d4-4328-96fd-1710a439916d | STACK2     | CREATE_IN_PROGRESS | 2015-02-05T15:35:01Z |
+--------------------------------------+------------+--------------------+----------------------+
Thu Feb  5 15:35:01 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ [1;34m
 === wait and check if heat stack2 create_complete
[0m
heat stack-show STACK2
+----------------------+-------------------------------------------------------------------------------------------------------------------------------+
| Property             | Value                                                                                                                         |
+----------------------+-------------------------------------------------------------------------------------------------------------------------------+
| capabilities         | []                                                                                                                            |
| creation_time        | 2015-02-05T15:35:01Z                                                                                                          |
| description          | Creates a HEAT autoscaling stack and a VM instance                                                                            |
|                      | which is able to scale up/down the number of guest                                                                            |
|                      | vpcu's based on vcpu_util on the guest instance. Note:                                                                        |
|                      | This uses the HOT template                                                                                                    |
| disable_rollback     | True                                                                                                                          |
| id                   | 7589f8e2-89d4-4328-96fd-1710a439916d                                                                                          |
| links                | http://128.224.150.189:8004/v1/a4e3a58f85e344c9b238f99045ee9e4e/stacks/STACK2/7589f8e2-89d4-4328-96fd-1710a439916d            |
| notification_topics  | []                                                                                                                            |
| outputs              | []                                                                                                                            |
| parameters           | {                                                                                                                             |
|                      |   "PrivateNetName": "tenant1-mgmt-net",                                                                                       |
|                      |   "InstanceName": "guest2",                                                                                                   |
|                      |   "AWS::StackName": "STACK2",                                                                                                 |
|                      |   "CustomMeterName": "vote",                                                                                                  |
|                      |   "FlavorName": "vcpu4-1",                                                                                                    |
|                      |   "KeyName": "keypair-tenant1",                                                                                               |
|                      |   "AWS::StackId": "arn:openstack:heat::a4e3a58f85e344c9b238f99045ee9e4e:stacks/STACK2/7589f8e2-89d4-4328-96fd-1710a439916d",  |
|                      |   "ImageName": "cgcs-guest",                                                                                                  |
|                      |   "MetricLowWaterMark": "5",                                                                                                  |
|                      |   "AWS::Region": "ap-southeast-1",                                                                                            |
|                      |   "TenantUserId": "49be897e674a4456af937371ecfa936d",                                                                         |
|                      |   "MetricHighWaterMark": "60"                                                                                                 |
|                      | }                                                                                                                             |
| stack_name           | STACK2                                                                                                                        |
| stack_status         | CREATE_COMPLETE                                                                                                               |
| stack_status_reason  | Stack create completed successfully                                                                                           |
| template_description | Creates a HEAT autoscaling stack and a VM instance                                                                            |
|                      | which is able to scale up/down the number of guest                                                                            |
|                      | vpcu's based on vcpu_util on the guest instance. Note:                                                                        |
|                      | This uses the HOT template                                                                                                    |
| timeout_mins         | 60                                                                                                                            |
| updated_time         | 2015-02-05T15:35:13Z                                                                                                          |
+----------------------+-------------------------------------------------------------------------------------------------------------------------------+
[0;32m<stack_status[0m
[0;32m<CREATE_COMPLETE[0m
[1;34m
 === find the compute on which guest2 booted
[0m
Thu Feb  5 15:35:47 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ [0;32m

Setting Expect Timeout to: 20 

[0m
time vm-topology -s servers | grep guest2
[0;32m<guest2[0m
libnuma: Warning: Cannot parse sysfs meminfo (3)
| tenant1 | 065c54c0-8e0e-4b7b-9f9f-38c15828e2b4 | instance-0000006f | guest2 | compute-1 | active   | None       | Running     | -            | vcpu4-1 | pinned |        None | 1,4,4 |    512 |        0 | 4-7     |    yes     |

real	0m1.823s
user	0m0.874s
sys	0m0.194s
Thu Feb  5 15:35:49 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ [0;32m
Assigned Var:guest2_compute=compute-1
[0m
[0;32m
If: expr { "compute-1" != "compute-1" } |then   ;red === guest1 and guest are not in same NUMA0|result=FALSE
[0m
[1;34m
 === save the current state of guest2 cpu
[0m
vm-topology -s servers
libnuma: Warning: Cannot parse sysfs meminfo (3)
vm-topology: 2015-02-05T15:35:49.787632  options: show:['servers']

SERVERS (nova view):  Legend: cpulist = [cpu_id[i], ...], S = siblings, R = reserved
+---------+--------------------------------------+-------------------+--------+-----------+----------+------------+-------------+--------------+---------+--------+-------------+-------+--------+----------+---------+------------+
| tenant  | ID                                   | instance_name     | name   | host      | vm_state | task_state | power_state | server_group | flavor  | pinned | shared_vcpu | vcpus | memory | numanode | cpulist | in_libvirt |
+---------+--------------------------------------+-------------------+--------+-----------+----------+------------+-------------+--------------+---------+--------+-------------+-------+--------+----------+---------+------------+
| tenant1 | 6eabdf2e-d81f-4f9f-87f7-9eebf14ccd38 | instance-0000006e | guest1 | compute-1 | active   | None       | Running     | -            | vcpu4-1 | pinned |        None | 1,1,4 |    512 |        0 | 3       |    yes     |
| tenant1 | 065c54c0-8e0e-4b7b-9f9f-38c15828e2b4 | instance-0000006f | guest2 | compute-1 | active   | None       | Running     | -            | vcpu4-1 | pinned |        None | 1,4,4 |    512 |        0 | 4-7     |    yes     |
+---------+--------------------------------------+-------------------+--------+-----------+----------+------------+-------------+--------------+---------+--------+-------------+-------+--------+----------+---------+------------+
[0;32m<guest2[0m
Thu Feb  5 15:35:51 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ [0;32m
Assigned Var:min_cpu=1
[0m
[0;32m
Assigned Var:cur_cpu=4
[0m
[0;32m
Assigned Var:max_cpu=4
[0m
[1;34m
=== scale down guest2 cpu to the minimum value:1
[0m
[0;32m
While: expr { "1" < "4" } |result=TRUE
[0m
[0;32m

Setting Expect Timeout to: 25 

[0m
nova scale guest2 cpu down
Thu Feb  5 15:35:54 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ echo $?
0
Thu Feb  5 15:35:54 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ [0;32m<
0[0m
[0;32m
While: expr { "1" < "3" } |result=TRUE
[0m
[0;32m

Setting Expect Timeout to: 25 

[0m
nova scale guest2 cpu down
Thu Feb  5 15:35:58 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ echo $?
0
Thu Feb  5 15:35:58 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ [0;32m<
0[0m
[0;32m
While: expr { "1" < "2" } |result=TRUE
[0m
[0;32m

Setting Expect Timeout to: 25 

[0m
nova scale guest2 cpu down
Thu Feb  5 15:36:01 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ echo $?
0
Thu Feb  5 15:36:01 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ [0;32m<
0[0m
[0;32m
While: expr { "1" < "1" } |result=FALSE
[0m
[1;34m
 === check if guest2 current cpu value reached minimum cpu value:1
[0m
nova show guest2
+--------------------------------------+----------------------------------------------------------------------------------------------------------------------------------+
| Property                             | Value                                                                                                                            |
+--------------------------------------+----------------------------------------------------------------------------------------------------------------------------------+
| OS-DCF:diskConfig                    | MANUAL                                                                                                                           |
| OS-EXT-AZ:availability_zone          | nova                                                                                                                             |
| OS-EXT-STS:power_state               | 1                                                                                                                                |
| OS-EXT-STS:task_state                | -                                                                                                                                |
| OS-EXT-STS:vm_state                  | active                                                                                                                           |
| OS-SRV-USG:launched_at               | 2015-02-05T15:35:10.810641                                                                                                       |
| OS-SRV-USG:terminated_at             | -                                                                                                                                |
| accessIPv4                           |                                                                                                                                  |
| accessIPv6                           |                                                                                                                                  |
| config_drive                         |                                                                                                                                  |
| created                              | 2015-02-05T15:35:02Z                                                                                                             |
| extended                             | {"cpuset": 16, "numanode": 0, "siblings_cpuset": null}                                                                           |
| flavor                               | vcpu4-1 (5f0d748b-1c8b-4a70-1985-4d57e25ac137)                                                                                   |
| hostId                               | 1ea8da9884e6179694739654aaa506b2817ea351d58559c80c37d716                                                                         |
| id                                   | 065c54c0-8e0e-4b7b-9f9f-38c15828e2b4                                                                                             |
| image                                | cgcs-guest (7aeabc04-8b05-44fa-bfe6-07d6dfbfc6ea)                                                                                |
| key_name                             | keypair-tenant1                                                                                                                  |
| metadata                             | {}                                                                                                                               |
| name                                 | guest2                                                                                                                           |
| nics                                 | {"nic1": {"vif_model": "virtio", "port_id": "0dc36c10-92ea-45cf-91b6-04cc90d9bdfa", "network": "tenant1-mgmt-net", "mtu": 1500}} |
| os-extended-volumes:volumes_attached | []                                                                                                                               |
| pinned                               | True                                                                                                                             |
| progress                             | 0                                                                                                                                |
| server_group                         |                                                                                                                                  |
| status                               | ACTIVE                                                                                                                           |
| tenant1-mgmt-net network             | 192.168.109.18                                                                                                                   |
| tenant_id                            | a4e3a58f85e344c9b238f99045ee9e4e                                                                                                 |
| updated                              | 2015-02-05T15:36:00Z                                                                                                             |
| user_id                              | 49be897e674a4456af937371ecfa936d                                                                                                 |
| vcpus (min/cur/max)                  | [1, 1, 4]                                                                                                                        |
+--------------------------------------+----------------------------------------------------------------------------------------------------------------------------------+
[0;32m<min/cur/max[0m
Thu Feb  5 15:36:03 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ [0;32m
Assigned Var:min_cpu=1
[0m
[0;32m
Assigned Var:cur_cpu=1
[0m
[0;32m
Assigned Var:max_cpu=4
[0m
[0;32m
If: expr { "1" != "1" } |then   [|result=FALSE
[0m
[1;34m
 === guest2 scale down should fail beyond minimum limit: 1
[0m
vm-topology -s servers
libnuma: Warning: Cannot parse sysfs meminfo (3)
vm-topology: 2015-02-05T15:36:03.696986  options: show:['servers']

SERVERS (nova view):  Legend: cpulist = [cpu_id[i], ...], S = siblings, R = reserved
+---------+--------------------------------------+-------------------+--------+-----------+----------+------------+-------------+--------------+---------+--------+-------------+-------+--------+----------+---------+------------+
| tenant  | ID                                   | instance_name     | name   | host      | vm_state | task_state | power_state | server_group | flavor  | pinned | shared_vcpu | vcpus | memory | numanode | cpulist | in_libvirt |
+---------+--------------------------------------+-------------------+--------+-----------+----------+------------+-------------+--------------+---------+--------+-------------+-------+--------+----------+---------+------------+
| tenant1 | 6eabdf2e-d81f-4f9f-87f7-9eebf14ccd38 | instance-0000006e | guest1 | compute-1 | active   | None       | Running     | -            | vcpu4-1 | pinned |        None | 1,1,4 |    512 |        0 | 3       |    yes     |
| tenant1 | 065c54c0-8e0e-4b7b-9f9f-38c15828e2b4 | instance-0000006f | guest2 | compute-1 | active   | None       | Running     | -            | vcpu4-1 | pinned |        None | 1,1,4 |    512 |        0 | 4       |    yes     |
+---------+--------------------------------------+-------------------+--------+-----------+----------+------------+-------------+--------------+---------+--------+-------------+-------+--------+----------+---------+------------+
Thu Feb  5 15:36:04 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ nova scale guest2 cpu down
ERROR (BadRequest): When scaling, cannot scale beyond limits! (HTTP 400) (Request-ID: req-af193cd7-1b36-447e-9f82-24b569e698b2)
Thu Feb  5 15:36:06 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ [0;32m

Setting Expect Timeout to: 25 

[0m
echo $?
1
Thu Feb  5 15:36:06 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ [0;32m<
1[0m
[1;34m
 === scale down of guest2 completed
[0m
[1;34m
 === scale up guest1  cpu to the maximum value:4
[0m
[1;34m
 === save the current state of guest1  cpu
[0m
vm-topology -s servers
libnuma: Warning: Cannot parse sysfs meminfo (3)
vm-topology: 2015-02-05T15:36:06.855958  options: show:['servers']

SERVERS (nova view):  Legend: cpulist = [cpu_id[i], ...], S = siblings, R = reserved
+---------+--------------------------------------+-------------------+--------+-----------+----------+------------+-------------+--------------+---------+--------+-------------+-------+--------+----------+---------+------------+
| tenant  | ID                                   | instance_name     | name   | host      | vm_state | task_state | power_state | server_group | flavor  | pinned | shared_vcpu | vcpus | memory | numanode | cpulist | in_libvirt |
+---------+--------------------------------------+-------------------+--------+-----------+----------+------------+-------------+--------------+---------+--------+-------------+-------+--------+----------+---------+------------+
| tenant1 | 6eabdf2e-d81f-4f9f-87f7-9eebf14ccd38 | instance-0000006e | guest1 | compute-1 | active   | None       | Running     | -            | vcpu4-1 | pinned |        None | 1,1,4 |    512 |        0 | 3       |    yes     |
| tenant1 | 065c54c0-8e0e-4b7b-9f9f-38c15828e2b4 | instance-0000006f | guest2 | compute-1 | active   | None       | Running     | -            | vcpu4-1 | pinned |        None | 1,1,4 |    512 |        0 | 4       |    yes     |
+---------+--------------------------------------+-------------------+--------+-----------+----------+------------+-------------+--------------+---------+--------+-------------+-------+--------+----------+---------+------------+
[0;32m<guest1[0m
Thu Feb  5 15:36:08 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ [0;32m
Assigned Var:min_cpu=1
[0m
[0;32m
Assigned Var:cur_cpu=1
[0m
[0;32m
Assigned Var:max_cpu=4
[0m
[1;34m
=== scale up cpu to the maximum value:4
[0m
[0;32m
While: expr { "1" < "4" } |result=TRUE
[0m
[0;32m

Setting Expect Timeout to: 10 

[0m
nova scale guest1 cpu up
Thu Feb  5 15:36:11 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ echo $?
0
Thu Feb  5 15:36:11 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ [0;32m<
0[0m
[0;32m
While: expr { "2" < "4" } |result=TRUE
[0m
[0;32m

Setting Expect Timeout to: 10 

[0m
nova scale guest1 cpu up
Thu Feb  5 15:36:15 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ echo $?
0
Thu Feb  5 15:36:15 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ [0;32m<
0[0m
[0;32m
While: expr { "3" < "4" } |result=TRUE
[0m
[0;32m

Setting Expect Timeout to: 10 

[0m
nova scale guest1 cpu up
Thu Feb  5 15:36:18 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ echo $?
0
Thu Feb  5 15:36:18 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ [0;32m<
0[0m
[0;32m
While: expr { "4" < "4" } |result=FALSE
[0m
[1;34m
 === check if guest1 current cpu value reached max cpu value:4
[0m
nova show guest1
+--------------------------------------+----------------------------------------------------------------------------------------------------------------------------------+
| Property                             | Value                                                                                                                            |
+--------------------------------------+----------------------------------------------------------------------------------------------------------------------------------+
| OS-DCF:diskConfig                    | MANUAL                                                                                                                           |
| OS-EXT-AZ:availability_zone          | nova                                                                                                                             |
| OS-EXT-STS:power_state               | 1                                                                                                                                |
| OS-EXT-STS:task_state                | -                                                                                                                                |
| OS-EXT-STS:vm_state                  | active                                                                                                                           |
| OS-SRV-USG:launched_at               | 2015-02-05T15:34:05.103881                                                                                                       |
| OS-SRV-USG:terminated_at             | -                                                                                                                                |
| accessIPv4                           |                                                                                                                                  |
| accessIPv6                           |                                                                                                                                  |
| config_drive                         |                                                                                                                                  |
| created                              | 2015-02-05T15:33:56Z                                                                                                             |
| extended                             | {"cpuset": 232, "numanode": 0, "siblings_cpuset": null}                                                                          |
| flavor                               | vcpu4-1 (5f0d748b-1c8b-4a70-1985-4d57e25ac137)                                                                                   |
| hostId                               | 1ea8da9884e6179694739654aaa506b2817ea351d58559c80c37d716                                                                         |
| id                                   | 6eabdf2e-d81f-4f9f-87f7-9eebf14ccd38                                                                                             |
| image                                | cgcs-guest (7aeabc04-8b05-44fa-bfe6-07d6dfbfc6ea)                                                                                |
| key_name                             | keypair-tenant1                                                                                                                  |
| metadata                             | {}                                                                                                                               |
| name                                 | guest1                                                                                                                           |
| nics                                 | {"nic1": {"vif_model": "virtio", "port_id": "430c73c2-efa5-4bad-99ba-f3e4aeb92191", "network": "tenant1-mgmt-net", "mtu": 1500}} |
| os-extended-volumes:volumes_attached | []                                                                                                                               |
| pinned                               | True                                                                                                                             |
| progress                             | 0                                                                                                                                |
| server_group                         |                                                                                                                                  |
| status                               | ACTIVE                                                                                                                           |
| tenant1-mgmt-net network             | 192.168.109.17                                                                                                                   |
| tenant_id                            | a4e3a58f85e344c9b238f99045ee9e4e                                                                                                 |
| updated                              | 2015-02-05T15:36:17Z                                                                                                             |
| user_id                              | 49be897e674a4456af937371ecfa936d                                                                                                 |
| vcpus (min/cur/max)                  | [1, 4, 4]                                                                                                                        |
+--------------------------------------+----------------------------------------------------------------------------------------------------------------------------------+
[0;32m<min/cur/max[0m
Thu Feb  5 15:36:20 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ [0;32m
Assigned Var:min_cpu=1
[0m
[0;32m
Assigned Var:cur_cpu=4
[0m
[0;32m
Assigned Var:max_cpu=4
[0m
[0;32m
If: expr { "4" != "4" } |then   [|result=FALSE
[0m
[1;34m
 === guest1 scale up should fail beyond max limit: 4
[0m
vm-topology -s servers
libnuma: Warning: Cannot parse sysfs meminfo (3)
vm-topology: 2015-02-05T15:36:20.652058  options: show:['servers']

SERVERS (nova view):  Legend: cpulist = [cpu_id[i], ...], S = siblings, R = reserved
+---------+--------------------------------------+-------------------+--------+-----------+----------+------------+-------------+--------------+---------+--------+-------------+-------+--------+----------+---------+------------+
| tenant  | ID                                   | instance_name     | name   | host      | vm_state | task_state | power_state | server_group | flavor  | pinned | shared_vcpu | vcpus | memory | numanode | cpulist | in_libvirt |
+---------+--------------------------------------+-------------------+--------+-----------+----------+------------+-------------+--------------+---------+--------+-------------+-------+--------+----------+---------+------------+
| tenant1 | 6eabdf2e-d81f-4f9f-87f7-9eebf14ccd38 | instance-0000006e | guest1 | compute-1 | active   | None       | Running     | -            | vcpu4-1 | pinned |        None | 1,4,4 |    512 |        0 | 3,5-7   |    yes     |
| tenant1 | 065c54c0-8e0e-4b7b-9f9f-38c15828e2b4 | instance-0000006f | guest2 | compute-1 | active   | None       | Running     | -            | vcpu4-1 | pinned |        None | 1,1,4 |    512 |        0 | 4       |    yes     |
+---------+--------------------------------------+-------------------+--------+-----------+----------+------------+-------------+--------------+---------+--------+-------------+-------+--------+----------+---------+------------+
Thu Feb  5 15:36:21 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ nova scale guest1 cpu up
ERROR (BadRequest): When scaling, cannot scale beyond limits! (HTTP 400) (Request-ID: req-0d764309-2d1e-4846-a145-bf678f56ecb2)
Thu Feb  5 15:36:22 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ [0;32m

Setting Expect Timeout to: 25 

[0m
echo $?
1
Thu Feb  5 15:36:22 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ [0;32m<
1[0m
[1;34m
 === scale up of guest1 completed
[0m
[1;34m
 === Calculate the maximum limit guest2 can scale up
[0m
vm-topology -s computes 
libnuma: Warning: Cannot parse sysfs meminfo (3)
vm-topology: 2015-02-05T15:36:23.435960  options: show:['computes']

COMPUTE HOSTS:  Legend: U = Used, F = Free, list = [node[i], ...], C = cpulist
+-----------+----------------------------------------------+-------------+-----------+------+------+---------+-------+---------+----------+----------+---------+------------+--------+----------+--------------+---------+
| Host      | Aggregate                                    | model       | topology  | numa | cpus | servers | pcpus | U:vcpus | F:pinned | F:float  | C:float | C:reserved | memory | U:memory | F:memory     | status  |
+-----------+----------------------------------------------+-------------+-----------+------+------+---------+-------+---------+----------+----------+---------+------------+--------+----------+--------------+---------+
| compute-0 | provider_group0-data1, provider_group0-data0 | SandyBridge | 1s,10c,1t |    2 |   20 |       0 |    17 |       0 | 7, 10    | 112, 160 | 3-19    | -          | 118802 |      300 | 58042, 60460 | enabled |
| compute-1 | provider_group0-data1, provider_group0-data0 | SandyBridge | 1s,10c,1t |    2 |   20 |       2 |    17 |       5 | 2, 10    | 32, 160  | 8-19    | -          | 118802 |     1324 | 57018, 60460 | enabled |
| count: 2  | -                                            | -           | -         |    - |    - |       2 |    34 |       5 | -        | -        | -       | -          | 237604 |     1624 | -            | -       |
+-----------+----------------------------------------------+-------------+-----------+------+------+---------+-------+---------+----------+----------+---------+------------+--------+----------+--------------+---------+
[0;32m<compute-1[0m
Thu Feb  5 15:36:24 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ [0;32m
Assigned Var:max_resource=2
[0m
[1;34m
 === scale up guest2 cpu to the maximum value:2
[0m
vm-topology -s servers
libnuma: Warning: Cannot parse sysfs meminfo (3)
vm-topology: 2015-02-05T15:36:25.117693  options: show:['servers']

SERVERS (nova view):  Legend: cpulist = [cpu_id[i], ...], S = siblings, R = reserved
+---------+--------------------------------------+-------------------+--------+-----------+----------+------------+-------------+--------------+---------+--------+-------------+-------+--------+----------+---------+------------+
| tenant  | ID                                   | instance_name     | name   | host      | vm_state | task_state | power_state | server_group | flavor  | pinned | shared_vcpu | vcpus | memory | numanode | cpulist | in_libvirt |
+---------+--------------------------------------+-------------------+--------+-----------+----------+------------+-------------+--------------+---------+--------+-------------+-------+--------+----------+---------+------------+
| tenant1 | 6eabdf2e-d81f-4f9f-87f7-9eebf14ccd38 | instance-0000006e | guest1 | compute-1 | active   | None       | Running     | -            | vcpu4-1 | pinned |        None | 1,4,4 |    512 |        0 | 3,5-7   |    yes     |
| tenant1 | 065c54c0-8e0e-4b7b-9f9f-38c15828e2b4 | instance-0000006f | guest2 | compute-1 | active   | None       | Running     | -            | vcpu4-1 | pinned |        None | 1,1,4 |    512 |        0 | 4       |    yes     |
+---------+--------------------------------------+-------------------+--------+-----------+----------+------------+-------------+--------------+---------+--------+-------------+-------+--------+----------+---------+------------+
[0;32m<guest2[0m
Thu Feb  5 15:36:26 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ [0;32m
Assigned Var:min_cpu=1
[0m
[0;32m
Assigned Var:cur_cpu=1
[0m
[0;32m
Assigned Var:max_cpu=4
[0m
[1;34m
=== scale up cpu to the maximum value:2
[0m
[0;32m
While: expr { "1" <= "2" } |result=TRUE
[0m
[0;32m

Setting Expect Timeout to: 10 

[0m
vm-topology -s servers
libnuma: Warning: Cannot parse sysfs meminfo (3)
vm-topology: 2015-02-05T15:36:26.979386  options: show:['servers']

SERVERS (nova view):  Legend: cpulist = [cpu_id[i], ...], S = siblings, R = reserved
+---------+--------------------------------------+-------------------+--------+-----------+----------+------------+-------------+--------------+---------+--------+-------------+-------+--------+----------+---------+------------+
| tenant  | ID                                   | instance_name     | name   | host      | vm_state | task_state | power_state | server_group | flavor  | pinned | shared_vcpu | vcpus | memory | numanode | cpulist | in_libvirt |
+---------+--------------------------------------+-------------------+--------+-----------+----------+------------+-------------+--------------+---------+--------+-------------+-------+--------+----------+---------+------------+
| tenant1 | 6eabdf2e-d81f-4f9f-87f7-9eebf14ccd38 | instance-0000006e | guest1 | compute-1 | active   | None       | Running     | -            | vcpu4-1 | pinned |        None | 1,4,4 |    512 |        0 | 3,5-7   |    yes     |
| tenant1 | 065c54c0-8e0e-4b7b-9f9f-38c15828e2b4 | instance-0000006f | guest2 | compute-1 | active   | None       | Running     | -            | vcpu4-1 | pinned |        None | 1,1,4 |    512 |        0 | 4       |    yes     |
+---------+--------------------------------------+-------------------+--------+-----------+----------+------------+-------------+--------------+---------+--------+-------------+-------+--------+----------+---------+------------+
Thu Feb  5 15:36:28 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ nova scale guest2 cpu up
Thu Feb  5 15:36:31 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ echo $?
0
Thu Feb  5 15:36:31 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ [0;32m<
0[0m
[0;32m
While: expr { "2" <= "2" } |result=TRUE
[0m
[0;32m

Setting Expect Timeout to: 10 

[0m
vm-topology -s servers
libnuma: Warning: Cannot parse sysfs meminfo (3)
vm-topology: 2015-02-05T15:36:32.061345  options: show:['servers']

SERVERS (nova view):  Legend: cpulist = [cpu_id[i], ...], S = siblings, R = reserved
+---------+--------------------------------------+-------------------+--------+-----------+----------+------------+-------------+--------------+---------+--------+-------------+-------+--------+----------+---------+------------+
| tenant  | ID                                   | instance_name     | name   | host      | vm_state | task_state | power_state | server_group | flavor  | pinned | shared_vcpu | vcpus | memory | numanode | cpulist | in_libvirt |
+---------+--------------------------------------+-------------------+--------+-----------+----------+------------+-------------+--------------+---------+--------+-------------+-------+--------+----------+---------+------------+
| tenant1 | 6eabdf2e-d81f-4f9f-87f7-9eebf14ccd38 | instance-0000006e | guest1 | compute-1 | active   | None       | Running     | -            | vcpu4-1 | pinned |        None | 1,4,4 |    512 |        0 | 3,5-7   |    yes     |
| tenant1 | 065c54c0-8e0e-4b7b-9f9f-38c15828e2b4 | instance-0000006f | guest2 | compute-1 | active   | None       | Running     | -            | vcpu4-1 | pinned |        None | 1,2,4 |    512 |        0 | 4,8     |    yes     |
+---------+--------------------------------------+-------------------+--------+-----------+----------+------------+-------------+--------------+---------+--------+-------------+-------+--------+----------+---------+------------+
Thu Feb  5 15:36:33 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ nova scale guest2 cpu up
Thu Feb  5 15:36:36 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ echo $?
0
Thu Feb  5 15:36:36 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ [0;32m<
0[0m
[0;32m
While: expr { "3" <= "2" } |result=FALSE
[0m
[1;34m
 === check if guest2 current cpu value reached max cpu value:2
[0m
nova show guest2
+--------------------------------------+----------------------------------------------------------------------------------------------------------------------------------+
| Property                             | Value                                                                                                                            |
+--------------------------------------+----------------------------------------------------------------------------------------------------------------------------------+
| OS-DCF:diskConfig                    | MANUAL                                                                                                                           |
| OS-EXT-AZ:availability_zone          | nova                                                                                                                             |
| OS-EXT-STS:power_state               | 1                                                                                                                                |
| OS-EXT-STS:task_state                | -                                                                                                                                |
| OS-EXT-STS:vm_state                  | active                                                                                                                           |
| OS-SRV-USG:launched_at               | 2015-02-05T15:35:10.810641                                                                                                       |
| OS-SRV-USG:terminated_at             | -                                                                                                                                |
| accessIPv4                           |                                                                                                                                  |
| accessIPv6                           |                                                                                                                                  |
| config_drive                         |                                                                                                                                  |
| created                              | 2015-02-05T15:35:02Z                                                                                                             |
| extended                             | {"cpuset": 784, "numanode": 0, "siblings_cpuset": null}                                                                          |
| flavor                               | vcpu4-1 (5f0d748b-1c8b-4a70-1985-4d57e25ac137)                                                                                   |
| hostId                               | 1ea8da9884e6179694739654aaa506b2817ea351d58559c80c37d716                                                                         |
| id                                   | 065c54c0-8e0e-4b7b-9f9f-38c15828e2b4                                                                                             |
| image                                | cgcs-guest (7aeabc04-8b05-44fa-bfe6-07d6dfbfc6ea)                                                                                |
| key_name                             | keypair-tenant1                                                                                                                  |
| metadata                             | {}                                                                                                                               |
| name                                 | guest2                                                                                                                           |
| nics                                 | {"nic1": {"vif_model": "virtio", "port_id": "0dc36c10-92ea-45cf-91b6-04cc90d9bdfa", "network": "tenant1-mgmt-net", "mtu": 1500}} |
| os-extended-volumes:volumes_attached | []                                                                                                                               |
| pinned                               | True                                                                                                                             |
| progress                             | 0                                                                                                                                |
| server_group                         |                                                                                                                                  |
| status                               | ACTIVE                                                                                                                           |
| tenant1-mgmt-net network             | 192.168.109.18                                                                                                                   |
| tenant_id                            | a4e3a58f85e344c9b238f99045ee9e4e                                                                                                 |
| updated                              | 2015-02-05T15:36:35Z                                                                                                             |
| user_id                              | 49be897e674a4456af937371ecfa936d                                                                                                 |
| vcpus (min/cur/max)                  | [1, 3, 4]                                                                                                                        |
+--------------------------------------+----------------------------------------------------------------------------------------------------------------------------------+
[0;32m<min/cur/max[0m
Thu Feb  5 15:36:38 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ [0;32m
Assigned Var:min_cpu=1
[0m
[0;32m
Assigned Var:cur_cpu=3
[0m
[0;32m
Assigned Var:max_cpu=4
[0m
[1;34m
 === guest2 scale up should fail beyond allowed max limit in MUMA0: 2
[0m
vm-topology -s servers
libnuma: Warning: Cannot parse sysfs meminfo (3)
vm-topology: 2015-02-05T15:36:39.109737  options: show:['servers']

SERVERS (nova view):  Legend: cpulist = [cpu_id[i], ...], S = siblings, R = reserved
+---------+--------------------------------------+-------------------+--------+-----------+----------+------------+-------------+--------------+---------+--------+-------------+-------+--------+----------+---------+------------+
| tenant  | ID                                   | instance_name     | name   | host      | vm_state | task_state | power_state | server_group | flavor  | pinned | shared_vcpu | vcpus | memory | numanode | cpulist | in_libvirt |
+---------+--------------------------------------+-------------------+--------+-----------+----------+------------+-------------+--------------+---------+--------+-------------+-------+--------+----------+---------+------------+
| tenant1 | 6eabdf2e-d81f-4f9f-87f7-9eebf14ccd38 | instance-0000006e | guest1 | compute-1 | active   | None       | Running     | -            | vcpu4-1 | pinned |        None | 1,4,4 |    512 |        0 | 3,5-7   |    yes     |
| tenant1 | 065c54c0-8e0e-4b7b-9f9f-38c15828e2b4 | instance-0000006f | guest2 | compute-1 | active   | None       | Running     | -            | vcpu4-1 | pinned |        None | 1,3,4 |    512 |        0 | 4,8-9   |    yes     |
+---------+--------------------------------------+-------------------+--------+-----------+----------+------------+-------------+--------------+---------+--------+-------------+-------+--------+----------+---------+------------+
Thu Feb  5 15:36:40 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ nova scale guest2 cpu up
ERROR (BadRequest): Insufficient compute resources. (HTTP 400) (Request-ID: req-39ccec10-9c5d-4761-a5a2-d34c81a12ac2)
Thu Feb  5 15:36:41 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ [0;32m

Setting Expect Timeout to: 25 

[0m
echo $?
1
Thu Feb  5 15:36:41 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ [0;32m<
1[0m
[1;34m
 === scale down guest1 cpu and scale up guest2 cpu
[0m
vm-topology -s servers
libnuma: Warning: Cannot parse sysfs meminfo (3)
vm-topology: 2015-02-05T15:36:42.244243  options: show:['servers']

SERVERS (nova view):  Legend: cpulist = [cpu_id[i], ...], S = siblings, R = reserved
+---------+--------------------------------------+-------------------+--------+-----------+----------+------------+-------------+--------------+---------+--------+-------------+-------+--------+----------+---------+------------+
| tenant  | ID                                   | instance_name     | name   | host      | vm_state | task_state | power_state | server_group | flavor  | pinned | shared_vcpu | vcpus | memory | numanode | cpulist | in_libvirt |
+---------+--------------------------------------+-------------------+--------+-----------+----------+------------+-------------+--------------+---------+--------+-------------+-------+--------+----------+---------+------------+
| tenant1 | 6eabdf2e-d81f-4f9f-87f7-9eebf14ccd38 | instance-0000006e | guest1 | compute-1 | active   | None       | Running     | -            | vcpu4-1 | pinned |        None | 1,4,4 |    512 |        0 | 3,5-7   |    yes     |
| tenant1 | 065c54c0-8e0e-4b7b-9f9f-38c15828e2b4 | instance-0000006f | guest2 | compute-1 | active   | None       | Running     | -            | vcpu4-1 | pinned |        None | 1,3,4 |    512 |        0 | 4,8-9   |    yes     |
+---------+--------------------------------------+-------------------+--------+-----------+----------+------------+-------------+--------------+---------+--------+-------------+-------+--------+----------+---------+------------+
Thu Feb  5 15:36:43 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ nova scale guest1 cpu down
Thu Feb  5 15:36:46 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ echo $?
0
Thu Feb  5 15:36:46 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ [0;32m<
0[0m
vm-topology -s servers
libnuma: Warning: Cannot parse sysfs meminfo (3)
vm-topology: 2015-02-05T15:36:47.249456  options: show:['servers']

SERVERS (nova view):  Legend: cpulist = [cpu_id[i], ...], S = siblings, R = reserved
+---------+--------------------------------------+-------------------+--------+-----------+----------+------------+-------------+--------------+---------+--------+-------------+-------+--------+----------+---------+------------+
| tenant  | ID                                   | instance_name     | name   | host      | vm_state | task_state | power_state | server_group | flavor  | pinned | shared_vcpu | vcpus | memory | numanode | cpulist | in_libvirt |
+---------+--------------------------------------+-------------------+--------+-----------+----------+------------+-------------+--------------+---------+--------+-------------+-------+--------+----------+---------+------------+
| tenant1 | 6eabdf2e-d81f-4f9f-87f7-9eebf14ccd38 | instance-0000006e | guest1 | compute-1 | active   | None       | Running     | -            | vcpu4-1 | pinned |        None | 1,3,4 |    512 |        0 | 3,5-6   |    yes     |
| tenant1 | 065c54c0-8e0e-4b7b-9f9f-38c15828e2b4 | instance-0000006f | guest2 | compute-1 | active   | None       | Running     | -            | vcpu4-1 | pinned |        None | 1,3,4 |    512 |        0 | 4,8-9   |    yes     |
+---------+--------------------------------------+-------------------+--------+-----------+----------+------------+-------------+--------------+---------+--------+-------------+-------+--------+----------+---------+------------+
Thu Feb  5 15:36:48 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ nova scale guest2 cpu up
Thu Feb  5 15:36:52 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ echo $?
0
Thu Feb  5 15:36:52 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ [0;32m<
0[0m
[1;34m
 === clean up setup
[0m
heat stack-delete STACK1 STACK2
+--------------------------------------+------------+--------------------+----------------------+
| id                                   | stack_name | stack_status       | creation_time        |
+--------------------------------------+------------+--------------------+----------------------+
| 95fbb906-3b78-42bd-bd72-6273c09a1979 | STACK1     | DELETE_IN_PROGRESS | 2015-02-05T15:33:55Z |
| 7589f8e2-89d4-4328-96fd-1710a439916d | STACK2     | DELETE_IN_PROGRESS | 2015-02-05T15:35:01Z |
+--------------------------------------+------------+--------------------+----------------------+
Thu Feb  5 15:36:53 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ heat stack-list
+----+------------+--------------+---------------+
| id | stack_name | stack_status | creation_time |
+----+------------+--------------+---------------+
+----+------------+--------------+---------------+
Thu Feb  5 15:37:23 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ [1;34m
 === become admin to delete flavors
[0m
source /etc/nova/openrc
Thu Feb  5 15:37:24 UTC 2015
[wrsroot@controller-0 ~(keystone_admin)]$ nova flavor-delete vcpu4-1
+--------------------------------------+---------+-----------+------+-----------+------+-------+-------------+-----------+------------+
| ID                                   | Name    | Memory_MB | Disk | Ephemeral | Swap | VCPUs | RXTX_Factor | Is_Public | VCPU_Model |
+--------------------------------------+---------+-----------+------+-----------+------+-------+-------------+-----------+------------+
| 5f0d748b-1c8b-4a70-1985-4d57e25ac137 | vcpu4-1 | 512       | 0    | 0         |      | 4     | 1.0         | True      | -          |
+--------------------------------------+---------+-----------+------+-----------+------+-------+-------------+-----------+------------+
Thu Feb  5 15:37:25 UTC 2015
[wrsroot@controller-0 ~(keystone_admin)]$ nova flavor-delete vcpu5-2
+--------------------------------------+---------+-----------+------+-----------+------+-------+-------------+-----------+------------+
| ID                                   | Name    | Memory_MB | Disk | Ephemeral | Swap | VCPUs | RXTX_Factor | Is_Public | VCPU_Model |
+--------------------------------------+---------+-----------+------+-----------+------+-------+-------------+-----------+------------+
| db9b37f5-cba5-1985-a264-a6c1375a4ff7 | vcpu5-2 | 512       | 0    | 0         |      | 5     | 1.0         | True      | -          |
+--------------------------------------+---------+-----------+------+-----------+------+-------+-------------+-----------+------------+
Thu Feb  5 15:37:26 UTC 2015
[wrsroot@controller-0 ~(keystone_admin)]$ [1;34m
 === Create necessary flavors and set minimum vcpu value
[0m
nova flavor-create --dedicated-cpus True vcpu4-1 5f0d748b-1c8b-4a70-1985-4d57e25ac137 512 0 4
+--------------------------------------+---------+-----------+------+-----------+------+-------+-------------+-----------+------------+
| ID                                   | Name    | Memory_MB | Disk | Ephemeral | Swap | VCPUs | RXTX_Factor | Is_Public | VCPU_Model |
+--------------------------------------+---------+-----------+------+-----------+------+-------+-------------+-----------+------------+
| 5f0d748b-1c8b-4a70-1985-4d57e25ac137 | vcpu4-1 | 512       | 0    | 0         |      | 4     | 1.0         | True      | -          |
+--------------------------------------+---------+-----------+------+-----------+------+-------+-------------+-----------+------------+
Thu Feb  5 15:37:27 UTC 2015
[wrsroot@controller-0 ~(keystone_admin)]$ echo $?
0
Thu Feb  5 15:37:27 UTC 2015
[wrsroot@controller-0 ~(keystone_admin)]$ [0;32m<
0[0m
nova flavor-create --dedicated-cpus True vcpu5-2 db9b37f5-cba5-1985-a264-a6c1375a4ff7 512 0 5
+--------------------------------------+---------+-----------+------+-----------+------+-------+-------------+-----------+------------+
| ID                                   | Name    | Memory_MB | Disk | Ephemeral | Swap | VCPUs | RXTX_Factor | Is_Public | VCPU_Model |
+--------------------------------------+---------+-----------+------+-----------+------+-------+-------------+-----------+------------+
| db9b37f5-cba5-1985-a264-a6c1375a4ff7 | vcpu5-2 | 512       | 0    | 0         |      | 5     | 1.0         | True      | -          |
+--------------------------------------+---------+-----------+------+-----------+------+-------+-------------+-----------+------------+
Thu Feb  5 15:37:28 UTC 2015
[wrsroot@controller-0 ~(keystone_admin)]$ echo $?
0
Thu Feb  5 15:37:28 UTC 2015
[wrsroot@controller-0 ~(keystone_admin)]$ [0;32m<
0[0m
[1;34m
 === flavor created
[0m
nova flavor-list | grep vcpu4-1
| 5f0d748b-1c8b-4a70-1985-4d57e25ac137 | vcpu4-1                               | 512       | 0    | 0         |      | 4     | 1.0         | True      | -           |
Thu Feb  5 15:37:29 UTC 2015
[wrsroot@controller-0 ~(keystone_admin)]$ nova flavor-list | grep vcpu5-2
| db9b37f5-cba5-1985-a264-a6c1375a4ff7 | vcpu5-2                               | 512       | 0    | 0         |      | 5     | 1.0         | True      | -           |
Thu Feb  5 15:37:30 UTC 2015
[wrsroot@controller-0 ~(keystone_admin)]$ nova flavor-key vcpu4-1 set wrs:min_vcpus=1 
Thu Feb  5 15:37:31 UTC 2015
[wrsroot@controller-0 ~(keystone_admin)]$ nova flavor-list --extra-specs | grep vcpu4-1
| 5f0d748b-1c8b-4a70-1985-4d57e25ac137 | vcpu4-1                               | 512       | 0    | 0         |      | 4     | 1.0         | True      | -           | {u'dedicated:cpus': u'True', u'guest:heartbeat': u'False', u'wrs:min_vcpus': u'1'} |
Thu Feb  5 15:37:32 UTC 2015
[wrsroot@controller-0 ~(keystone_admin)]$ [0;32m
Assigned Var:result=1
[0m
[1;34m
 === Minimum CPU value set for vcpu4-1 is 1
[0m
nova flavor-key vcpu5-2 set wrs:min_vcpus=2
Thu Feb  5 15:37:33 UTC 2015
[wrsroot@controller-0 ~(keystone_admin)]$ nova flavor-list --extra-specs | grep vcpu5-2
| db9b37f5-cba5-1985-a264-a6c1375a4ff7 | vcpu5-2                               | 512       | 0    | 0         |      | 5     | 1.0         | True      | -           | {u'dedicated:cpus': u'True', u'guest:heartbeat': u'False', u'wrs:min_vcpus': u'2'} |
Thu Feb  5 15:37:34 UTC 2015
[wrsroot@controller-0 ~(keystone_admin)]$ [0;32m
Assigned Var:result=2
[0m
[1;34m
 === Minimum CPU value set for vcpu5-2 is 2
[0m
[1;34m
 === become tenant to create stacks
[0m
[0;32m
While: expr { "1" <= "10" } |result=TRUE
[0m
[0;32m
While: expr { "2" <= "10" } |result=TRUE
[0m
[0;32m
While: expr { "3" <= "10" } |result=TRUE
[0m
[0;32m
While: expr { "4" <= "10" } |result=TRUE
[0m
[0;32m
While: expr { "5" <= "10" } |result=TRUE
[0m
[0;32m
While: expr { "6" <= "10" } |result=TRUE
[0m
[0;32m
While: expr { "7" <= "10" } |result=TRUE
[0m
[0;32m
While: expr { "8" <= "10" } |result=TRUE
[0m
[0;32m
While: expr { "9" <= "10" } |result=TRUE
[0m
[0;32m
While: expr { "10" <= "10" } |result=TRUE
[0m
[0;32m
While: expr { "11" <= "10" } |result=FALSE
[0m
[1;34m
 === create multiple heat stack
[0m
[0;32m
While: expr { "1" <= "3" } |result=TRUE
[0m
source /home/wrsroot/openrc.tenant1
Thu Feb  5 15:37:34 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ [0;32m
If: expr { "1" == "1" } |then   $flavor=$flavor2|result=TRUE
[0m
[0;32m
While: expr { "2" <= "3" } |result=TRUE
[0m
heat stack-create -f VMAutoScaling.yaml -P TenantUserId=49be897e674a4456af937371ecfa936d -P PrivateNetName=tenant1-mgmt-net -P Ins tanceName=guest1 -P FlavorName=vcpu4-1 -P ImageName=cgcs-guest -P CustomMeterName=vote -P KeyName=keypair-tenant1 STACK1
+--------------------------------------+------------+--------------------+----------------------+
| id                                   | stack_name | stack_status       | creation_time        |
+--------------------------------------+------------+--------------------+----------------------+
| 5cf93636-087c-45ea-bbe1-0b4225f79071 | STACK1     | CREATE_IN_PROGRESS | 2015-02-05T15:37:36Z |
+--------------------------------------+------------+--------------------+----------------------+
Thu Feb  5 15:37:36 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ [0;32m
If: expr { "2" == "1" } |then   $flavor=$flavor2|result=FALSE
[0m
[0;32m
While: expr { "3" <= "3" } |result=TRUE
[0m
heat stack-create -f VMAutoScaling.yaml -P TenantUserId=49be897e674a4456af937371ecfa936d -P PrivateNetName=tenant1-mgmt-net -P Ins tanceName=guest2 -P FlavorName=vcpu5-2 -P ImageName=cgcs-guest -P CustomMeterName=vote -P KeyName=keypair-tenant1 STACK2
+--------------------------------------+------------+--------------------+----------------------+
| id                                   | stack_name | stack_status       | creation_time        |
+--------------------------------------+------------+--------------------+----------------------+
| 5cf93636-087c-45ea-bbe1-0b4225f79071 | STACK1     | CREATE_IN_PROGRESS | 2015-02-05T15:37:36Z |
| 8b89792e-9667-45be-8ae6-70ae7ef13b51 | STACK2     | CREATE_IN_PROGRESS | 2015-02-05T15:37:38Z |
+--------------------------------------+------------+--------------------+----------------------+
Thu Feb  5 15:37:38 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ [0;32m
If: expr { "3" == "1" } |then   $flavor=$flavor2|result=FALSE
[0m
[0;32m
While: expr { "4" <= "3" } |result=FALSE
[0m
[1;34m
 === wait and check if heat stack create_complete
[0m
[0;32m
While: expr { "1" <= "3" } |result=TRUE
[0m
heat stack-create -f VMAutoScaling.yaml -P TenantUserId=49be897e674a4456af937371ecfa936d -P PrivateNetName=tenant1-mgmt-net -P Ins tanceName=guest3 -P FlavorName=vcpu5-2 -P ImageName=cgcs-guest -P CustomMeterName=vote -P KeyName=keypair-tenant1 STACK3
+--------------------------------------+------------+--------------------+----------------------+
| id                                   | stack_name | stack_status       | creation_time        |
+--------------------------------------+------------+--------------------+----------------------+
| 5cf93636-087c-45ea-bbe1-0b4225f79071 | STACK1     | CREATE_IN_PROGRESS | 2015-02-05T15:37:36Z |
| 8b89792e-9667-45be-8ae6-70ae7ef13b51 | STACK2     | CREATE_IN_PROGRESS | 2015-02-05T15:37:38Z |
| d8d5af90-b710-40e1-a104-9485aa28bfeb | STACK3     | CREATE_IN_PROGRESS | 2015-02-05T15:37:39Z |
+--------------------------------------+------------+--------------------+----------------------+
Thu Feb  5 15:37:39 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ heat stack-show STACK1
+----------------------+-------------------------------------------------------------------------------------------------------------------------------+
| Property             | Value                                                                                                                         |
+----------------------+-------------------------------------------------------------------------------------------------------------------------------+
| capabilities         | []                                                                                                                            |
| creation_time        | 2015-02-05T15:37:36Z                                                                                                          |
| description          | Creates a HEAT autoscaling stack and a VM instance                                                                            |
|                      | which is able to scale up/down the number of guest                                                                            |
|                      | vpcu's based on vcpu_util on the guest instance. Note:                                                                        |
|                      | This uses the HOT template                                                                                                    |
| disable_rollback     | True                                                                                                                          |
| id                   | 5cf93636-087c-45ea-bbe1-0b4225f79071                                                                                          |
| links                | http://128.224.150.189:8004/v1/a4e3a58f85e344c9b238f99045ee9e4e/stacks/STACK1/5cf93636-087c-45ea-bbe1-0b4225f79071            |
| notification_topics  | []                                                                                                                            |
| outputs              | []                                                                                                                            |
| parameters           | {                                                                                                                             |
|                      |   "PrivateNetName": "tenant1-mgmt-net",                                                                                       |
|                      |   "InstanceName": "guest1",                                                                                                   |
|                      |   "AWS::StackName": "STACK1",                                                                                                 |
|                      |   "CustomMeterName": "vote",                                                                                                  |
|                      |   "FlavorName": "vcpu4-1",                                                                                                    |
|                      |   "KeyName": "keypair-tenant1",                                                                                               |
|                      |   "AWS::StackId": "arn:openstack:heat::a4e3a58f85e344c9b238f99045ee9e4e:stacks/STACK1/5cf93636-087c-45ea-bbe1-0b4225f79071",  |
|                      |   "ImageName": "cgcs-guest",                                                                                                  |
|                      |   "MetricLowWaterMark": "5",                                                                                                  |
|                      |   "AWS::Region": "ap-southeast-1",                                                                                            |
|                      |   "TenantUserId": "49be897e674a4456af937371ecfa936d",                                                                         |
|                      |   "MetricHighWaterMark": "60"                                                                                                 |
|                      | }                                                                                                                             |
| stack_name           | STACK1                                                                                                                        |
| stack_status         | CREATE_COMPLETE                                                                                                               |
| stack_status_reason  | Stack create completed successfully                                                                                           |
| template_description | Creates a HEAT autoscaling stack and a VM instance                                                                            |
|                      | which is able to scale up/down the number of guest                                                                            |
|                      | vpcu's based on vcpu_util on the guest instance. Note:                                                                        |
|                      | This uses the HOT template                                                                                                    |
| timeout_mins         | 60                                                                                                                            |
| updated_time         | 2015-02-05T15:37:49Z                                                                                                          |
+----------------------+-------------------------------------------------------------------------------------------------------------------------------+
[0;32m<stack_status[0m
[0;32m<CREATE_COMPLETE[0m
[0;32m
While: expr { "2" <= "3" } |result=TRUE
[0m
Thu Feb  5 15:38:09 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ heat stack-show STACK2
+----------------------+-------------------------------------------------------------------------------------------------------------------------------+
| Property             | Value                                                                                                                         |
+----------------------+-------------------------------------------------------------------------------------------------------------------------------+
| capabilities         | []                                                                                                                            |
| creation_time        | 2015-02-05T15:37:38Z                                                                                                          |
| description          | Creates a HEAT autoscaling stack and a VM instance                                                                            |
|                      | which is able to scale up/down the number of guest                                                                            |
|                      | vpcu's based on vcpu_util on the guest instance. Note:                                                                        |
|                      | This uses the HOT template                                                                                                    |
| disable_rollback     | True                                                                                                                          |
| id                   | 8b89792e-9667-45be-8ae6-70ae7ef13b51                                                                                          |
| links                | http://128.224.150.189:8004/v1/a4e3a58f85e344c9b238f99045ee9e4e/stacks/STACK2/8b89792e-9667-45be-8ae6-70ae7ef13b51            |
| notification_topics  | []                                                                                                                            |
| outputs              | []                                                                                                                            |
| parameters           | {                                                                                                                             |
|                      |   "PrivateNetName": "tenant1-mgmt-net",                                                                                       |
|                      |   "InstanceName": "guest2",                                                                                                   |
|                      |   "AWS::StackName": "STACK2",                                                                                                 |
|                      |   "CustomMeterName": "vote",                                                                                                  |
|                      |   "FlavorName": "vcpu5-2",                                                                                                    |
|                      |   "KeyName": "keypair-tenant1",                                                                                               |
|                      |   "AWS::StackId": "arn:openstack:heat::a4e3a58f85e344c9b238f99045ee9e4e:stacks/STACK2/8b89792e-9667-45be-8ae6-70ae7ef13b51",  |
|                      |   "ImageName": "cgcs-guest",                                                                                                  |
|                      |   "MetricLowWaterMark": "5",                                                                                                  |
|                      |   "AWS::Region": "ap-southeast-1",                                                                                            |
|                      |   "TenantUserId": "49be897e674a4456af937371ecfa936d",                                                                         |
|                      |   "MetricHighWaterMark": "60"                                                                                                 |
|                      | }                                                                                                                             |
| stack_name           | STACK2                                                                                                                        |
| stack_status         | CREATE_COMPLETE                                                                                                               |
| stack_status_reason  | Stack create completed successfully                                                                                           |
| template_description | Creates a HEAT autoscaling stack and a VM instance              [0;32m<stack_status[0m
                                                              |
|                      | which is able to scale up/down the number of guest                                                                            |
|                      | vpcu's based on vcpu_util on the guest instance. Note:                                                                        |
|                      | This uses the HOT template                                                                                                    |
| timeout_mins         | 60                                                                                                                            |
| updated_time         | 2015-02-05T15:37:51Z                                                                                                          |
+----------------------+-------------------------------------------------------------------------------------------------------------------------------+
[0;32m<CREATE_COMPLETE[0m
[0;32m
While: expr { "3" <= "3" } |result=TRUE
[0m
Thu Feb  5 15:38:10 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ heat stack-show STACK3
+----------------------+-------------------------------------------------------------------------------------------------------------------------------+
| Property             | Value                                                                                                                         |
+----------------------+-------------------------------------------------------------------------------------------------------------------------------+
| capabilities         | []                                                                                                                            |
| creation_time        | 2015-02-05T15:37:39Z                                                                                                          |
| description          | Creates a HEAT autoscaling stack and a VM instance                                                                            |
|                      | which is able to scale up/down the number of guest                                                                            |
|                      | vpcu's based on vcpu_util on the guest instance. Note:                                                                        |
|                      | This uses the HOT template                                                                                                    |
| disable_rollback     | True                                                                                                                          |
| id                   | d8d5af90-b710-40e1-a104-9485aa28bfeb                                                                                          |
| links                | http://128.224.150.189:8004/v1/a4e3a58f85e344c9b238f99045ee9e4e/stacks/STACK3/d8d5af90-b710-40e1-a104-9485aa28bfeb            |
| notification_topics  | []                                                                                                                            |
| outputs              | []                                                                                                                            |
| parameters           | {                                                                                                                             |
|                      |   "PrivateNetName": "tenant1-mgmt-net",                                                                                       |
|                      |   "InstanceName": "guest3",                                                                                                   |
|                      |   "AWS::StackName": "STACK3",                                                                                                 |
|                      |   "CustomMeterName": "vote",                                                                                                  |
|                      |   "FlavorName": "vcpu5-2",                                                                                                    |
|                      |   "KeyName": "keypair-tenant1",                                                                                               |
|                      |   "AWS::StackId": "arn:openstack:heat::a4e3a58f85e344c9b238f99045ee9e4e:stacks/STACK3/d8d5af90-b710-40e1-a104-9485aa28bfeb",  |
|                      |   "ImageName": "cgcs-guest",                                                                                                  |
|                      |   "MetricLowWaterMark": "5",                                                                                                  |
|                      |   "AWS::Region": "ap-southeast-1",                                                                                            |
|                      |   "TenantUserId": "49be897e674a4456af937371ecfa936d",                                                                         |
|                      |   "MetricHighWaterMark": "60"                                                                                                 |
|                      | }                                                                                                                             |
| stack_name           | STACK3                                                                                                                        |
| stack_status         | CREATE_COMPLETE                                                                                                               |
| stack_status_reason  | Stack create completed successfully                                                                                           |
| template_description | Creates a HEAT autoscaling stack and a VM instance                                                                            |
|                      | which is able to scale up/down the number of guest                                                                            |
|                      | vpcu's based on vcpu_util on the guest instance. Note:                                                                        |
|                      | This uses the HOT template                                                                                                    |
| timeout_mins         | 60                                                                                                                            |
| updated_time         | 2015-02-05T15:37:53Z                                                                                                          |
+----------------------+-------------------------------------------------------------------------------------------------------------------------------+
[0;32m<stack_status[0m
[0;32m<CREATE_COMPLETE[0m
[0;32m
While: expr { "4" <= "3" } |result=FALSE
[0m
[1;34m
 === Do scale up/down sequentially
[0m
[0;32m
While: expr { "1" <= "3" } |result=TRUE
[0m
[1;34m
 === execute scale down for guest1
[0m
[1;34m
 === save the current state of guest1 cpu
[0m
Thu Feb  5 15:38:11 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ [0;32m

Setting Expect Timeout to: 25 

[0m
vm-topology -s servers
libnuma: Warning: Cannot parse sysfs meminfo (3)
vm-topology: 2015-02-05T15:38:12.000624  options: show:['servers']

SERVERS (nova view):  Legend: cpulist = [cpu_id[i], ...], S = siblings, R = reserved
+---------+--------------------------------------+-------------------+--------+-----------+----------+------------+-------------+--------------+---------+--------+-------------+-------+--------+----------+---------+------------+
| tenant  | ID                                   | instance_name     | name   | host      | vm_state | task_state | power_state | server_group | flavor  | pinned | shared_vcpu | vcpus | memory | numanode | cpulist | in_libvirt |
+---------+--------------------------------------+-------------------+--------+-----------+----------+------------+-------------+--------------+---------+--------+-------------+-------+--------+----------+---------+------------+
| tenant1 | 3fba3be4-b0e1-44d2-80d9-ae8495e13f82 | instance-00000071 | guest2 | compute-0 | active   | None       | Running     | -            | vcpu5-2 | pinned |        None | 2,5,5 |    512 |        0 | 3-7     |    yes     |
| tenant1 | 1be7ef2b-8298-46f0-af8d-80ea67ead7bd | instance-00000070 | guest1 | compute-1 | active   | None       | Running     | -            | vcpu4-1 | pinned |        None | 1,4,4 |    512 |        0 | 3-6     |    yes     |
| tenant1 | bac22332-e1b4-426f-8fd6-cd44eeda8354 | instance-00000072 | guest3 | compute-1 | active   | None       | Running     | -            | vcpu5-2 | pinned |        None | 2,5,5 |    512 |        1 | 10-14   |    yes     |
+---------+--------------------------------------+-------------------+--------+-----------+----------+------------+-------------+--------------+---------+--------+-------------+-------+--------+----------+---------+------------+
[0;32m<guest1[0m
Thu Feb  5 15:38:13 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ [0;32m
Assigned Var:min_cpu=1
[0m
[0;32m
Assigned Var:cur_cpu=4
[0m
[0;32m
Assigned Var:max_cpu=4
[0m
[1;34m
=== scale down guest1 cpu to the minimum value:1
[0m
[0;32m
While: expr { "1" < "4" } |result=TRUE
[0m
[0;32m

Setting Expect Timeout to: 20 

[0m
nova scale guest1 cpu down
Thu Feb  5 15:38:26 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ echo $?
0
Thu Feb  5 15:38:26 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ [0;32m<
0[0m
[0;32m
While: expr { "1" < "3" } |result=TRUE
[0m
[0;32m

Setting Expect Timeout to: 20 

[0m
nova scale guest1 cpu down
Thu Feb  5 15:38:29 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ echo $?
0
Thu Feb  5 15:38:29 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ [0;32m<
0[0m
[0;32m
While: expr { "1" < "2" } |result=TRUE
[0m
[0;32m

Setting Expect Timeout to: 20 

[0m
nova scale guest1 cpu down
Thu Feb  5 15:38:33 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ echo $?
0
Thu Feb  5 15:38:33 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ [0;32m<
0[0m
[0;32m
While: expr { "1" < "1" } |result=FALSE
[0m
[1;34m
 === check if guest1 current cpu value reached minimum cpu value:1
[0m
nova show guest1
+--------------------------------------+----------------------------------------------------------------------------------------------------------------------------------+
| Property                             | Value                                                                                                                            |
+--------------------------------------+----------------------------------------------------------------------------------------------------------------------------------+
| OS-DCF:diskConfig                    | MANUAL                                                                                                                           |
| OS-EXT-AZ:availability_zone          | nova                                                                                                                             |
| OS-EXT-STS:power_state               | 1                                                                                                                                |
| OS-EXT-STS:task_state                | -                                                                                                                                |
| OS-EXT-STS:vm_state                  | active                                                                                                                           |
| OS-SRV-USG:launched_at               | 2015-02-05T15:37:46.553947                                                                                                       |
| OS-SRV-USG:terminated_at             | -                                                                                                                                |
| accessIPv4                           |                                                                                                                                  |
| accessIPv6                           |                                                                                                                                  |
| config_drive                         |                                                                                                                                  |
| created                              | 2015-02-05T15:37:37Z                                                                                                             |
| extended                             | {"cpuset": 8, "numanode": 0, "siblings_cpuset": null}                                                                            |
| flavor                               | vcpu4-1 (5f0d748b-1c8b-4a70-1985-4d57e25ac137)                                                                                   |
| hostId                               | 1ea8da9884e6179694739654aaa506b2817ea351d58559c80c37d716                                                                         |
| id                                   | 1be7ef2b-8298-46f0-af8d-80ea67ead7bd                                                                                             |
| image                                | cgcs-guest (7aeabc04-8b05-44fa-bfe6-07d6dfbfc6ea)                                                                                |
| key_name                             | keypair-tenant1                                                                                                                  |
| metadata                             | {}                                                                                                                               |
| name                                 | guest1                                                                                                                           |
| nics                                 | {"nic1": {"vif_model": "virtio", "port_id": "51675f43-af24-4f0b-b7ad-4c238f806fc0", "network": "tenant1-mgmt-net", "mtu": 1500}} |
| os-extended-volumes:volumes_attached | []                                                                                                                               |
| pinned                               | True                                                                                                                             |
| progress                             | 0                                                                                                                                |
| server_group                         |                                                                                                                                  |
| status                               | ACTIVE                                                                                                                           |
| tenant1-mgmt-net network             | 192.168.109.19                                                                                                                   |
| tenant_id                            | a4e3a58f85e344c9b238f99045ee9e4e                                                                                                 |
| updated                              | 2015-02-05T15:38:32Z                                                                                                             |
| user_id                              | 49be897e674a4456af937371ecfa936d                                                                                                 |
| vcpus (min/cur/max)                  | [1, 1, 4]                                                                                                                        |
+--------------------------------------+----------------------------------------------------------------------------[0;32m<min/cur/max[0m
------------------------------------------------------+
Thu Feb  5 15:38:34 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ [0;32m
Assigned Var:min_cpu=1
[0m
[0;32m
Assigned Var:cur_cpu=1
[0m
[0;32m
Assigned Var:max_cpu=4
[0m
[0;32m
If: expr { "1" != "1" } |then   [|result=FALSE
[0m
[1;34m
 === guest1 scale down should fail beyond minimum limit: 1
[0m
vm-topology -s servers
libnuma: Warning: Cannot parse sysfs meminfo (3)
vm-topology: 2015-02-05T15:38:35.362895  options: show:['servers']

SERVERS (nova view):  Legend: cpulist = [cpu_id[i], ...], S = siblings, R = reserved
+---------+--------------------------------------+-------------------+--------+-----------+----------+------------+-------------+--------------+---------+--------+-------------+-------+--------+----------+---------+------------+
| tenant  | ID                                   | instance_name     | name   | host      | vm_state | task_state | power_state | server_group | flavor  | pinned | shared_vcpu | vcpus | memory | numanode | cpulist | in_libvirt |
+---------+--------------------------------------+-------------------+--------+-----------+----------+------------+-------------+--------------+---------+--------+-------------+-------+--------+----------+---------+------------+
| tenant1 | 3fba3be4-b0e1-44d2-80d9-ae8495e13f82 | instance-00000071 | guest2 | compute-0 | active   | None       | Running     | -            | vcpu5-2 | pinned |        None | 2,5,5 |    512 |        0 | 3-7     |    yes     |
| tenant1 | 1be7ef2b-8298-46f0-af8d-80ea67ead7bd | instance-00000070 | guest1 | compute-1 | active   | None       | Running     | -            | vcpu4-1 | pinned |        None | 1,1,4 |    512 |        0 | 3       |    yes     |
| tenant1 | bac22332-e1b4-426f-8fd6-cd44eeda8354 | instance-00000072 | guest3 | compute-1 | active   | None       | Running     | -            | vcpu5-2 | pinned |        None | 2,5,5 |    512 |        1 | 10-14   |    yes     |
+---------+--------------------------------------+-------------------+--------+-----------+----------+------------+-------------+--------------+---------+--------+-------------+-------+--------+----------+---------+------------+
Thu Feb  5 15:38:36 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ nova scale guest1 cpu down
ERROR (BadRequest): When scaling, cannot scale beyond limits! (HTTP 400) (Request-ID: req-a9c1c05a-0277-4a64-80e3-339d925a4ca3)
Thu Feb  5 15:38:38 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ [0;32m

Setting Expect Timeout to: 25 

[0m
echo $?
1
Thu Feb  5 15:38:38 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ [0;32m<
1[0m
[1;34m
 === scale down of vm2 completed
[0m
[0;32m
While: expr { "2" <= "3" } |result=TRUE
[0m
[1;34m
 === execute scale down for guest2
[0m
[1;34m
 === save the current state of guest2 cpu
[0m
[0;32m

Setting Expect Timeout to: 25 

[0m
vm-topology -s servers
libnuma: Warning: Cannot parse sysfs meminfo (3)
vm-topology: 2015-02-05T15:38:38.596408  options: show:['servers']

SERVERS (nova view):  Legend: cpulist = [cpu_id[i], ...], S = siblings, R = reserved
+---------+--------------------------------------+-------------------+--------+-----------+----------+------------+-------------+--------------+---------+--------+-------------+-------+--------+----------+---------+------------+
| tenant  | ID                                   | instance_name     | name   | host      | vm_state | task_state | power_state | server_group | flavor  | pinned | shared_vcpu | vcpus | memory | numanode | cpulist | in_libvirt |
+---------+--------------------------------------+-------------------+--------+-----------+----------+------------+-------------+--------------+---------+--------+-------------+-------+--------+----------+---------+------------+
| tenant1 | 3fba3be4-b0e1-44d2-80d9-ae8495e13f82 | instance-00000071 | guest2 | compute-0 | active   | None       | Running     | -            | vcpu5-2 | pinned |        None | 2,5,5 |    512 |        0 | 3-7     |    yes     |
| tenant1 | 1be7ef2b-8298-46f0-af8d-80ea67ead7bd | instance-00000070 | guest1 | compute-1 | active   | None       | Running     | -            | vcpu4-1 | pinned |        None | 1,1,4 |    512 |        0 | 3       |    yes     |
| tenant1 | bac22332-e1b4-426f-8fd6-cd44eeda8354 | instance-00000072 | guest3 | compute-1 | active   | None       | Running     | -            | vcpu5-2 | pinned |        None | 2,5,5 |    512 |        1 | 10-14   |    yes     |
+---------+--------------------------------------+-------------------+--------+-----------+----------+------------+-------------+--------------+---------+--------+-------------+-------+--------+----------+---------+------------+
[0;32m<guest2[0m
Thu Feb  5 15:38:39 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ [0;32m
Assigned Var:min_cpu=2
[0m
[0;32m
Assigned Var:cur_cpu=5
[0m
[0;32m
Assigned Var:max_cpu=5
[0m
[1;34m
=== scale down guest2 cpu to the minimum value:2
[0m
[0;32m
While: expr { "2" < "5" } |result=TRUE
[0m
[0;32m

Setting Expect Timeout to: 20 

[0m
nova scale guest2 cpu down
Thu Feb  5 15:38:43 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ echo $?
0
Thu Feb  5 15:38:43 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ [0;32m<
0[0m
[0;32m
While: expr { "2" < "4" } |result=TRUE
[0m
[0;32m

Setting Expect Timeout to: 20 

[0m
nova scale guest2 cpu down
Thu Feb  5 15:38:46 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ echo $?
0
Thu Feb  5 15:38:46 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ [0;32m<
0[0m
[0;32m
While: expr { "2" < "3" } |result=TRUE
[0m
[0;32m

Setting Expect Timeout to: 20 

[0m
nova scale guest2 cpu down
Thu Feb  5 15:38:50 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ echo $?
0
Thu Feb  5 15:38:50 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ [0;32m<
0[0m
[0;32m
While: expr { "2" < "2" } |result=FALSE
[0m
[1;34m
 === check if guest2 current cpu value reached minimum cpu value:2
[0m
nova show guest2
+--------------------------------------+----------------------------------------------------------------------------------------------------------------------------------+
| Property                             | Value                                                                                                                            |
+--------------------------------------+----------------------------------------------------------------------------------------------------------------------------------+
| OS-DCF:diskConfig                    | MANUAL                                                                                                                           |
| OS-EXT-AZ:availability_zone          | nova                                                                                                                             |
| OS-EXT-STS:power_state               | 1                                                                                                                                |
| OS-EXT-STS:task_state                | -                                                                                                                                |
| OS-EXT-STS:vm_state                  | active                                                                                                                           |
| OS-SRV-USG:launched_at               | 2015-02-05T15:37:48.018830                                                                                                       |
| OS-SRV-USG:terminated_at             | -                                                                                                                                |
| accessIPv4                           |                                                                                                                                  |
| accessIPv6                           |                                                                                                                                  |
| config_drive                         |                                                                                                                                  |
| created                              | 2015-02-05T15:37:38Z                                                                                                             |
| extended                             | {"cpuset": 24, "numanode": 0, "siblings_cpuset": null}                                                                           |
| flavor                               | vcpu5-2 (db9b37f5-cba5-1985-a264-a6c1375a4ff7)                                                                                   |
| hostId                               | 5108074ec1b70826f368003ec6b5aedb0cdb9edb1e36064b0afbe7ad                                                                         |
| id                                   | 3fba3be4-b0e1-44d2-80d9-ae8495e13f82                                                                                             |
| image                                | cgcs-guest (7aeabc04-8b05-44fa-bfe6-07d6dfbfc6ea)                                                                                |
| key_name                             | keypair-tenant1                                                                                                                  |
| metadata                             | {}                                                                                                                               |
| name                                 | guest2                                                                                                                           |
| nics                                 | {"nic1": {"vif_model": "virtio", "port_id": "d96cede7-54c4-4184-a54d-96903b412409", "network": "tenant1-mgmt-net", "mtu": 1500}} |
| os-extended-volumes:volumes_attached | []                                                                                                                               |
| pinned                               | True                                                                                                                             |
| progress                             | 0                                                                                                                                |
| server_group                         |                                                                                                                                  |
| status                               | ACTIVE                                                                                                                           |
| tenant1-mgmt-net network             | 192.168.109.20                                                                                                                   |
| tenant_id                            | a4e3a58f85e344c9b238f99045ee9e4e                                                                                                 |
| updated                              | 2015-02-05T15:38:49Z                                                                                                             |
| user_id                              | 49be897e674a4456af937371ecfa936d                                                                                                 |
| vcpus (min/cur/max)                  | [2, 2, 5]                                                                                                                        |
+--------------------------------------+----------------------------------------------------------------------------------------------------------------------------------+
[0;32m<min/cur/max[0m
Thu Feb  5 15:38:51 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ [0;32m
Assigned Var:min_cpu=2
[0m
[0;32m
Assigned Var:cur_cpu=2
[0m
[0;32m
Assigned Var:max_cpu=5
[0m
[0;32m
If: expr { "2" != "2" } |then   [|result=FALSE
[0m
[1;34m
 === guest2 scale down should fail beyond minimum limit: 2
[0m
vm-topology -s servers
libnuma: Warning: Cannot parse sysfs meminfo (3)
vm-topology: 2015-02-05T15:38:52.430567  options: show:['servers']

SERVERS (nova view):  Legend: cpulist = [cpu_id[i], ...], S = siblings, R = reserved
+---------+--------------------------------------+-------------------+--------+-----------+----------+------------+-------------+--------------+---------+--------+-------------+-------+--------+----------+---------+------------+
| tenant  | ID                                   | instance_name     | name   | host      | vm_state | task_state | power_state | server_group | flavor  | pinned | shared_vcpu | vcpus | memory | numanode | cpulist | in_libvirt |
+---------+--------------------------------------+-------------------+--------+-----------+----------+------------+-------------+--------------+---------+--------+-------------+-------+--------+----------+---------+------------+
| tenant1 | 3fba3be4-b0e1-44d2-80d9-ae8495e13f82 | instance-00000071 | guest2 | compute-0 | active   | None       | Running     | -            | vcpu5-2 | pinned |        None | 2,2,5 |    512 |        0 | 3-4     |    yes     |
| tenant1 | 1be7ef2b-8298-46f0-af8d-80ea67ead7bd | instance-00000070 | guest1 | compute-1 | active   | None       | Running     | -            | vcpu4-1 | pinned |        None | 1,1,4 |    512 |        0 | 3       |    yes     |
| tenant1 | bac22332-e1b4-426f-8fd6-cd44eeda8354 | instance-00000072 | guest3 | compute-1 | active   | None       | Running     | -            | vcpu5-2 | pinned |        None | 2,5,5 |    512 |        1 | 10-14   |    yes     |
+---------+--------------------------------------+-------------------+--------+-----------+----------+------------+-------------+--------------+---------+--------+-------------+-------+--------+----------+---------+------------+
Thu Feb  5 15:38:53 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ nova scale guest2 cpu down
ERROR (BadRequest): When scaling, cannot scale beyond limits! (HTTP 400) (Request-ID: req-629e7e46-0ea2-44d0-b2bc-b14b79db822c)
Thu Feb  5 15:38:55 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ [0;32m

Setting Expect Timeout to: 25 

[0m
echo $?
1
Thu Feb  5 15:38:55 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ [0;32m<
1[0m
[1;34m
 === scale down of vm3 completed
[0m
[0;32m
While: expr { "3" <= "3" } |result=TRUE
[0m
[1;34m
 === execute scale down for guest3
[0m
[1;34m
 === save the current state of guest3 cpu
[0m
[0;32m

Setting Expect Timeout to: 25 

[0m
vm-topology -s servers
libnuma: Warning: Cannot parse sysfs meminfo (3)
vm-topology: 2015-02-05T15:38:55.967981  options: show:['servers']

SERVERS (nova view):  Legend: cpulist = [cpu_id[i], ...], S = siblings, R = reserved
+---------+--------------------------------------+-------------------+--------+-----------+----------+------------+-------------+--------------+---------+--------+-------------+-------+--------+----------+---------+------------+
| tenant  | ID                                   | instance_name     | name   | host      | vm_state | task_state | power_state | server_group | flavor  | pinned | shared_vcpu | vcpus | memory | numanode | cpulist | in_libvirt |
+---------+--------------------------------------+-------------------+--------+-----------+----------+------------+-------------+--------------+---------+--------+-------------+-------+--------+----------+---------+------------+
| tenant1 | 3fba3be4-b0e1-44d2-80d9-ae8495e13f82 | instance-00000071 | guest2 | compute-0 | active   | None       | Running     | -            | vcpu5-2 | pinned |        None | 2,2,5 |    512 |        0 | 3-4     |    yes     |
| tenant1 | 1be7ef2b-8298-46f0-af8d-80ea67ead7bd | instance-00000070 | guest1 | compute-1 | active   | None       | Running     | -            | vcpu4-1 | pinned |        None | 1,1,4 |    512 |        0 | 3       |    yes     |
| tenant1 | bac22332-e1b4-426f-8fd6-cd44eeda8354 | instance-00000072 | guest3 | compute-1 | active   | None       | Running     | -            | vcpu5-2 | pinned |        None | 2,5,5 |    512 |        1 | 10-14   |    yes     |
+---------+--------------------------------------+-------------------+--------+-----------+----------+------------+-------------+--------------+---------+--------+-------------+-------+--------+----------+---------+------------+
[0;32m<guest3[0m
Thu Feb  5 15:38:57 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ [0;32m
Assigned Var:min_cpu=2
[0m
[0;32m
Assigned Var:cur_cpu=5
[0m
[0;32m
Assigned Var:max_cpu=5
[0m
[1;34m
=== scale down guest3 cpu to the minimum value:2
[0m
[0;32m
While: expr { "2" < "5" } |result=TRUE
[0m
[0;32m

Setting Expect Timeout to: 20 

[0m
nova scale guest3 cpu down
Thu Feb  5 15:39:01 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ echo $?
0
Thu Feb  5 15:39:01 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ [0;32m<
0[0m
[0;32m
While: expr { "2" < "4" } |result=TRUE
[0m
[0;32m

Setting Expect Timeout to: 20 

[0m
nova scale guest3 cpu down
Thu Feb  5 15:39:04 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ echo $?
0
Thu Feb  5 15:39:04 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ [0;32m<
0[0m
[0;32m
While: expr { "2" < "3" } |result=TRUE
[0m
[0;32m

Setting Expect Timeout to: 20 

[0m
nova scale guest3 cpu down
Thu Feb  5 15:39:07 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ echo $?
0
Thu Feb  5 15:39:07 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ [0;32m<
0[0m
[0;32m
While: expr { "2" < "2" } |result=FALSE
[0m
[1;34m
 === check if guest3 current cpu value reached minimum cpu value:2
[0m
nova show guest3
+--------------------------------------+----------------------------------------------------------------------------------------------------------------------------------+
| Property                             | Value                                                                                                                            |
+--------------------------------------+----------------------------------------------------------------------------------------------------------------------------------+
| OS-DCF:diskConfig                    | MANUAL                                                                                                                           |
| OS-EXT-AZ:availability_zone          | nova                                                                                                                             |
| OS-EXT-STS:power_state               | 1                                                                                                                                |
| OS-EXT-STS:task_state                | -                                                                                                                                |
| OS-EXT-STS:vm_state                  | active                                                                                                                           |
| OS-SRV-USG:launched_at               | 2015-02-05T15:37:49.245847                                                                                                       |
| OS-SRV-USG:terminated_at             | -                                                                                                                                |
| accessIPv4                           |                                                                                                                                  |
| accessIPv6                           |                                                                                                                                  |
| config_drive                         |                                                                                                                                  |
| created                              | 2015-02-05T15:37:40Z                                                                                                             |
| extended                             | {"cpuset": 3072, "numanode": 1, "siblings_cpuset": null}                                                                         |
| flavor                               | vcpu5-2 (db9b37f5-cba5-1985-a264-a6c1375a4ff7)                                                                                   |
| hostId                               | 1ea8da9884e6179694739654aaa506b2817ea351d58559c80c37d716                                                                         |
| id                                   | bac22332-e1b4-426f-8fd6-cd44eeda8354                                                                                             |
| image                                | cgcs-guest (7aeabc04-8b05-44fa-bfe6-07d6dfbfc6ea)                                                                                |
| key_name                             | keypair-tenant1                                                                                                                  |
| metadata                             | {}                                                                                                                               |
| name                                 | guest3                                                                                                                           |
| nics                                 | {"nic1": {"vif_model": "virtio", "port_id": "3da5b17c-91bd-4171-b65d-3d6f6dfa823e", "network": "tenant1-mgmt-net", "mtu": 1500}} |
| os-extended-volumes:volumes_attached | []                                                                                                                               |
| pinned                               | True                                                                                                                             |
| progress                             | 0                                                                                                                                |
| server_group                         |                                                                                                                                  |
| status                               | ACTIVE                                                                                                                           |
| tenant1-mgmt-net network             | 192.168.109.21                                                                                                                   |
| tenant_id                            | a4e3a58f85e344c9b238f99045ee9e4e                                                                                                 |
| updated                              | 2015-02-05T15:39:07Z                                                                                                             |
| user_id                              | 49be897e674a4456af937371ecfa936d                                                                                                 |
| vcpus (min/cur/max)                  | [2, 2, 5]                                                                                                                        |
+--------------------------------------+----------------------------------------------------------------------------------------------------------------------------------+
[0;32m<min/cur/max[0m
Thu Feb  5 15:39:09 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ [0;32m
Assigned Var:min_cpu=2
[0m
[0;32m
Assigned Var:cur_cpu=2
[0m
[0;32m
Assigned Var:max_cpu=5
[0m
[0;32m
If: expr { "2" != "2" } |then   [|result=FALSE
[0m
[1;34m
 === guest3 scale down should fail beyond minimum limit: 2
[0m
vm-topology -s servers
libnuma: Warning: Cannot parse sysfs meminfo (3)
vm-topology: 2015-02-05T15:39:09.975138  options: show:['servers']

SERVERS (nova view):  Legend: cpulist = [cpu_id[i], ...], S = siblings, R = reserved
+---------+--------------------------------------+-------------------+--------+-----------+----------+------------+-------------+--------------+---------+--------+-------------+-------+--------+----------+---------+------------+
| tenant  | ID                                   | instance_name     | name   | host      | vm_state | task_state | power_state | server_group | flavor  | pinned | shared_vcpu | vcpus | memory | numanode | cpulist | in_libvirt |
+---------+--------------------------------------+-------------------+--------+-----------+----------+------------+-------------+--------------+---------+--------+-------------+-------+--------+----------+---------+------------+
| tenant1 | 3fba3be4-b0e1-44d2-80d9-ae8495e13f82 | instance-00000071 | guest2 | compute-0 | active   | None       | Running     | -            | vcpu5-2 | pinned |        None | 2,2,5 |    512 |        0 | 3-4     |    yes     |
| tenant1 | 1be7ef2b-8298-46f0-af8d-80ea67ead7bd | instance-00000070 | guest1 | compute-1 | active   | None       | Running     | -            | vcpu4-1 | pinned |        None | 1,1,4 |    512 |        0 | 3       |    yes     |
| tenant1 | bac22332-e1b4-426f-8fd6-cd44eeda8354 | instance-00000072 | guest3 | compute-1 | active   | None       | Running     | -            | vcpu5-2 | pinned |        None | 2,2,5 |    512 |        1 | 10-11   |    yes     |
+---------+--------------------------------------+-------------------+--------+-----------+----------+------------+-------------+--------------+---------+--------+-------------+-------+--------+----------+---------+------------+
Thu Feb  5 15:39:11 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ nova scale guest3 cpu down
ERROR (BadRequest): When scaling, cannot scale beyond limits! (HTTP 400) (Request-ID: req-92cb60d7-e82c-4abc-ac45-642e5b3380e1)
Thu Feb  5 15:39:12 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ [0;32m

Setting Expect Timeout to: 25 

[0m
echo $?
1
Thu Feb  5 15:39:12 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ [0;32m<
1[0m
[1;34m
 === scale down of vm4 completed
[0m
[0;32m
While: expr { "4" <= "3" } |result=FALSE
[0m
[1;34m
 === scale down of all VMs completed
[0m
[0;32m
While: expr { "1" <= "3" } |result=TRUE
[0m
[1;34m
 === save the current state of guest1 cpu
[0m
vm-topology -s servers
libnuma: Warning: Cannot parse sysfs meminfo (3)
vm-topology: 2015-02-05T15:39:13.186026  options: show:['servers']

SERVERS (nova view):  Legend: cpulist = [cpu_id[i], ...], S = siblings, R = reserved
+---------+--------------------------------------+-------------------+--------+-----------+----------+------------+-------------+--------------+---------+--------+-------------+-------+--------+----------+---------+------------+
| tenant  | ID                                   | instance_name     | name   | host      | vm_state | task_state | power_state | server_group | flavor  | pinned | shared_vcpu | vcpus | memory | numanode | cpulist | in_libvirt |
+---------+--------------------------------------+-------------------+--------+-----------+----------+------------+-------------+--------------+---------+--------+-------------+-------+--------+----------+---------+------------+
| tenant1 | 3fba3be4-b0e1-44d2-80d9-ae8495e13f82 | instance-00000071 | guest2 | compute-0 | active   | None       | Running     | -            | vcpu5-2 | pinned |        None | 2,2,5 |    512 |        0 | 3-4     |    yes     |
| tenant1 | 1be7ef2b-8298-46f0-af8d-80ea67ead7bd | instance-00000070 | guest1 | compute-1 | active   | None       | Running     | -            | vcpu4-1 | pinned |        None | 1,1,4 |    512 |        0 | 3       |    yes     |
| tenant1 | bac22332-e1b4-426f-8fd6-cd44eeda8354 | instance-00000072 | guest3 | compute-1 | active   | None       | Running     | -            | vcpu5-2 | pinned |        None | 2,2,5 |    512 |        1 | 10-11   |    yes     |
+---------+--------------------------------------+-------------------+--------+-----------+----------+------------+-------------+--------------+---------+--------+-------------+-------+--------+----------+---------+------------+
[0;32m<guest1[0m
Thu Feb  5 15:39:14 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ [0;32m
Assigned Var:min_cpu=1
[0m
[0;32m
Assigned Var:cur_cpu=1
[0m
[0;32m
Assigned Var:max_cpu=4
[0m
[1;34m
=== scale up cpu to the maximum value:4
[0m
[0;32m
While: expr { "1" < "4" } |result=TRUE
[0m
[0;32m

Setting Expect Timeout to: 20 

[0m
nova scale guest1 cpu up
Thu Feb  5 15:39:17 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ echo $?
0
Thu Feb  5 15:39:17 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ [0;32m<
0[0m
[0;32m
While: expr { "2" < "4" } |result=TRUE
[0m
[0;32m

Setting Expect Timeout to: 20 

[0m
nova scale guest1 cpu up
Thu Feb  5 15:39:21 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ echo $?
0
Thu Feb  5 15:39:21 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ [0;32m<
0[0m
[0;32m
While: expr { "3" < "4" } |result=TRUE
[0m
[0;32m

Setting Expect Timeout to: 20 

[0m
nova scale guest1 cpu up
Thu Feb  5 15:39:24 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ echo $?
0
Thu Feb  5 15:39:24 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ [0;32m<
0[0m
[0;32m
While: expr { "4" < "4" } |result=FALSE
[0m
[1;34m
 === check if guest1 current cpu value reached max cpu value:4
[0m
nova show guest1
+--------------------------------------+----------------------------------------------------------------------------------------------------------------------------------+
| Property                             | Value                                                                                                                            |
+--------------------------------------+----------------------------------------------------------------------------------------------------------------------------------+
| OS-DCF:diskConfig                    | MANUAL                                                                                                                           |
| OS-EXT-AZ:availability_zone          | nova                                                                                                                             |
| OS-EXT-STS:power_state               | 1                                                                                                                                |
| OS-EXT-STS:task_state                | -                                                                                                                                |
| OS-EXT-STS:vm_state                  | active                                                                                                                           |
| OS-SRV-USG:launched_at               | 2015-02-05T15:37:46.553947                                                                                                       |
| OS-SRV-USG:terminated_at             | -                                                                                                                                |
| accessIPv4                           |                                                                                                                                  |
| accessIPv6                           |                                                                                                                                  |
| config_drive                         |                                                                                                                                  |
| created                              | 2015-02-05T15:37:37Z                                                                                                             |
| extended                             | {"cpuset": 120, "numanode": 0, "siblings_cpuset": null}                                                                          |
| flavor                               | vcpu4-1 (5f0d748b-1c8b-4a70-1985-4d57e25ac137)                                                                                   |
| hostId                               | 1ea8da9884e6179694739654aaa506b2817ea351d58559c80c37d716                                                                         |
| id                                   | 1be7ef2b-8298-46f0-af8d-80ea67ead7bd                                                                                             |
| image                                | cgcs-guest (7aeabc04-8b05-44fa-bfe6-07d6dfbfc6ea)                                                                                |
| key_name                             | keypair-tenant1                                                                                                                  |
| metadata                             | {}                                                                                                                               |
| name                                 | guest1                                                                                                                           |
| nics                                 | {"nic1": {"vif_model": "virtio", "port_id": "51675f43-af24-4f0b-b7ad-4c238f806fc0", "network": "tenant1-mgmt-net", "mtu": 1500}} |
| os-extended-volumes:volumes_attached | []                                                                                                                               |
| pinned                               | True                                                                                                                             |
| progress                             | 0                                                                                                                                |
| server_group                         |                                                                                                                                  |
| status                               | ACTIVE                                                                                                                           |
| tenant1-mgmt-net network             | 192.168.109.19                                                                                                                   |
| tenant_id                            | a4e3a58f85e344c9b238f99045ee9e4e                                                                                                 |
| updated                              | 2015-02-05T15:39:23Z                                                                                                             |
| user_id                              | 49be897e674a4456af937371ecfa936d                                                                                                 |
| vcpus (min/cur/max)                  | [1, 4, 4]                                                                                                                        |
+--------------------------------------+----------------------------------------------------------------------------------------------------------------------------------+
[0;32m<min/cur/max[0m
Thu Feb  5 15:39:26 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ [0;32m
Assigned Var:min_cpu=1
[0m
[0;32m
Assigned Var:cur_cpu=4
[0m
[0;32m
Assigned Var:max_cpu=4
[0m
[0;32m
If: expr { "4" != "4" } |then   [|result=FALSE
[0m
[1;34m
 === guest1 scale up should fail beyond max limit: 4
[0m
vm-topology -s servers
libnuma: Warning: Cannot parse sysfs meminfo (3)
vm-topology: 2015-02-05T15:39:26.999678  options: show:['servers']

SERVERS (nova view):  Legend: cpulist = [cpu_id[i], ...], S = siblings, R = reserved
+---------+--------------------------------------+-------------------+--------+-----------+----------+------------+-------------+--------------+---------+--------+-------------+-------+--------+----------+---------+------------+
| tenant  | ID                                   | instance_name     | name   | host      | vm_state | task_state | power_state | server_group | flavor  | pinned | shared_vcpu | vcpus | memory | numanode | cpulist | in_libvirt |
+---------+--------------------------------------+-------------------+--------+-----------+----------+------------+-------------+--------------+---------+--------+-------------+-------+--------+----------+---------+------------+
| tenant1 | 3fba3be4-b0e1-44d2-80d9-ae8495e13f82 | instance-00000071 | guest2 | compute-0 | active   | None       | Running     | -            | vcpu5-2 | pinned |        None | 2,2,5 |    512 |        0 | 3-4     |    yes     |
| tenant1 | 1be7ef2b-8298-46f0-af8d-80ea67ead7bd | instance-00000070 | guest1 | compute-1 | active   | None       | Running     | -            | vcpu4-1 | pinned |        None | 1,4,4 |    512 |        0 | 3-6     |    yes     |
| tenant1 | bac22332-e1b4-426f-8fd6-cd44eeda8354 | instance-00000072 | guest3 | compute-1 | active   | None       | Running     | -            | vcpu5-2 | pinned |        None | 2,2,5 |    512 |        1 | 10-11   |    yes     |
+---------+--------------------------------------+-------------------+--------+-----------+----------+------------+-------------+--------------+---------+--------+-------------+-------+--------+----------+---------+------------+
Thu Feb  5 15:39:28 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ nova scale guest1 cpu up
ERROR (BadRequest): When scaling, cannot scale beyond limits! (HTTP 400) (Request-ID: req-7798529b-c8d6-42f4-b391-f0f5aa01f0a0)
Thu Feb  5 15:39:29 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ [0;32m

Setting Expect Timeout to: 25 

[0m
echo $?
1
Thu Feb  5 15:39:29 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ [0;32m<
1[0m
[1;34m
 === scale up of vm2 completed
[0m
[0;32m
While: expr { "2" <= "3" } |result=TRUE
[0m
[1;34m
 === save the current state of guest2 cpu
[0m
vm-topology -s servers
libnuma: Warning: Cannot parse sysfs meminfo (3)
vm-topology: 2015-02-05T15:39:30.375916  options: show:['servers']

SERVERS (nova view):  Legend: cpulist = [cpu_id[i], ...], S = siblings, R = reserved
+---------+--------------------------------------+-------------------+--------+-----------+----------+------------+-------------+--------------+---------+--------+-------------+-------+--------+----------+---------+------------+
| tenant  | ID                                   | instance_name     | name   | host      | vm_state | task_state | power_state | server_group | flavor  | pinned | shared_vcpu | vcpus | memory | numanode | cpulist | in_libvirt |
+---------+--------------------------------------+-------------------+--------+-----------+----------+------------+-------------+--------------+---------+--------+-------------+-------+--------+----------+---------+------------+
| tenant1 | 3fba3be4-b0e1-44d2-80d9-ae8495e13f82 | instance-00000071 | guest2 | compute-0 | active   | None       | Running     | -            | vcpu5-2 | pinned |        None | 2,2,5 |    512 |        0 | 3-4     |    yes     |
| tenant1 | 1be7ef2b-8298-46f0-af8d-80ea67ead7bd | instance-00000070 | guest1 | compute-1 | active   | None       | Running     | -            | vcpu4-1 | pinned |        None | 1,4,4 |    512 |        0 | 3-6     |    yes     |
| tenant1 | bac22332-e1b4-426f-8fd6-cd44eeda8354 | instance-00000072 | guest3 | compute-1 | active   | None       | Running     | -            | vcpu5-2 | pinned |        None | 2,2,5 |    512 |        1 | 10-11   |    yes     |
+---------+--------------------------------------+-------------------+--------+-----------+----------+------------+-------------+--------------+---------+--------+-------------+-------+--------+----------+---------+------------+
[0;32m<guest2[0m
Thu Feb  5 15:39:31 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ [0;32m
Assigned Var:min_cpu=2
[0m
[0;32m
Assigned Var:cur_cpu=2
[0m
[0;32m
Assigned Var:max_cpu=5
[0m
[1;34m
=== scale up cpu to the maximum value:5
[0m
[0;32m
While: expr { "2" < "5" } |result=TRUE
[0m
[0;32m

Setting Expect Timeout to: 20 

[0m
nova scale guest2 cpu up
Thu Feb  5 15:39:35 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ echo $?
0
Thu Feb  5 15:39:35 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ [0;32m<
0[0m
[0;32m
While: expr { "3" < "5" } |result=TRUE
[0m
[0;32m

Setting Expect Timeout to: 20 

[0m
nova scale guest2 cpu up
Thu Feb  5 15:39:38 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ echo $?
0
Thu Feb  5 15:39:38 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ [0;32m<
0[0m
[0;32m
While: expr { "4" < "5" } |result=TRUE
[0m
[0;32m

Setting Expect Timeout to: 20 

[0m
nova scale guest2 cpu up
Thu Feb  5 15:39:42 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ echo $?
0
Thu Feb  5 15:39:42 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ [0;32m<
0[0m
[0;32m
While: expr { "5" < "5" } |result=FALSE
[0m
[1;34m
 === check if guest2 current cpu value reached max cpu value:5
[0m
nova show guest2
+--------------------------------------+----------------------------------------------------------------------------------------------------------------------------------+
| Property                             | Value                                                                                                                            |
+--------------------------------------+----------------------------------------------------------------------------------------------------------------------------------+
| OS-DCF:diskConfig                    | MANUAL                                                                                                                           |
| OS-EXT-AZ:availability_zone          | nova                                                                                                                             |
| OS-EXT-STS:power_state               | 1                                                                                                                                |
| OS-EXT-STS:task_state                | -                                                                                                                                |
| OS-EXT-STS:vm_state                  | active                                                                                                                           |
| OS-SRV-USG:launched_at               | 2015-02-05T15:37:48.018830                                                                                                       |
| OS-SRV-USG:terminated_at             | -                                                                                                                                |
| accessIPv4                           |                                                                                                                                  |
| accessIPv6                           |                                                                                                                                  |
| config_drive                         |                                                                                                                                  |
| created                              | 2015-02-05T15:37:38Z                                                                                                             |
| extended                             | {"cpuset": 248, "numanode": 0, "siblings_cpuset": null}                                                                          |
| flavor                               | vcpu5-2 (db9b37f5-cba5-1985-a264-a6c1375a4ff7)                                                                                   |
| hostId                               | 5108074ec1b70826f368003ec6b5aedb0cdb9edb1e36064b0afbe7ad                                                                         |
| id                                   | 3fba3be4-b0e1-44d2-80d9-ae8495e13f82                                                                                             |
| image                                | cgcs-guest (7aeabc04-8b05-44fa-bfe6-07d6dfbfc6ea)                                                                                |
| key_name                             | keypair-tenant1                                                                                                                  |
| metadata                             | {}                                                                                                                               |
| name                                 | guest2                                                                                                                           |
| nics                                 | {"nic1": {"vif_model": "virtio", "port_id": "d96cede7-54c4-4184-a54d-96903b412409", "network": "tenant1-mgmt-net", "mtu": 1500}} |
| os-extended-volumes:volumes_attached | []                                                                                                                               |
| pinned                               | True                                                                                                                             |
| progress                             | 0                                                                                                                                |
| server_group                         |                                                                                                                                  |
| status                               | ACTIVE                                                                                                                           |
| tenant1-mgmt-net network             | 192.168.109.20                                                                                                                   |
| tenant_id                            | a4e3a58f85e344c9b238f99045ee9e4e                                                                                                 |
| updated                              | 2015-02-05T15:39:41Z                                                                                                             |
| user_id                              | 49be897e674a4456af937371ecfa936d                                                                                                 |
| vcpus (min/cur/max)                  | [2, 5, 5]                                                                                                                        |
+--------------------------------------+----------------------------------------------------------------------------------------------------------------------------------+
[0;32m<min/cur/max[0m
Thu Feb  5 15:39:43 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ [0;32m
Assigned Var:min_cpu=2
[0m
[0;32m
Assigned Var:cur_cpu=5
[0m
[0;32m
Assigned Var:max_cpu=5
[0m
[0;32m
If: expr { "5" != "5" } |then   [|result=FALSE
[0m
[1;34m
 === guest2 scale up should fail beyond max limit: 5
[0m
vm-topology -s servers
libnuma: Warning: Cannot parse sysfs meminfo (3)
vm-topology: 2015-02-05T15:39:43.795452  options: show:['servers']

SERVERS (nova view):  Legend: cpulist = [cpu_id[i], ...], S = siblings, R = reserved
+---------+--------------------------------------+-------------------+--------+-----------+----------+------------+-------------+--------------+---------+--------+-------------+-------+--------+----------+---------+------------+
| tenant  | ID                                   | instance_name     | name   | host      | vm_state | task_state | power_state | server_group | flavor  | pinned | shared_vcpu | vcpus | memory | numanode | cpulist | in_libvirt |
+---------+--------------------------------------+-------------------+--------+-----------+----------+------------+-------------+--------------+---------+--------+-------------+-------+--------+----------+---------+------------+
| tenant1 | 3fba3be4-b0e1-44d2-80d9-ae8495e13f82 | instance-00000071 | guest2 | compute-0 | active   | None       | Running     | -            | vcpu5-2 | pinned |        None | 2,5,5 |    512 |        0 | 3-7     |    yes     |
| tenant1 | 1be7ef2b-8298-46f0-af8d-80ea67ead7bd | instance-00000070 | guest1 | compute-1 | active   | None       | Running     | -            | vcpu4-1 | pinned |        None | 1,4,4 |    512 |        0 | 3-6     |    yes     |
| tenant1 | bac22332-e1b4-426f-8fd6-cd44eeda8354 | instance-00000072 | guest3 | compute-1 | active   | None       | Running     | -            | vcpu5-2 | pinned |        None | 2,2,5 |    512 |        1 | 10-11   |    yes     |
+---------+--------------------------------------+-------------------+--------+-----------+----------+------------+-------------+--------------+---------+--------+-------------+-------+--------+----------+---------+------------+
Thu Feb  5 15:39:45 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ nova scale guest2 cpu up
ERROR (BadRequest): When scaling, cannot scale beyond limits! (HTTP 400) (Request-ID: req-5f52a770-a9d0-438e-9cfc-53f032f07b11)
Thu Feb  5 15:39:46 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ [0;32m

Setting Expect Timeout to: 25 

[0m
echo $?
1
Thu Feb  5 15:39:46 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ [0;32m<
1[0m
[1;34m
 === scale up of vm3 completed
[0m
[0;32m
While: expr { "3" <= "3" } |result=TRUE
[0m
[1;34m
 === save the current state of guest3 cpu
[0m
vm-topology -s servers
libnuma: Warning: Cannot parse sysfs meminfo (3)
vm-topology: 2015-02-05T15:39:46.959397  options: show:['servers']

SERVERS (nova view):  Legend: cpulist = [cpu_id[i], ...], S = siblings, R = reserved
+---------+--------------------------------------+-------------------+--------+-----------+----------+------------+-------------+--------------+---------+--------+-------------+-------+--------+----------+---------+------------+
| tenant  | ID                                   | instance_name     | name   | host      | vm_state | task_state | power_state | server_group | flavor  | pinned | shared_vcpu | vcpus | memory | numanode | cpulist | in_libvirt |
+---------+--------------------------------------+-------------------+--------+-----------+----------+------------+-------------+--------------+---------+--------+-------------+-------+--------+----------+---------+------------+
| tenant1 | 3fba3be4-b0e1-44d2-80d9-ae8495e13f82 | instance-00000071 | guest2 | compute-0 | active   | None       | Running     | -            | vcpu5-2 | pinned |        None | 2,5,5 |    512 |        0 | 3-7     |    yes     |
| tenant1 | 1be7ef2b-8298-46f0-af8d-80ea67ead7bd | instance-00000070 | guest1 | compute-1 | active   | None       | Running     | -            | vcpu4-1 | pinned |        None | 1,4,4 |    512 |        0 | 3-6     |    yes     |
| tenant1 | bac22332-e1b4-426f-8fd6-cd44eeda8354 | instance-00000072 | guest3 | compute-1 | active   | None       | Running     | -            | vcpu5-2 | pinned |        None | 2,2,5 |    512 |        1 | 10-11   |    yes     |
+---------+--------------------------------------+-------------------+--------+-----------+----------+------------+-------------+--------------+---------+--------+-------------+-------+--------+----------+---------+------------+
[0;32m<guest3[0m
Thu Feb  5 15:39:48 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ [0;32m
Assigned Var:min_cpu=2
[0m
[0;32m
Assigned Var:cur_cpu=2
[0m
[0;32m
Assigned Var:max_cpu=5
[0m
[1;34m
=== scale up cpu to the maximum value:5
[0m
[0;32m
While: expr { "2" < "5" } |result=TRUE
[0m
[0;32m

Setting Expect Timeout to: 20 

[0m
nova scale guest3 cpu up
Thu Feb  5 15:39:52 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ echo $?
0
Thu Feb  5 15:39:52 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ [0;32m<
0[0m
[0;32m
While: expr { "3" < "5" } |result=TRUE
[0m
[0;32m

Setting Expect Timeout to: 20 

[0m
nova scale guest3 cpu up
Thu Feb  5 15:39:55 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ echo $?
0
Thu Feb  5 15:39:55 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ [0;32m<
0[0m
[0;32m
While: expr { "4" < "5" } |result=TRUE
[0m
[0;32m

Setting Expect Timeout to: 20 

[0m
nova scale guest3 cpu up
Thu Feb  5 15:39:59 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ echo $?
0
Thu Feb  5 15:39:59 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ [0;32m<
0[0m
[0;32m
While: expr { "5" < "5" } |result=FALSE
[0m
[1;34m
 === check if guest3 current cpu value reached max cpu value:5
[0m
nova show guest3
+--------------------------------------+----------------------------------------------------------------------------------------------------------------------------------+
| Property                             | Value                                                                                                                            |
+--------------------------------------+----------------------------------------------------------------------------------------------------------------------------------+
| OS-DCF:diskConfig                    | MANUAL                                                                                                                           |
| OS-EXT-AZ:availability_zone          | nova                                                                                                                             |
| OS-EXT-STS:power_state               | 1                                                                                                                                |
| OS-EXT-STS:task_state                | -                                                                                                                                |
| OS-EXT-STS:vm_state                  | active                                                                                                                           |
| OS-SRV-USG:launched_at               | 2015-02-05T15:37:49.245847                                                                                                       |
| OS-SRV-USG:terminated_at             | -                                                                                                                                |
| accessIPv4                           |                                                                                                                                  |
| accessIPv6                           |                                                                                                                                  |
| config_drive                         |                                                                                                                                  |
| created                              | 2015-02-05T15:37:40Z                                                                                                             |
| extended                             | {"cpuset": 31744, "numanode": 1, "siblings_cpuset": null}                                                                        |
| flavor                               | vcpu5-2 (db9b37f5-cba5-1985-a264-a6c1375a4ff7)                                                                                   |
| hostId                               | 1ea8da9884e6179694739654aaa506b2817ea351d58559c80c37d716                                                                         |
| id                                   | bac22332-e1b4-426f-8fd6-cd44eeda8354                                                                                             |
| image                                | cgcs-guest (7aeabc04-8b05-44fa-bfe6-07d6dfbfc6ea)                                                                                |
| key_name                             | keypair-tenant1                                                                                                                  |
| metadata                             | {}                                                                                                                               |
| name                                 | guest3                                                                                                                           |
| nics                                 | {"nic1": {"vif_model": "virtio", "port_id": "3da5b17c-91bd-4171-b65d-3d6f6dfa823e", "network": "tenant1-mgmt-net", "mtu": 1500}} |
| os-extended-volumes:volumes_attached | []                                                                                                                               |
| pinned                               | True                                                                                                                             |
| progress                             | 0                                                                                                                                |
| server_group                         |                                                                                                                                  |
| status                               | ACTIVE                                                                                                                           |
| tenant1-mgmt-net network             | 192.168.109.21                                                                                                                   |
| tenant_id                            | a4e3a58f85e344c9b238f99045ee9e4e                                                                                                 |
| updated                              | 2015-02-05T15:39:58Z                                                                                                             |
| user_id                              | 49be897e674a4456af937371ecfa936d                                                                                                 |
| vcpus (min/cur/max)                  | [2, 5, 5]                                                                                                                        |
+--------------------------------------+----------------------------------------------------------------------------------------------------------------------------------+
[0;32m<min/cur/max[0m
Thu Feb  5 15:40:00 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ [0;32m
Assigned Var:min_cpu=2
[0m
[0;32m
Assigned Var:cur_cpu=5
[0m
[0;32m
Assigned Var:max_cpu=5
[0m
[0;32m
If: expr { "5" != "5" } |then   [|result=FALSE
[0m
[1;34m
 === guest3 scale up should fail beyond max limit: 5
[0m
vm-topology -s servers
libnuma: Warning: Cannot parse sysfs meminfo (3)
vm-topology: 2015-02-05T15:40:01.137674  options: show:['servers']

SERVERS (nova view):  Legend: cpulist = [cpu_id[i], ...], S = siblings, R = reserved
+---------+--------------------------------------+-------------------+--------+-----------+----------+------------+-------------+--------------+---------+--------+-------------+-------+--------+----------+---------+------------+
| tenant  | ID                                   | instance_name     | name   | host      | vm_state | task_state | power_state | server_group | flavor  | pinned | shared_vcpu | vcpus | memory | numanode | cpulist | in_libvirt |
+---------+--------------------------------------+-------------------+--------+-----------+----------+------------+-------------+--------------+---------+--------+-------------+-------+--------+----------+---------+------------+
| tenant1 | 3fba3be4-b0e1-44d2-80d9-ae8495e13f82 | instance-00000071 | guest2 | compute-0 | active   | None       | Running     | -            | vcpu5-2 | pinned |        None | 2,5,5 |    512 |        0 | 3-7     |    yes     |
| tenant1 | 1be7ef2b-8298-46f0-af8d-80ea67ead7bd | instance-00000070 | guest1 | compute-1 | active   | None       | Running     | -            | vcpu4-1 | pinned |        None | 1,4,4 |    512 |        0 | 3-6     |    yes     |
| tenant1 | bac22332-e1b4-426f-8fd6-cd44eeda8354 | instance-00000072 | guest3 | compute-1 | active   | None       | Running     | -            | vcpu5-2 | pinned |        None | 2,5,5 |    512 |        1 | 10-14   |    yes     |
+---------+--------------------------------------+-------------------+--------+-----------+----------+------------+-------------+--------------+---------+--------+-------------+-------+--------+----------+---------+------------+
Thu Feb  5 15:40:02 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ nova scale guest3 cpu up
ERROR (BadRequest): When scaling, cannot scale beyond limits! (HTTP 400) (Request-ID: req-97429e9c-7a40-4706-96a5-69e53f227713)
Thu Feb  5 15:40:03 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ [0;32m

Setting Expect Timeout to: 25 

[0m
echo $?
1
Thu Feb  5 15:40:03 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ [0;32m<
1[0m
[1;34m
 === scale up of vm4 completed
[0m
[0;32m
While: expr { "4" <= "3" } |result=FALSE
[0m
[1;34m
 === Scale up of all Vms completed
[0m
[1;34m
 === get ID of each instance
[0m
[0;32m
While: expr { "1" <= "3" } |result=TRUE
[0m
nova list
+--------------------------------------+--------+--------+------------+-------------+---------------------------------+
| ID                                   | Name   | Status | Task State | Power State | Networks                        |
+--------------------------------------+--------+--------+------------+-------------+---------------------------------+
| 1be7ef2b-8298-46f0-af8d-80ea67ead7bd | guest1 | ACTIVE | -          | Running     | tenant1-mgmt-net=192.168.109.19 |
| 3fba3be4-b0e1-44d2-80d9-ae8495e13f82 | guest2 | ACTIVE | -          | Running     | tenant1-mgmt-net=192.168.109.20 |
| bac22332-e1b4-426f-8fd6-cd44eeda8354 | guest3 | ACTIVE | -          | Running     | tenant1-mgmt-net=192.168.109.21 |
+--------------------------------------+--------+--------+------------+-------------+---------------------------------+
Thu Feb  5 15:40:04 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ nova list | grep guest1
| 1be7ef2b-8298-46f0-af8d-80ea67ead7bd | guest1 | ACTIVE | -          | Running     | tenant1-mgmt-net=192.168.109.19 |
Thu Feb  5 15:40:05 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ [0;32m
Assigned Var:resource_id_vm1=1be7ef2b-8298-46f0-af8d-80ea67ead7bd
[0m
[0;32m
While: expr { "2" <= "3" } |result=TRUE
[0m
nova list | grep guest2
| 3fba3be4-b0e1-44d2-80d9-ae8495e13f82 | guest2 | ACTIVE | -          | Running     | tenant1-mgmt-net=192.168.109.20 |
Thu Feb  5 15:40:07 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ [0;32m
Assigned Var:resource_id_vm2=3fba3be4-b0e1-44d2-80d9-ae8495e13f82
[0m
[0;32m
While: expr { "3" <= "3" } |result=TRUE
[0m
nova list | grep guest3
| bac22332-e1b4-426f-8fd6-cd44eeda8354 | guest3 | ACTIVE | -          | Running     | tenant1-mgmt-net=192.168.109.21 |
Thu Feb  5 15:40:08 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ [0;32m
Assigned Var:resource_id_vm3=bac22332-e1b4-426f-8fd6-cd44eeda8354
[0m
[0;32m
While: expr { "4" <= "3" } |result=FALSE
[0m
ceilometer sample-create -r 1be7ef2b-8298-46f0-af8d-80ea67ead7bd -m vote --meter-type gauge --meter-unit '%' --sample-volume 2 --r esource-metadata '{"display_name":"guest1"}'
+-------------------+--------------------------------------------+
| Property          | Value                                      |
+-------------------+--------------------------------------------+
| message_id        | 43f6a1a2-ad4d-11e4-99ab-2c44fd83b910       |
| name              | vote                                       |
| project_id        | a4e3a58f85e344c9b238f99045ee9e4e           |
| resource_id       | 1be7ef2b-8298-46f0-af8d-80ea67ead7bd       |
| resource_metadata | {u'display_name': u'guest1'}               |
| source            | a4e3a58f85e344c9b238f99045ee9e4e:openstack |
| timestamp         | 2015-02-05T15:40:09.226791                 |
| type              | gauge                                      |
| unit              | %                                          |
| user_id           | 49be897e674a4456af937371ecfa936d           |
| volume            | 2.0                                        |
+-------------------+--------------------------------------------+
Thu Feb  5 15:40:09 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ ceilometer resource-show -r 1be7ef2b-8298-46f0-af8d-80ea67ead7bd
+-------------+--------------------------------------------+
| Property    | Value                                      |
+-------------+--------------------------------------------+
| metadata    | {u'display_name': u'guest1'}               |
| project_id  | a4e3a58f85e344c9b238f99045ee9e4e           |
| resource_id | 1be7ef2b-8298-46f0-af8d-80ea67ead7bd       |
| source      | a4e3a58f85e344c9b238f99045ee9e4e:openstack |
| user_id     | 49be897e674a4456af937371ecfa936d           |
+-------------+--------------------------------------------+
Thu Feb  5 15:40:10 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ [0;32m<[0m
ceilometer alarm-list
[0;32m<alarm[0m
+--------------------------------------+----------------------------------+-------------------+---------+------------+-----------------------------+------------------+
| Alarm ID                             | Name                             | State             | Enabled | Continuous | Alarm condition             | Time constraints |
+--------------------------------------+----------------------------------+-------------------+---------+------------+-----------------------------+------------------+
| 16798576-d280-4220-b451-c29401ab3a47 | STACK3-CPUAlarmHigh-f23l4sb4kyfm | insufficient data | True    | True       | vote > 60.0 during 1 x 120s | None             |
| 57806677-81e3-4fe3-b418-5a3edfdfd670 | STACK1-CPUAlarmLow-kdifk33wqx42  | alarm             | True    | True       | vote < 5.0 during 1 x 120s  | None             |
| a82b9b63-afd9-4759-97c9-826d01863287 | STACK3-CPUAlarmLow-qtfb72by7yxi  | insufficient data | True    | True       | vote < 5.0 during 1 x 120s  | None             |
| b6300331-f025-41bb-8f2c-21d5dee1d62d | STACK2-CPUAlarmLow-ka26ms4iiss5  | insufficient data | True    | True       | vote < 5.0 during 1 x 120s  | None             |
| dba36058-5f4c-4ffe-8233-54c8944bdc3e | STACK1-CPUAlarmHigh-to2atu424urn | ok                | True    | True       | vote > 60.0 during 1 x 120s | None             |
| dfa52044-f4ea-4358-bb64-3d536aac949d | STACK2-CPUAlarmHigh-leiv5qcxexjb | insufficient data | True    | True       | vote > 60.0 during 1 x 120s | None             |
+--------------------------------------+----------------------------------+-------------------+---------+------------+-----------------------------+------------------+
Thu Feb  5 15:40:41 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ [1;34m
 === going in a loop to check guest1 reached minimum cpu vale 
[0m
nova show guest1
[0;32m<guest1[0m
+--------------------------------------+----------------------------------------------------------------------------------------------------------------------------------+
| Property                             | Value                                                                                                                            |
+--------------------------------------+----------------------------------------------------------------------------------------------------------------------------------+
| OS-DCF:diskConfig                    | MANUAL                                                                                                                           |
| OS-EXT-AZ:availability_zone          | nova                                                                                                                             |
| OS-EXT-STS:power_state               | 1                                                                                                                                |
| OS-EXT-STS:task_state                | -                                                                                                                                |
| OS-EXT-STS:vm_state                  | active                                                                                                                           |
| OS-SRV-USG:launched_at               | 2015-02-05T15:37:46.553947                                                                                                       |
| OS-SRV-USG:terminated_at             | -                                                                                                                                |
| accessIPv4                           |                                                                                                                                  |
| accessIPv6                           |                                                                                                                                  |
| config_drive                         |                                                                                                                                  |
| created                              | 2015-02-05T15:37:37Z                                                                                                             |
| extended                             | {"cpuset": 56, "numanode": 0, "siblings_cpuset": null}                                                                           |
| flavor                               | vcpu4-1 (5f0d748b-1c8b-4a70-1985-4d57e25ac137)                                                                                   |
| hostId                               | 1ea8da9884e6179694739654aaa506b2817ea351d58559c80c37d716                                                                         |
| id                                   | 1be7ef2b-8298-46f0-af8d-80ea67ead7bd                                                                                             |
| image                                | cgcs-guest (7aeabc04-8b05-44fa-bfe6-07d6dfbfc6ea)                                                                                |
| key_name                             | keypair-tenant1                                                                                                                  |
| metadata                             | {}                                                                                                                               |
| name                                 | guest1                                                                                                                           |
| nics                                 | {"nic1": {"vif_model": "virtio", "port_id": "51675f43-af24-4f0b-b7ad-4c238f806fc0", "network": "tenant1-mgmt-net", "mtu": 1500}} |
| os-extended-volumes:volumes_attached | []                                                                                                                               |
| pinned                               | True                                                                                                                             |
| progress                             | 0                                                                                                                                |
| server_group                         |                                                                                                                                  |
| status                               | ACTIVE                                                                                                                           |
| tenant1-mgmt-net network             | 192.168.109.19                                                                                                                   |
| tenant_id                            | a4e3a58f85e344c9b238f99045ee9e4e                                                                                                 |
| updated                              | 2015-02-05T15:40:17Z                                                                                                             |
| user_id                              | 49be897e674a4456af937371ecfa936d                                                                                                 |
| vcpus (min/cur/max)                  | [1, 3, 4]                                                                                                                        |
+--------------------------------------+----------------------------------------------------------------------------------------------------------------------------------+
Thu Feb  5 15:40:42 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ [0;32m
Assigned Var:min_cpu=1
[0m
[0;32m
Assigned Var:cur_cpu=3
[0m
[0;32m
Assigned Var:max_cpu=4
[0m
[0;32m
While: expr { "3" != "1" } |result=TRUE
[0m
nova show guest1
[0;32m<guest1[0m
+--------------------------------------+----------------------------------------------------------------------------------------------------------------------------------+
| Property                             | Value                                                                                                                            |
+--------------------------------------+----------------------------------------------------------------------------------------------------------------------------------+
| OS-DCF:diskConfig                    | MANUAL                                                                                                                           |
| OS-EXT-AZ:availability_zone          | nova                                                                                                                             |
| OS-EXT-STS:power_state               | 1                                                                                                                                |
| OS-EXT-STS:task_state                | -                                                                                                                                |
| OS-EXT-STS:vm_state                  | active                                                                                                                           |
| OS-SRV-USG:launched_at               | 2015-02-05T15:37:46.553947                                                                                                       |
| OS-SRV-USG:terminated_at             | -                                                                                                                                |
| accessIPv4                           |                                                                                                                                  |
| accessIPv6                           |                                                                                                                                  |
| config_drive                         |                                                                                                                                  |
| created                              | 2015-02-05T15:37:37Z                                                                                                             |
| extended                             | {"cpuset": 56, "numanode": 0, "siblings_cpuset": null}                                                                           |
| flavor                               | vcpu4-1 (5f0d748b-1c8b-4a70-1985-4d57e25ac137)                                                                                   |
| hostId                               | 1ea8da9884e6179694739654aaa506b2817ea351d58559c80c37d716                                                                         |
| id                                   | 1be7ef2b-8298-46f0-af8d-80ea67ead7bd                                                                                             |
| image                                | cgcs-guest (7aeabc04-8b05-44fa-bfe6-07d6dfbfc6ea)                                                                                |
| key_name                             | keypair-tenant1                                                                                                                  |
| metadata                             | {}                                                                                                                               |
| name                                 | guest1                                                                                                                           |
| nics                                 | {"nic1": {"vif_model": "virtio", "port_id": "51675f43-af24-4f0b-b7ad-4c238f806fc0", "network": "tenant1-mgmt-net", "mtu": 1500}} |
| os-extended-volumes:volumes_attached | []                                                                                                                               |
| pinned                               | True                                                                                                                             |
| progress                             | 0                                                                                                                                |
| server_group                         |                                                                                                                                  |
| status                               | ACTIVE                                                                                                                           |
| tenant1-mgmt-net network             | 192.168.109.19                                                                                                                   |
| tenant_id                            | a4e3a58f85e344c9b238f99045ee9e4e                                                                                                 |
| updated                              | 2015-02-05T15:40:17Z                                                                                                             |
| user_id                              | 49be897e674a4456af937371ecfa936d                                                                                                 |
| vcpus (min/cur/max)                  | [1, 3, 4]                                                                                                                        |
+--------------------------------------+----------------------------------------------------------------------------------------------------------------------------------+
Thu Feb  5 15:40:43 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ [0;32m
Assigned Var:cur_cpu=3
[0m
[1;34m
 === auto scaling down
[0m
[0;32m
If: expr { "3" == "1" } |then   %BREAK_REACHED_MIN_CPU1|result=FALSE
[0m
[0;32m
While: expr { "3" != "1" } |result=TRUE
[0m
nova show guest1
[0;32m<guest1[0m
+--------------------------------------+----------------------------------------------------------------------------------------------------------------------------------+
| Property                             | Value                                                                                                                            |
+--------------------------------------+----------------------------------------------------------------------------------------------------------------------------------+
| OS-DCF:diskConfig                    | MANUAL                                                                                                                           |
| OS-EXT-AZ:availability_zone          | nova                                                                                                                             |
| OS-EXT-STS:power_state               | 1                                                                                                                                |
| OS-EXT-STS:task_state                | -                                                                                                                                |
| OS-EXT-STS:vm_state                  | active                                                                                                                           |
| OS-SRV-USG:launched_at               | 2015-02-05T15:37:46.553947                                                                                                       |
| OS-SRV-USG:terminated_at             | -                                                                                                                                |
| accessIPv4                           |                                                                                                                                  |
| accessIPv6                           |                                                                                                                                  |
| config_drive                         |                                                                                                                                  |
| created                              | 2015-02-05T15:37:37Z                                                                                                             |
| extended                             | {"cpuset": 24, "numanode": 0, "siblings_cpuset": null}                                                                           |
| flavor                               | vcpu4-1 (5f0d748b-1c8b-4a70-1985-4d57e25ac137)                                                                                   |
| hostId                               | 1ea8da9884e6179694739654aaa506b2817ea351d58559c80c37d716                                                                         |
| id                                   | 1be7ef2b-8298-46f0-af8d-80ea67ead7bd                                                                                             |
| image                                | cgcs-guest (7aeabc04-8b05-44fa-bfe6-07d6dfbfc6ea)                                                                                |
| key_name                             | keypair-tenant1                                                                                                                  |
| metadata                             | {}                                                                                                                               |
| name                                 | guest1                                                                                                                           |
| nics                                 | {"nic1": {"vif_model": "virtio", "port_id": "51675f43-af24-4f0b-b7ad-4c238f806fc0", "network": "tenant1-mgmt-net", "mtu": 1500}} |
| os-extended-volumes:volumes_attached | []                                                                                                                               |
| pinned                               | True                                                                                                                             |
| progress                             | 0                                                                                                                                |
| server_group                         |                                                                                                                                  |
| status                               | ACTIVE                                                                                                                           |
| tenant1-mgmt-net network             | 192.168.109.19                                                                                                                   |
| tenant_id                            | a4e3a58f85e344c9b238f99045ee9e4e                                                                                                 |
| updated                              | 2015-02-05T15:40:47Z                                                                                                             |
| user_id                              | 49be897e674a4456af937371ecfa936d                                                                                                 |
| vcpus (min/cur/max)                  | [1, 2, 4]                                                                                                                        |
+--------------------------------------+----------------------------------------------------------------------------------------------------------------------------------+
Thu Feb  5 15:41:15 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ [0;32m
Assigned Var:cur_cpu=2
[0m
[1;34m
 === auto scaling down
[0m
[0;32m
If: expr { "2" == "1" } |then   %BREAK_REACHED_MIN_CPU1|result=FALSE
[0m
[0;32m
While: expr { "2" != "1" } |result=TRUE
[0m
nova show guest1
[0;32m<guest1[0m
+--------------------------------------+----------------------------------------------------------------------------------------------------------------------------------+
| Property                             | Value                                                                                                                            |
+--------------------------------------+----------------------------------------------------------------------------------------------------------------------------------+
| OS-DCF:diskConfig                    | MANUAL                                                                                                                           |
| OS-EXT-AZ:availability_zone          | nova                                                                                                                             |
| OS-EXT-STS:power_state               | 1                                                                                                                                |
| OS-EXT-STS:task_state                | -                                                                                                                                |
| OS-EXT-STS:vm_state                  | active                                                                                                                           |
| OS-SRV-USG:launched_at               | 2015-02-05T15:37:46.553947                                                                                                       |
| OS-SRV-USG:terminated_at             | -                                                                                                                                |
| accessIPv4                           |                                                                                                                                  |
| accessIPv6                           |                                                                                                                                  |
| config_drive                         |                                                                                                                                  |
| created                              | 2015-02-05T15:37:37Z                                                                                                             |
| extended                             | {"cpuset": 8, "numanode": 0, "siblings_cpuset": null}                                                                            |
| flavor                               | vcpu4-1 (5f0d748b-1c8b-4a70-1985-4d57e25ac137)                                                                                   |
| hostId                               | 1ea8da9884e6179694739654aaa506b2817ea351d58559c80c37d716                                                                         |
| id                                   | 1be7ef2b-8298-46f0-af8d-80ea67ead7bd                                                                                             |
| image                                | cgcs-guest (7aeabc04-8b05-44fa-bfe6-07d6dfbfc6ea)                                                                                |
| key_name                             | keypair-tenant1                                                                                                                  |
| metadata                             | {}                                                                                                                               |
| name                                 | guest1                                                                                                                           |
| nics                                 | {"nic1": {"vif_model": "virtio", "port_id": "51675f43-af24-4f0b-b7ad-4c238f806fc0", "network": "tenant1-mgmt-net", "mtu": 1500}} |
| os-extended-volumes:volumes_attached | []                                                                                                                               |
| pinned                               | True                                                                                                                             |
| progress                             | 0                                                                                                                                |
| server_group                         |                                                                                                                                  |
| status                               | ACTIVE                                                                                                                           |
| tenant1-mgmt-net network             | 192.168.109.19                                                                                                                   |
| tenant_id                            | a4e3a58f85e344c9b238f99045ee9e4e                                                                                                 |
| updated                              | 2015-02-05T15:41:17Z                                                                                                             |
| user_id                              | 49be897e674a4456af937371ecfa936d                                                                                                 |
| vcpus (min/cur/max)                  | [1, 1, 4]                                                                                                                        |
+--------------------------------------+----------------------------------------------------------------------------------------------------------------------------------+
Thu Feb  5 15:41:46 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ [0;32m
Assigned Var:cur_cpu=1
[0m
[1;34m
 === auto scaling down
[0m
[0;32m
If: expr { "1" == "1" } |then   %BREAK_REACHED_MIN_CPU1|result=TRUE
[0m

Jumping to label[0;32m:%BREAK_REACHED_MIN_CPU1
[0m
[1;34m
 === check if guest1 current cpu value reached minimum cpu value:1
[0m
nova show guest1
+--------------------------------------+----------------------------------------------------------------------------------------------------------------------------------+
| Property                             | Value                                                                                                                            |
+--------------------------------------+----------------------------------------------------------------------------------------------------------------------------------+
| OS-DCF:diskConfig                    | MANUAL                                                                                                                           |
| OS-EXT-AZ:availability_zone          | nova                                                                                                                             |
| OS-EXT-STS:power_state               | 1                                                                                                                                |
| OS-EXT-STS:task_state                | -                                                                                                                                |
| OS-EXT-STS:vm_state                  | active                                                                                                                           |
| OS-SRV-USG:launched_at               | 2015-02-05T15:37:46.553947                                                                                                       |
| OS-SRV-USG:terminated_at             | -                                                                                                                                |
| accessIPv4                           |                                                                                                                                  |
| accessIPv6                           |                                                                                                                                  |
| config_drive                         |                                                                                                                                  |
| created                              | 2015-02-05T15:37:37Z                                                                                                             |
| extended                             | {"cpuset": 8, "numanode": 0, "siblings_cpuset": null}                                                                            |
| flavor                               | vcpu4-1 (5f0d748b-1c8b-4a70-1985-4d57e25ac137)                                                                                   |
| hostId                               | 1ea8da9884e6179694739654aaa506b2817ea351d58559c80c37d716                                                                         |
| id                                   | 1be7ef2b-8298-46f0-af8d-80ea67ead7bd                                                                                             |
| image                                | cgcs-guest (7aeabc04-8b05-44fa-bfe6-07d6dfbfc6ea)                                                                                |
| key_name                             | keypair-tenant1                                                                                                                  |
| metadata                             | {}                                                                                                                               |
| name                                 | guest1                                                                                                                           |
| nics                                 | {"nic1": {"vif_model": "virtio", "port_id": "51675f43-af24-4f0b-b7ad-4c238f806fc0", "network": "tenant1-mgmt-net", "mtu": 1500}} |
| os-extended-volumes:volumes_attached | []                                                                                                                               |
| pinned                               | True                                                                                                                             |
| progress                             | 0                                                                                                                                |
| server_group                         |                                                                                                                                  |
| status                               | ACTIVE                                                                                                                           |
| tenant1-mgmt-net network             | 192.168.109.19                                                                                                                   |
| tenant_id                            | a4e3a58f85e344c9b238f99045ee9e4e                                                                                                 |
| updated                              | 2015-02-05T15:41:17Z                                                                                                             |
| user_id                              | 49be897e674a4456af937371ecfa936d                                                                                                 |
| vcpus (min/cur/max)                  | [1, 1, 4]                                                                                                                        |
+--------------------------------------+----------------------------------------------------------------------------------------------------------------------------------+
[0;32m<min/cur/max[0m
Thu Feb  5 15:42:18 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ [0;32m
Assigned Var:min_cpu=1
[0m
[0;32m
Assigned Var:cur_cpu=1
[0m
[0;32m
Assigned Var:max_cpu=4
[0m
[0;32m
If: expr { "1" != "1" } |then   [|result=FALSE
[0m
ceilometer sample-create -r 1be7ef2b-8298-46f0-af8d-80ea67ead7bd -m vote --meter-type gauge --meter-unit '%' --sample-volume 90 -- resource-metadata '{"display_name":"guest1"}'
+-------------------+--------------------------------------------+
| Property          | Value                                      |
+-------------------+--------------------------------------------+
| message_id        | 916c2286-ad4d-11e4-99ab-2c44fd83b910       |
| name              | vote                                       |
| project_id        | a4e3a58f85e344c9b238f99045ee9e4e           |
| resource_id       | 1be7ef2b-8298-46f0-af8d-80ea67ead7bd       |
| resource_metadata | {u'display_name': u'guest1'}               |
| source            | a4e3a58f85e344c9b238f99045ee9e4e:openstack |
| timestamp         | 2015-02-05T15:42:19.181411                 |
| type              | gauge                                      |
| unit              | %                                          |
| user_id           | 49be897e674a4456af937371ecfa936d           |
| volume            | 90.0                                       |
+-------------------+--------------------------------------------+
Thu Feb  5 15:42:19 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ ceilometer resource-show -r 1be7ef2b-8298-46f0-af8d-80ea67ead7bd
+-------------+--------------------------------------------+
| Property    | Value                                      |
+-------------+--------------------------------------------+
| metadata    | {u'display_name': u'guest1'}               |
| project_id  | a4e3a58f85e344c9b238f99045ee9e4e           |
| resource_id | 1be7ef2b-8298-46f0-af8d-80ea67ead7bd       |
| source      | a4e3a58f85e344c9b238f99045ee9e4e:openstack |
| user_id     | 49be897e674a4456af937371ecfa936d           |
+-------------+--------------------------------------------+
Thu Feb  5 15:42:20 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ [0;32m<[0m
ceilometer alarm-list
[0;32m<alarm[0m
+--------------------------------------+----------------------------------+-------------------+---------+------------+-----------------------------+------------------+
| Alarm ID                             | Name                             | State             | Enabled | Continuous | Alarm condition             | Time constraints |
+--------------------------------------+----------------------------------+-------------------+---------+------------+-----------------------------+------------------+
| 16798576-d280-4220-b451-c29401ab3a47 | STACK3-CPUAlarmHigh-f23l4sb4kyfm | insufficient data | True    | True       | vote > 60.0 during 1 x 120s | None             |
| 57806677-81e3-4fe3-b418-5a3edfdfd670 | STACK1-CPUAlarmLow-kdifk33wqx42  | ok                | True    | True       | vote < 5.0 during 1 x 120s  | None             |
| a82b9b63-afd9-4759-97c9-826d01863287 | STACK3-CPUAlarmLow-qtfb72by7yxi  | insufficient data | True    | True       | vote < 5.0 during 1 x 120s  | None             |
| b6300331-f025-41bb-8f2c-21d5dee1d62d | STACK2-CPUAlarmLow-ka26ms4iiss5  | insufficient data | True    | True       | vote < 5.0 during 1 x 120s  | None             |
| dba36058-5f4c-4ffe-8233-54c8944bdc3e | STACK1-CPUAlarmHigh-to2atu424urn | alarm             | True    | True       | vote > 60.0 during 1 x 120s | None             |
| dfa52044-f4ea-4358-bb64-3d536aac949d | STACK2-CPUAlarmHigh-leiv5qcxexjb | insufficient data | True    | True       | vote > 60.0 during 1 x 120s | None             |
+--------------------------------------+----------------------------------+-------------------+---------+------------+-----------------------------+------------------+
Thu Feb  5 15:42:50 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ [1;34m
 === going in a loop to check guest1 reached maximum cpu vale 
[0m
nova show guest1
[0;32m<guest1[0m
+--------------------------------------+----------------------------------------------------------------------------------------------------------------------------------+
| Property                             | Value                                                                                                                            |
+--------------------------------------+----------------------------------------------------------------------------------------------------------------------------------+
| OS-DCF:diskConfig                    | MANUAL                                                                                                                           |
| OS-EXT-AZ:availability_zone          | nova                                                                                                                             |
| OS-EXT-STS:power_state               | 1                                                                                                                                |
| OS-EXT-STS:task_state                | -                                                                                                                                |
| OS-EXT-STS:vm_state                  | active                                                                                                                           |
| OS-SRV-USG:launched_at               | 2015-02-05T15:37:46.553947                                                                                                       |
| OS-SRV-USG:terminated_at             | -                                                                                                                                |
| accessIPv4                           |                                                                                                                                  |
| accessIPv6                           |                                                                                                                                  |
| config_drive                         |                                                                                                                                  |
| created                              | 2015-02-05T15:37:37Z                                                                                                             |
| extended                             | {"cpuset": 24, "numanode": 0, "siblings_cpuset": null}                                                                           |
| flavor                               | vcpu4-1 (5f0d748b-1c8b-4a70-1985-4d57e25ac137)                                                                                   |
| hostId                               | 1ea8da9884e6179694739654aaa506b2817ea351d58559c80c37d716                                                                         |
| id                                   | 1be7ef2b-8298-46f0-af8d-80ea67ead7bd                                                                                             |
| image                                | cgcs-guest (7aeabc04-8b05-44fa-bfe6-07d6dfbfc6ea)                                                                                |
| key_name                             | keypair-tenant1                                                                                                                  |
| metadata                             | {}                                                                                                                               |
| name                                 | guest1                                                                                                                           |
| nics                                 | {"nic1": {"vif_model": "virtio", "port_id": "51675f43-af24-4f0b-b7ad-4c238f806fc0", "network": "tenant1-mgmt-net", "mtu": 1500}} |
| os-extended-volumes:volumes_attached | []                                                                                                                               |
| pinned                               | True                                                                                                                             |
| progress                             | 0                                                                                                                                |
| server_group                         |                                                                                                                                  |
| status                               | ACTIVE                                                                                                                           |
| tenant1-mgmt-net network             | 192.168.109.19                                                                                                                   |
| tenant_id                            | a4e3a58f85e344c9b238f99045ee9e4e                                                                                                 |
| updated                              | 2015-02-05T15:42:47Z                                                                                                             |
| user_id                              | 49be897e674a4456af937371ecfa936d                                                                                                 |
| vcpus (min/cur/max)                  | [1, 2, 4]                                                                                                                        |
+--------------------------------------+----------------------------------------------------------------------------------------------------------------------------------+
Thu Feb  5 15:42:52 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ [0;32m
Assigned Var:min_cpu=1
[0m
[0;32m
Assigned Var:cur_cpu=2
[0m
[0;32m
Assigned Var:max_cpu=4
[0m
[0;32m
While: expr { "2" != "4" } |result=TRUE
[0m
nova show guest1
[0;32m<guest1[0m
+--------------------------------------+----------------------------------------------------------------------------------------------------------------------------------+
| Property                             | Value                                                                                                                            |
+--------------------------------------+----------------------------------------------------------------------------------------------------------------------------------+
| OS-DCF:diskConfig                    | MANUAL                                                                                                                           |
| OS-EXT-AZ:availability_zone          | nova                                                                                                                             |
| OS-EXT-STS:power_state               | 1                                                                                                                                |
| OS-EXT-STS:task_state                | -                                                                                                                                |
| OS-EXT-STS:vm_state                  | active                                                                                                                           |
| OS-SRV-USG:launched_at               | 2015-02-05T15:37:46.553947                                                                                                       |
| OS-SRV-USG:terminated_at             | -                                                                                                                                |
| accessIPv4                           |                                                                                                                                  |
| accessIPv6                           |                                                                                                                                  |
| config_drive                         |                                                                                                                                  |
| created                              | 2015-02-05T15:37:37Z                                                                                                             |
| extended                             | {"cpuset": 24, "numanode": 0, "siblings_cpuset": null}                                                                           |
| flavor                               | vcpu4-1 (5f0d748b-1c8b-4a70-1985-4d57e25ac137)                                                                                   |
| hostId                               | 1ea8da9884e6179694739654aaa506b2817ea351d58559c80c37d716                                                                         |
| id                                   | 1be7ef2b-8298-46f0-af8d-80ea67ead7bd                                                                                             |
| image                                | cgcs-guest (7aeabc04-8b05-44fa-bfe6-07d6dfbfc6ea)                                                                                |
| key_name                             | keypair-tenant1                                                                                                                  |
| metadata                             | {}                                                                                                                               |
| name                                 | guest1                                                                                                                           |
| nics                                 | {"nic1": {"vif_model": "virtio", "port_id": "51675f43-af24-4f0b-b7ad-4c238f806fc0", "network": "tenant1-mgmt-net", "mtu": 1500}} |
| os-extended-volumes:volumes_attached | []                                                                                                                               |
| pinned                               | True                                                                                                                             |
| progress                             | 0                                                                                                                                |
| server_group                         |                                                                                                                                  |
| status                               | ACTIVE                                                                                                                           |
| tenant1-mgmt-net network             | 192.168.109.19                                                                                                                   |
| tenant_id                            | a4e3a58f85e344c9b238f99045ee9e4e                                                                                                 |
| updated                              | 2015-02-05T15:42:47Z                                                                                                             |
| user_id                              | 49be897e674a4456af937371ecfa936d                                                                                                 |
| vcpus (min/cur/max)                  | [1, 2, 4]                                                                                                                        |
+--------------------------------------+----------------------------------------------------------------------------------------------------------------------------------+
Thu Feb  5 15:42:53 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ [0;32m
Assigned Var:cur_cpu=2
[0m
[1;34m
 === auto scaling up
[0m
[0;32m
If: expr { "2" == "4" } |then   %BREAK_REACHED_MAX_CPU1|result=FALSE
[0m
[0;32m
While: expr { "2" != "4" } |result=TRUE
[0m
nova show guest1
[0;32m<guest1[0m
+--------------------------------------+----------------------------------------------------------------------------------------------------------------------------------+
| Property                             | Value                                                                                                                            |
+--------------------------------------+----------------------------------------------------------------------------------------------------------------------------------+
| OS-DCF:diskConfig                    | MANUAL                                                                                                                           |
| OS-EXT-AZ:availability_zone          | nova                                                                                                                             |
| OS-EXT-STS:power_state               | 1                                                                                                                                |
| OS-EXT-STS:task_state                | -                                                                                                                                |
| OS-EXT-STS:vm_state                  | active                                                                                                                           |
| OS-SRV-USG:launched_at               | 2015-02-05T15:37:46.553947                                                                                                       |
| OS-SRV-USG:terminated_at             | -                                                                                                                                |
| accessIPv4                           |                                                                                                                                  |
| accessIPv6                           |                                                                                                                                  |
| config_drive                         |                                                                                                                                  |
| created                              | 2015-02-05T15:37:37Z                                                                                                             |
| extended                             | {"cpuset": 56, "numanode": 0, "siblings_cpuset": null}                                                                           |
| flavor                               | vcpu4-1 (5f0d748b-1c8b-4a70-1985-4d57e25ac137)                                                                                   |
| hostId                               | 1ea8da9884e6179694739654aaa506b2817ea351d58559c80c37d716                                                                         |
| id                                   | 1be7ef2b-8298-46f0-af8d-80ea67ead7bd                                                                                             |
| image                                | cgcs-guest (7aeabc04-8b05-44fa-bfe6-07d6dfbfc6ea)                                                                                |
| key_name                             | keypair-tenant1                                                                                                                  |
| metadata                             | {}                                                                                                                               |
| name                                 | guest1                                                                                                                           |
| nics                                 | {"nic1": {"vif_model": "virtio", "port_id": "51675f43-af24-4f0b-b7ad-4c238f806fc0", "network": "tenant1-mgmt-net", "mtu": 1500}} |
| os-extended-volumes:volumes_attached | []                                                                                                                               |
| pinned                               | True                                                                                                                             |
| progress                             | 0                                                                                                                                |
| server_group                         |                                                                                                                                  |
| status                               | ACTIVE                                                                                                                           |
| tenant1-mgmt-net network             | 192.168.109.19                                                                                                                   |
| tenant_id                            | a4e3a58f85e344c9b238f99045ee9e4e                                                                                                 |
| updated                              | 2015-02-05T15:43:17Z                                                                                                             |
| user_id                              | 49be897e674a4456af937371ecfa936d                                                                                                 |
| vcpus (min/cur/max)                  | [1, 3, 4]                                                                                                                        |
+--------------------------------------+----------------------------------------------------------------------------------------------------------------------------------+
Thu Feb  5 15:43:25 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ [0;32m
Assigned Var:cur_cpu=3
[0m
[1;34m
 === auto scaling up
[0m
[0;32m
If: expr { "3" == "4" } |then   %BREAK_REACHED_MAX_CPU1|result=FALSE
[0m
[0;32m
While: expr { "3" != "4" } |result=TRUE
[0m
nova show guest1
[0;32m<guest1[0m
+--------------------------------------+----------------------------------------------------------------------------------------------------------------------------------+
| Property                             | Value                                                                                                                            |
+--------------------------------------+----------------------------------------------------------------------------------------------------------------------------------+
| OS-DCF:diskConfig                    | MANUAL                                                                                                                           |
| OS-EXT-AZ:availability_zone          | nova                                                                                                                             |
| OS-EXT-STS:power_state               | 1                                                                                                                                |
| OS-EXT-STS:task_state                | -                                                                                                                                |
| OS-EXT-STS:vm_state                  | active                                                                                                                           |
| OS-SRV-USG:launched_at               | 2015-02-05T15:37:46.553947                                                                                                       |
| OS-SRV-USG:terminated_at             | -                                                                                                                                |
| accessIPv4                           |                                                                                                                                  |
| accessIPv6                           |                                                                                                                                  |
| config_drive                         |                                                                                                                                  |
| created                              | 2015-02-05T15:37:37Z                                                                                                             |
| extended                             | {"cpuset": 120, "numanode": 0, "siblings_cpuset": null}                                                                          |
| flavor                               | vcpu4-1 (5f0d748b-1c8b-4a70-1985-4d57e25ac137)                                                                                   |
| hostId                               | 1ea8da9884e6179694739654aaa506b2817ea351d58559c80c37d716                                                                         |
| id                                   | 1be7ef2b-8298-46f0-af8d-80ea67ead7bd                                                                                             |
| image                                | cgcs-guest (7aeabc04-8b05-44fa-bfe6-07d6dfbfc6ea)                                                                                |
| key_name                             | keypair-tenant1                                                                                                                  |
| metadata                             | {}                                                                                                                               |
| name                                 | guest1                                                                                                                           |
| nics                                 | {"nic1": {"vif_model": "virtio", "port_id": "51675f43-af24-4f0b-b7ad-4c238f806fc0", "network": "tenant1-mgmt-net", "mtu": 1500}} |
| os-extended-volumes:volumes_attached | []                                                                                                                               |
| pinned                               | True                                                                                                                             |
| progress                             | 0                                                                                                                                |
| server_group                         |                                                                                                                                  |
| status                               | ACTIVE                                                                                                                           |
| tenant1-mgmt-net network             | 192.168.109.19                                                                                                                   |
| tenant_id                            | a4e3a58f85e344c9b238f99045ee9e4e                                                                                                 |
| updated                              | 2015-02-05T15:43:47Z                                                                                                             |
| user_id                              | 49be897e674a4456af937371ecfa936d                                                                                                 |
| vcpus (min/cur/max)                  | [1, 4, 4]                                                                                                                        |
+--------------------------------------+----------------------------------------------------------------------------------------------------------------------------------+
Thu Feb  5 15:43:56 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ [0;32m
Assigned Var:cur_cpu=4
[0m
[1;34m
 === auto scaling up
[0m
[0;32m
If: expr { "4" == "4" } |then   %BREAK_REACHED_MAX_CPU1|result=TRUE
[0m

Jumping to label[0;32m:%BREAK_REACHED_MAX_CPU1
[0m
[1;34m
 === check if guest1 current cpu value reached maximum cpu value:4
[0m
nova show guest1
+--------------------------------------+----------------------------------------------------------------------------------------------------------------------------------+
| Property                             | Value                                                                                                                            |
+--------------------------------------+----------------------------------------------------------------------------------------------------------------------------------+
| OS-DCF:diskConfig                    | MANUAL                                                                                                                           |
| OS-EXT-AZ:availability_zone          | nova                                                                                                                             |
| OS-EXT-STS:power_state               | 1                                                                                                                                |
| OS-EXT-STS:task_state                | -                                                                                                                                |
| OS-EXT-STS:vm_state                  | active                                                                                                                           |
| OS-SRV-USG:launched_at               | 2015-02-05T15:37:46.553947                                                                                                       |
| OS-SRV-USG:terminated_at             | -                                                                                                                                |
| accessIPv4                           |                                                                                                                                  |
| accessIPv6                           |                                                                                                                                  |
| config_drive                         |                                                                                                                                  |
| created                              | 2015-02-05T15:37:37Z                                                                                                             |
| extended                             | {"cpuset": 120, "numanode": 0, "siblings_cpuset": null}                                                                          |
| flavor                               | vcpu4-1 (5f0d748b-1c8b-4a70-1985-4d57e25ac137)                                                                                   |
| hostId                               | 1ea8da9884e6179694739654aaa506b2817ea351d58559c80c37d716                                                                         |
| id                                   | 1be7ef2b-8298-46f0-af8d-80ea67ead7bd                                                                                             |
| image                                | cgcs-guest (7aeabc04-8b05-44fa-bfe6-07d6dfbfc6ea)                                                                                |
| key_name                             | keypair-tenant1                                                                                                                  |
| metadata                             | {}                                                                                                                               |
| name                                 | guest1                                                                                                                           |
| nics                                 | {"nic1": {"vif_model": "virtio", "port_id": "51675f43-af24-4f0b-b7ad-4c238f806fc0", "network": "tenant1-mgmt-net", "mtu": 1500}} |
| os-extended-volumes:volumes_attached | []                                                                                                                               |
| pinned                               | True                                                                                                                             |
| progress                             | 0                                                                                                                                |
| server_group                         |                                                                                                                                  |
| status                               | ACTIVE                                                                                                                           |
| tenant1-mgmt-net network             | 192.168.109.19                                                                                                                   |
| tenant_id                            | a4e3a58f85e344c9b238f99045ee9e4e                                                                                                 |
| updated                              | 2015-02-05T15:43:47Z                                                                                                             |
| user_id                              | 49be897e674a4456af937371ecfa936d                                                                                                 |
| vcpus (min/cur/max)                  | [1, 4, 4]                                                                                                                        |
+--------------------------------------+----------------------------------------------------------------------------------------------------------------------------------+
[0;32m<min/cur/max[0m
Thu Feb  5 15:44:28 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ [0;32m
Assigned Var:min_cpu=1
[0m
[0;32m
Assigned Var:cur_cpu=4
[0m
[0;32m
Assigned Var:max_cpu=4
[0m
[0;32m
If: expr { "4" != "4" } |then   [|result=FALSE
[0m
ceilometer sample-create -r 3fba3be4-b0e1-44d2-80d9-ae8495e13f82 -m vote --meter-type gauge --meter-unit '%' --sample-volume 2 --r esource-metadata '{"display_name":"guest2"}'
+-------------------+--------------------------------------------+
| Property          | Value                                      |
+-------------------+--------------------------------------------+
| message_id        | dec0a016-ad4d-11e4-99ab-2c44fd83b910       |
| name              | vote                                       |
| project_id        | a4e3a58f85e344c9b238f99045ee9e4e           |
| resource_id       | 3fba3be4-b0e1-44d2-80d9-ae8495e13f82       |
| resource_metadata | {u'display_name': u'guest2'}               |
| source            | a4e3a58f85e344c9b238f99045ee9e4e:openstack |
| timestamp         | 2015-02-05T15:44:28.919689                 |
| type              | gauge                                      |
| unit              | %                                          |
| user_id           | 49be897e674a4456af937371ecfa936d           |
| volume            | 2.0                                        |
+-------------------+--------------------------------------------+
Thu Feb  5 15:44:28 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ ceilometer resource-show -r 3fba3be4-b0e1-44d2-80d9-ae8495e13f82
+-------------+--------------------------------------------+
| Property    | Value                                      |
+-------------+--------------------------------------------+
| metadata    | {u'display_name': u'guest2'}               |
| project_id  | a4e3a58f85e344c9b238f99045ee9e4e           |
| resource_id | 3fba3be4-b0e1-44d2-80d9-ae8495e13f82       |
| source      | a4e3a58f85e344c9b238f99045ee9e4e:openstack |
| user_id     | 49be897e674a4456af937371ecfa936d           |
+-------------+--------------------------------------------+
Thu Feb  5 15:44:29 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ [0;32m<[0m
ceilometer alarm-list
[0;32m<alarm[0m
+--------------------------------------+----------------------------------+-------------------+---------+------------+-----------------------------+------------------+
| Alarm ID                             | Name                             | State             | Enabled | Continuous | Alarm condition             | Time constraints |
+--------------------------------------+----------------------------------+-------------------+---------+------------+-----------------------------+------------------+
| 16798576-d280-4220-b451-c29401ab3a47 | STACK3-CPUAlarmHigh-f23l4sb4kyfm | insufficient data | True    | True       | vote > 60.0 during 1 x 120s | None             |
| 57806677-81e3-4fe3-b418-5a3edfdfd670 | STACK1-CPUAlarmLow-kdifk33wqx42  | ok                | True    | True       | vote < 5.0 during 1 x 120s  | None             |
| a82b9b63-afd9-4759-97c9-826d01863287 | STACK3-CPUAlarmLow-qtfb72by7yxi  | insufficient data | True    | True       | vote < 5.0 during 1 x 120s  | None             |
| b6300331-f025-41bb-8f2c-21d5dee1d62d | STACK2-CPUAlarmLow-ka26ms4iiss5  | alarm             | True    | True       | vote < 5.0 during 1 x 120s  | None             |
| dba36058-5f4c-4ffe-8233-54c8944bdc3e | STACK1-CPUAlarmHigh-to2atu424urn | alarm             | True    | True       | vote > 60.0 during 1 x 120s | None             |
| dfa52044-f4ea-4358-bb64-3d536aac949d | STACK2-CPUAlarmHigh-leiv5qcxexjb | ok                | True    | True       | vote > 60.0 during 1 x 120s | None             |
+--------------------------------------+----------------------------------+-------------------+---------+------------+-----------------------------+------------------+
Thu Feb  5 15:44:50 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ [1;34m
 === going in a loop to check guest2 reached minimum cpu vale 
[0m
nova show guest2
[0;32m<guest2[0m
+--------------------------------------+----------------------------------------------------------------------------------------------------------------------------------+
| Property                             | Value                                                                                                                            |
+--------------------------------------+----------------------------------------------------------------------------------------------------------------------------------+
| OS-DCF:diskConfig                    | MANUAL                                                                                                                           |
| OS-EXT-AZ:availability_zone          | nova                                                                                                                             |
| OS-EXT-STS:power_state               | 1                                                                                                                                |
| OS-EXT-STS:task_state                | -                                                                                                                                |
| OS-EXT-STS:vm_state                  | active                                                                                                                           |
| OS-SRV-USG:launched_at               | 2015-02-05T15:37:48.018830                                                                                                       |
| OS-SRV-USG:terminated_at             | -                                                                                                                                |
| accessIPv4                           |                                                                                                                                  |
| accessIPv6                           |                                                                                                                                  |
| config_drive                         |                                                                                                                                  |
| created                              | 2015-02-05T15:37:38Z                                                                                                             |
| extended                             | {"cpuset": 120, "numanode": 0, "siblings_cpuset": null}                                                                          |
| flavor                               | vcpu5-2 (db9b37f5-cba5-1985-a264-a6c1375a4ff7)                                                                                   |
| hostId                               | 5108074ec1b70826f368003ec6b5aedb0cdb9edb1e36064b0afbe7ad                                                                         |
| id                                   | 3fba3be4-b0e1-44d2-80d9-ae8495e13f82                                                                                             |
| image                                | cgcs-guest (7aeabc04-8b05-44fa-bfe6-07d6dfbfc6ea)                                                                                |
| key_name                             | keypair-tenant1                                                                                                                  |
| metadata                             | {}                                                                                                                               |
| name                                 | guest2                                                                                                                           |
| nics                                 | {"nic1": {"vif_model": "virtio", "port_id": "d96cede7-54c4-4184-a54d-96903b412409", "network": "tenant1-mgmt-net", "mtu": 1500}} |
| os-extended-volumes:volumes_attached | []                                                                                                                               |
| pinned                               | True                                                                                                                             |
| progress                             | 0                                                                                                                                |
| server_group                         |                                                                                                                                  |
| status                               | ACTIVE                                                                                                                           |
| tenant1-mgmt-net network             | 192.168.109.20                                                                                                                   |
| tenant_id                            | a4e3a58f85e344c9b238f99045ee9e4e                                                                                                 |
| updated                              | 2015-02-05T15:44:47Z                                                                                                             |
| user_id                              | 49be897e674a4456af937371ecfa936d                                                                                                 |
| vcpus (min/cur/max)                  | [2, 4, 5]                                                                                                                        |
+--------------------------------------+----------------------------------------------------------------------------------------------------------------------------------+
Thu Feb  5 15:44:52 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ [0;32m
Assigned Var:min_cpu=2
[0m
[0;32m
Assigned Var:cur_cpu=4
[0m
[0;32m
Assigned Var:max_cpu=5
[0m
[0;32m
While: expr { "4" != "2" } |result=TRUE
[0m
nova show guest2
[0;32m<guest2[0m
+--------------------------------------+----------------------------------------------------------------------------------------------------------------------------------+
| Property                             | Value                                                                                                                            |
+--------------------------------------+----------------------------------------------------------------------------------------------------------------------------------+
| OS-DCF:diskConfig                    | MANUAL                                                                                                                           |
| OS-EXT-AZ:availability_zone          | nova                                                                                                                             |
| OS-EXT-STS:power_state               | 1                                                                                                                                |
| OS-EXT-STS:task_state                | -                                                                                                                                |
| OS-EXT-STS:vm_state                  | active                                                                                                                           |
| OS-SRV-USG:launched_at               | 2015-02-05T15:37:48.018830                                                                                                       |
| OS-SRV-USG:terminated_at             | -                                                                                                                                |
| accessIPv4                           |                                                                                                                                  |
| accessIPv6                           |                                                                                                                                  |
| config_drive                         |                                                                                                                                  |
| created                              | 2015-02-05T15:37:38Z                                                                                                             |
| extended                             | {"cpuset": 120, "numanode": 0, "siblings_cpuset": null}                                                                          |
| flavor                               | vcpu5-2 (db9b37f5-cba5-1985-a264-a6c1375a4ff7)                                                                                   |
| hostId                               | 5108074ec1b70826f368003ec6b5aedb0cdb9edb1e36064b0afbe7ad                                                                         |
| id                                   | 3fba3be4-b0e1-44d2-80d9-ae8495e13f82                                                                                             |
| image                                | cgcs-guest (7aeabc04-8b05-44fa-bfe6-07d6dfbfc6ea)                                                                                |
| key_name                             | keypair-tenant1                                                                                                                  |
| metadata                             | {}                                                                                                                               |
| name                                 | guest2                                                                                                                           |
| nics                                 | {"nic1": {"vif_model": "virtio", "port_id": "d96cede7-54c4-4184-a54d-96903b412409", "network": "tenant1-mgmt-net", "mtu": 1500}} |
| os-extended-volumes:volumes_attached | []                                                                                                                               |
| pinned                               | True                                                                                                                             |
| progress                             | 0                                                                                                                                |
| server_group                         |                                                                                                                                  |
| status                               | ACTIVE                                                                                                                           |
| tenant1-mgmt-net network             | 192.168.109.20                                                                                                                   |
| tenant_id                            | a4e3a58f85e344c9b238f99045ee9e4e                                                                                                 |
| updated                              | 2015-02-05T15:44:47Z                                                                                                             |
| user_id                              | 49be897e674a4456af937371ecfa936d                                                                                                 |
| vcpus (min/cur/max)                  | [2, 4, 5]                                                                                                                        |
+--------------------------------------+----------------------------------------------------------------------------------------------------------------------------------+
Thu Feb  5 15:44:53 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ [0;32m
Assigned Var:cur_cpu=4
[0m
[1;34m
 === auto scaling down
[0m
[0;32m
If: expr { "4" == "2" } |then   %BREAK_REACHED_MIN_CPU2|result=FALSE
[0m
[0;32m
While: expr { "4" != "2" } |result=TRUE
[0m
nova show guest2
[0;32m<guest2[0m
+--------------------------------------+----------------------------------------------------------------------------------------------------------------------------------+
| Property                             | Value                                                                                                                            |
+--------------------------------------+----------------------------------------------------------------------------------------------------------------------------------+
| OS-DCF:diskConfig                    | MANUAL                                                                                                                           |
| OS-EXT-AZ:availability_zone          | nova                                                                                                                             |
| OS-EXT-STS:power_state               | 1                                                                                                                                |
| OS-EXT-STS:task_state                | -                                                                                                                                |
| OS-EXT-STS:vm_state                  | active                                                                                                                           |
| OS-SRV-USG:launched_at               | 2015-02-05T15:37:48.018830                                                                                                       |
| OS-SRV-USG:terminated_at             | -                                                                                                                                |
| accessIPv4                           |                                                                                                                                  |
| accessIPv6                           |                                                                                                                                  |
| config_drive                         |                                                                                                                                  |
| created                              | 2015-02-05T15:37:38Z                                                                                                             |
| extended                             | {"cpuset": 56, "numanode": 0, "siblings_cpuset": null}                                                                           |
| flavor                               | vcpu5-2 (db9b37f5-cba5-1985-a264-a6c1375a4ff7)                                                                                   |
| hostId                               | 5108074ec1b70826f368003ec6b5aedb0cdb9edb1e36064b0afbe7ad                                                                         |
| id                                   | 3fba3be4-b0e1-44d2-80d9-ae8495e13f82                                                                                             |
| image                                | cgcs-guest (7aeabc04-8b05-44fa-bfe6-07d6dfbfc6ea)                                                                                |
| key_name                             | keypair-tenant1                                                                                                                  |
| metadata                             | {}                                                                                                                               |
| name                                 | guest2                                                                                                                           |
| nics                                 | {"nic1": {"vif_model": "virtio", "port_id": "d96cede7-54c4-4184-a54d-96903b412409", "network": "tenant1-mgmt-net", "mtu": 1500}} |
| os-extended-volumes:volumes_attached | []                                                                                                                               |
| pinned                               | True                                                                                                                             |
| progress                             | 0                                                                                                                                |
| server_group                         |                                                                                                                                  |
| status                               | ACTIVE                                                                                                                           |
| tenant1-mgmt-net network             | 192.168.109.20                                                                                                                   |
| tenant_id                            | a4e3a58f85e344c9b238f99045ee9e4e                                                                                                 |
| updated                              | 2015-02-05T15:45:17Z                                                                                                             |
| user_id                              | 49be897e674a4456af937371ecfa936d                                                                                                 |
| vcpus (min/cur/max)                  | [2, 3, 5]                                                                                                                        |
+--------------------------------------+----------------------------------------------------------------------------------------------------------------------------------+
Thu Feb  5 15:45:24 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ [0;32m
Assigned Var:cur_cpu=3
[0m
[1;34m
 === auto scaling down
[0m
[0;32m
If: expr { "3" == "2" } |then   %BREAK_REACHED_MIN_CPU2|result=FALSE
[0m
[0;32m
While: expr { "3" != "2" } |result=TRUE
[0m
nova show guest2
[0;32m<guest2[0m
+--------------------------------------+----------------------------------------------------------------------------------------------------------------------------------+
| Property                             | Value                                                                                                                            |
+--------------------------------------+----------------------------------------------------------------------------------------------------------------------------------+
| OS-DCF:diskConfig                    | MANUAL                                                                                                                           |
| OS-EXT-AZ:availability_zone          | nova                                                                                                                             |
| OS-EXT-STS:power_state               | 1                                                                                                                                |
| OS-EXT-STS:task_state                | -                                                                                                                                |
| OS-EXT-STS:vm_state                  | active                                                                                                                           |
| OS-SRV-USG:launched_at               | 2015-02-05T15:37:48.018830                                                                                                       |
| OS-SRV-USG:terminated_at             | -                                                                                                                                |
| accessIPv4                           |                                                                                                                                  |
| accessIPv6                           |                                                                                                                                  |
| config_drive                         |                                                                                                                                  |
| created                              | 2015-02-05T15:37:38Z                                                                                                             |
| extended                             | {"cpuset": 24, "numanode": 0, "siblings_cpuset": null}                                                                           |
| flavor                               | vcpu5-2 (db9b37f5-cba5-1985-a264-a6c1375a4ff7)                                                                                   |
| hostId                               | 5108074ec1b70826f368003ec6b5aedb0cdb9edb1e36064b0afbe7ad                                                                         |
| id                                   | 3fba3be4-b0e1-44d2-80d9-ae8495e13f82                                                                                             |
| image                                | cgcs-guest (7aeabc04-8b05-44fa-bfe6-07d6dfbfc6ea)                                                                                |
| key_name                             | keypair-tenant1                                                                                                                  |
| metadata                             | {}                                                                                                                               |
| name                                 | guest2                                                                                                                           |
| nics                                 | {"nic1": {"vif_model": "virtio", "port_id": "d96cede7-54c4-4184-a54d-96903b412409", "network": "tenant1-mgmt-net", "mtu": 1500}} |
| os-extended-volumes:volumes_attached | []                                                                                                                               |
| pinned                               | True                                                                                                                             |
| progress                             | 0                                                                                                                                |
| server_group                         |                                                                                                                                  |
| status                               | ACTIVE                                                                                                                           |
| tenant1-mgmt-net network             | 192.168.109.20                                                                                                                   |
| tenant_id                            | a4e3a58f85e344c9b238f99045ee9e4e                                                                                                 |
| updated                              | 2015-02-05T15:45:47Z                                                                                                             |
| user_id                              | 49be897e674a4456af937371ecfa936d                                                                                                 |
| vcpus (min/cur/max)                  | [2, 2, 5]                                                                                                                        |
+--------------------------------------+----------------------------------------------------------------------------------------------------------------------------------+
Thu Feb  5 15:45:56 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ [0;32m
Assigned Var:cur_cpu=2
[0m
[1;34m
 === auto scaling down
[0m
[0;32m
If: expr { "2" == "2" } |then   %BREAK_REACHED_MIN_CPU2|result=TRUE
[0m

Jumping to label[0;32m:%BREAK_REACHED_MIN_CPU2
[0m
[1;34m
 === check if guest2 current cpu value reached minimum cpu value:2
[0m
nova show guest2
+--------------------------------------+----------------------------------------------------------------------------------------------------------------------------------+
| Property                             | Value                                                                                                                            |
+--------------------------------------+----------------------------------------------------------------------------------------------------------------------------------+
| OS-DCF:diskConfig                    | MANUAL                                                                                                                           |
| OS-EXT-AZ:availability_zone          | nova                                                                                                                             |
| OS-EXT-STS:power_state               | 1                                                                                                                                |
| OS-EXT-STS:task_state                | -                                                                                                                                |
| OS-EXT-STS:vm_state                  | active                                                                                                                           |
| OS-SRV-USG:launched_at               | 2015-02-05T15:37:48.018830                                                                                                       |
| OS-SRV-USG:terminated_at             | -                                                                                                                                |
| accessIPv4                           |                                                                                                                                  |
| accessIPv6                           |                                                                                                                                  |
| config_drive                         |                                                                                                                                  |
| created                              | 2015-02-05T15:37:38Z                                                                                                             |
| extended                             | {"cpuset": 24, "numanode": 0, "siblings_cpuset": null}                                                                           |
| flavor                               | vcpu5-2 (db9b37f5-cba5-1985-a264-a6c1375a4ff7)                                                                                   |
| hostId                               | 5108074ec1b70826f368003ec6b5aedb0cdb9edb1e36064b0afbe7ad                                                                         |
| id                                   | 3fba3be4-b0e1-44d2-80d9-ae8495e13f82                                                                                             |
| image                                | cgcs-guest (7aeabc04-8b05-44fa-bfe6-07d6dfbfc6ea)                                                                                |
| key_name                             | keypair-tenant1                                                                                                                  |
| metadata                             | {}                                                                                                                               |
| name                                 | guest2                                                                                                                           |
| nics                                 | {"nic1": {"vif_model": "virtio", "port_id": "d96cede7-54c4-4184-a54d-96903b412409", "network": "tenant1-mgmt-net", "mtu": 1500}} |
| os-extended-volumes:volumes_attached | []                                                                                                                               |
| pinned                               | True                                                                                                                             |
| progress                             | 0                                                                                                                                |
| server_group                         |                                                                                                                                  |
| status                               | ACTIVE                                                                                                                           |
| tenant1-mgmt-net network             | 192.168.109.20                                                                                                                   |
| tenant_id                            | a4e3a58f85e344c9b238f99045ee9e4e                                                                                                 |
| updated                              | 2015-02-05T15:45:47Z                                                                                                             |
| user_id                              | 49be897e674a4456af937371ecfa936d                                                                                                 |
| vcpus (min/cur/max)                  | [2, 2, 5]                                                                                                                        |
+--------------------------------------+----------------------------------------------------------------------------------------------------------------------------------+
[0;32m<min/cur/max[0m
Thu Feb  5 15:46:27 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ [0;32m
Assigned Var:min_cpu=2
[0m
[0;32m
Assigned Var:cur_cpu=2
[0m
[0;32m
Assigned Var:max_cpu=5
[0m
[0;32m
If: expr { "2" != "2" } |then   [|result=FALSE
[0m
ceilometer sample-create -r 3fba3be4-b0e1-44d2-80d9-ae8495e13f82 -m vote --meter-type gauge --meter-unit '%' --sample-volume 90 -- resource-metadata '{"display_name":"guest2"}'
+-------------------+--------------------------------------------+
| Property          | Value                                      |
+-------------------+--------------------------------------------+
| message_id        | 25f7329c-ad4e-11e4-99ab-2c44fd83b910       |
| name              | vote                                       |
| project_id        | a4e3a58f85e344c9b238f99045ee9e4e           |
| resource_id       | 3fba3be4-b0e1-44d2-80d9-ae8495e13f82       |
| resource_metadata | {u'display_name': u'guest2'}               |
| source            | a4e3a58f85e344c9b238f99045ee9e4e:openstack |
| timestamp         | 2015-02-05T15:46:28.395541                 |
| type              | gauge                                      |
| unit              | %                                          |
| user_id           | 49be897e674a4456af937371ecfa936d           |
| volume            | 90.0                                       |
+-------------------+--------------------------------------------+
Thu Feb  5 15:46:28 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ ceilometer resource-show -r 3fba3be4-b0e1-44d2-80d9-ae8495e13f82
+-------------+--------------------------------------------+
| Property    | Value                                      |
+-------------+--------------------------------------------+
| metadata    | {u'display_name': u'guest2'}               |
| project_id  | a4e3a58f85e344c9b238f99045ee9e4e           |
| resource_id | 3fba3be4-b0e1-44d2-80d9-ae8495e13f82       |
| source      | a4e3a58f85e344c9b238f99045ee9e4e:openstack |
| user_id     | 49be897e674a4456af937371ecfa936d           |
+-------------+--------------------------------------------+
Thu Feb  5 15:46:29 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ [0;32m<[0m
ceilometer alarm-list
[0;32m<alarm[0m
+--------------------------------------+----------------------------------+-------------------+---------+------------+-----------------------------+------------------+
| Alarm ID                             | Name                             | State             | Enabled | Continuous | Alarm condition             | Time constraints |
+--------------------------------------+----------------------------------+-------------------+---------+------------+-----------------------------+------------------+
| 16798576-d280-4220-b451-c29401ab3a47 | STACK3-CPUAlarmHigh-f23l4sb4kyfm | insufficient data | True    | True       | vote > 60.0 during 1 x 120s | None             |
| 57806677-81e3-4fe3-b418-5a3edfdfd670 | STACK1-CPUAlarmLow-kdifk33wqx42  | insufficient data | True    | True       | vote < 5.0 during 1 x 120s  | None             |
| a82b9b63-afd9-4759-97c9-826d01863287 | STACK3-CPUAlarmLow-qtfb72by7yxi  | insufficient data | True    | True       | vote < 5.0 during 1 x 120s  | None             |
| b6300331-f025-41bb-8f2c-21d5dee1d62d | STACK2-CPUAlarmLow-ka26ms4iiss5  | ok                | True    | True       | vote < 5.0 during 1 x 120s  | None             |
| dba36058-5f4c-4ffe-8233-54c8944bdc3e | STACK1-CPUAlarmHigh-to2atu424urn | insufficient data | True    | True       | vote > 60.0 during 1 x 120s | None             |
| dfa52044-f4ea-4358-bb64-3d536aac949d | STACK2-CPUAlarmHigh-leiv5qcxexjb | alarm             | True    | True       | vote > 60.0 during 1 x 120s | None             |
+--------------------------------------+----------------------------------+-------------------+---------+------------+-----------------------------+------------------+
Thu Feb  5 15:47:10 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ [1;34m
 === going in a loop to check guest2 reached maximum cpu vale 
[0m
nova show guest2
[0;32m<guest2[0m
+--------------------------------------+----------------------------------------------------------------------------------------------------------------------------------+
| Property                             | Value                                                                                                                            |
+--------------------------------------+----------------------------------------------------------------------------------------------------------------------------------+
| OS-DCF:diskConfig                    | MANUAL                                                                                                                           |
| OS-EXT-AZ:availability_zone          | nova                                                                                                                             |
| OS-EXT-STS:power_state               | 1                                                                                                                                |
| OS-EXT-STS:task_state                | -                                                                                                                                |
| OS-EXT-STS:vm_state                  | active                                                                                                                           |
| OS-SRV-USG:launched_at               | 2015-02-05T15:37:48.018830                                                                                                       |
| OS-SRV-USG:terminated_at             | -                                                                                                                                |
| accessIPv4                           |                                                                                                                                  |
| accessIPv6                           |                                                                                                                                  |
| config_drive                         |                                                                                                                                  |
| created                              | 2015-02-05T15:37:38Z                                                                                                             |
| extended                             | {"cpuset": 56, "numanode": 0, "siblings_cpuset": null}                                                                           |
| flavor                               | vcpu5-2 (db9b37f5-cba5-1985-a264-a6c1375a4ff7)                                                                                   |
| hostId                               | 5108074ec1b70826f368003ec6b5aedb0cdb9edb1e36064b0afbe7ad                                                                         |
| id                                   | 3fba3be4-b0e1-44d2-80d9-ae8495e13f82                                                                                             |
| image                                | cgcs-guest (7aeabc04-8b05-44fa-bfe6-07d6dfbfc6ea)                                                                                |
| key_name                             | keypair-tenant1                                                                                                                  |
| metadata                             | {}                                                                                                                               |
| name                                 | guest2                                                                                                                           |
| nics                                 | {"nic1": {"vif_model": "virtio", "port_id": "d96cede7-54c4-4184-a54d-96903b412409", "network": "tenant1-mgmt-net", "mtu": 1500}} |
| os-extended-volumes:volumes_attached | []                                                                                                                               |
| pinned                               | True                                                                                                                             |
| progress                             | 0                                                                                                                                |
| server_group                         |                                                                                                                                  |
| status                               | ACTIVE                                                                                                                           |
| tenant1-mgmt-net network             | 192.168.109.20                                                                                                                   |
| tenant_id                            | a4e3a58f85e344c9b238f99045ee9e4e                                                                                                 |
| updated                              | 2015-02-05T15:46:48Z                                                                                                             |
| user_id                              | 49be897e674a4456af937371ecfa936d                                                                                                 |
| vcpus (min/cur/max)                  | [2, 3, 5]                                                                                                                        |
+--------------------------------------+----------------------------------------------------------------------------------------------------------------------------------+
Thu Feb  5 15:47:11 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ [0;32m
Assigned Var:min_cpu=2
[0m
[0;32m
Assigned Var:cur_cpu=3
[0m
[0;32m
Assigned Var:max_cpu=5
[0m
[0;32m
While: expr { "3" != "5" } |result=TRUE
[0m
nova show guest2
[0;32m<guest2[0m
+--------------------------------------+----------------------------------------------------------------------------------------------------------------------------------+
| Property                             | Value                                                                                                                            |
+--------------------------------------+----------------------------------------------------------------------------------------------------------------------------------+
| OS-DCF:diskConfig                    | MANUAL                                                                                                                           |
| OS-EXT-AZ:availability_zone          | nova                                                                                                                             |
| OS-EXT-STS:power_state               | 1                                                                                                                                |
| OS-EXT-STS:task_state                | -                                                                                                                                |
| OS-EXT-STS:vm_state                  | active                                                                                                                           |
| OS-SRV-USG:launched_at               | 2015-02-05T15:37:48.018830                                                                                                       |
| OS-SRV-USG:terminated_at             | -                                                                                                                                |
| accessIPv4                           |                                                                                                                                  |
| accessIPv6                           |                                                                                                                                  |
| config_drive                         |                                                                                                                                  |
| created                              | 2015-02-05T15:37:38Z                                                                                                             |
| extended                             | {"cpuset": 56, "numanode": 0, "siblings_cpuset": null}                                                                           |
| flavor                               | vcpu5-2 (db9b37f5-cba5-1985-a264-a6c1375a4ff7)                                                                                   |
| hostId                               | 5108074ec1b70826f368003ec6b5aedb0cdb9edb1e36064b0afbe7ad                                                                         |
| id                                   | 3fba3be4-b0e1-44d2-80d9-ae8495e13f82                                                                                             |
| image                                | cgcs-guest (7aeabc04-8b05-44fa-bfe6-07d6dfbfc6ea)                                                                                |
| key_name                             | keypair-tenant1                                                                                                                  |
| metadata                             | {}                                                                                                                               |
| name                                 | guest2                                                                                                                           |
| nics                                 | {"nic1": {"vif_model": "virtio", "port_id": "d96cede7-54c4-4184-a54d-96903b412409", "network": "tenant1-mgmt-net", "mtu": 1500}} |
| os-extended-volumes:volumes_attached | []                                                                                                                               |
| pinned                               | True                                                                                                                             |
| progress                             | 0                                                                                                                                |
| server_group                         |                                                                                                                                  |
| status                               | ACTIVE                                                                                                                           |
| tenant1-mgmt-net network             | 192.168.109.20                                                                                                                   |
| tenant_id                            | a4e3a58f85e344c9b238f99045ee9e4e                                                                                                 |
| updated                              | 2015-02-05T15:46:48Z                                                                                                             |
| user_id                              | 49be897e674a4456af937371ecfa936d                                                                                                 |
| vcpus (min/cur/max)                  | [2, 3, 5]                                                                                                                        |
+--------------------------------------+----------------------------------------------------------------------------------------------------------------------------------+
Thu Feb  5 15:47:13 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ [0;32m
Assigned Var:cur_cpu=3
[0m
[1;34m
 === auto scaling up
[0m
[0;32m
If: expr { "3" == "5" } |then   %BREAK_REACHED_MAX_CPU2|result=FALSE
[0m
[0;32m
While: expr { "3" != "5" } |result=TRUE
[0m
nova show guest2
[0;32m<guest2[0m
+--------------------------------------+----------------------------------------------------------------------------------------------------------------------------------+
| Property                             | Value                                                                                                                            |
+--------------------------------------+----------------------------------------------------------------------------------------------------------------------------------+
| OS-DCF:diskConfig                    | MANUAL                                                                                                                           |
| OS-EXT-AZ:availability_zone          | nova                                                                                                                             |
| OS-EXT-STS:power_state               | 1                                                                                                                                |
| OS-EXT-STS:task_state                | -                                                                                                                                |
| OS-EXT-STS:vm_state                  | active                                                                                                                           |
| OS-SRV-USG:launched_at               | 2015-02-05T15:37:48.018830                                                                                                       |
| OS-SRV-USG:terminated_at             | -                                                                                                                                |
| accessIPv4                           |                                                                                                                                  |
| accessIPv6                           |                                                                                                                                  |
| config_drive                         |                                                                                                                                  |
| created                              | 2015-02-05T15:37:38Z                                                                                                             |
| extended                             | {"cpuset": 120, "numanode": 0, "siblings_cpuset": null}                                                                          |
| flavor                               | vcpu5-2 (db9b37f5-cba5-1985-a264-a6c1375a4ff7)                                                                                   |
| hostId                               | 5108074ec1b70826f368003ec6b5aedb0cdb9edb1e36064b0afbe7ad                                                                         |
| id                                   | 3fba3be4-b0e1-44d2-80d9-ae8495e13f82                                                                                             |
| image                                | cgcs-guest (7aeabc04-8b05-44fa-bfe6-07d6dfbfc6ea)                                                                                |
| key_name                             | keypair-tenant1                                                                                                                  |
| metadata                             | {}                                                                                                                               |
| name                                 | guest2                                                                                                                           |
| nics                                 | {"nic1": {"vif_model": "virtio", "port_id": "d96cede7-54c4-4184-a54d-96903b412409", "network": "tenant1-mgmt-net", "mtu": 1500}} |
| os-extended-volumes:volumes_attached | []                                                                                                                               |
| pinned                               | True                                                                                                                             |
| progress                             | 0                                                                                                                                |
| server_group                         |                                                                                                                                  |
| status                               | ACTIVE                                                                                                                           |
| tenant1-mgmt-net network             | 192.168.109.20                                                                                                                   |
| tenant_id                            | a4e3a58f85e344c9b238f99045ee9e4e                                                                                                 |
| updated                              | 2015-02-05T15:47:17Z                                                                                                             |
| user_id                              | 49be897e674a4456af937371ecfa936d                                                                                                 |
| vcpus (min/cur/max)                  | [2, 4, 5]                                                                                                                        |
+--------------------------------------+----------------------------------------------------------------------------------------------------------------------------------+
Thu Feb  5 15:47:44 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ [0;32m
Assigned Var:cur_cpu=4
[0m
[1;34m
 === auto scaling up
[0m
[0;32m
If: expr { "4" == "5" } |then   %BREAK_REACHED_MAX_CPU2|result=FALSE
[0m
[0;32m
While: expr { "4" != "5" } |result=TRUE
[0m
nova show guest2
[0;32m<guest2[0m
+--------------------------------------+----------------------------------------------------------------------------------------------------------------------------------+
| Property                             | Value                                                                                                                            |
+--------------------------------------+----------------------------------------------------------------------------------------------------------------------------------+
| OS-DCF:diskConfig                    | MANUAL                                                                                                                           |
| OS-EXT-AZ:availability_zone          | nova                                                                                                                             |
| OS-EXT-STS:power_state               | 1                                                                                                                                |
| OS-EXT-STS:task_state                | -                                                                                                                                |
| OS-EXT-STS:vm_state                  | active                                                                                                                           |
| OS-SRV-USG:launched_at               | 2015-02-05T15:37:48.018830                                                                                                       |
| OS-SRV-USG:terminated_at             | -                                                                                                                                |
| accessIPv4                           |                                                                                                                                  |
| accessIPv6                           |                                                                                                                                  |
| config_drive                         |                                                                                                                                  |
| created                              | 2015-02-05T15:37:38Z                                                                                                             |
| extended                             | {"cpuset": 248, "numanode": 0, "siblings_cpuset": null}                                                                          |
| flavor                               | vcpu5-2 (db9b37f5-cba5-1985-a264-a6c1375a4ff7)                                                                                   |
| hostId                               | 5108074ec1b70826f368003ec6b5aedb0cdb9edb1e36064b0afbe7ad                                                                         |
| id                                   | 3fba3be4-b0e1-44d2-80d9-ae8495e13f82                                                                                             |
| image                                | cgcs-guest (7aeabc04-8b05-44fa-bfe6-07d6dfbfc6ea)                                                                                |
| key_name                             | keypair-tenant1                                                                                                                  |
| metadata                             | {}                                                                                                                               |
| name                                 | guest2                                                                                                                           |
| nics                                 | {"nic1": {"vif_model": "virtio", "port_id": "d96cede7-54c4-4184-a54d-96903b412409", "network": "tenant1-mgmt-net", "mtu": 1500}} |
| os-extended-volumes:volumes_attached | []                                                                                                                               |
| pinned                               | True                                                                                                                             |
| progress                             | 0                                                                                                                                |
| server_group                         |                                                                                                                                  |
| status                               | ACTIVE                                                                                                                           |
| tenant1-mgmt-net network             | 192.168.109.20                                                                                                                   |
| tenant_id                            | a4e3a58f85e344c9b238f99045ee9e4e                                                                                                 |
| updated                              | 2015-02-05T15:47:48Z                                                                                                             |
| user_id                              | 49be897e674a4456af937371ecfa936d                                                                                                 |
| vcpus (min/cur/max)                  | [2, 5, 5]                                                                                                                        |
+--------------------------------------+----------------------------------------------------------------------------------------------------------------------------------+
Thu Feb  5 15:48:15 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ [0;32m
Assigned Var:cur_cpu=5
[0m
[1;34m
 === auto scaling up
[0m
[0;32m
If: expr { "5" == "5" } |then   %BREAK_REACHED_MAX_CPU2|result=TRUE
[0m

Jumping to label[0;32m:%BREAK_REACHED_MAX_CPU2
[0m
[1;34m
 === check if guest2 current cpu value reached maximum cpu value:5
[0m
nova show guest2
+--------------------------------------+----------------------------------------------------------------------------------------------------------------------------------+
| Property                             | Value                                                                                                                            |
+--------------------------------------+----------------------------------------------------------------------------------------------------------------------------------+
| OS-DCF:diskConfig                    | MANUAL                                                                                                                           |
| OS-EXT-AZ:availability_zone          | nova                                                                                                                             |
| OS-EXT-STS:power_state               | 1                                                                                                                                |
| OS-EXT-STS:task_state                | -                                                                                                                                |
| OS-EXT-STS:vm_state                  | active                                                                                                                           |
| OS-SRV-USG:launched_at               | 2015-02-05T15:37:48.018830                                                                                                       |
| OS-SRV-USG:terminated_at             | -                                                                                                                                |
| accessIPv4                           |                                                                                                                                  |
| accessIPv6                           |                                                                                                                                  |
| config_drive                         |                                                                                                                                  |
| created                              | 2015-02-05T15:37:38Z                                                                                                             |
| extended                             | {"cpuset": 248, "numanode": 0, "siblings_cpuset": null}                                                                          |
| flavor                               | vcpu5-2 (db9b37f5-cba5-1985-a264-a6c1375a4ff7)                                                                                   |
| hostId                               | 5108074ec1b70826f368003ec6b5aedb0cdb9edb1e36064b0afbe7ad                                                                         |
| id                                   | 3fba3be4-b0e1-44d2-80d9-ae8495e13f82                                                                                             |
| image                                | cgcs-guest (7aeabc04-8b05-44fa-bfe6-07d6dfbfc6ea)                                                                                |
| key_name                             | keypair-tenant1                                                                                                                  |
| metadata                             | {}                                                                                                                               |
| name                                 | guest2                                                                                                                           |
| nics                                 | {"nic1": {"vif_model": "virtio", "port_id": "d96cede7-54c4-4184-a54d-96903b412409", "network": "tenant1-mgmt-net", "mtu": 1500}} |
| os-extended-volumes:volumes_attached | []                                                                                                                               |
| pinned                               | True                                                                                                                             |
| progress                             | 0                                                                                                                                |
| server_group                         |                                                                                                                                  |
| status                               | ACTIVE                                                                                                                           |
| tenant1-mgmt-net network             | 192.168.109.20                                                                                                                   |
| tenant_id                            | a4e3a58f85e344c9b238f99045ee9e4e                                                                                                 |
| updated                              | 2015-02-05T15:47:48Z                                                                                                             |
| user_id                              | 49be897e674a4456af937371ecfa936d                                                                                                 |
| vcpus (min/cur/max)                  | [2, 5, 5]                                                                                                                        |
+--------------------------------------+----------------------------------------------------------------------------------------------------------------------------------+
[0;32m<min/cur/max[0m
Thu Feb  5 15:48:47 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ [0;32m
Assigned Var:min_cpu=2
[0m
[0;32m
Assigned Var:cur_cpu=5
[0m
[0;32m
Assigned Var:max_cpu=5
[0m
[0;32m
If: expr { "5" != "5" } |then   [|result=FALSE
[0m
[1;34m
 scale down guest1 guest2 in parallel
[0m
[1;34m
 === save the current state of guest1 cpu
[0m
[0;32m

Setting Expect Timeout to: 20 

[0m
vm-topology -s servers
libnuma: Warning: Cannot parse sysfs meminfo (3)
vm-topology: 2015-02-05T15:48:47.782743  options: show:['servers']

SERVERS (nova view):  Legend: cpulist = [cpu_id[i], ...], S = siblings, R = reserved
+---------+--------------------------------------+-------------------+--------+-----------+----------+------------+-------------+--------------+---------+--------+-------------+-------+--------+----------+---------+------------+
| tenant  | ID                                   | instance_name     | name   | host      | vm_state | task_state | power_state | server_group | flavor  | pinned | shared_vcpu | vcpus | memory | numanode | cpulist | in_libvirt |
+---------+--------------------------------------+-------------------+--------+-----------+----------+------------+-------------+--------------+---------+--------+-------------+-------+--------+----------+---------+------------+
| tenant1 | 3fba3be4-b0e1-44d2-80d9-ae8495e13f82 | instance-00000071 | guest2 | compute-0 | active   | None       | Running     | -            | vcpu5-2 | pinned |        None | 2,5,5 |    512 |        0 | 3-7     |    yes     |
| tenant1 | 1be7ef2b-8298-46f0-af8d-80ea67ead7bd | instance-00000070 | guest1 | compute-1 | active   | None       | Running     | -            | vcpu4-1 | pinned |        None | 1,4,4 |    512 |        0 | 3-6     |    yes     |
| tenant1 | bac22332-e1b4-426f-8fd6-cd44eeda8354 | instance-00000072 | guest3 | compute-1 | active   | None       | Running     | -            | vcpu5-2 | pinned |        None | 2,5,5 |    512 |        1 | 10-14   |    yes     |
+---------+--------------------------------------+-------------------+--------+-----------+----------+------------+-------------+--------------+---------+--------+-------------+-------+--------+----------+---------+------------+
[0;32m<guest1[0m
Thu Feb  5 15:48:49 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ [0;32m
Assigned Var:min_cpu1=1
[0m
[0;32m
Assigned Var:cur_cpu1=4
[0m
[0;32m
Assigned Var:max_cpu1=4
[0m
vm-topology -s servers
libnuma: Warning: Cannot parse sysfs meminfo (3)
vm-topology: 2015-02-05T15:48:49.809456  options: show:['servers']

SERVERS (nova view):  Legend: cpulist = [cpu_id[i], ...], S = siblings, R = reserved
+---------+--------------------------------------+-------------------+--------+-----------+----------+------------+-------------+--------------+---------+--------+-------------+-------+--------+----------+---------+------------+
| tenant  | ID                                   | instance_name     | name   | host      | vm_state | task_state | power_state | server_group | flavor  | pinned | shared_vcpu | vcpus | memory | numanode | cpulist | in_libvirt |
+---------+--------------------------------------+-------------------+--------+-----------+----------+------------+-------------+--------------+---------+--------+-------------+-------+--------+----------+---------+------------+
| tenant1 | 3fba3be4-b0e1-44d2-80d9-ae8495e13f82 | instance-00000071 | guest2 | compute-0 | active   | None       | Running     | -            | vcpu5-2 | pinned |        None | 2,5,5 |    512 |        0 | 3-7     |    yes     |
| tenant1 | 1be7ef2b-8298-46f0-af8d-80ea67ead7bd | instance-00000070 | guest1 | compute-1 | active   | None       | Running     | -            | vcpu4-1 | pinned |        None | 1,4,4 |    512 |        0 | 3-6     |    yes     |
| tenant1 | bac22332-e1b4-426f-8fd6-cd44eeda8354 | instance-00000072 | guest3 | compute-1 | active   | None       | Running     | -            | vcpu5-2 | pinned |        None | 2,5,5 |    512 |        1 | 10-14   |    yes     |
+---------+--------------------------------------+-------------------+--------+-----------+----------+------------+-------------+--------------+---------+--------+-------------+-------+--------+----------+---------+------------+
[0;32m<guest2[0m
Thu Feb  5 15:48:51 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ [0;32m
Assigned Var:min_cpu2=2
[0m
[0;32m
Assigned Var:cur_cpu2=5
[0m
[0;32m
Assigned Var:max_cpu2=5
[0m
[1;34m
 === if cur_cpu is not equal to min_cpu do scale down in parallel
[0m
[0;32m
If: expr { "4" != "1" } |then   [|result=TRUE
[0m
[0;32m
If: expr { "5" != "2" } |then   [ |result=TRUE
[0m
[1;34m
 === scale down in parallel
[0m
nova scale guest1 cpu down
Thu Feb  5 15:48:54 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ nova scale guest2 cpu down
Thu Feb  5 15:48:58 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ [0;32m

Setting Expect Timeout to: 5 

[0m
vm-topology -s servers
libnuma: Warning: Cannot parse sysfs meminfo (3)
vm-topology: 2015-02-05T15:48:58.590091  options: show:['servers']

SERVERS (nova view):  Legend: cpulist = [cpu_id[i], ...], S = siblings, R = reserved
+---------+--------------------------------------+-------------------+--------+-----------+----------+------------+-------------+--------------+---------+--------+-------------+-------+--------+----------+---------+------------+
| tenant  | ID                                   | instance_name     | name   | host      | vm_state | task_state | power_state | server_group | flavor  | pinned | shared_vcpu | vcpus | memory | numanode | cpulist | in_libvirt |
+---------+--------------------------------------+-------------------+--------+-----------+----------+------------+-------------+--------------+---------+--------+-------------+-------+--------+----------+---------+------------+
| tenant1 | 3fba3be4-b0e1-44d2-80d9-ae8495e13f82 | instance-00000071 | guest2 | compute-0 | active   | None       | Running     | -            | vcpu5-2 | pinned |        None | 2,4,5 |    512 |        0 | 3-6     |    yes     |
| tenant1 | 1be7ef2b-8298-46f0-af8d-80ea67ead7bd | instance-00000070 | guest1 | compute-1 | active   | None       | Running     | -            | vcpu4-1 | pinned |        None | 1,3,4 |    512 |        0 | 3-5     |    yes     |
| tenant1 | bac22332-e1b4-426f-8fd6-cd44eeda8354 | instance-00000072 | guest3 | compute-1 | active   | None       | Running     | -            | vcpu5-2 | pinned |        None | 2,5,5 |    512 |        1 | 10-14   |    yes     |
+---------+--------------------------------------+-------------------+--------+-----------+----------+------------+-------------+--------------+---------+--------+-------------+-------+--------+----------+---------+------------+
[0;32m<guest1[0m
Thu Feb  5 15:48:59 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ [0;32m
Assigned Var:cur_cpu1=3
[0m
vm-topology -s servers
libnuma: Warning: Cannot parse sysfs meminfo (3)
vm-topology: 2015-02-05T15:49:00.570143  options: show:['servers']

SERVERS (nova view):  Legend: cpulist = [cpu_id[i], ...], S = siblings, R = reserved
+---------+--------------------------------------+-------------------+--------+-----------+----------+------------+-------------+--------------+---------+--------+-------------+-------+--------+----------+---------+------------+
| tenant  | ID                                   | instance_name     | name   | host      | vm_state | task_state | power_state | server_group | flavor  | pinned | shared_vcpu | vcpus | memory | numanode | cpulist | in_libvirt |
+---------+--------------------------------------+-------------------+--------+-----------+----------+------------+-------------+--------------+---------+--------+-------------+-------+--------+----------+---------+------------+
| tenant1 | 3fba3be4-b0e1-44d2-80d9-ae8495e13f82 | instance-00000071 | guest2 | compute-0 | active   | None       | Running     | -            | vcpu5-2 | pinned |        None | 2,4,5 |    512 |        0 | 3-6     |    yes     |
| tenant1 | 1be7ef2b-8298-46f0-af8d-80ea67ead7bd | instance-00000070 | guest1 | compute-1 | active   | None       | Running     | -            | vcpu4-1 | pinned |        None | 1,3,4 |    512 |        0 | 3-5     |    yes     |
| tenant1 | bac22332-e1b4-426f-8fd6-cd44eeda8354 | instance-00000072 | guest3 | compute-1 | active   | None       | Running     | -            | vcpu5-2 | pinned |        None | 2,5,5 |    512 |        1 | 10-14   |    yes     |
+---------+--------------------------------------+-------------------+--------+-----------+----------+------------+-------------+--------------+---------+--------+-------------+-------+--------+----------+---------+------------+
[0;32m<guest2[0m
Thu Feb  5 15:49:01 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ [0;32m
Assigned Var:cur_cpu2=4
[0m
[0;32m
If: expr { "3" != "3" } |then   [|result=FALSE
[0m
[0;32m
If: expr { "4" != "4" } |then   [|result=FALSE
[0m
[1;34m
 === scale down in parallel completed
[0m
[1;34m
 scale up guest1 guest2 in parallel
[0m
[1;34m
 === save the current state of guest1 guest2 cpu
[0m
[0;32m

Setting Expect Timeout to: 20 

[0m
vm-topology -s servers
libnuma: Warning: Cannot parse sysfs meminfo (3)
vm-topology: 2015-02-05T15:49:02.416116  options: show:['servers']

SERVERS (nova view):  Legend: cpulist = [cpu_id[i], ...], S = siblings, R = reserved
+---------+--------------------------------------+-------------------+--------+-----------+----------+------------+-------------+--------------+---------+--------+-------------+-------+--------+----------+---------+------------+
| tenant  | ID                                   | instance_name     | name   | host      | vm_state | task_state | power_state | server_group | flavor  | pinned | shared_vcpu | vcpus | memory | numanode | cpulist | in_libvirt |
+---------+--------------------------------------+-------------------+--------+-----------+----------+------------+-------------+--------------+---------+--------+-------------+-------+--------+----------+---------+------------+
| tenant1 | 3fba3be4-b0e1-44d2-80d9-ae8495e13f82 | instance-00000071 | guest2 | compute-0 | active   | None       | Running     | -            | vcpu5-2 | pinned |        None | 2,4,5 |    512 |        0 | 3-6     |    yes     |
| tenant1 | 1be7ef2b-8298-46f0-af8d-80ea67ead7bd | instance-00000070 | guest1 | compute-1 | active   | None       | Running     | -            | vcpu4-1 | pinned |        None | 1,3,4 |    512 |        0 | 3-5     |    yes     |
| tenant1 | bac22332-e1b4-426f-8fd6-cd44eeda8354 | instance-00000072 | guest3 | compute-1 | active   | None       | Running     | -            | vcpu5-2 | pinned |        None | 2,5,5 |    512 |        1 | 10-14   |    yes     |
+---------+--------------------------------------+-------------------+--------+-----------+----------+------------+-------------+--------------+---------+--------+-------------+-------+--------+----------+---------+------------+
[0;32m<guest1[0m
Thu Feb  5 15:49:03 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ [0;32m
Assigned Var:min_cpu1=1
[0m
[0;32m
Assigned Var:cur_cpu1=3
[0m
[0;32m
Assigned Var:max_cpu1=4
[0m
vm-topology -s servers
libnuma: Warning: Cannot parse sysfs meminfo (3)
vm-topology: 2015-02-05T15:49:04.071047  options: show:['servers']

SERVERS (nova view):  Legend: cpulist = [cpu_id[i], ...], S = siblings, R = reserved
+---------+--------------------------------------+-------------------+--------+-----------+----------+------------+-------------+--------------+---------+--------+-------------+-------+--------+----------+---------+------------+
| tenant  | ID                                   | instance_name     | name   | host      | vm_state | task_state | power_state | server_group | flavor  | pinned | shared_vcpu | vcpus | memory | numanode | cpulist | in_libvirt |
+---------+--------------------------------------+-------------------+--------+-----------+----------+------------+-------------+--------------+---------+--------+-------------+-------+--------+----------+---------+------------+
| tenant1 | 3fba3be4-b0e1-44d2-80d9-ae8495e13f82 | instance-00000071 | guest2 | compute-0 | active   | None       | Running     | -            | vcpu5-2 | pinned |        None | 2,4,5 |    512 |        0 | 3-6     |    yes     |
| tenant1 | 1be7ef2b-8298-46f0-af8d-80ea67ead7bd | instance-00000070 | guest1 | compute-1 | active   | None       | Running     | -            | vcpu4-1 | pinned |        None | 1,3,4 |    512 |        0 | 3-5     |    yes     |
| tenant1 | bac22332-e1b4-426f-8fd6-cd44eeda8354 | instance-00000072 | guest3 | compute-1 | active   | None       | Running     | -            | vcpu5-2 | pinned |        None | 2,5,5 |    512 |        1 | 10-14   |    yes     |
+---------+--------------------------------------+-------------------+--------+-----------+----------+------------+-------------+--------------+---------+--------+-------------+-------+--------+----------+---------+------------+
[0;32m<guest2[0m
Thu Feb  5 15:49:05 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ [0;32m
Assigned Var:min_cpu2=2
[0m
[0;32m
Assigned Var:cur_cpu2=4
[0m
[0;32m
Assigned Var:max_cpu2=5
[0m
[1;34m
 === if cur_cpu is not equal to max_cpu do scale up in parallel
[0m
[0;32m
If: expr { "3" != "4" } |then   [|result=TRUE
[0m
[0;32m
If: expr { "4" != "5" } |then   [ |result=TRUE
[0m
[1;34m
 === scale up in parallel
[0m
nova scale guest1 cpu up
Thu Feb  5 15:49:08 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ nova scale guest2 cpu up
Thu Feb  5 15:49:12 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ [0;32m

Setting Expect Timeout to: 20 

[0m
vm-topology -s servers
libnuma: Warning: Cannot parse sysfs meminfo (3)
vm-topology: 2015-02-05T15:49:12.801805  options: show:['servers']

SERVERS (nova view):  Legend: cpulist = [cpu_id[i], ...], S = siblings, R = reserved
+---------+--------------------------------------+-------------------+--------+-----------+----------+------------+-------------+--------------+---------+--------+-------------+-------+--------+----------+---------+------------+
| tenant  | ID                                   | instance_name     | name   | host      | vm_state | task_state | power_state | server_group | flavor  | pinned | shared_vcpu | vcpus | memory | numanode | cpulist | in_libvirt |
+---------+--------------------------------------+-------------------+--------+-----------+----------+------------+-------------+--------------+---------+--------+-------------+-------+--------+----------+---------+------------+
| tenant1 | 3fba3be4-b0e1-44d2-80d9-ae8495e13f82 | instance-00000071 | guest2 | compute-0 | active   | None       | Running     | -            | vcpu5-2 | pinned |        None | 2,5,5 |    512 |        0 | 3-7     |    yes     |
| tenant1 | 1be7ef2b-8298-46f0-af8d-80ea67ead7bd | instance-00000070 | guest1 | compute-1 | active   | None       | Running     | -            | vcpu4-1 | pinned |        None | 1,4,4 |    512 |        0 | 3-6     |    yes     |
| tenant1 | bac22332-e1b4-426f-8fd6-cd44eeda8354 | instance-00000072 | guest3 | compute-1 | active   | None       | Running     | -            | vcpu5-2 | pinned |        None | 2,5,5 |    512 |        1 | 10-14   |    yes     |
+---------+--------------------------------------+-------------------+--------+-----------+----------+------------+-------------+--------------+---------+--------+-------------+-------+--------+----------+---------+------------+
[0;32m<guest1[0m
Thu Feb  5 15:49:14 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ [0;32m
Assigned Var:cur_cpu1=4
[0m
[0;32m

Setting Expect Timeout to: 20 

[0m
vm-topology -s servers
libnuma: Warning: Cannot parse sysfs meminfo (3)
vm-topology: 2015-02-05T15:49:14.809370  options: show:['servers']

SERVERS (nova view):  Legend: cpulist = [cpu_id[i], ...], S = siblings, R = reserved
+---------+--------------------------------------+-------------------+--------+-----------+----------+------------+-------------+--------------+---------+--------+-------------+-------+--------+----------+---------+------------+
| tenant  | ID                                   | instance_name     | name   | host      | vm_state | task_state | power_state | server_group | flavor  | pinned | shared_vcpu | vcpus | memory | numanode | cpulist | in_libvirt |
+---------+--------------------------------------+-------------------+--------+-----------+----------+------------+-------------+--------------+---------+--------+-------------+-------+--------+----------+---------+------------+
| tenant1 | 3fba3be4-b0e1-44d2-80d9-ae8495e13f82 | instance-00000071 | guest2 | compute-0 | active   | None       | Running     | -            | vcpu5-2 | pinned |        None | 2,5,5 |    512 |        0 | 3-7     |    yes     |
| tenant1 | 1be7ef2b-8298-46f0-af8d-80ea67ead7bd | instance-00000070 | guest1 | compute-1 | active   | None       | Running     | -            | vcpu4-1 | pinned |        None | 1,4,4 |    512 |        0 | 3-6     |    yes     |
| tenant1 | bac22332-e1b4-426f-8fd6-cd44eeda8354 | instance-00000072 | guest3 | compute-1 | active   | None       | Running     | -            | vcpu5-2 | pinned |        None | 2,5,5 |    512 |        1 | 10-14   |    yes     |
+---------+--------------------------------------+-------------------+--------+-----------+----------+------------+-------------+--------------+---------+--------+-------------+-------+--------+----------+---------+------------+
[0;32m<guest2[0m
Thu Feb  5 15:49:16 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ [0;32m
Assigned Var:cur_cpu2=5
[0m
[0;32m
If: expr { "4" != "4" } |then   [|result=FALSE
[0m
[0;32m
If: expr { "5" != "5" } |then   [|result=FALSE
[0m
[1;34m
 === scale up in parallel completed
[0m
[1;34m
 scale down guest1 and check guest2 not changed
[0m
[1;34m
 === save the current state of guest1 guest2 cpu
[0m
[0;32m

Setting Expect Timeout to: 20 

[0m
vm-topology -s servers
libnuma: Warning: Cannot parse sysfs meminfo (3)
vm-topology: 2015-02-05T15:49:16.854490  options: show:['servers']

SERVERS (nova view):  Legend: cpulist = [cpu_id[i], ...], S = siblings, R = reserved
+---------+--------------------------------------+-------------------+--------+-----------+----------+------------+-------------+--------------+---------+--------+-------------+-------+--------+----------+---------+------------+
| tenant  | ID                                   | instance_name     | name   | host      | vm_state | task_state | power_state | server_group | flavor  | pinned | shared_vcpu | vcpus | memory | numanode | cpulist | in_libvirt |
+---------+--------------------------------------+-------------------+--------+-----------+----------+------------+-------------+--------------+---------+--------+-------------+-------+--------+----------+---------+------------+
| tenant1 | 3fba3be4-b0e1-44d2-80d9-ae8495e13f82 | instance-00000071 | guest2 | compute-0 | active   | None       | Running     | -            | vcpu5-2 | pinned |        None | 2,5,5 |    512 |        0 | 3-7     |    yes     |
| tenant1 | 1be7ef2b-8298-46f0-af8d-80ea67ead7bd | instance-00000070 | guest1 | compute-1 | active   | None       | Running     | -            | vcpu4-1 | pinned |        None | 1,4,4 |    512 |        0 | 3-6     |    yes     |
| tenant1 | bac22332-e1b4-426f-8fd6-cd44eeda8354 | instance-00000072 | guest3 | compute-1 | active   | None       | Running     | -            | vcpu5-2 | pinned |        None | 2,5,5 |    512 |        1 | 10-14   |    yes     |
+---------+--------------------------------------+-------------------+--------+-----------+----------+------------+-------------+--------------+---------+--------+-------------+-------+--------+----------+---------+------------+
[0;32m<guest1[0m
Thu Feb  5 15:49:18 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ [0;32m
Assigned Var:min_cpu1=1
[0m
[0;32m
Assigned Var:cur_cpu1=4
[0m
[0;32m
Assigned Var:max_cpu1=4
[0m
vm-topology -s servers
libnuma: Warning: Cannot parse sysfs meminfo (3)
vm-topology: 2015-02-05T15:49:18.947086  options: show:['servers']

SERVERS (nova view):  Legend: cpulist = [cpu_id[i], ...], S = siblings, R = reserved
+---------+--------------------------------------+-------------------+--------+-----------+----------+------------+-------------+--------------+---------+--------+-------------+-------+--------+----------+---------+------------+
| tenant  | ID                                   | instance_name     | name   | host      | vm_state | task_state | power_state | server_group | flavor  | pinned | shared_vcpu | vcpus | memory | numanode | cpulist | in_libvirt |
+---------+--------------------------------------+-------------------+--------+-----------+----------+------------+-------------+--------------+---------+--------+-------------+-------+--------+----------+---------+------------+
| tenant1 | 3fba3be4-b0e1-44d2-80d9-ae8495e13f82 | instance-00000071 | guest2 | compute-0 | active   | None       | Running     | -            | vcpu5-2 | pinned |        None | 2,5,5 |    512 |        0 | 3-7     |    yes     |
| tenant1 | 1be7ef2b-8298-46f0-af8d-80ea67ead7bd | instance-00000070 | guest1 | compute-1 | active   | None       | Running     | -            | vcpu4-1 | pinned |        None | 1,4,4 |    512 |        0 | 3-6     |    yes     |
| tenant1 | bac22332-e1b4-426f-8fd6-cd44eeda8354 | instance-00000072 | guest3 | compute-1 | active   | None       | Running     | -            | vcpu5-2 | pinned |        None | 2,5,5 |    512 |        1 | 10-14   |    yes     |
+---------+--------------------------------------+-------------------+--------+-----------+----------+------------+-------------+--------------+---------+--------+-------------+-------+--------+----------+---------+------------+
[0;32m<guest2[0m
Thu Feb  5 15:49:20 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ [0;32m
Assigned Var:min_cpu2=2
[0m
[0;32m
Assigned Var:cur_cpu2=5
[0m
[0;32m
Assigned Var:max_cpu2=5
[0m
[1;34m
 === if cur_cpu is not equal to min_cpu do scale down in parallel
[0m
[0;32m
If: expr { "4" != "1" } |then   [|result=TRUE
[0m
[0;32m
If: expr { "5" != "2" } |then   [ |result=TRUE
[0m
[1;34m
 === scale down in only guest1
[0m
[0;32m

Setting Expect Timeout to: 10 

[0m
nova scale guest1 cpu down
Thu Feb  5 15:49:24 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ [0;32m

Setting Expect Timeout to: 20 

[0m
vm-topology -s servers
libnuma: Warning: Cannot parse sysfs meminfo (3)
vm-topology: 2015-02-05T15:49:24.820435  options: show:['servers']

SERVERS (nova view):  Legend: cpulist = [cpu_id[i], ...], S = siblings, R = reserved
+---------+--------------------------------------+-------------------+--------+-----------+----------+------------+-------------+--------------+---------+--------+-------------+-------+--------+----------+---------+------------+
| tenant  | ID                                   | instance_name     | name   | host      | vm_state | task_state | power_state | server_group | flavor  | pinned | shared_vcpu | vcpus | memory | numanode | cpulist | in_libvirt |
+---------+--------------------------------------+-------------------+--------+-----------+----------+------------+-------------+--------------+---------+--------+-------------+-------+--------+----------+---------+------------+
| tenant1 | 3fba3be4-b0e1-44d2-80d9-ae8495e13f82 | instance-00000071 | guest2 | compute-0 | active   | None       | Running     | -            | vcpu5-2 | pinned |        None | 2,5,5 |    512 |        0 | 3-7     |    yes     |
| tenant1 | 1be7ef2b-8298-46f0-af8d-80ea67ead7bd | instance-00000070 | guest1 | compute-1 | active   | None       | Running     | -            | vcpu4-1 | pinned |        None | 1,3,4 |    512 |        0 | 3-5     |    yes     |
| tenant1 | bac22332-e1b4-426f-8fd6-cd44eeda8354 | instance-00000072 | guest3 | compute-1 | active   | None       | Running     | -            | vcpu5-2 | pinned |        None | 2,5,5 |    512 |        1 | 10-14   |    yes     |
+---------+--------------------------------------+-------------------+--------+-----------+----------+------------+-------------+--------------+---------+--------+-------------+-------+--------+----------+---------+------------+
[0;32m<guest1[0m
Thu Feb  5 15:49:26 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ [0;32m
Assigned Var:cur_cpu1=3
[0m
vm-topology -s servers
libnuma: Warning: Cannot parse sysfs meminfo (3)
vm-topology: 2015-02-05T15:49:26.929561  options: show:['servers']

SERVERS (nova view):  Legend: cpulist = [cpu_id[i], ...], S = siblings, R = reserved
+---------+--------------------------------------+-------------------+--------+-----------+----------+------------+-------------+--------------+---------+--------+-------------+-------+--------+----------+---------+------------+
| tenant  | ID                                   | instance_name     | name   | host      | vm_state | task_state | power_state | server_group | flavor  | pinned | shared_vcpu | vcpus | memory | numanode | cpulist | in_libvirt |
+---------+--------------------------------------+-------------------+--------+-----------+----------+------------+-------------+--------------+---------+--------+-------------+-------+--------+----------+---------+------------+
| tenant1 | 3fba3be4-b0e1-44d2-80d9-ae8495e13f82 | instance-00000071 | guest2 | compute-0 | active   | None       | Running     | -            | vcpu5-2 | pinned |        None | 2,5,5 |    512 |        0 | 3-7     |    yes     |
| tenant1 | 1be7ef2b-8298-46f0-af8d-80ea67ead7bd | instance-00000070 | guest1 | compute-1 | active   | None       | Running     | -            | vcpu4-1 | pinned |        None | 1,3,4 |    512 |        0 | 3-5     |    yes     |
| tenant1 | bac22332-e1b4-426f-8fd6-cd44eeda8354 | instance-00000072 | guest3 | compute-1 | active   | None       | Running     | -            | vcpu5-2 | pinned |        None | 2,5,5 |    512 |        1 | 10-14   |    yes     |
+---------+--------------------------------------+-------------------+--------+-----------+----------+------------+-------------+--------------+---------+--------+-------------+-------+--------+----------+---------+------------+
[0;32m<guest2[0m
Thu Feb  5 15:49:28 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ [0;32m
Assigned Var:cur_cpu2=5
[0m
[0;32m
If: expr { "3" != "3" } |then   [|result=FALSE
[0m
[0;32m
If: expr { "5" != "5" } |then   [|result=FALSE
[0m
[1;34m
 scale up guest1 and check guest2 state not changed
[0m
[1;34m
 === save the current state of guest1 guest2 cpu
[0m
[0;32m

Setting Expect Timeout to: 20 

[0m
vm-topology -s servers
libnuma: Warning: Cannot parse sysfs meminfo (3)
vm-topology: 2015-02-05T15:49:28.729786  options: show:['servers']

SERVERS (nova view):  Legend: cpulist = [cpu_id[i], ...], S = siblings, R = reserved
+---------+--------------------------------------+-------------------+--------+-----------+----------+------------+-------------+--------------+---------+--------+-------------+-------+--------+----------+---------+------------+
| tenant  | ID                                   | instance_name     | name   | host      | vm_state | task_state | power_state | server_group | flavor  | pinned | shared_vcpu | vcpus | memory | numanode | cpulist | in_libvirt |
+---------+--------------------------------------+-------------------+--------+-----------+----------+------------+-------------+--------------+---------+--------+-------------+-------+--------+----------+---------+------------+
| tenant1 | 3fba3be4-b0e1-44d2-80d9-ae8495e13f82 | instance-00000071 | guest2 | compute-0 | active   | None       | Running     | -            | vcpu5-2 | pinned |        None | 2,5,5 |    512 |        0 | 3-7     |    yes     |
| tenant1 | 1be7ef2b-8298-46f0-af8d-80ea67ead7bd | instance-00000070 | guest1 | compute-1 | active   | None       | Running     | -            | vcpu4-1 | pinned |        None | 1,3,4 |    512 |        0 | 3-5     |    yes     |
| tenant1 | bac22332-e1b4-426f-8fd6-cd44eeda8354 | instance-00000072 | guest3 | compute-1 | active   | None       | Running     | -            | vcpu5-2 | pinned |        None | 2,5,5 |    512 |        1 | 10-14   |    yes     |
+---------+--------------------------------------+-------------------+--------+-----------+----------+------------+-------------+--------------+---------+--------+-------------+-------+--------+----------+---------+------------+
[0;32m<guest1[0m
Thu Feb  5 15:49:30 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ [0;32m
Assigned Var:min_cpu1=1
[0m
[0;32m
Assigned Var:cur_cpu1=3
[0m
[0;32m
Assigned Var:max_cpu1=4
[0m
vm-topology -s servers
libnuma: Warning: Cannot parse sysfs meminfo (3)
vm-topology: 2015-02-05T15:49:30.687554  options: show:['servers']

SERVERS (nova view):  Legend: cpulist = [cpu_id[i], ...], S = siblings, R = reserved
+---------+--------------------------------------+-------------------+--------+-----------+----------+------------+-------------+--------------+---------+--------+-------------+-------+--------+----------+---------+------------+
| tenant  | ID                                   | instance_name     | name   | host      | vm_state | task_state | power_state | server_group | flavor  | pinned | shared_vcpu | vcpus | memory | numanode | cpulist | in_libvirt |
+---------+--------------------------------------+-------------------+--------+-----------+----------+------------+-------------+--------------+---------+--------+-------------+-------+--------+----------+---------+------------+
| tenant1 | 3fba3be4-b0e1-44d2-80d9-ae8495e13f82 | instance-00000071 | guest2 | compute-0 | active   | None       | Running     | -            | vcpu5-2 | pinned |        None | 2,5,5 |    512 |        0 | 3-7     |    yes     |
| tenant1 | 1be7ef2b-8298-46f0-af8d-80ea67ead7bd | instance-00000070 | guest1 | compute-1 | active   | None       | Running     | -            | vcpu4-1 | pinned |        None | 1,3,4 |    512 |        0 | 3-5     |    yes     |
| tenant1 | bac22332-e1b4-426f-8fd6-cd44eeda8354 | instance-00000072 | guest3 | compute-1 | active   | None       | Running     | -            | vcpu5-2 | pinned |        None | 2,5,5 |    512 |        1 | 10-14   |    yes     |
+---------+--------------------------------------+-------------------+--------+-----------+----------+------------+-------------+--------------+---------+--------+-------------+-------+--------+----------+---------+------------+
[0;32m<guest2[0m
Thu Feb  5 15:49:32 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ [0;32m
Assigned Var:min_cpu2=2
[0m
[0;32m
Assigned Var:cur_cpu2=5
[0m
[0;32m
Assigned Var:max_cpu2=5
[0m
[1;34m
 === if cur_cpu is not equal to max_cpu do scale up 
[0m
[0;32m
If: expr { "3" != "4" } |then   [|result=TRUE
[0m
[1;34m
 === scale up in guest1
[0m
nova scale guest1 cpu up
Thu Feb  5 15:49:35 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ [0;32m

Setting Expect Timeout to: 20 

[0m
vm-topology -s servers
libnuma: Warning: Cannot parse sysfs meminfo (3)
vm-topology: 2015-02-05T15:49:36.303832  options: show:['servers']

SERVERS (nova view):  Legend: cpulist = [cpu_id[i], ...], S = siblings, R = reserved
+---------+--------------------------------------+-------------------+--------+-----------+----------+------------+-------------+--------------+---------+--------+-------------+-------+--------+----------+---------+------------+
| tenant  | ID                                   | instance_name     | name   | host      | vm_state | task_state | power_state | server_group | flavor  | pinned | shared_vcpu | vcpus | memory | numanode | cpulist | in_libvirt |
+---------+--------------------------------------+-------------------+--------+-----------+----------+------------+-------------+--------------+---------+--------+-------------+-------+--------+----------+---------+------------+
| tenant1 | 3fba3be4-b0e1-44d2-80d9-ae8495e13f82 | instance-00000071 | guest2 | compute-0 | active   | None       | Running     | -            | vcpu5-2 | pinned |        None | 2,5,5 |    512 |        0 | 3-7     |    yes     |
| tenant1 | 1be7ef2b-8298-46f0-af8d-80ea67ead7bd | instance-00000070 | guest1 | compute-1 | active   | None       | Running     | -            | vcpu4-1 | pinned |        None | 1,4,4 |    512 |        0 | 3-6     |    yes     |
| tenant1 | bac22332-e1b4-426f-8fd6-cd44eeda8354 | instance-00000072 | guest3 | compute-1 | active   | None       | Running     | -            | vcpu5-2 | pinned |        None | 2,5,5 |    512 |        1 | 10-14   |    yes     |
+---------+--------------------------------------+-------------------+--------+-----------+----------+------------+-------------+--------------+---------+--------+-------------+-------+--------+----------+---------+------------+
[0;32m<guest1[0m
Thu Feb  5 15:49:37 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ [0;32m
Assigned Var:cur_cpu1=4
[0m
vm-topology -s servers
libnuma: Warning: Cannot parse sysfs meminfo (3)
vm-topology: 2015-02-05T15:49:38.667599  options: show:['servers']

SERVERS (nova view):  Legend: cpulist = [cpu_id[i], ...], S = siblings, R = reserved
+---------+--------------------------------------+-------------------+--------+-----------+----------+------------+-------------+--------------+---------+--------+-------------+-------+--------+----------+---------+------------+
| tenant  | ID                                   | instance_name     | name   | host      | vm_state | task_state | power_state | server_group | flavor  | pinned | shared_vcpu | vcpus | memory | numanode | cpulist | in_libvirt |
+---------+--------------------------------------+-------------------+--------+-----------+----------+------------+-------------+--------------+---------+--------+-------------+-------+--------+----------+---------+------------+
| tenant1 | 3fba3be4-b0e1-44d2-80d9-ae8495e13f82 | instance-00000071 | guest2 | compute-0 | active   | None       | Running     | -            | vcpu5-2 | pinned |        None | 2,5,5 |    512 |        0 | 3-7     |    yes     |
| tenant1 | 1be7ef2b-8298-46f0-af8d-80ea67ead7bd | instance-00000070 | guest1 | compute-1 | active   | None       | Running     | -            | vcpu4-1 | pinned |        None | 1,4,4 |    512 |        0 | 3-6     |    yes     |
| tenant1 | bac22332-e1b4-426f-8fd6-cd44eeda8354 | instance-00000072 | guest3 | compute-1 | active   | None       | Running     | -            | vcpu5-2 | pinned |        None | 2,5,5 |    512 |        1 | 10-14   |    yes     |
+---------+--------------------------------------+-------------------+--------+-----------+----------+------------+-------------+--------------+---------+--------+-------------+-------+--------+----------+---------+------------+
[0;32m<guest2[0m
Thu Feb  5 15:49:40 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ [0;32m
Assigned Var:cur_cpu2=5
[0m
[0;32m
If: expr { "4" != "4" } |then   [|result=FALSE
[0m
[0;32m
If: expr { "5" != "5" } |then   [|result=FALSE
[0m
[1;34m
 === clean up setup
[0m
heat stack-delete STACK1 STACK2 STACK3
+--------------------------------------+------------+--------------------+----------------------+
| id                                   | stack_name | stack_status       | creation_time        |
+--------------------------------------+------------+--------------------+----------------------+
| 5cf93636-087c-45ea-bbe1-0b4225f79071 | STACK1     | DELETE_IN_PROGRESS | 2015-02-05T15:37:36Z |
| 8b89792e-9667-45be-8ae6-70ae7ef13b51 | STACK2     | DELETE_IN_PROGRESS | 2015-02-05T15:37:38Z |
| d8d5af90-b710-40e1-a104-9485aa28bfeb | STACK3     | DELETE_IN_PROGRESS | 2015-02-05T15:37:39Z |
+--------------------------------------+------------+--------------------+----------------------+
Thu Feb  5 15:49:41 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ heat stack-list
+----+------------+--------------+---------------+
| id | stack_name | stack_status | creation_time |
+----+------------+--------------+---------------+
+----+------------+--------------+---------------+
Thu Feb  5 15:50:12 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ [1;34m
 === become admin to clean up
[0m
[1;34m
cleanup all setup created for this testcase
[0m
[1;34m
 === delete the stack created
[0m
source /etc/nova/openrc
Thu Feb  5 15:50:12 UTC 2015
[wrsroot@controller-0 ~(keystone_admin)]$ [1;34m
 === delete the flavor created 
[0m
nova flavor-list
+--------------------------------------+---------------------------------------+-----------+------+-----------+------+-------+-------------+-----------+-------------+
| ID                                   | Name                                  | Memory_MB | Disk | Ephemeral | Swap | VCPUs | RXTX_Factor | Is_Public | VCPU_Model  |
+--------------------------------------+---------------------------------------+-----------+------+-----------+------+-------+-------------+-----------+-------------+
| 1                                    | m1.tiny                               | 512       | 1    | 0         |      | 1     | 1.0         | True      | -           |
| 100                                  | wrl5.dpdk.big                         | 4096      | 0    | 0         |      | 3     | 1.0         | True      | -           |
| 101                                  | wrl5.dpdk.small                       | 512       | 0    | 0         |      | 2     | 1.0         | True      | -           |
| 2                                    | m1.small                              | 2048      | 20   | 0         |      | 1     | 1.0         | True      | -           |
| 200                                  | wrl5.dpdk.small.heartbeat             | 512       | 0    | 0         |      | 2     | 1.0         | True      | -           |
| 201                                  | wrl5.dpdk.big.heartbeat               | 4096      | 0    | 0         |      | 3     | 1.0         | True      | -           |
| 233                                  | wrl5.dpdk.big.heartbeat.pinToMgmtCore | 4096      | 0    | 0         |      | 3     | 1.0         | True      | -           |
| 28aa6811-d4b8-41f5-994c-db017e81511d | small                                 | 512       | 1    | 0         |      | 1     | 1.0         | True      | -           |
| 41a0c6b2-5ce1-4ff2-9d73-2a6201847cc0 | medium.dpdk                           | 512       | 1    | 0         |      | 2     | 1.0         | True      | SandyBridge |
| 5f0d748b-1c8b-4a70-1985-4d57e25ac137 | vcpu4-1                               | 512       | 0    | 0         |      | 4     | 1.0         | True      | -           |
| d3b37dcf-227b-419d-9385-7623f08b65fd | test_flavor_1431620018                | 1024      | 0    | 0         |      | 1     | 1.0         | True      | -           |
| db9b37f5-cba5-1985-a264-a6c1375a4ff7 | vcpu5-2                               | 512       | 0    | 0         |      | 5     | 1.0         | True      | -           |
| f345d0a0-54be-4ab6-a9db-ddcff6524bcb | small.float                           | 512       | 1    | 0         |      | 1     | 1.0         | True      | -           |
+--------------------------------------+---------------------------------------+-----------+------+-----------+------+-------+-------------+-----------+-------------+
Thu Feb  5 15:50:13 UTC 2015
[wrsroot@controller-0 ~(keystone_admin)]$ nova flavor-delete vcpu4-1
+--------------------------------------+---------+-----------+------+-----------+------+-------+-------------+-----------+------------+
| ID                                   | Name    | Memory_MB | Disk | Ephemeral | Swap | VCPUs | RXTX_Factor | Is_Public | VCPU_Model |
+--------------------------------------+---------+-----------+------+-----------+------+-------+-------------+-----------+------------+
| 5f0d748b-1c8b-4a70-1985-4d57e25ac137 | vcpu4-1 | 512       | 0    | 0         |      | 4     | 1.0         | True      | -          |
+--------------------------------------+---------+-----------+------+-----------+------+-------+-------------+-----------+------------+
Thu Feb  5 15:50:14 UTC 2015
[wrsroot@controller-0 ~(keystone_admin)]$ nova flavor-delete vcpu5-2
+--------------------------------------+---------+-----------+------+-----------+------+-------+-------------+-----------+------------+
| ID                                   | Name    | Memory_MB | Disk | Ephemeral | Swap | VCPUs | RXTX_Factor | Is_Public | VCPU_Model |
+--------------------------------------+---------+-----------+------+-----------+------+-------+-------------+-----------+------------+
| db9b37f5-cba5-1985-a264-a6c1375a4ff7 | vcpu5-2 | 512       | 0    | 0         |      | 5     | 1.0         | True      | -          |
+--------------------------------------+---------+-----------+------+-----------+------+-------+-------------+-----------+------------+
Thu Feb  5 15:50:15 UTC 2015
[wrsroot@controller-0 ~(keystone_admin)]$ nova flavor-list
+--------------------------------------+---------------------------------------+-----------+------+-----------+------+-------+-------------+-----------+-------------+
| ID                                   | Name                                  | Memory_MB | Disk | Ephemeral | Swap | VCPUs | RXTX_Factor | Is_Public | VCPU_Model  |
+--------------------------------------+---------------------------------------+-----------+------+-----------+------+-------+-------------+-----------+-------------+
| 1                                    | m1.tiny                               | 512       | 1    | 0         |      | 1     | 1.0         | True      | -           |
| 100                                  | wrl5.dpdk.big                         | 4096      | 0    | 0         |      | 3     | 1.0         | True      | -           |
| 101                                  | wrl5.dpdk.small                       | 512       | 0    | 0         |      | 2     | 1.0         | True      | -           |
| 2                                    | m1.small                              | 2048      | 20   | 0         |      | 1     | 1.0         | True      | -           |
| 200                                  | wrl5.dpdk.small.heartbeat             | 512       | 0    | 0         |      | 2     | 1.0         | True      | -           |
| 201                                  | wrl5.dpdk.big.heartbeat               | 4096      | 0    | 0         |      | 3     | 1.0         | True      | -           |
| 233                                  | wrl5.dpdk.big.heartbeat.pinToMgmtCore | 4096      | 0    | 0         |      | 3     | 1.0         | True      | -           |
| 28aa6811-d4b8-41f5-994c-db017e81511d | small                                 | 512       | 1    | 0         |      | 1     | 1.0         | True      | -           |
| 41a0c6b2-5ce1-4ff2-9d73-2a6201847cc0 | medium.dpdk                           | 512       | 1    | 0         |      | 2     | 1.0         | True      | SandyBridge |
| d3b37dcf-227b-419d-9385-7623f08b65fd | test_flavor_1431620018                | 1024      | 0    | 0         |      | 1     | 1.0         | True      | -           |
| f345d0a0-54be-4ab6-a9db-ddcff6524bcb | small.float                           | 512       | 1    | 0         |      | 1     | 1.0         | True      | -           |
+--------------------------------------+---------------------------------------+-----------+------+-----------+------+-------+-------------+-----------+-------------+
Thu Feb  5 15:50:16 UTC 2015
[wrsroot@controller-0 ~(keystone_admin)]$ [1;34m
 === become tenant to clean up stack
[0m
source /home/wrsroot/openrc.tenant1
Thu Feb  5 15:50:16 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ [1;34m
 === delete heat stack created
[0m
heat stack-delete STACK1 STACK2
ERROR: The Stack (STACK1) could not be found.
ERROR: The Stack (STACK2) could not be found.
Unable to delete any of the specified stacks.
Thu Feb  5 15:50:17 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ heat stack-list
+----+------------+--------------+---------------+
| id | stack_name | stack_status | creation_time |
+----+------------+--------------+---------------+
+----+------------+--------------+---------------+
Thu Feb  5 15:51:03 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ [0;32m

##Overall Result: PASS 

[0m
