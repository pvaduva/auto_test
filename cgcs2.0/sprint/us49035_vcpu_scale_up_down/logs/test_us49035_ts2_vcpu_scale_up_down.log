WASSP_WORKSPACE_HOME=/home/jjia/wassp-repos/Workspace
WASSP_USER_CONFIG_FILE=/home/jjia/.wassp/wasspuserconfig.ini
GNOME_KEYRING_PID=2285
WASSP_TESTRUN_WC_FILE=/home/jjia/wassp-repos/Logs/hp380/CGCS_2Cont_2Comp/test_us49035_ts2_vcpu_scale_up_down/testRunWorkingCopy.xml
USER=jjia
LANGUAGE=en_CA:en
WASSP_VSB_BASE=/home/jjia/wassp-repos/Workspace/vsb
PUBLIC_ROUTER=tenant1-router
noseTestTimeout=1000
WASSP_TC_NAME=test_us49035_ts2_vcpu_scale_up_down
WASSP_TC_USER_LOG=/home/jjia/wassp-repos/Logs/hp380/CGCS_2Cont_2Comp/test_us49035_ts2_vcpu_scale_up_down/user
HOST_IP=128.224.252.2
XDG_SEAT=seat0
WASSP_NEST_BASE=/home/jjia/wassp-repos/wassp-nest
TEXTDOMAIN=im-config
SSH_AGENT_PID=2375
COMPIZ_CONFIG_PROFILE=ubuntu
SESSION=ubuntu
LD_LIBRARY_PATH=/home/jjia/wassp-repos/.venv_wassp/lib:
SHLVL=3
WRSPASS=li69nux
QT4_IM_MODULE=xim
HOME=/home/jjia
WASSP_PRODUCT_NAME=cgcs
WASSP_TC_RUN_LOG=/home/jjia/wassp-repos/Logs/hp380/CGCS_2Cont_2Comp/test_us49035_ts2_vcpu_scale_up_down/
DESKTOP_SESSION=ubuntu
wrift_synchronisation_tag=B0E2R0
XDG_SEAT_PATH=/org/freedesktop/DisplayManager/Seat0
GTK_MODULES=overlay-scrollbar:unity-gtk-module
WASSP_WIND_HOME=/WindRiver
_wr_htee_execDir=/home/jjia/wassp-repos/wassp/host/htee
PS1=(.venv_wassp) 
WASSP_CONFIG_BASE=/home/jjia/wassp-repos/systems
INSTANCE=
WASSP_DATA_BASE=/home/jjia/wassp-repos/wassp-data
WASSP_TESTMATRIX_BASE=/home/jjia/wassp-repos/testmatrices
testCaseId=us49035_ts2
DBUS_SESSION_BUS_ADDRESS=unix:abstract=/tmp/dbus-aqf20KfIDP
LOADPATH=${LP}
COLORTERM=gnome-terminal
WASSP_LOGS_HOME=/home/jjia/wassp-repos/Logs
UBUNTU_MENUPROXY=1
GNOME_KEYRING_CONTROL=/run/user/19059/keyring-YEpf6D
WASSP_LOGGING_OPTIONS=all
WRSUSER=wrsroot
QT_QPA_PLATFORMTHEME=appmenu-qt5
MANDATORY_PATH=/usr/share/gconf/ubuntu.mandatory.path
IM_CONFIG_PHASE=1
SESSIONTYPE=gnome-session
BUILDSDIR=/localdisk/loadbuild/jenkins/CGCS_1.0_Unified_Daily_Build
WASSP_TC_PATH=/home/jjia/wassp-repos/testcases/cgcs/cgcs2.0/sprint/us49035_vcpu_scale_up_down/test_us49035_ts2_vcpu_scale_up_down
WASSP_TARGET_LOGS={'Con2': ['/home/jjia/wassp-repos/Logs/hp380/CGCS_2Cont_2Comp/test_us49035_ts2_vcpu_scale_up_down/target_21769.Con2_B0E2R0_20150205_155123.log'], 'Con1': ['/home/jjia/wassp-repos/Logs/hp380/CGCS_2Cont_2Comp/test_us49035_ts2_vcpu_scale_up_down/target_21768.Con1_B0E2R0_20150205_155123.log'], 'Com2': ['/home/jjia/wassp-repos/Logs/hp380/CGCS_2Cont_2Comp/test_us49035_ts2_vcpu_scale_up_down/target_21771.Com2_B0E2R0_20150205_155123.log'], 'Con1SSH': ['/home/jjia/wassp-repos/Logs/hp380/CGCS_2Cont_2Comp/test_us49035_ts2_vcpu_scale_up_down/target_21768.Con1SSH_B0E2R0_20150205_155123.log'], 'SHELL': ['/home/jjia/wassp-repos/Logs/hp380/CGCS_2Cont_2Comp/test_us49035_ts2_vcpu_scale_up_down/target_host:localshell.SHELL_B0E2R0_20150205_155123.log'], 'Com1': ['/home/jjia/wassp-repos/Logs/hp380/CGCS_2Cont_2Comp/test_us49035_ts2_vcpu_scale_up_down/target_21770.Com1_B0E2R0_20150205_155123.log']}
GTK_IM_MODULE=ibus
LOGNAME=jjia
wrift_htee_data_file=/tmp/tmp7wnbz1.tmp
WINDOWID=98566155
_=/home/jjia/wassp-repos/.venv_wassp/bin/python3
DEFAULTS_PATH=/usr/share/gconf/ubuntu.default.path
WASSP_RUNTIMECONFIGS_BASE=/home/jjia/wassp-repos/runtimeconfigs/cgcs
WASSP_SYSTEMS_RUNTIMECONFIGS_BASE=/home/jjia/wassp-repos/systems/cgcs/runtimeconfigs/cgcs2.0/sprint/us49035_vcpu_scale_up_down
TERM=xterm
XDG_SESSION_ID=c3
WASSP_LOCAL_CONFIG_DIR=/home/jjia/.wassp
GNOME_DESKTOP_SESSION_ID=this-is-deprecated
WASSP_TESTCASE_BASE=/home/jjia/wassp-repos/testcases/cgcs
WASSP_TARGET_CONTROL_FILES_DIR=/home/jjia/wassp-repos/wassp-data/Data
PATH=/home/jjia/wassp-repos/.venv_wassp/bin:/home/jjia/wassp-repos/wassp-nest/tools/bin:/home/jjia/wassp-repos/wassp/host/tools/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/games:/usr/local/games
GDM_LANG=en_CA
SELINUX_INIT=YES
SESSION_MANAGER=local/yow-jjia-lx:@/tmp/.ICE-unix/2445,unix/yow-jjia-lx:/tmp/.ICE-unix/2445
XDG_MENU_PREFIX=gnome-
XDG_RUNTIME_DIR=/run/user/19059
XDG_SESSION_PATH=/org/freedesktop/DisplayManager/Session0
WASSP_CONSOLELOGS_BASE=/home/jjia/wassp-repos/Logs/consolelogs
DISPLAY=:0
COMPIZ_BIN_PATH=/usr/bin/
WASSP_SYSTEMS_BASE=/home/jjia/wassp-repos/systems/cgcs
BUILDSERVER=${BS}
WASSP_BASE=/home/jjia/wassp-repos/wassp/host
LANG=en_CA.UTF-8
XDG_CURRENT_DESKTOP=Unity
XAUTHORITY=/folk/jjia/.Xauthority
XMODIFIERS=@im=ibus
WASSP_TESTRUN_FILE=/home/jjia/wassp-repos/Logs/hp380/CGCS_2Cont_2Comp/test_us49035_ts2_vcpu_scale_up_down/testRun.xml
XDG_GREETER_DATA_DIR=/var/lib/lightdm-data/jjia
SSH_AUTH_SOCK=/run/user/19059/keyring-YEpf6D/ssh
SSH_AGENT_LAUNCHER=upstart
CGCS_TEST_DIR=/home/jjia/wassp-repos
SHELL=/bin/bash
GDMSESSION=ubuntu
WASSP_CONFIG_DIR=/home/jjia/wassp-repos/systems/cgcs/platforms/cgcs2.0/sprint/us49035_vcpu_scale_up_down
WASSP_TESTMATRIX_DIR=/home/jjia/wassp-repos/testmatrices/cgcs/cgcs2.0/sprint/us49035_vcpu_scale_up_down
CGCS_BUILD=2015-01-18_22-05-32-scale_up_down
WASSP_PYTHON_HOME=/home/jjia/wassp-repos/.venv_wassp/bin/python3
UPSTART_SESSION=unix:abstract=/com/ubuntu/upstart-session/19059/2297
GPG_AGENT_INFO=/run/user/19059/keyring-YEpf6D/gpg:0:1
TEXTDOMAINDIR=/usr/share/locale/
VIRTUAL_ENV=/home/jjia/wassp-repos/.venv_wassp
QT_IM_MODULE=ibus
XDG_VTNR=7
PWD=/home/jjia/wassp-repos/testcases/cgcs/cgcs2.0/sprint/us49035_vcpu_scale_up_down/test_us49035_ts2_vcpu_scale_up_down
WASSP_TDK_BASE=/home/jjia/wassp-repos/target
WASSP_SYSTEMS_TOPOLOGIES_BASE=/home/jjia/wassp-repos/systems/cgcs/topologies/cgcs2.0/sprint/us49035_vcpu_scale_up_down
XDG_CONFIG_DIRS=/etc/xdg/xdg-ubuntu:/usr/share/upstart/xdg:/etc/xdg
CLUTTER_IM_MODULE=xim
XDG_DATA_DIRS=/usr/share/ubuntu:/usr/share/gnome:/usr/local/share/:/usr/share/
WASSP_SYSTEMS_PLATFORMS_BASE=/home/jjia/wassp-repos/systems/cgcs/platforms/cgcs2.0/sprint/us49035_vcpu_scale_up_down
WRSDIR=/home/wrsroot
WASSP_TC_USER_WORKSPACE=/home/jjia/wassp-repos/Workspace/hp380/CGCS_2Cont_2Comp/test_us49035_ts2_vcpu_scale_up_down/user
WASSP_RUNTIMECONFIGS_DIR=/home/jjia/wassp-repos/runtimeconfigs/cgcs/cgcs2.0/sprint/us49035_vcpu_scale_up_down
GUESTPATH=${GP}
DBREPORT_SWITCH=True
PUBLIC_NETWORK=tenant1-net1
WASSP_FEATURE_DIR=cgcs2.0/sprint/us49035_vcpu_scale_up_down
WASSP_SYSTEMS_HOME=/home/jjia/wassp-repos/systems
VTE_VERSION=3409
WASSP_HOME=/home/jjia/wassp-repos
WRSPASSORIG=wrsroot
JOB=dbus
WASSP_TESTCASE_DIR=/home/jjia/wassp-repos/testcases/cgcs/cgcs2.0/sprint/us49035_vcpu_scale_up_down
hteeCleanWorkDir=True
WASSP_TC_RUN_WORKSPACE=/home/jjia/wassp-repos/Workspace/hp380/CGCS_2Cont_2Comp/test_us49035_ts2_vcpu_scale_up_down/
Const: HOST_IP = 128.224.150.199
[0;32m
expect-lite directive: *NOINTERACT [0m
[0;33mWarning: Remote Host=none, using Localhost[0m
spawn bash
 

jjia@yow-jjia-lx:~/wassp-repos/testcases/cgcs/cgcs2.0/sprint/us49035_vcpu_scale_up_down/test_us49035_ts2_vcpu_scale_up_down$  

PS1="[\u@\h:\w]\$ "
[0;32m
expect-lite directive: *NOFAIL [0m
[0;32m
expect-lite directive: *EXP_INFO [0m

jjia@yow-jjia-lx:~/wassp-repos/testcases/cgcs/cgcs2.0/sprint/us49035_vcpu_scale_up_down/test_us49035_ts2_vcpu_scale_up_down$ 
jjia@yow-jjia-lx:~/wassp-repos/testcases/cgcs/cgcs2.0/sprint/us49035_vcpu_scale_up_down/test_us49035_ts2_vcpu_scale_up_down$ 
jjia@yow-jjia-lx:~/wassp-repos/testcases/cgcs/cgcs2.0/sprint/us49035_vcpu_scale_up_down/test_us49035_ts2_vcpu_scale_up_down$ PS1="[\u@\h:\w]\$ "
[jjia@yow-jjia-lx:~/wassp-repos/testcases/cgcs/cgcs2.0/sprint/us49035_vcpu_scale_up_down/test_us49035_ts2_vcpu_scale_up_down]$ 
[jjia@yow-jjia-lx:~/wassp-repos/testcases/cgcs/cgcs2.0/sprint/us49035_vcpu_scale_up_down/test_us49035_ts2_vcpu_scale_up_down]$ date +%F_%T
2015-02-05_10:51:59
[jjia@yow-jjia-lx:~/wassp-repos/testcases/cgcs/cgcs2.0/sprint/us49035_vcpu_scale_up_down/test_us49035_ts2_vcpu_scale_up_down]$ [0;32m
Assigned Var:DATE=2015-02-05_10:51:59 
[0m
[0;32m

Setting Expect Timeout to: 2 

[0m
[0;32mINFO: CONST FOUND: HOST_IP = 128.224.150.199[0m
[1;34m
 === connecting to controller
[0m
ssh -X -o UserKnownHostsFIle=/dev/null -o Stric tHostKeyChecking=no wrsroot@128.224.150.199
ssh: /home/jjia/wassp-repos/.venv_wassp/lib/libcrypto.so.1.0.0: no version information available (required by ssh)
ssh: /home/jjia/wassp-repos/.venv_wassp/lib/libcrypto.so.1.0.0: no version information available (required by ssh)
Warning: Permanently added '128.224.150.199' (ECDSA) to the list of known hosts.
Wind River Linux 5.0.1.0
------------------------------------------------------------------------
W A R N I N G *** W A R N I N G *** W A R N I N G *** W A R N I N G *** 
------------------------------------------------------------------------
THIS IS A PRIVATE COMPUTER SYSTEM.
This computer system including all related equipment, network devices
(specifically including Internet access), are provided only for authorized use.
All computer systems may be monitored for all lawful purposes, including to
ensure that their use is authorized, for management of the system, to
facilitate protection against unauthorized access, and to verify security
procedures, survivability and operational security. Monitoring includes active
attacks by authorized personnel and their entities to test or verify the
security of the system. During monitoring, information may be examined,
recorded, copied and used for authorized purposes. All information including
personal information, placed on or sent over this system may be monitored. Uses
of this system, authorized or unauthorized, constitutes consent to monitoring
of this system. Unauthorized use may subject you to criminal prosecution.
Evidence of any such unauthorized use collected during monitoring may be used
for administrative, criminal or other adverse action. Use of this system
constitutes consent to monitoring for these purposes.

Password: [0;32m<ssword:[0m

Warning: No xauth data; using fake authentication data for X11 forwarding.
X11 forwarding request failed on channel 0
Last login: Thu Feb  5 15:51:16 2015 from 128.224.144.162
[H[2J
WARNING: Unauthorized access to this system is forbidden and will be
prosecuted by law. By accessing this system, you agree that your
actions may be monitored if unauthorized usage is suspected.


====================================================================
         SYSTEM: yow-cgcs-hp380-1_4
====================================================================

Thu Feb  5 15:51:47 UTC 2015
controller-0:~$ export TMOUT=0
Thu Feb  5 15:51:47 UTC 2015
controller-0:~$ [1;34m
 === become admin
[0m
source /etc/nova/openrc
Thu Feb  5 15:51:47 UTC 2015
[wrsroot@controller-0 ~(keystone_admin)]$ [1;34m
 === show version
[0m
system show
+------------------+-------------------------------------------+
| Property         | Value                                     |
+------------------+-------------------------------------------+
| name             | yow-cgcs-hp380-1_4                        |
| description      | yow-cgcs-hp380-1_4: setup by lab_setup.sh |
| location         | None                                      |
| contact          | None                                      |
| software_version | 14.10 3.4.103-ovp-ga2-rt120-r5_standard   |
| uuid             | 447008ec-d4cb-443e-abfc-abc15fa7bc05      |
| created_at       | 2015-02-04T02:28:21.217852+00:00          |
| updated_at       | 2015-02-05T15:33:22.808996+00:00          |
+------------------+-------------------------------------------+
Thu Feb  5 15:51:49 UTC 2015
[wrsroot@controller-0 ~(keystone_admin)]$ cat /etc/build.info
###
### Wind River Titanium Server
###     Release 14.10
###
###     Wind River Systems, Inc.
###

SW_VERSION="14.10"
BUILD_TARGET="Host Installer"
BUILD_TYPE="Formal"
BUILD_ID="2015-01-18_21-04-50"

JOB="CGCS_1.0_Unified_Daily_Build"
BUILD_BY="jenkins"
BUILD_NUMBER="471"
BUILD_HOST="yow-cgts2-lx"
BUILD_DATE="2015-01-18 21:04:53 -0500"
Thu Feb  5 15:51:49 UTC 2015
[wrsroot@controller-0 ~(keystone_admin)]$ [1;34m
 === show system status
[0m
nova service-list
+------------------+--------------+----------+---------+------------+-------+----------------------------+-----------------+
| Binary           | Host         | Zone     | Status  | Maint Mode | State | Updated_at                 | Disabled Reason |
+------------------+--------------+----------+---------+------------+-------+----------------------------+-----------------+
| nova-conductor   | controller-1 | internal | enabled | disabled   | down  | 2015-02-05T04:16:39.168025 | -               |
| nova-scheduler   | controller-1 | internal | enabled | disabled   | down  | 2015-02-05T04:16:39.203819 | -               |
| nova-consoleauth | controller-1 | internal | enabled | disabled   | down  | 2015-02-05T04:16:39.271516 | -               |
| nova-cert        | controller-1 | internal | enabled | disabled   | down  | 2015-02-05T04:16:39.301624 | -               |
| nova-compute     | compute-0    | nova     | enabled | disabled   | up    | 2015-02-05T15:51:40.073831 | -               |
| nova-conductor   | controller-0 | internal | enabled | disabled   | up    | 2015-02-05T15:51:40.490743 | -               |
| nova-compute     | compute-1    | nova     | enabled | disabled   | up    | 2015-02-05T15:51:40.524388 | -               |
| nova-scheduler   | controller-0 | internal | enabled | disabled   | up    | 2015-02-05T15:51:40.705628 | -               |
| nova-consoleauth | controller-0 | internal | enabled | disabled   | up    | 2015-02-05T15:51:42.374027 | -               |
| nova-cert        | controller-0 | internal | enabled | disabled   | up    | 2015-02-05T15:51:42.393793 | -               |
+------------------+--------------+----------+---------+------------+-------+----------------------------+-----------------+
Thu Feb  5 15:51:50 UTC 2015
[wrsroot@controller-0 ~(keystone_admin)]$ [1;34m
 === validate that controllers and computes are present
[0m
system host-list
+----+--------------+-------------+----------------+-------------+--------------+
| id | hostname     | personality | administrative | operational | availability |
+----+--------------+-------------+----------------+-------------+--------------+
| 1  | controller-0 | controller  | unlocked       | enabled     | available    |
| 2  | controller-1 | controller  | unlocked       | enabled     | available    |
| 3  | compute-0    | compute     | unlocked       | enabled     | available    |
| 4  | compute-1    | compute     | unlocked       | enabled     | available    |
+----+--------------+-------------+----------------+-------------+--------------+
[0;32m<controller-0[0m
[0;32m<controller-1[0m
[0;32m<compute-0[0m
[0;32m<compute-1[0m
Thu Feb  5 15:51:51 UTC 2015
[wrsroot@controller-0 ~(keystone_admin)]$ [0;32m
Assigned Var:last_compute=compute
[0m
[0;32m
If: expr { "compute" != "compute" } |then   [|result=FALSE
[0m
[1;34m
 === Do valid lab_Setup
[0m
[0;32m
If: expr { "yes" == "yes" } |then   [|result=TRUE
[0m
[1;34m
 === validate lab_setup script
[0m
ls lab_setup.sh
lab_setup.sh
Thu Feb  5 15:51:51 UTC 2015
[wrsroot@controller-0 ~(keystone_admin)]$ [0;32m<
lab_setup.sh[0m
ls lab_setup.conf
lab_setup.conf
Thu Feb  5 15:51:51 UTC 2015
[wrsroot@controller-0 ~(keystone_admin)]$ [0;32m<
lab_setup.conf[0m
[1;34m
 === use lab_setup to configure compute nodes, interfaces, provider networks, tenant networks, images, flavors. Ready to boot VMs
[0m
[0;32m

Setting Expect Timeout to: 600 

[0m
time ./lab_setup.sh
Checking for required files
Setting system name
+------------------+-------------------------------------------+
| Property         | Value                                     |
+------------------+-------------------------------------------+
| name             | yow-cgcs-hp380-1_4                        |
| description      | yow-cgcs-hp380-1_4: setup by lab_setup.sh |
| location         | None                                      |
| contact          | None                                      |
| software_version | 14.10 3.4.103-ovp-ga2-rt120-r5_standard   |
| uuid             | 447008ec-d4cb-443e-abfc-abc15fa7bc05      |
| created_at       | 2015-02-04T02:28:21.217852+00:00          |
| updated_at       | 2015-02-05T15:33:22.808996+00:00          |
+------------------+-------------------------------------------+
Adding tenants
Adding tenant credentials
Adding tenant quotas
+---------------------+-------+
| Field               | Value |
+---------------------+-------+
| floatingip          | 50    |
| network             | 5     |
| port                | 19    |
| router              | 10    |
| security_group      | 10    |
| security_group_rule | 100   |
| subnet              | 5     |
+---------------------+-------+
ERROR (BadRequest): Quota value 6 for cores are greater than already used and reserved 7 (HTTP 400) (Request-ID: req-a813e479-5bd6-4e83-ada9-0c72dcc3800b)

real	0m12.685s
user	0m7.428s
sys	0m1.616s
[0;32m<
real[0m
[0;32m

Setting Expect Timeout to: 10 

[0m
Thu Feb  5 15:52:03 UTC 2015
[wrsroot@controller-0 ~(keystone_admin)]$ [1;34m
 === unlock computes
[0m
system host-unlock compute-0
Avoiding 'unlock' action on already 'unlocked' host compute-0
Thu Feb  5 15:52:04 UTC 2015
[wrsroot@controller-0 ~(keystone_admin)]$ system host-unlock compute-1
Avoiding 'unlock' action on already 'unlocked' host compute-1
Thu Feb  5 15:52:05 UTC 2015
[wrsroot@controller-0 ~(keystone_admin)]$ system host-list | grep compute-1
| 4  | compute-1    | compute     | unlocked       | enabled     | available    |
Thu Feb  5 15:52:07 UTC 2015
[wrsroot@controller-0 ~(keystone_admin)]$ [0;32m
Assigned Var:avail=available
[0m
[0;32m
While: expr { "available" != "available" } |result=FALSE
[0m
system host-list
+----+--------------+-------------+----------------+-------------+--------------+
| id | hostname     | personality | administrative | operational | availability |
+----+--------------+-------------+----------------+-------------+--------------+
| 1  | controller-0 | controller  | unlocked       | enabled     | available    |
| 2  | controller-1 | controller  | unlocked       | enabled     | available    |
| 3  | compute-0    | compute     | unlocked       | enabled     | available    |
| 4  | compute-1    | compute     | unlocked       | enabled     | available    |
+----+--------------+-------------+----------------+-------------+--------------+
Thu Feb  5 15:52:08 UTC 2015
[wrsroot@controller-0 ~(keystone_admin)]$ [1;34m
 === Create necessary flavors and set minimum vcpu value
[0m
nova flavor-create --dedicated-cpus True vcpu4-1 5f0d748b-1c8b-4a70-1985-4d57e25ac137 512 0 4
+--------------------------------------+---------+-----------+------+-----------+------+-------+-------------+-----------+------------+
| ID                                   | Name    | Memory_MB | Disk | Ephemeral | Swap | VCPUs | RXTX_Factor | Is_Public | VCPU_Model |
+--------------------------------------+---------+-----------+------+-----------+------+-------+-------------+-----------+------------+
| 5f0d748b-1c8b-4a70-1985-4d57e25ac137 | vcpu4-1 | 512       | 0    | 0         |      | 4     | 1.0         | True      | -          |
+--------------------------------------+---------+-----------+------+-----------+------+-------+-------------+-----------+------------+
Thu Feb  5 15:52:09 UTC 2015
[wrsroot@controller-0 ~(keystone_admin)]$ echo $?
0
Thu Feb  5 15:52:09 UTC 2015
[wrsroot@controller-0 ~(keystone_admin)]$ [0;32m<
0[0m
nova flavor-create --dedicated-cpus True vcpu5-2 db9b37f5-cba5-1985-a264-a6c1375a4ff7 512 0 5
+--------------------------------------+---------+-----------+------+-----------+------+-------+-------------+-----------+------------+
| ID                                   | Name    | Memory_MB | Disk | Ephemeral | Swap | VCPUs | RXTX_Factor | Is_Public | VCPU_Model |
+--------------------------------------+---------+-----------+------+-----------+------+-------+-------------+-----------+------------+
| db9b37f5-cba5-1985-a264-a6c1375a4ff7 | vcpu5-2 | 512       | 0    | 0         |      | 5     | 1.0         | True      | -          |
+--------------------------------------+---------+-----------+------+-----------+------+-------+-------------+-----------+------------+
Thu Feb  5 15:52:10 UTC 2015
[wrsroot@controller-0 ~(keystone_admin)]$ echo $?
0
Thu Feb  5 15:52:10 UTC 2015
[wrsroot@controller-0 ~(keystone_admin)]$ [0;32m<
0[0m
[1;34m
 === flavor created
[0m
nova flavor-list | grep vcpu4-1
| 5f0d748b-1c8b-4a70-1985-4d57e25ac137 | vcpu4-1                               | 512       | 0    | 0         |      | 4     | 1.0         | True      | -           |
Thu Feb  5 15:52:11 UTC 2015
[wrsroot@controller-0 ~(keystone_admin)]$ nova flavor-list | grep vcpu5-2
| db9b37f5-cba5-1985-a264-a6c1375a4ff7 | vcpu5-2                               | 512       | 0    | 0         |      | 5     | 1.0         | True      | -           |
Thu Feb  5 15:52:12 UTC 2015
[wrsroot@controller-0 ~(keystone_admin)]$ [1;34m
 === set minimum value for the cpu created
[0m
nova flavor-key vcpu4-1 set wrs:min_vcpus=1 
Thu Feb  5 15:52:13 UTC 2015
[wrsroot@controller-0 ~(keystone_admin)]$ nova flavor-list --extra-specs | grep vcpu4-1
| 5f0d748b-1c8b-4a70-1985-4d57e25ac137 | vcpu4-1                               | 512       | 0    | 0         |      | 4     | 1.0         | True      | -           | {u'dedicated:cpus': u'True', u'guest:heartbeat': u'False', u'wrs:min_vcpus': u'1'} |
Thu Feb  5 15:52:14 UTC 2015
[wrsroot@controller-0 ~(keystone_admin)]$ [0;32m
Assigned Var:result=1
[0m
[1;34m
 === Minimum CPU value set for vcpu4-1 is 1
[0m
nova flavor-key vcpu5-2 set wrs:min_vcpus=2
Thu Feb  5 15:52:16 UTC 2015
[wrsroot@controller-0 ~(keystone_admin)]$ nova flavor-list --extra-specs | grep vcpu5-2
| db9b37f5-cba5-1985-a264-a6c1375a4ff7 | vcpu5-2                               | 512       | 0    | 0         |      | 5     | 1.0         | True      | -           | {u'dedicated:cpus': u'True', u'guest:heartbeat': u'False', u'wrs:min_vcpus': u'2'} |
Thu Feb  5 15:52:17 UTC 2015
[wrsroot@controller-0 ~(keystone_admin)]$ [0;32m
Assigned Var:result=2
[0m
[1;34m
 === Minimum CPU value set for vcpu5-2 is 2
[0m
[1;34m
 === get tenant uuids
[0m
keystone tenant-list
+----------------------------------+----------+---------+
|                id                |   name   | enabled |
+----------------------------------+----------+---------+
| 1e17286a61104702bc2a3b6ef5467af9 |  admin   |   True  |
| a318972360584e319782fcc2282c8bee | services |   True  |
| a4e3a58f85e344c9b238f99045ee9e4e | tenant1  |   True  |
| e2a088214fe747c59a24256d3e02eb7f | tenant2  |   True  |
+----------------------------------+----------+---------+
[0;32m<name[0m
Thu Feb  5 15:52:17 UTC 2015
[wrsroot@controller-0 ~(keystone_admin)]$ [0;32m
Assigned Var:tenant_uuid=a4e3a58f85e344c9b238f99045ee9e4e
[0m
[1;34m
 === get tenant id
[0m
keystone user-list
+----------------------------------+------------+---------+----------------------+
|                id                |    name    | enabled |        email         |
+----------------------------------+------------+---------+----------------------+
| 5889d8c0e6274cb3923e9aac43d216c3 |   admin    |   True  |   admin@localhost    |
| db6f987048614bfeaa580cdd9f9baa7e | ceilometer |   True  | ceilometer@localhost |
| 4ed222a140204e6fa5a5f17af72f1877 |   cinder   |   True  |   cinder@localhost   |
| c992eed28b814f998e67dbc4322ee138 |   glance   |   True  |   glance@localhost   |
| 92b10c41dcae4a6280ab675c657a1e4a |    heat    |   True  |    heat@localhost    |
| b2e344598b624f12ab516d300556f71a |  neutron   |   True  |  neutron@localhost   |
| 6425a7a5c9b54761a81aaa71a18de55e |    nova    |   True  |    nova@localhost    |
| c550b3e687544b4c9a90380754ac659f |  patching  |   True  |  patching@localhost  |
| 1a105c6520364f29b40e8a01a8ae2ff3 | power_mgmt |   True  | power_mgmt@localhost |
| bd504f2f6f254d5f9d075cd079926ada |   sysinv   |   True  |   sysinv@localhost   |
| 49be897e674a4456af937371ecfa936d |  tenant1   |   True  | tenant1@noreply.com  |
| 52389e4935fc49f39699d21cd188dc09 |  tenant2   |   True  | tenant2@noreply.com  |
+----------------------------------+------------+---------+----------------------+
Thu Feb  5 15:52:18 UTC 2015
[wrsroot@controller-0 ~(keystone_admin)]$ keystone user-list | grep tenant1
| 49be897e674a4456af937371ecfa936d |  tenant1   |   True  | tenant1@noreply.com  |
Thu Feb  5 15:52:19 UTC 2015
[wrsroot@controller-0 ~(keystone_admin)]$ [0;32m
Assigned Var:tenant_user_id=49be897e674a4456af937371ecfa936d
[0m
[1;34m
 === increase quotas for test
[0m
nova quota-update --instances 30 a4e3a58f85e344c9b238f99045ee9e4e
Thu Feb  5 15:52:20 UTC 2015
[wrsroot@controller-0 ~(keystone_admin)]$ nova quota-update --cores 60 a4e3a58f85e344c9b238f99045ee9e4e
Thu Feb  5 15:52:21 UTC 2015
[wrsroot@controller-0 ~(keystone_admin)]$ nova quota-show --tenant a4e3a58f85e344c9b238f99045ee9e4e
+-----------------------------+-------+
| Quota                       | Limit |
+-----------------------------+-------+
| instances                   | 30    |
| cores                       | 60    |
| ram                         | 51200 |
| floating_ips                | 3     |
| fixed_ips                   | -1    |
| metadata_items              | 128   |
| injected_files              | 5     |
| injected_file_content_bytes | 10240 |
| injected_file_path_bytes    | 255   |
| key_pairs                   | 100   |
| security_groups             | 10    |
| security_group_rules        | 20    |
+-----------------------------+-------+
Thu Feb  5 15:52:22 UTC 2015
[wrsroot@controller-0 ~(keystone_admin)]$ neutron quota-update --port 60 --tenant-id a4e3a58f85e344c9b238f99045ee9e4e
+---------------------+-------+
| Field               | Value |
+---------------------+-------+
| floatingip          | 50    |
| network             | 5     |
| port                | 60    |
| router              | 10    |
| security_group      | 10    |
| security_group_rule | 100   |
| subnet              | 5     |
+---------------------+-------+
Thu Feb  5 15:52:23 UTC 2015
[wrsroot@controller-0 ~(keystone_admin)]$ cinder quota-update --volumes 30 a4e3a58f85e344c9b238f99045ee9e4e
Thu Feb  5 15:52:23 UTC 2015
[wrsroot@controller-0 ~(keystone_admin)]$ cinder quota-show a4e3a58f85e344c9b238f99045ee9e4e
+-----------+-------+
|  Property | Value |
+-----------+-------+
| gigabytes |  1000 |
| snapshots |   3   |
|  volumes  |   30  |
+-----------+-------+
Thu Feb  5 15:52:24 UTC 2015
[wrsroot@controller-0 ~(keystone_admin)]$ [1;34m
 === switch to tenant mode
[0m
source /home/wrsroot/openrc.tenant1
Thu Feb  5 15:52:24 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ [1;34m
 === copy heat template to /home/wrsroot/ 
[0m
find . -iname VMAutoScaling.yaml
./VMAutoScaling.yaml
./wrs-heat-templates-1.1.0/hot/scenarios/VMAutoScaling.yaml
./heat/product/hot/scenarios/VMAutoScaling.yaml
./heat/hot/scenarios/VMAutoScaling.yaml
./heat/wrs-heat-templates-1.1.0/hot/scenarios/VMAutoScaling.yaml
Thu Feb  5 15:52:24 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ [0;32m
Assigned Var:result= ./wrs-heat-templates-1.1.0/hot/scenarios/VMAutoScaling.yaml
[0m
cp  ./wrs-heat-templates-1.1.0/hot/scenarios/VMAutoScaling.yaml .
Thu Feb  5 15:52:24 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ [1;34m
 === change the cool down period to 20 secs from 60 secs
[0m
sed -i "s/Cooldown: '60'/Cooldown: '20'/g" VMAutoScaling.yaml
Thu Feb  5 15:52:24 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ [0;32m
While: expr { "1" <= "10" } |result=TRUE
[0m
[0;32m
While: expr { "2" <= "10" } |result=TRUE
[0m
[0;32m
While: expr { "3" <= "10" } |result=TRUE
[0m
[0;32m
While: expr { "4" <= "10" } |result=TRUE
[0m
[0;32m
While: expr { "5" <= "10" } |result=TRUE
[0m
[0;32m
While: expr { "6" <= "10" } |result=TRUE
[0m
[0;32m
While: expr { "7" <= "10" } |result=TRUE
[0m
[0;32m
While: expr { "8" <= "10" } |result=TRUE
[0m
[0;32m
While: expr { "9" <= "10" } |result=TRUE
[0m
[0;32m
While: expr { "10" <= "10" } |result=TRUE
[0m
[0;32m
While: expr { "11" <= "10" } |result=FALSE
[0m
sed -i "s/period: '60'/period: '70'/g" VMAutoScaling.yaml
Thu Feb  5 15:52:24 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ [1;34m
 === become tenant again
[0m
[1;34m
 === create multiple heat stack
[0m
[0;32m
While: expr { "1" <= "1" } |result=TRUE
[0m
source /home/wrsroot/openrc.tenant1
Thu Feb  5 15:52:25 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ [0;32m
If: expr { "1" == "0" } |then   $flavor=$flavor2|result=FALSE
[0m
[0;32m
While: expr { "2" <= "1" } |result=FALSE
[0m
[1;34m
 === wait and check if heat stack create_complete
[0m
[0;32m
While: expr { "1" <= "1" } |result=TRUE
[0m
heat stack-create -f VMAutoScaling.yaml -P TenantUserId=49be897e674a4456af937371ecfa936d -P PrivateNetName=tenant1-mgmt-net -P Ins tanceName=guest1 -P FlavorName=vcpu4-1 -P ImageName=cgcs-guest -P CustomMeterName=vote -P KeyName=keypair-tenant1 STACK1
+--------------------------------------+------------+--------------------+----------------------+
| id                                   | stack_name | stack_status       | creation_time        |
+--------------------------------------+------------+--------------------+----------------------+
| f3eb1a03-bf33-4700-9660-9e3dd4387c22 | STACK1     | CREATE_IN_PROGRESS | 2015-02-05T15:52:26Z |
+--------------------------------------+------------+--------------------+----------------------+
Thu Feb  5 15:52:26 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ heat stack-show STACK1
+----------------------+-------------------------------------------------------------------------------------------------------------------------------+
| Property             | Value                                                                                                                         |
+----------------------+-------------------------------------------------------------------------------------------------------------------------------+
| capabilities         | []                                                                                                                            |
| creation_time        | 2015-02-05T15:52:26Z                                                                                                          |
| description          | Creates a HEAT autoscaling stack and a VM instance                                                                            |
|                      | which is able to scale up/down the number of guest                                                                            |
|                      | vpcu's based on vcpu_util on the guest instance. Note:                                                                        |
|                      | This uses the HOT template                                                                                                    |
| disable_rollback     | True                                                                                                                          |
| id                   | f3eb1a03-bf33-4700-9660-9e3dd4387c22                                                                                          |
| links                | http://128.224.150.189:8004/v1/a4e3a58f85e344c9b238f99045ee9e4e/stacks/STACK1/f3eb1a03-bf33-4700-9660-9e3dd4387c22            |
| notification_topics  | []                                                                                                                            |
| outputs              | []                                                                                                                            |
| parameters           | {                                                                                                                             |
|                      |   "PrivateNetName": "tenant1-mgmt-net",                                                                                       |
|                      |   "InstanceName": "guest1",                                                                                                   |
|                      |   "AWS::StackName": "STACK1",                                                                                                 |
|                      |   "CustomMeterName": "vote",                                                                                                  |
|                      |   "FlavorName": "vcpu4-1",                                                                                                    |
|                      |   "KeyName": "keypair-tenant1",                                                                                               |
|                      |   "AWS::StackId": "arn:openstack:heat::a4e3a58f85e344c9b238f99045ee9e4e:stacks/STACK1/f3eb1a03-bf33-4700-9660-9e3dd4387c22",  |
|                      |   "ImageName": "cgcs-guest",                                                                                                  |
|                      |   "MetricLowWaterMark": "5",                                                                                                  |
|                      |   "AWS::Region": "ap-southeast-1",                                                                                            |
|                      |   "TenantUserId": "49be897e674a4456af937371ecfa936d",                                                                         |
|                      |   "MetricHighWaterMark": "60"                                                                                                 |
|                      | }                                                                                                                             |
| stack_name           | STACK1                                                                                                                        |
| stack_status         | CREATE_COMPLETE                                                                                                               |
| stack_status_reason  | Stack create completed successfully                                                                                           |
| template_description | Creates a HEAT autoscaling stack and a VM instance                                                                            |
|                      | which is able to scale up/down the number of guest                                                                            |
|                      | vpcu's based on vcpu_util on the guest instance. Note:                                                                        |
|                      | This uses the HOT template                                                                                                    |
| timeout_mins         | 60                                                                                                                            |
| updated_time         | 2015-02-05T15:52:39Z                                                                                                          |
+----------------------+-------------------------------------------------------------------------------------------------------------------------------+
[0;32m<stack_status[0m
[0;32m<CREATE_COMPLETE[0m
[0;32m
While: expr { "2" <= "1" } |result=FALSE
[0m
Thu Feb  5 15:52:55 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ [1;34m
 === get ID of each instance
[0m
[0;32m
While: expr { "1" <= "1" } |result=TRUE
[0m
nova list
+--------------------------------------+--------+--------+------------+-------------+---------------------------------+
| ID                                   | Name   | Status | Task State | Power State | Networks                        |
+--------------------------------------+--------+--------+------------+-------------+---------------------------------+
| cbb98ffb-7546-44c5-af22-7583c3c1ad4f | guest1 | ACTIVE | -          | Running     | tenant1-mgmt-net=192.168.109.22 |
+--------------------------------------+--------+--------+------------+-------------+---------------------------------+
Thu Feb  5 15:52:56 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ nova list | grep guest1
| cbb98ffb-7546-44c5-af22-7583c3c1ad4f | guest1 | ACTIVE | -          | Running     | tenant1-mgmt-net=192.168.109.22 |
Thu Feb  5 15:52:58 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ [0;32m
Assigned Var:resource_id_vm1=cbb98ffb-7546-44c5-af22-7583c3c1ad4f
[0m
[0;32m
While: expr { "2" <= "1" } |result=FALSE
[0m
[1;34m
 === check the VMs in good state
[0m
[0;32m
While: expr { "1" <= "1" } |result=TRUE
[0m
nova list
+--------------------------------------+--------+--------+------------+-------------+---------------------------------+
| ID                                   | Name   | Status | Task State | Power State | Networks                        |
+--------------------------------------+--------+--------+------------+-------------+---------------------------------+
| cbb98ffb-7546-44c5-af22-7583c3c1ad4f | guest1 | ACTIVE | -          | Running     | tenant1-mgmt-net=192.168.109.22 |
+--------------------------------------+--------+--------+------------+-------------+---------------------------------+
[0;32m<guest1[0m
[0;32m<ACTIVE[0m
[0;32m
While: expr { "2" <= "1" } |result=FALSE
[0m
[1;34m
 === show vm-topology on VMs and save pre-migrate compute state
[0m
[0;32m
While: expr { "1" <= "1" } |result=TRUE
[0m
Thu Feb  5 15:52:59 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ [0;32m

Setting Expect Timeout to: 30 

[0m
time vm-topology -s all | grep cbb98ffb-7546-44c5-af22-7583c3c1ad4f
libnuma: Warning: Cannot parse sysfs meminfo (3)
| tenant1 | cbb98ffb-7546-44c5-af22-7583c3c1ad4f | instance-00000073 | guest1 | compute-1 | active   | None       | Running     | -            | vcpu4-1 | pinned |        None | 1,4,4 |    512 |        0 | 3-6     |    yes     |
| cbb98ffb-7546-44c5-af22-7583c3c1ad4f | instance-00000073 | compute-1 | 30 | Running |     4 |    512 | 3-6     |   yes   |
[0;32m<guest1[0m

real	0m1.929s
user	0m0.946s
sys	0m0.194s
Thu Feb  5 15:53:01 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ [0;32m
Assigned Var:premigrate_compute_vm1=compute-1
[0m
[0;32m
While: expr { "2" <= "1" } |result=FALSE
[0m
[1;34m
 === Become Admin to migrate
[0m
[1;34m
 === live migrate guest1
[0m
[0;32m
While: expr { "1" <= "1" } |result=TRUE
[0m
source /etc/nova/openrc
Thu Feb  5 15:53:01 UTC 2015
[wrsroot@controller-0 ~(keystone_admin)]$ [0;32m
While: expr { "2" <= "1" } |result=FALSE
[0m
nova live-migration cbb98ffb-7546-44c5-af22-7583c3c1ad4f
Thu Feb  5 15:53:04 UTC 2015
[wrsroot@controller-0 ~(keystone_admin)]$ [1;34m
 === switch to tenant mode
[0m
source /home/wrsroot/openrc.tenant1
Thu Feb  5 15:53:11 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ [1;34m
 === wait for guest1 to finish migrating
[0m
[0;32m
While: expr { "none" != "ACTIVE" } |result=TRUE
[0m
nova list
+--------------------------------------+--------+--------+------------+-------------+---------------------------------+
| ID                                   | Name   | Status | Task State | Power State | Networks                        |
+--------------------------------------+--------+--------+------------+-------------+---------------------------------+
| cbb98ffb-7546-44c5-af22-7583c3c1ad4f | guest1 | ACTIVE | -          | Running     | tenant1-mgmt-net=192.168.109.22 |
+--------------------------------------+--------+--------+------------+-------------+---------------------------------+
Thu Feb  5 15:53:12 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ nova list
+--------------------------------------+--------+--------+------------+-------------+---------------------------------+
| ID                                   | Name   | Status | Task State | Power State | Networks                        |
+--------------------------------------+--------+--------+------------+-------------+---------------------------------+
| cbb98ffb-7546-44c5-af22-7583c3c1ad4f | guest1 | ACTIVE | -          | Running     | tenant1-mgmt-net=192.168.109.22 |
+--------------------------------------+--------+--------+------------+-------------+---------------------------------+
[0;32m<guest1[0m
Thu Feb  5 15:53:13 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ [0;32m
Assigned Var:vm_state=ACTIVE
[0m
[0;32m
If: expr { "ACTIVE" == "ERROR" } |then   %BREAK_VM_MIGRATE1|result=FALSE
[0m
[0;32m
If: expr { "1" > "50" } |then   %BREAK_VM_MIGRATE1|result=FALSE
[0m
[0;32m
While: expr { "ACTIVE" != "ACTIVE" } |result=FALSE
[0m
[1;34m
 === check the VMs in good state
[0m
[0;32m
While: expr { "1" <= "1" } |result=TRUE
[0m
nova list
+--------------------------------------+--------+--------+------------+-------------+---------------------------------+
| ID                                   | Name   | Status | Task State | Power State | Networks                        |
+--------------------------------------+--------+--------+------------+-------------+---------------------------------+
| cbb98ffb-7546-44c5-af22-7583c3c1ad4f | guest1 | ACTIVE | -          | Running     | tenant1-mgmt-net=192.168.109.22 |
+--------------------------------------+--------+--------+------------+-------------+---------------------------------+
[0;32m<guest1[0m
[0;32m<ACTIVE[0m
[0;32m
While: expr { "2" <= "1" } |result=FALSE
[0m
[1;34m
 === show vm-topology on VMs and save after migration compute state
[0m
[0;32m
While: expr { "1" <= "1" } |result=TRUE
[0m
Thu Feb  5 15:53:16 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ [0;32m

Setting Expect Timeout to: 30 

[0m
time vm-topology -s all | grep cbb98ffb-7546-44c5-af22-7583c3c1ad4f
libnuma: Warning: Cannot parse sysfs meminfo (3)
| tenant1 | cbb98ffb-7546-44c5-af22-7583c3c1ad4f | instance-00000073 | guest1 | compute-0 | active   | None       | Running     | -            | vcpu4-1 | pinned |        None | 1,4,4 |    512 |        0 | 3-6     |    yes     |
| cbb98ffb-7546-44c5-af22-7583c3c1ad4f | instance-00000073 | compute-0 | 32 | Running |     4 |    512 | 3-6     |   yes   |
[0;32m<guest1[0m

real	0m1.919s
user	0m0.922s
sys	0m0.214s
Thu Feb  5 15:53:18 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ [0;32m
Assigned Var:after_migration_compute_vm1=compute-0
[0m
[0;32m
While: expr { "2" <= "1" } |result=FALSE
[0m
[1;34m
 === Verify VMs migrated
[0m
[0;32m
If: expr { "compute-1" == "compute-0" } |then   ;red === guest1 did not live migrate|result=FALSE
[0m
[1;34m
 === Do scale up/down sequentially
[0m
[0;32m
While: expr { "1" <= "1" } |result=TRUE
[0m
[1;34m
 === execute scale down for guest1
[0m
[1;34m
 === save the current state of guest1 cpu
[0m
[0;32m

Setting Expect Timeout to: 10 

[0m
vm-topology -s servers
libnuma: Warning: Cannot parse sysfs meminfo (3)
vm-topology: 2015-02-05T15:53:19.446705  options: show:['servers']

SERVERS (nova view):  Legend: cpulist = [cpu_id[i], ...], S = siblings, R = reserved
+---------+--------------------------------------+-------------------+--------+-----------+----------+------------+-------------+--------------+---------+--------+-------------+-------+--------+----------+---------+------------+
| tenant  | ID                                   | instance_name     | name   | host      | vm_state | task_state | power_state | server_group | flavor  | pinned | shared_vcpu | vcpus | memory | numanode | cpulist | in_libvirt |
+---------+--------------------------------------+-------------------+--------+-----------+----------+------------+-------------+--------------+---------+--------+-------------+-------+--------+----------+---------+------------+
| tenant1 | cbb98ffb-7546-44c5-af22-7583c3c1ad4f | instance-00000073 | guest1 | compute-0 | active   | None       | Running     | -            | vcpu4-1 | pinned |        None | 1,4,4 |    512 |        0 | 3-6     |    yes     |
+---------+--------------------------------------+-------------------+--------+-----------+----------+------------+-------------+--------------+---------+--------+-------------+-------+--------+----------+---------+------------+
[0;32m<guest1[0m
Thu Feb  5 15:53:20 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ [0;32m
Assigned Var:min_cpu=1
[0m
[0;32m
Assigned Var:cur_cpu=4
[0m
[0;32m
Assigned Var:max_cpu=4
[0m
[1;34m
=== scale down guest1 cpu to the minimum value:1
[0m
[0;32m
While: expr { "1" < "4" } |result=TRUE
[0m
[0;32m

Setting Expect Timeout to: 10 

[0m
nova scale guest1 cpu down
Thu Feb  5 15:53:23 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ echo $?
0
Thu Feb  5 15:53:23 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ [0;32m<
0[0m
[0;32m
While: expr { "1" < "3" } |result=TRUE
[0m
[0;32m

Setting Expect Timeout to: 10 

[0m
nova scale guest1 cpu down
Thu Feb  5 15:53:27 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ echo $?
0
Thu Feb  5 15:53:27 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ [0;32m<
0[0m
[0;32m
While: expr { "1" < "2" } |result=TRUE
[0m
[0;32m

Setting Expect Timeout to: 10 

[0m
nova scale guest1 cpu down
Thu Feb  5 15:53:31 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ echo $?
0
Thu Feb  5 15:53:31 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ [0;32m<
0[0m
[0;32m
While: expr { "1" < "1" } |result=FALSE
[0m
[1;34m
 === check if guest1 current cpu value reached minimum cpu value:1
[0m
nova show guest1
+--------------------------------------+----------------------------------------------------------------------------------------------------------------------------------+
| Property                             | Value                                                                                                                            |
+--------------------------------------+----------------------------------------------------------------------------------------------------------------------------------+
| OS-DCF:diskConfig                    | MANUAL                                                                                                                           |
| OS-EXT-AZ:availability_zone          | nova                                                                                                                             |
| OS-EXT-STS:power_state               | 1                                                                                                                                |
| OS-EXT-STS:task_state                | -                                                                                                                                |
| OS-EXT-STS:vm_state                  | active                                                                                                                           |
| OS-SRV-USG:launched_at               | 2015-02-05T15:52:35.904130                                                                                                       |
| OS-SRV-USG:terminated_at             | -                                                                                                                                |
| accessIPv4                           |                                                                                                                                  |
| accessIPv6                           |                                                                                                                                  |
| config_drive                         |                                                                                                                                  |
| created                              | 2015-02-05T15:52:27Z                                                                                                             |
| extended                             | {"cpuset": 8, "numanode": 0, "siblings_cpuset": null}                                                                            |
| flavor                               | vcpu4-1 (5f0d748b-1c8b-4a70-1985-4d57e25ac137)                                                                                   |
| hostId                               | 5108074ec1b70826f368003ec6b5aedb0cdb9edb1e36064b0afbe7ad                                                                         |
| id                                   | cbb98ffb-7546-44c5-af22-7583c3c1ad4f                                                                                             |
| image                                | cgcs-guest (7aeabc04-8b05-44fa-bfe6-07d6dfbfc6ea)                                                                                |
| key_name                             | keypair-tenant1                                                                                                                  |
| metadata                             | {}                                                                                                                               |
| name                                 | guest1                                                                                                                           |
| nics                                 | {"nic1": {"vif_model": "virtio", "port_id": "6a5ee5eb-61e4-4b75-b49a-d3a683888b8e", "network": "tenant1-mgmt-net", "mtu": 1500}} |
| os-extended-volumes:volumes_attached | []                                                                                                                               |
| pinned                               | True                                                                                                                             |
| progress                             | 0                                                                                                                                |
| server_group                         |                                                                                                                                  |
| status                               | ACTIVE                                                                                                                           |
| tenant1-mgmt-net network             | 192.168.109.22                                                                                                                   |
| tenant_id                            | a4e3a58f85e344c9b238f99045ee9e4e                                                                                                 |
| updated                              | 2015-02-05T15:53:30Z                                                                                                             |
| user_id                              | 49be897e674a4456af937371ecfa936d                                                                                                 |
| vcpus (min/cur/max)                  | [1, 1, 4]                                                                                                                        |
+--------------------------------------+----------------------------------------------------------------------------------------------------------------------------------+
[0;32m<min/cur/max[0m
Thu Feb  5 15:53:32 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ [0;32m
Assigned Var:min_cpu=1
[0m
[0;32m
Assigned Var:cur_cpu=1
[0m
[0;32m
Assigned Var:max_cpu=4
[0m
[0;32m
If: expr { "1" != "1" } |then   [|result=FALSE
[0m
[1;34m
 === guest1 scale down should fail beyond minimum limit: 1
[0m
vm-topology -s servers
libnuma: Warning: Cannot parse sysfs meminfo (3)
vm-topology: 2015-02-05T15:53:33.105454  options: show:['servers']

SERVERS (nova view):  Legend: cpulist = [cpu_id[i], ...], S = siblings, R = reserved
+---------+--------------------------------------+-------------------+--------+-----------+----------+------------+-------------+--------------+---------+--------+-------------+-------+--------+----------+---------+------------+
| tenant  | ID                                   | instance_name     | name   | host      | vm_state | task_state | power_state | server_group | flavor  | pinned | shared_vcpu | vcpus | memory | numanode | cpulist | in_libvirt |
+---------+--------------------------------------+-------------------+--------+-----------+----------+------------+-------------+--------------+---------+--------+-------------+-------+--------+----------+---------+------------+
| tenant1 | cbb98ffb-7546-44c5-af22-7583c3c1ad4f | instance-00000073 | guest1 | compute-0 | active   | None       | Running     | -            | vcpu4-1 | pinned |        None | 1,1,4 |    512 |        0 | 3       |    yes     |
+---------+--------------------------------------+-------------------+--------+-----------+----------+------------+-------------+--------------+---------+--------+-------------+-------+--------+----------+---------+------------+
Thu Feb  5 15:53:34 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ nova scale guest1 cpu down
ERROR (BadRequest): When scaling, cannot scale beyond limits! (HTTP 400) (Request-ID: req-81f4ed42-4d6a-452c-a7fe-f7e53c5e7edd)
Thu Feb  5 15:53:35 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ [0;32m

Setting Expect Timeout to: 25 

[0m
echo $?
1
Thu Feb  5 15:53:35 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ [0;32m<
1[0m
[1;34m
 === scale down of vm2 completed
[0m
[0;32m
While: expr { "2" <= "1" } |result=FALSE
[0m
[1;34m
 === scale down of all VMs completed
[0m
[0;32m
While: expr { "1" <= "1" } |result=TRUE
[0m
[1;34m
 === save the current state of guest1 cpu
[0m
vm-topology -s servers
libnuma: Warning: Cannot parse sysfs meminfo (3)
vm-topology: 2015-02-05T15:53:36.462505  options: show:['servers']

SERVERS (nova view):  Legend: cpulist = [cpu_id[i], ...], S = siblings, R = reserved
+---------+--------------------------------------+-------------------+--------+-----------+----------+------------+-------------+--------------+---------+--------+-------------+-------+--------+----------+---------+------------+
| tenant  | ID                                   | instance_name     | name   | host      | vm_state | task_state | power_state | server_group | flavor  | pinned | shared_vcpu | vcpus | memory | numanode | cpulist | in_libvirt |
+---------+--------------------------------------+-------------------+--------+-----------+----------+------------+-------------+--------------+---------+--------+-------------+-------+--------+----------+---------+------------+
| tenant1 | cbb98ffb-7546-44c5-af22-7583c3c1ad4f | instance-00000073 | guest1 | compute-0 | active   | None       | Running     | -            | vcpu4-1 | pinned |        None | 1,1,4 |    512 |        0 | 3       |    yes     |
+---------+--------------------------------------+-------------------+--------+-----------+----------+------------+-------------+--------------+---------+--------+-------------+-------+--------+----------+---------+------------+
[0;32m<guest1[0m
Thu Feb  5 15:53:37 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ [0;32m
Assigned Var:min_cpu=1
[0m
[0;32m
Assigned Var:cur_cpu=1
[0m
[0;32m
Assigned Var:max_cpu=4
[0m
[1;34m
=== scale up cpu to the maximum value:4
[0m
[0;32m
While: expr { "1" < "4" } |result=TRUE
[0m
[0;32m

Setting Expect Timeout to: 10 

[0m
nova scale guest1 cpu up
Thu Feb  5 15:53:41 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ echo $?
0
Thu Feb  5 15:53:41 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ [0;32m<
0[0m
[0;32m
While: expr { "2" < "4" } |result=TRUE
[0m
[0;32m

Setting Expect Timeout to: 10 

[0m
nova scale guest1 cpu up
Thu Feb  5 15:53:44 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ echo $?
0
Thu Feb  5 15:53:44 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ [0;32m<
0[0m
[0;32m
While: expr { "3" < "4" } |result=TRUE
[0m
[0;32m

Setting Expect Timeout to: 10 

[0m
nova scale guest1 cpu up
Thu Feb  5 15:53:47 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ echo $?
0
Thu Feb  5 15:53:47 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ [0;32m<
0[0m
[0;32m
While: expr { "4" < "4" } |result=FALSE
[0m
[1;34m
 === check if guest1 current cpu value reached max cpu value:4
[0m
nova show guest1
+--------------------------------------+----------------------------------------------------------------------------------------------------------------------------------+
| Property                             | Value                                                                                                                            |
+--------------------------------------+----------------------------------------------------------------------------------------------------------------------------------+
| OS-DCF:diskConfig                    | MANUAL                                                                                                                           |
| OS-EXT-AZ:availability_zone          | nova                                                                                                                             |
| OS-EXT-STS:power_state               | 1                                                                                                                                |
| OS-EXT-STS:task_state                | -                                                                                                                                |
| OS-EXT-STS:vm_state                  | active                                                                                                                           |
| OS-SRV-USG:launched_at               | 2015-02-05T15:52:35.904130                                                                                                       |
| OS-SRV-USG:terminated_at             | -                                                                                                                                |
| accessIPv4                           |                                                                                                                                  |
| accessIPv6                           |                                                                                                                                  |
| config_drive                         |                                                                                                                                  |
| created                              | 2015-02-05T15:52:27Z                                                                                                             |
| extended                             | {"cpuset": 120, "numanode": 0, "siblings_cpuset": null}                                                                          |
| flavor                               | vcpu4-1 (5f0d748b-1c8b-4a70-1985-4d57e25ac137)                                                                                   |
| hostId                               | 5108074ec1b70826f368003ec6b5aedb0cdb9edb1e36064b0afbe7ad                                                                         |
| id                                   | cbb98ffb-7546-44c5-af22-7583c3c1ad4f                                                                                             |
| image                                | cgcs-guest (7aeabc04-8b05-44fa-bfe6-07d6dfbfc6ea)                                                                                |
| key_name                             | keypair-tenant1                                                                                                                  |
| metadata                             | {}                                                                                                                               |
| name                                 | guest1                                                                                                                           |
| nics                                 | {"nic1": {"vif_model": "virtio", "port_id": "6a5ee5eb-61e4-4b75-b49a-d3a683888b8e", "network": "tenant1-mgmt-net", "mtu": 1500}} |
| os-extended-volumes:volumes_attached | []                                                                                                                               |
| pinned                               | True                                                                                                                             |
| progress                             | 0                                                                                                                                |
| server_group                         |                                                                                                                                  |
| status                               | ACTIVE                                                                                                                           |
| tenant1-mgmt-net network             | 192.168.109.22                                                                                                                   |
| tenant_id                            | a4e3a58f85e344c9b238f99045ee9e4e                                                                                                 |
| updated                              | 2015-02-05T15:53:46Z                                                                                                             |
| user_id                              | 49be897e674a4456af937371ecfa936d                                                                                                 |
| vcpus (min/cur/max)                  | [1, 4, 4]                                                                                                                        |
+--------------------------------------+----------------------------------------------------------------------------------------------------------------------------------+
[0;32m<min/cur/max[0m
Thu Feb  5 15:53:49 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ [0;32m
Assigned Var:min_cpu=1
[0m
[0;32m
Assigned Var:cur_cpu=4
[0m
[0;32m
Assigned Var:max_cpu=4
[0m
[0;32m
If: expr { "4" != "4" } |then   [|result=FALSE
[0m
[1;34m
 === guest1 scale up should fail beyond max limit: 4
[0m
vm-topology -s servers
libnuma: Warning: Cannot parse sysfs meminfo (3)
vm-topology: 2015-02-05T15:53:49.940510  options: show:['servers']

SERVERS (nova view):  Legend: cpulist = [cpu_id[i], ...], S = siblings, R = reserved
+---------+--------------------------------------+-------------------+--------+-----------+----------+------------+-------------+--------------+---------+--------+-------------+-------+--------+----------+---------+------------+
| tenant  | ID                                   | instance_name     | name   | host      | vm_state | task_state | power_state | server_group | flavor  | pinned | shared_vcpu | vcpus | memory | numanode | cpulist | in_libvirt |
+---------+--------------------------------------+-------------------+--------+-----------+----------+------------+-------------+--------------+---------+--------+-------------+-------+--------+----------+---------+------------+
| tenant1 | cbb98ffb-7546-44c5-af22-7583c3c1ad4f | instance-00000073 | guest1 | compute-0 | active   | None       | Running     | -            | vcpu4-1 | pinned |        None | 1,4,4 |    512 |        0 | 3-6     |    yes     |
+---------+--------------------------------------+-------------------+--------+-----------+----------+------------+-------------+--------------+---------+--------+-------------+-------+--------+----------+---------+------------+
Thu Feb  5 15:53:51 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ nova scale guest1 cpu up
ERROR (BadRequest): When scaling, cannot scale beyond limits! (HTTP 400) (Request-ID: req-99a79c2f-dc0d-4f0d-af70-a3baaf6cd86a)
Thu Feb  5 15:53:52 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ [0;32m

Setting Expect Timeout to: 25 

[0m
echo $?
1
Thu Feb  5 15:53:52 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ [0;32m<
1[0m
[1;34m
 === scale down of vm2 completed
[0m
[0;32m
While: expr { "2" <= "1" } |result=FALSE
[0m
[1;34m
 === Scale up of all Vms completed
[0m
[1;34m
 === check the VMs in good state
[0m
[0;32m
While: expr { "1" <= "1" } |result=TRUE
[0m
nova list
+--------------------------------------+--------+--------+------------+-------------+---------------------------------+
| ID                                   | Name   | Status | Task State | Power State | Networks                        |
+--------------------------------------+--------+--------+------------+-------------+---------------------------------+
| cbb98ffb-7546-44c5-af22-7583c3c1ad4f | guest1 | ACTIVE | -          | Running     | tenant1-mgmt-net=192.168.109.22 |
+--------------------------------------+--------+--------+------------+-------------+---------------------------------+
[0;32m<guest1[0m
[0;32m<ACTIVE[0m
[0;32m
While: expr { "2" <= "1" } |result=FALSE
[0m
[1;34m
 === show vm-topology on VMs and save pre-migrate compute state
[0m
[0;32m
While: expr { "1" <= "1" } |result=TRUE
[0m
Thu Feb  5 15:53:53 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ [0;32m

Setting Expect Timeout to: 30 

[0m
time vm-topology -s all | grep cbb98ffb-7546-44c5-af22-7583c3c1ad4f
libnuma: Warning: Cannot parse sysfs meminfo (3)
| tenant1 | cbb98ffb-7546-44c5-af22-7583c3c1ad4f | instance-00000073 | guest1 | compute-0 | active   | None       | Running     | -            | vcpu4-1 | pinned |        None | 1,4,4 |    512 |        0 | 3-6     |    yes     |
| cbb98ffb-7546-44c5-af22-7583c3c1ad4f | instance-00000073 | compute-0 | 32 | Running |     4 |    512 | 3-6     |   yes   |
[0;32m<guest1[0m

real	0m1.826s
user	0m0.868s
sys	0m0.173s
Thu Feb  5 15:53:55 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ [0;32m
Assigned Var:premigrate_compute_vm1=compute-0
[0m
[0;32m
While: expr { "2" <= "1" } |result=FALSE
[0m
[1;34m
 === Become Admin to migrate
[0m
[1;34m
 === live migrate Vms
[0m
[0;32m
While: expr { "1" <= "1" } |result=TRUE
[0m
source /etc/nova/openrc
Thu Feb  5 15:53:55 UTC 2015
[wrsroot@controller-0 ~(keystone_admin)]$ [0;32m
While: expr { "2" <= "1" } |result=FALSE
[0m
nova migrate cbb98ffb-7546-44c5-af22-7583c3c1ad4f
Thu Feb  5 15:53:57 UTC 2015
[wrsroot@controller-0 ~(keystone_admin)]$ nova migrate cbb98ffb-7546-44c5-af22-7583c3c1ad4f
ERROR (Conflict): Cannot 'migrate' while instance is in task_state resize_prep (HTTP 409) (Request-ID: req-a33a5ec6-b242-4c9d-926b-37ff4c2a2de3)
Thu Feb  5 15:53:59 UTC 2015
[wrsroot@controller-0 ~(keystone_admin)]$ [1;34m
 === switch to tenant mode
[0m
source /home/wrsroot/openrc.tenant1
Thu Feb  5 15:53:59 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ [1;34m
 === wait for guest1 to VERIFY_RESIZE
[0m
[0;32m
While: expr { "none" != "VERIFY_RESIZE" } |result=TRUE
[0m
nova list
+--------------------------------------+--------+--------+------------------+-------------+---------------------------------+
| ID                                   | Name   | Status | Task State       | Power State | Networks                        |
+--------------------------------------+--------+--------+------------------+-------------+---------------------------------+
| cbb98ffb-7546-44c5-af22-7583c3c1ad4f | guest1 | RESIZE | resize_migrating | Running     | tenant1-mgmt-net=192.168.109.22 |
+--------------------------------------+--------+--------+------------------+-------------+---------------------------------+
Thu Feb  5 15:54:00 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ nova list
+--------------------------------------+--------+--------+------------------+-------------+---------------------------------+
| ID                                   | Name   | Status | Task State       | Power State | Networks                        |
+--------------------------------------+--------+--------+------------------+-------------+---------------------------------+
| cbb98ffb-7546-44c5-af22-7583c3c1ad4f | guest1 | RESIZE | resize_migrating | Running     | tenant1-mgmt-net=192.168.109.22 |
+--------------------------------------+--------+--------+------------------+-------------+---------------------------------+
[0;32m<guest1[0m
Thu Feb  5 15:54:01 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ [0;32m
Assigned Var:vm_state=RESIZE
[0m
[0;32m
If: expr { "RESIZE" == "ACTIVE" } |then   %BREAK_VM_RESIZE1|result=FALSE
[0m
[0;32m
If: expr { "RESIZE" == "ERROR" } |then   %BREAK_VM_RESIZE1|result=FALSE
[0m
[0;32m
If: expr { "1" > "50" } |then   %BREAK_VM_RESIZE1|result=FALSE
[0m
[0;32m
While: expr { "RESIZE" != "VERIFY_RESIZE" } |result=TRUE
[0m
nova list
+--------------------------------------+--------+--------+------------------+-------------+---------------------------------+
| ID                                   | Name   | Status | Task State       | Power State | Networks                        |
+--------------------------------------+--------+--------+------------------+-------------+---------------------------------+
| cbb98ffb-7546-44c5-af22-7583c3c1ad4f | guest1 | RESIZE | resize_migrating | Running     | tenant1-mgmt-net=192.168.109.22 |
+--------------------------------------+--------+--------+------------------+-------------+---------------------------------+
[0;32m<guest1[0m
Thu Feb  5 15:54:04 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ [0;32m
Assigned Var:vm_state=RESIZE
[0m
[0;32m
If: expr { "RESIZE" == "ACTIVE" } |then   %BREAK_VM_RESIZE1|result=FALSE
[0m
[0;32m
If: expr { "RESIZE" == "ERROR" } |then   %BREAK_VM_RESIZE1|result=FALSE
[0m
[0;32m
If: expr { "2" > "50" } |then   %BREAK_VM_RESIZE1|result=FALSE
[0m
[0;32m
While: expr { "RESIZE" != "VERIFY_RESIZE" } |result=TRUE
[0m
nova list
+--------------------------------------+--------+--------+------------------+-------------+---------------------------------+
| ID                                   | Name   | Status | Task State       | Power State | Networks                        |
+--------------------------------------+--------+--------+------------------+-------------+---------------------------------+
| cbb98ffb-7546-44c5-af22-7583c3c1ad4f | guest1 | RESIZE | resize_migrating | Running     | tenant1-mgmt-net=192.168.109.22 |
+--------------------------------------+--------+--------+------------------+-------------+---------------------------------+
[0;32m<guest1[0m
Thu Feb  5 15:54:07 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ [0;32m
Assigned Var:vm_state=RESIZE
[0m
[0;32m
If: expr { "RESIZE" == "ACTIVE" } |then   %BREAK_VM_RESIZE1|result=FALSE
[0m
[0;32m
If: expr { "RESIZE" == "ERROR" } |then   %BREAK_VM_RESIZE1|result=FALSE
[0m
[0;32m
If: expr { "3" > "50" } |then   %BREAK_VM_RESIZE1|result=FALSE
[0m
[0;32m
While: expr { "RESIZE" != "VERIFY_RESIZE" } |result=TRUE
[0m
nova list
+--------------------------------------+--------+--------+------------------+-------------+---------------------------------+
| ID                                   | Name   | Status | Task State       | Power State | Networks                        |
+--------------------------------------+--------+--------+------------------+-------------+---------------------------------+
| cbb98ffb-7546-44c5-af22-7583c3c1ad4f | guest1 | RESIZE | resize_migrating | Running     | tenant1-mgmt-net=192.168.109.22 |
+--------------------------------------+--------+--------+------------------+-------------+---------------------------------+
[0;32m<guest1[0m
Thu Feb  5 15:54:10 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ [0;32m
Assigned Var:vm_state=RESIZE
[0m
[0;32m
If: expr { "RESIZE" == "ACTIVE" } |then   %BREAK_VM_RESIZE1|result=FALSE
[0m
[0;32m
If: expr { "RESIZE" == "ERROR" } |then   %BREAK_VM_RESIZE1|result=FALSE
[0m
[0;32m
If: expr { "4" > "50" } |then   %BREAK_VM_RESIZE1|result=FALSE
[0m
[0;32m
While: expr { "RESIZE" != "VERIFY_RESIZE" } |result=TRUE
[0m
nova list
+--------------------------------------+--------+--------+------------------+-------------+---------------------------------+
| ID                                   | Name   | Status | Task State       | Power State | Networks                        |
+--------------------------------------+--------+--------+------------------+-------------+---------------------------------+
| cbb98ffb-7546-44c5-af22-7583c3c1ad4f | guest1 | RESIZE | resize_migrating | Running     | tenant1-mgmt-net=192.168.109.22 |
+--------------------------------------+--------+--------+------------------+-------------+---------------------------------+
[0;32m<guest1[0m
Thu Feb  5 15:54:13 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ [0;32m
Assigned Var:vm_state=RESIZE
[0m
[0;32m
If: expr { "RESIZE" == "ACTIVE" } |then   %BREAK_VM_RESIZE1|result=FALSE
[0m
[0;32m
If: expr { "RESIZE" == "ERROR" } |then   %BREAK_VM_RESIZE1|result=FALSE
[0m
[0;32m
If: expr { "5" > "50" } |then   %BREAK_VM_RESIZE1|result=FALSE
[0m
[0;32m
While: expr { "RESIZE" != "VERIFY_RESIZE" } |result=TRUE
[0m
nova list
+--------------------------------------+--------+--------+------------------+-------------+---------------------------------+
| ID                                   | Name   | Status | Task State       | Power State | Networks                        |
+--------------------------------------+--------+--------+------------------+-------------+---------------------------------+
| cbb98ffb-7546-44c5-af22-7583c3c1ad4f | guest1 | RESIZE | resize_migrating | Running     | tenant1-mgmt-net=192.168.109.22 |
+--------------------------------------+--------+--------+------------------+-------------+---------------------------------+
[0;32m<guest1[0m
Thu Feb  5 15:54:16 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ [0;32m
Assigned Var:vm_state=RESIZE
[0m
[0;32m
If: expr { "RESIZE" == "ACTIVE" } |then   %BREAK_VM_RESIZE1|result=FALSE
[0m
[0;32m
If: expr { "RESIZE" == "ERROR" } |then   %BREAK_VM_RESIZE1|result=FALSE
[0m
[0;32m
If: expr { "6" > "50" } |then   %BREAK_VM_RESIZE1|result=FALSE
[0m
[0;32m
While: expr { "RESIZE" != "VERIFY_RESIZE" } |result=TRUE
[0m
nova list
+--------------------------------------+--------+--------+------------------+-------------+---------------------------------+
| ID                                   | Name   | Status | Task State       | Power State | Networks                        |
+--------------------------------------+--------+--------+------------------+-------------+---------------------------------+
| cbb98ffb-7546-44c5-af22-7583c3c1ad4f | guest1 | RESIZE | resize_migrating | Running     | tenant1-mgmt-net=192.168.109.22 |
+--------------------------------------+--------+--------+------------------+-------------+---------------------------------+
[0;32m<guest1[0m
Thu Feb  5 15:54:19 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ [0;32m
Assigned Var:vm_state=RESIZE
[0m
[0;32m
If: expr { "RESIZE" == "ACTIVE" } |then   %BREAK_VM_RESIZE1|result=FALSE
[0m
[0;32m
If: expr { "RESIZE" == "ERROR" } |then   %BREAK_VM_RESIZE1|result=FALSE
[0m
[0;32m
If: expr { "7" > "50" } |then   %BREAK_VM_RESIZE1|result=FALSE
[0m
[0;32m
While: expr { "RESIZE" != "VERIFY_RESIZE" } |result=TRUE
[0m
nova list
+--------------------------------------+--------+--------+------------------+-------------+---------------------------------+
| ID                                   | Name   | Status | Task State       | Power State | Networks                        |
+--------------------------------------+--------+--------+------------------+-------------+---------------------------------+
| cbb98ffb-7546-44c5-af22-7583c3c1ad4f | guest1 | RESIZE | resize_migrating | Running     | tenant1-mgmt-net=192.168.109.22 |
+--------------------------------------+--------+--------+------------------+-------------+---------------------------------+
[0;32m<guest1[0m
Thu Feb  5 15:54:23 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ [0;32m
Assigned Var:vm_state=RESIZE
[0m
[0;32m
If: expr { "RESIZE" == "ACTIVE" } |then   %BREAK_VM_RESIZE1|result=FALSE
[0m
[0;32m
If: expr { "RESIZE" == "ERROR" } |then   %BREAK_VM_RESIZE1|result=FALSE
[0m
[0;32m
If: expr { "8" > "50" } |then   %BREAK_VM_RESIZE1|result=FALSE
[0m
[0;32m
While: expr { "RESIZE" != "VERIFY_RESIZE" } |result=TRUE
[0m
nova list
+--------------------------------------+--------+--------+------------------+-------------+---------------------------------+
| ID                                   | Name   | Status | Task State       | Power State | Networks                        |
+--------------------------------------+--------+--------+------------------+-------------+---------------------------------+
| cbb98ffb-7546-44c5-af22-7583c3c1ad4f | guest1 | RESIZE | resize_migrating | Running     | tenant1-mgmt-net=192.168.109.22 |
+--------------------------------------+--------+--------+------------------+-------------+---------------------------------+
[0;32m<guest1[0m
Thu Feb  5 15:54:26 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ [0;32m
Assigned Var:vm_state=RESIZE
[0m
[0;32m
If: expr { "RESIZE" == "ACTIVE" } |then   %BREAK_VM_RESIZE1|result=FALSE
[0m
[0;32m
If: expr { "RESIZE" == "ERROR" } |then   %BREAK_VM_RESIZE1|result=FALSE
[0m
[0;32m
If: expr { "9" > "50" } |then   %BREAK_VM_RESIZE1|result=FALSE
[0m
[0;32m
While: expr { "RESIZE" != "VERIFY_RESIZE" } |result=TRUE
[0m
nova list
+--------------------------------------+--------+--------+------------------+-------------+---------------------------------+
| ID                                   | Name   | Status | Task State       | Power State | Networks                        |
+--------------------------------------+--------+--------+------------------+-------------+---------------------------------+
| cbb98ffb-7546-44c5-af22-7583c3c1ad4f | guest1 | RESIZE | resize_migrating | Running     | tenant1-mgmt-net=192.168.109.22 |
+--------------------------------------+--------+--------+------------------+-------------+---------------------------------+
[0;32m<guest1[0m
Thu Feb  5 15:54:29 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ [0;32m
Assigned Var:vm_state=RESIZE
[0m
[0;32m
If: expr { "RESIZE" == "ACTIVE" } |then   %BREAK_VM_RESIZE1|result=FALSE
[0m
[0;32m
If: expr { "RESIZE" == "ERROR" } |then   %BREAK_VM_RESIZE1|result=FALSE
[0m
[0;32m
If: expr { "10" > "50" } |then   %BREAK_VM_RESIZE1|result=FALSE
[0m
[0;32m
While: expr { "RESIZE" != "VERIFY_RESIZE" } |result=TRUE
[0m
nova list
+--------------------------------------+--------+--------+------------------+-------------+---------------------------------+
| ID                                   | Name   | Status | Task State       | Power State | Networks                        |
+--------------------------------------+--------+--------+------------------+-------------+---------------------------------+
| cbb98ffb-7546-44c5-af22-7583c3c1ad4f | guest1 | RESIZE | resize_migrating | Running     | tenant1-mgmt-net=192.168.109.22 |
+--------------------------------------+--------+--------+------------------+-------------+---------------------------------+
[0;32m<guest1[0m
Thu Feb  5 15:54:32 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ [0;32m
Assigned Var:vm_state=RESIZE
[0m
[0;32m
If: expr { "RESIZE" == "ACTIVE" } |then   %BREAK_VM_RESIZE1|result=FALSE
[0m
[0;32m
If: expr { "RESIZE" == "ERROR" } |then   %BREAK_VM_RESIZE1|result=FALSE
[0m
[0;32m
If: expr { "11" > "50" } |then   %BREAK_VM_RESIZE1|result=FALSE
[0m
[0;32m
While: expr { "RESIZE" != "VERIFY_RESIZE" } |result=TRUE
[0m
nova list
+--------------------------------------+--------+--------+------------------+-------------+---------------------------------+
| ID                                   | Name   | Status | Task State       | Power State | Networks                        |
+--------------------------------------+--------+--------+------------------+-------------+---------------------------------+
| cbb98ffb-7546-44c5-af22-7583c3c1ad4f | guest1 | RESIZE | resize_migrating | Running     | tenant1-mgmt-net=192.168.109.22 |
+--------------------------------------+--------+--------+------------------+-------------+---------------------------------+
[0;32m<guest1[0m
Thu Feb  5 15:54:36 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ [0;32m
Assigned Var:vm_state=RESIZE
[0m
[0;32m
If: expr { "RESIZE" == "ACTIVE" } |then   %BREAK_VM_RESIZE1|result=FALSE
[0m
[0;32m
If: expr { "RESIZE" == "ERROR" } |then   %BREAK_VM_RESIZE1|result=FALSE
[0m
[0;32m
If: expr { "12" > "50" } |then   %BREAK_VM_RESIZE1|result=FALSE
[0m
[0;32m
While: expr { "RESIZE" != "VERIFY_RESIZE" } |result=TRUE
[0m
nova list
+--------------------------------------+--------+--------+------------------+-------------+---------------------------------+
| ID                                   | Name   | Status | Task State       | Power State | Networks                        |
+--------------------------------------+--------+--------+------------------+-------------+---------------------------------+
| cbb98ffb-7546-44c5-af22-7583c3c1ad4f | guest1 | RESIZE | resize_migrating | Running     | tenant1-mgmt-net=192.168.109.22 |
+--------------------------------------+--------+--------+------------------+-------------+---------------------------------+
[0;32m<guest1[0m
Thu Feb  5 15:54:39 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ [0;32m
Assigned Var:vm_state=RESIZE
[0m
[0;32m
If: expr { "RESIZE" == "ACTIVE" } |then   %BREAK_VM_RESIZE1|result=FALSE
[0m
[0;32m
If: expr { "RESIZE" == "ERROR" } |then   %BREAK_VM_RESIZE1|result=FALSE
[0m
[0;32m
If: expr { "13" > "50" } |then   %BREAK_VM_RESIZE1|result=FALSE
[0m
[0;32m
While: expr { "RESIZE" != "VERIFY_RESIZE" } |result=TRUE
[0m
nova list
+--------------------------------------+--------+--------+------------------+-------------+---------------------------------+
| ID                                   | Name   | Status | Task State       | Power State | Networks                        |
+--------------------------------------+--------+--------+------------------+-------------+---------------------------------+
| cbb98ffb-7546-44c5-af22-7583c3c1ad4f | guest1 | RESIZE | resize_migrating | Running     | tenant1-mgmt-net=192.168.109.22 |
+--------------------------------------+--------+--------+------------------+-------------+---------------------------------+
[0;32m<guest1[0m
Thu Feb  5 15:54:42 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ [0;32m
Assigned Var:vm_state=RESIZE
[0m
[0;32m
If: expr { "RESIZE" == "ACTIVE" } |then   %BREAK_VM_RESIZE1|result=FALSE
[0m
[0;32m
If: expr { "RESIZE" == "ERROR" } |then   %BREAK_VM_RESIZE1|result=FALSE
[0m
[0;32m
If: expr { "14" > "50" } |then   %BREAK_VM_RESIZE1|result=FALSE
[0m
[0;32m
While: expr { "RESIZE" != "VERIFY_RESIZE" } |result=TRUE
[0m
nova list
+--------------------------------------+--------+--------+---------------+-------------+---------------------------------+
| ID                                   | Name   | Status | Task State    | Power State | Networks                        |
+--------------------------------------+--------+--------+---------------+-------------+---------------------------------+
| cbb98ffb-7546-44c5-af22-7583c3c1ad4f | guest1 | RESIZE | resize_finish | Running     | tenant1-mgmt-net=192.168.109.22 |
+--------------------------------------+--------+--------+---------------+-------------+---------------------------------+
[0;32m<guest1[0m
Thu Feb  5 15:54:45 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ [0;32m
Assigned Var:vm_state=RESIZE
[0m
[0;32m
If: expr { "RESIZE" == "ACTIVE" } |then   %BREAK_VM_RESIZE1|result=FALSE
[0m
[0;32m
If: expr { "RESIZE" == "ERROR" } |then   %BREAK_VM_RESIZE1|result=FALSE
[0m
[0;32m
If: expr { "15" > "50" } |then   %BREAK_VM_RESIZE1|result=FALSE
[0m
[0;32m
While: expr { "RESIZE" != "VERIFY_RESIZE" } |result=TRUE
[0m
nova list
+--------------------------------------+--------+--------+---------------+-------------+---------------------------------+
| ID                                   | Name   | Status | Task State    | Power State | Networks                        |
+--------------------------------------+--------+--------+---------------+-------------+---------------------------------+
| cbb98ffb-7546-44c5-af22-7583c3c1ad4f | guest1 | RESIZE | resize_finish | Running     | tenant1-mgmt-net=192.168.109.22 |
+--------------------------------------+--------+--------+---------------+-------------+---------------------------------+
[0;32m<guest1[0m
Thu Feb  5 15:54:48 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ [0;32m
Assigned Var:vm_state=RESIZE
[0m
[0;32m
If: expr { "RESIZE" == "ACTIVE" } |then   %BREAK_VM_RESIZE1|result=FALSE
[0m
[0;32m
If: expr { "RESIZE" == "ERROR" } |then   %BREAK_VM_RESIZE1|result=FALSE
[0m
[0;32m
If: expr { "16" > "50" } |then   %BREAK_VM_RESIZE1|result=FALSE
[0m
[0;32m
While: expr { "RESIZE" != "VERIFY_RESIZE" } |result=TRUE
[0m
nova list
+--------------------------------------+--------+---------------+------------+-------------+---------------------------------+
| ID                                   | Name   | Status        | Task State | Power State | Networks                        |
+--------------------------------------+--------+---------------+------------+-------------+---------------------------------+
| cbb98ffb-7546-44c5-af22-7583c3c1ad4f | guest1 | VERIFY_RESIZE | -          | Running     | tenant1-mgmt-net=192.168.109.22 |
+--------------------------------------+--------+---------------+------------+-------------+---------------------------------+
[0;32m<guest1[0m
Thu Feb  5 15:54:51 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ [0;32m
Assigned Var:vm_state=VERIFY_RESIZE
[0m
[0;32m
If: expr { "VERIFY_RESIZE" == "ACTIVE" } |then   %BREAK_VM_RESIZE1|result=FALSE
[0m
[0;32m
If: expr { "VERIFY_RESIZE" == "ERROR" } |then   %BREAK_VM_RESIZE1|result=FALSE
[0m
[0;32m
If: expr { "17" > "50" } |then   %BREAK_VM_RESIZE1|result=FALSE
[0m
[0;32m
While: expr { "VERIFY_RESIZE" != "VERIFY_RESIZE" } |result=FALSE
[0m
[1;34m
 === check the VMs in VERIFY_RESIZE state
[0m
[0;32m
While: expr { "1" <= "1" } |result=TRUE
[0m
[0;32m

Setting Expect Timeout to: 10 

[0m
nova list | grep guest1
| cbb98ffb-7546-44c5-af22-7583c3c1ad4f | guest1 | VERIFY_RESIZE | -          | Running     | tenant1-mgmt-net=192.168.109.22 |
[0;32m<VERIFY_RESIZE[0m
[0;32m
While: expr { "2" <= "1" } |result=FALSE
[0m
[1;34m
 === confirm resize 
[0m
[0;32m
While: expr { "1" <= "1" } |result=TRUE
[0m
Thu Feb  5 15:54:54 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ nova resize-confirm cbb98ffb-7546-44c5-af22-7583c3c1ad4f
Thu Feb  5 15:54:56 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ echo $?
0
Thu Feb  5 15:54:56 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ [0;32m<
0[0m
[0;32m
While: expr { "2" <= "1" } |result=FALSE
[0m
[1;34m
 === wait for guest1 to finish migrating
[0m
[0;32m
While: expr { "none" != "ACTIVE" } |result=TRUE
[0m
nova list
+--------------------------------------+--------+---------------+------------+-------------+---------------------------------+
| ID                                   | Name   | Status        | Task State | Power State | Networks                        |
+--------------------------------------+--------+---------------+------------+-------------+---------------------------------+
| cbb98ffb-7546-44c5-af22-7583c3c1ad4f | guest1 | VERIFY_RESIZE | -          | Running     | tenant1-mgmt-net=192.168.109.22 |
+--------------------------------------+--------+---------------+------------+-------------+---------------------------------+
[0;32m<guest1[0m
Thu Feb  5 15:54:57 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ [0;32m
Assigned Var:vm_state=__NO_STRING_CAPTURED__
[0m
[0;32m
If: expr { "__NO_STRING_CAPTURED__" == "ERROR" } |then   %BREAK_VM_COLD_MIGRATE1|result=FALSE
[0m
[0;32m
If: expr { "1" > "50" } |then   %BREAK_VM_COLD_MIGRATE1|result=FALSE
[0m
[0;32m
While: expr { "__NO_STRING_CAPTURED__" != "ACTIVE" } |result=TRUE
[0m
nova list
+--------------------------------------+--------+--------+------------+-------------+---------------------------------+
| ID                                   | Name   | Status | Task State | Power State | Networks                        |
+--------------------------------------+--------+--------+------------+-------------+---------------------------------+
| cbb98ffb-7546-44c5-af22-7583c3c1ad4f | guest1 | ACTIVE | -          | Running     | tenant1-mgmt-net=192.168.109.22 |
+--------------------------------------+--------+--------+------------+-------------+---------------------------------+
[0;32m<guest1[0m
Thu Feb  5 15:55:00 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ [0;32m
Assigned Var:vm_state=ACTIVE
[0m
[0;32m
If: expr { "ACTIVE" == "ERROR" } |then   %BREAK_VM_COLD_MIGRATE1|result=FALSE
[0m
[0;32m
If: expr { "2" > "50" } |then   %BREAK_VM_COLD_MIGRATE1|result=FALSE
[0m
[0;32m
While: expr { "ACTIVE" != "ACTIVE" } |result=FALSE
[0m
[1;34m
 === check the VMs in good state
[0m
[0;32m
While: expr { "1" <= "1" } |result=TRUE
[0m
nova list
+--------------------------------------+--------+--------+------------+-------------+---------------------------------+
| ID                                   | Name   | Status | Task State | Power State | Networks                        |
+--------------------------------------+--------+--------+------------+-------------+---------------------------------+
| cbb98ffb-7546-44c5-af22-7583c3c1ad4f | guest1 | ACTIVE | -          | Running     | tenant1-mgmt-net=192.168.109.22 |
+--------------------------------------+--------+--------+------------+-------------+---------------------------------+
[0;32m<guest1[0m
[0;32m<ACTIVE[0m
[0;32m
While: expr { "2" <= "1" } |result=FALSE
[0m
[1;34m
 === show vm-topology on VMs and save after migration compute state
[0m
[0;32m
While: expr { "1" <= "1" } |result=TRUE
[0m
Thu Feb  5 15:55:03 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ [0;32m

Setting Expect Timeout to: 30 

[0m
time vm-topology -s all | grep cbb98ffb-7546-44c5-af22-7583c3c1ad4f
libnuma: Warning: Cannot parse sysfs meminfo (3)
| tenant1 | cbb98ffb-7546-44c5-af22-7583c3c1ad4f | instance-00000073 | guest1 | compute-1 | active   | None       | Running     | -            | vcpu4-1 | pinned |        None | 1,4,4 |    512 |        0 | 3-6     |    yes     |
| cbb98ffb-7546-44c5-af22-7583c3c1ad4f | instance-00000073 | compute-1 | 31 | Running |     4 |    512 | 3-6     |   yes   |
[0;32m<guest1[0m

real	0m2.035s
user	0m1.108s
sys	0m0.205s
Thu Feb  5 15:55:05 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ [0;32m
Assigned Var:after_migration_compute_vm1=compute-1
[0m
[0;32m
While: expr { "2" <= "1" } |result=FALSE
[0m
[1;34m
 === Verify VMs migrated
[0m
[0;32m
If: expr { "compute-0" == "compute-1" } |then   ;red === guest1 did not migrate|result=FALSE
[0m
[1;34m
 === Do scale up/down sequentially
[0m
[0;32m
While: expr { "1" <= "1" } |result=TRUE
[0m
[1;34m
 === execute scale down for guest1
[0m
[1;34m
 === save the current state of guest1 cpu
[0m
[0;32m

Setting Expect Timeout to: 5 

[0m
vm-topology -s servers
libnuma: Warning: Cannot parse sysfs meminfo (3)
vm-topology: 2015-02-05T15:55:06.122936  options: show:['servers']

SERVERS (nova view):  Legend: cpulist = [cpu_id[i], ...], S = siblings, R = reserved
+---------+--------------------------------------+-------------------+--------+-----------+----------+------------+-------------+--------------+---------+--------+-------------+-------+--------+----------+---------+------------+
| tenant  | ID                                   | instance_name     | name   | host      | vm_state | task_state | power_state | server_group | flavor  | pinned | shared_vcpu | vcpus | memory | numanode | cpulist | in_libvirt |
+---------+--------------------------------------+-------------------+--------+-----------+----------+------------+-------------+--------------+---------+--------+-------------+-------+--------+----------+---------+------------+
| tenant1 | cbb98ffb-7546-44c5-af22-7583c3c1ad4f | instance-00000073 | guest1 | compute-1 | active   | None       | Running     | -            | vcpu4-1 | pinned |        None | 1,4,4 |    512 |        0 | 3-6     |    yes     |
+---------+--------------------------------------+-------------------+--------+-----------+----------+------------+-------------+--------------+---------+--------+-------------+-------+--------+----------+---------+------------+
[0;32m<guest1[0m
Thu Feb  5 15:55:07 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ [0;32m
Assigned Var:min_cpu=1
[0m
[0;32m
Assigned Var:cur_cpu=4
[0m
[0;32m
Assigned Var:max_cpu=4
[0m
[1;34m
=== scale down guest1 cpu to the minimum value:1
[0m
[0;32m
While: expr { "1" < "4" } |result=TRUE
[0m
[0;32m

Setting Expect Timeout to: 10 

[0m
nova scale guest1 cpu down
Thu Feb  5 15:55:10 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ echo $?
0
Thu Feb  5 15:55:10 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ [0;32m<
0[0m
[0;32m
While: expr { "1" < "3" } |result=TRUE
[0m
[0;32m

Setting Expect Timeout to: 10 

[0m
nova scale guest1 cpu down
Thu Feb  5 15:55:14 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ echo $?
0
Thu Feb  5 15:55:14 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ [0;32m<
0[0m
[0;32m
While: expr { "1" < "2" } |result=TRUE
[0m
[0;32m

Setting Expect Timeout to: 10 

[0m
nova scale guest1 cpu down
Thu Feb  5 15:55:17 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ echo $?
0
Thu Feb  5 15:55:17 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ [0;32m<
0[0m
[0;32m
While: expr { "1" < "1" } |result=FALSE
[0m
[1;34m
 === check if guest1 current cpu value reached minimum cpu value:1
[0m
nova show guest1
+--------------------------------------+----------------------------------------------------------------------------------------------------------------------------------+
| Property                             | Value                                                                                                                            |
+--------------------------------------+----------------------------------------------------------------------------------------------------------------------------------+
| OS-DCF:diskConfig                    | MANUAL                                                                                                                           |
| OS-EXT-AZ:availability_zone          | nova                                                                                                                             |
| OS-EXT-STS:power_state               | 1                                                                                                                                |
| OS-EXT-STS:task_state                | -                                                                                                                                |
| OS-EXT-STS:vm_state                  | active                                                                                                                           |
| OS-SRV-USG:launched_at               | 2015-02-05T15:54:49.000000                                                                                                       |
| OS-SRV-USG:terminated_at             | -                                                                                                                                |
| accessIPv4                           |                                                                                                                                  |
| accessIPv6                           |                                                                                                                                  |
| config_drive                         |                                                                                                                                  |
| created                              | 2015-02-05T15:52:27Z                                                                                                             |
| extended                             | {"cpuset": 8, "numanode": 0, "siblings_cpuset": null}                                                                            |
| flavor                               | vcpu4-1 (5f0d748b-1c8b-4a70-1985-4d57e25ac137)                                                                                   |
| hostId                               | 1ea8da9884e6179694739654aaa506b2817ea351d58559c80c37d716                                                                         |
| id                                   | cbb98ffb-7546-44c5-af22-7583c3c1ad4f                                                                                             |
| image                                | cgcs-guest (7aeabc04-8b05-44fa-bfe6-07d6dfbfc6ea)                                                                                |
| key_name                             | keypair-tenant1                                                                                                                  |
| metadata                             | {}                                                                                                                               |
| name                                 | guest1                                                                                                                           |
| nics                                 | {"nic1": {"vif_model": "virtio", "port_id": "6a5ee5eb-61e4-4b75-b49a-d3a683888b8e", "network": "tenant1-mgmt-net", "mtu": 1500}} |
| os-extended-volumes:volumes_attached | []                                                                                                                               |
| pinned                               | True                                                                                                                             |
| progress                             | 0                                                                                                                                |
| server_group                         |                                                                                                                                  |
| status                               | ACTIVE                                                                                                                           |
| tenant1-mgmt-net network             | 192.168.109.22                                                                                                                   |
| tenant_id                            | a4e3a58f85e344c9b238f99045ee9e4e                                                                                                 |
| updated                              | 2015-02-05T15:55:16Z                                                                                                             |
| user_id                              | 49be897e674a4456af937371ecfa936d                                                                                                 |
| vcpus (min/cur/max)                  | [1, 1, 4]                                                                                                                        |
+--------------------------------------+----------------------------------------------------------------------------------------------------------------------------------+
[0;32m<min/cur/max[0m
Thu Feb  5 15:55:19 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ [0;32m
Assigned Var:min_cpu=1
[0m
[0;32m
Assigned Var:cur_cpu=1
[0m
[0;32m
Assigned Var:max_cpu=4
[0m
[0;32m
If: expr { "1" != "1" } |then   [|result=FALSE
[0m
[1;34m
 === guest1 scale down should fail beyond minimum limit: 1
[0m
vm-topology -s servers
libnuma: Warning: Cannot parse sysfs meminfo (3)
vm-topology: 2015-02-05T15:55:19.687559  options: show:['servers']

SERVERS (nova view):  Legend: cpulist = [cpu_id[i], ...], S = siblings, R = reserved
+---------+--------------------------------------+-------------------+--------+-----------+----------+------------+-------------+--------------+---------+--------+-------------+-------+--------+----------+---------+------------+
| tenant  | ID                                   | instance_name     | name   | host      | vm_state | task_state | power_state | server_group | flavor  | pinned | shared_vcpu | vcpus | memory | numanode | cpulist | in_libvirt |
+---------+--------------------------------------+-------------------+--------+-----------+----------+------------+-------------+--------------+---------+--------+-------------+-------+--------+----------+---------+------------+
| tenant1 | cbb98ffb-7546-44c5-af22-7583c3c1ad4f | instance-00000073 | guest1 | compute-1 | active   | None       | Running     | -            | vcpu4-1 | pinned |        None | 1,1,4 |    512 |        0 | 3       |    yes     |
+---------+--------------------------------------+-------------------+--------+-----------+----------+------------+-------------+--------------+---------+--------+-------------+-------+--------+----------+---------+------------+
Thu Feb  5 15:55:20 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ nova scale guest1 cpu down
ERROR (BadRequest): When scaling, cannot scale beyond limits! (HTTP 400) (Request-ID: req-3df559aa-ebd2-4d7c-83be-2eb0bd3b6717)
Thu Feb  5 15:55:22 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ [0;32m

Setting Expect Timeout to: 25 

[0m
echo $?
1
Thu Feb  5 15:55:22 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ [0;32m<
1[0m
[1;34m
 === scale down of vm2 completed
[0m
[0;32m
While: expr { "2" <= "1" } |result=FALSE
[0m
[1;34m
 === scale down of all VMs completed
[0m
[0;32m
While: expr { "1" <= "1" } |result=TRUE
[0m
[1;34m
 === save the current state of guest1 cpu
[0m
vm-topology -s servers
libnuma: Warning: Cannot parse sysfs meminfo (3)
vm-topology: 2015-02-05T15:55:22.831872  options: show:['servers']

SERVERS (nova view):  Legend: cpulist = [cpu_id[i], ...], S = siblings, R = reserved
+---------+--------------------------------------+-------------------+--------+-----------+----------+------------+-------------+--------------+---------+--------+-------------+-------+--------+----------+---------+------------+
| tenant  | ID                                   | instance_name     | name   | host      | vm_state | task_state | power_state | server_group | flavor  | pinned | shared_vcpu | vcpus | memory | numanode | cpulist | in_libvirt |
+---------+--------------------------------------+-------------------+--------+-----------+----------+------------+-------------+--------------+---------+--------+-------------+-------+--------+----------+---------+------------+
| tenant1 | cbb98ffb-7546-44c5-af22-7583c3c1ad4f | instance-00000073 | guest1 | compute-1 | active   | None       | Running     | -            | vcpu4-1 | pinned |        None | 1,1,4 |    512 |        0 | 3       |    yes     |
+---------+--------------------------------------+-------------------+--------+-----------+----------+------------+-------------+--------------+---------+--------+-------------+-------+--------+----------+---------+------------+
[0;32m<guest1[0m
Thu Feb  5 15:55:24 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ [0;32m
Assigned Var:min_cpu=1
[0m
[0;32m
Assigned Var:cur_cpu=1
[0m
[0;32m
Assigned Var:max_cpu=4
[0m
[1;34m
=== scale up cpu to the maximum value:4
[0m
[0;32m
While: expr { "1" < "4" } |result=TRUE
[0m
[0;32m

Setting Expect Timeout to: 10 

[0m
nova scale guest1 cpu up
Thu Feb  5 15:55:27 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ echo $?
0
Thu Feb  5 15:55:27 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ [0;32m<
0[0m
[0;32m
While: expr { "2" < "4" } |result=TRUE
[0m
[0;32m

Setting Expect Timeout to: 10 

[0m
nova scale guest1 cpu up
Thu Feb  5 15:55:30 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ echo $?
0
Thu Feb  5 15:55:30 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ [0;32m<
0[0m
[0;32m
While: expr { "3" < "4" } |result=TRUE
[0m
[0;32m

Setting Expect Timeout to: 10 

[0m
nova scale guest1 cpu up
Thu Feb  5 15:55:34 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ echo $?
0
Thu Feb  5 15:55:34 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ [0;32m<
0[0m
[0;32m
While: expr { "4" < "4" } |result=FALSE
[0m
[1;34m
 === check if guest1 current cpu value reached max cpu value:4
[0m
nova show guest1
+--------------------------------------+----------------------------------------------------------------------------------------------------------------------------------+
| Property                             | Value                                                                                                                            |
+--------------------------------------+----------------------------------------------------------------------------------------------------------------------------------+
| OS-DCF:diskConfig                    | MANUAL                                                                                                                           |
| OS-EXT-AZ:availability_zone          | nova                                                                                                                             |
| OS-EXT-STS:power_state               | 1                                                                                                                                |
| OS-EXT-STS:task_state                | -                                                                                                                                |
| OS-EXT-STS:vm_state                  | active                                                                                                                           |
| OS-SRV-USG:launched_at               | 2015-02-05T15:54:49.000000                                                                                                       |
| OS-SRV-USG:terminated_at             | -                                                                                                                                |
| accessIPv4                           |                                                                                                                                  |
| accessIPv6                           |                                                                                                                                  |
| config_drive                         |                                                                                                                                  |
| created                              | 2015-02-05T15:52:27Z                                                                                                             |
| extended                             | {"cpuset": 120, "numanode": 0, "siblings_cpuset": null}                                                                          |
| flavor                               | vcpu4-1 (5f0d748b-1c8b-4a70-1985-4d57e25ac137)                                                                                   |
| hostId                               | 1ea8da9884e6179694739654aaa506b2817ea351d58559c80c37d716                                                                         |
| id                                   | cbb98ffb-7546-44c5-af22-7583c3c1ad4f                                                                                             |
| image                                | cgcs-guest (7aeabc04-8b05-44fa-bfe6-07d6dfbfc6ea)                                                                                |
| key_name                             | keypair-tenant1                                                                                                                  |
| metadata                             | {}                                                                                                                               |
| name                                 | guest1                                                                                                                           |
| nics                                 | {"nic1": {"vif_model": "virtio", "port_id": "6a5ee5eb-61e4-4b75-b49a-d3a683888b8e", "network": "tenant1-mgmt-net", "mtu": 1500}} |
| os-extended-volumes:volumes_attached | []                                                                                                                               |
| pinned                               | True                                                                                                                             |
| progress                             | 0                                                                                                                                |
| server_group                         |                                                                                                                                  |
| status                               | ACTIVE                                                                                                                           |
| tenant1-mgmt-net network             | 192.168.109.22                                                                                                                   |
| tenant_id                            | a4e3a58f85e344c9b238f99045ee9e4e                                                                                                 |
| updated                              | 2015-02-05T15:55:33Z                                                                                                             |
| user_id                              | 49be897e674a4456af937371ecfa936d                                                                                                 |
| vcpus (min/cur/max)                  | [1, 4, 4]                                                                                                                        |
+--------------------------------------+----------------------------------------------------------------------------------------------------------------------------------+
[0;32m<min/cur/max[0m
Thu Feb  5 15:55:35 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ [0;32m
Assigned Var:min_cpu=1
[0m
[0;32m
Assigned Var:cur_cpu=4
[0m
[0;32m
Assigned Var:max_cpu=4
[0m
[0;32m
If: expr { "4" != "4" } |then   [|result=FALSE
[0m
[1;34m
 === guest1 scale up should fail beyond max limit: 4
[0m
vm-topology -s servers
libnuma: Warning: Cannot parse sysfs meminfo (3)
vm-topology: 2015-02-05T15:55:36.347329  options: show:['servers']

SERVERS (nova view):  Legend: cpulist = [cpu_id[i], ...], S = siblings, R = reserved
+---------+--------------------------------------+-------------------+--------+-----------+----------+------------+-------------+--------------+---------+--------+-------------+-------+--------+----------+---------+------------+
| tenant  | ID                                   | instance_name     | name   | host      | vm_state | task_state | power_state | server_group | flavor  | pinned | shared_vcpu | vcpus | memory | numanode | cpulist | in_libvirt |
+---------+--------------------------------------+-------------------+--------+-----------+----------+------------+-------------+--------------+---------+--------+-------------+-------+--------+----------+---------+------------+
| tenant1 | cbb98ffb-7546-44c5-af22-7583c3c1ad4f | instance-00000073 | guest1 | compute-1 | active   | None       | Running     | -            | vcpu4-1 | pinned |        None | 1,4,4 |    512 |        0 | 3-6     |    yes     |
+---------+--------------------------------------+-------------------+--------+-----------+----------+------------+-------------+--------------+---------+--------+-------------+-------+--------+----------+---------+------------+
Thu Feb  5 15:55:37 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ nova scale guest1 cpu up
ERROR (BadRequest): When scaling, cannot scale beyond limits! (HTTP 400) (Request-ID: req-ce01407d-7c5d-45d7-b4e5-05758295e3cd)
Thu Feb  5 15:55:38 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ [0;32m

Setting Expect Timeout to: 25 

[0m
echo $?
1
Thu Feb  5 15:55:38 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ [0;32m<
1[0m
[1;34m
 === scale up of vm2 completed
[0m
[0;32m
While: expr { "2" <= "1" } |result=FALSE
[0m
[1;34m
 === Scale up of all Vms completed
[0m
[1;34m
 === pause guest1 
[0m
nova pause cbb98ffb-7546-44c5-af22-7583c3c1ad4f
Thu Feb  5 15:55:40 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ [1;34m
 === check guest1 PAUSED
[0m
[0;32m

Setting Expect Timeout to: 15 

[0m
nova list | grep guest1
[0;32m<guest1[0m
| cbb98ffb-7546-44c5-af22-7583c3c1ad4f | guest1 | PAUSED | -          | Paused      | tenant1-mgmt-net=192.168.109.22 |
[0;32m<PAUSED[0m
Thu Feb  5 15:55:41 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ [1;34m
 === unpause guest1 
[0m
nova unpause cbb98ffb-7546-44c5-af22-7583c3c1ad4f
Thu Feb  5 15:55:42 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ [1;34m
 === check guest1 UNPAUSED
[0m
[0;32m

Setting Expect Timeout to: 15 

[0m
nova list | grep guest1
[0;32m<guest1[0m
| cbb98ffb-7546-44c5-af22-7583c3c1ad4f | guest1 | ACTIVE | -          | Running     | tenant1-mgmt-net=192.168.109.22 |
[0;32m<ACTIVE[0m
Thu Feb  5 15:55:43 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ ceilometer sample-create -r cbb98ffb-7546-44c5-af22-7583c3c1ad4f -m vote --meter-type gauge --meter-unit '%' --sample-volume 2 --r esource-metadata '{"display_name":"guest1"}'
+-------------------+--------------------------------------------+
| Property          | Value                                      |
+-------------------+--------------------------------------------+
| message_id        | 714863f0-ad4f-11e4-99ab-2c44fd83b910       |
| name              | vote                                       |
| project_id        | a4e3a58f85e344c9b238f99045ee9e4e           |
| resource_id       | cbb98ffb-7546-44c5-af22-7583c3c1ad4f       |
| resource_metadata | {u'display_name': u'guest1'}               |
| source            | a4e3a58f85e344c9b238f99045ee9e4e:openstack |
| timestamp         | 2015-02-05T15:55:44.253647                 |
| type              | gauge                                      |
| unit              | %                                          |
| user_id           | 49be897e674a4456af937371ecfa936d           |
| volume            | 2.0                                        |
+-------------------+--------------------------------------------+
Thu Feb  5 15:55:44 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ ceilometer resource-show -r cbb98ffb-7546-44c5-af22-7583c3c1ad4f
+-------------+--------------------------------------------+
| Property    | Value                                      |
+-------------+--------------------------------------------+
| metadata    | {u'display_name': u'guest1'}               |
| project_id  | a4e3a58f85e344c9b238f99045ee9e4e           |
| resource_id | cbb98ffb-7546-44c5-af22-7583c3c1ad4f       |
| source      | a4e3a58f85e344c9b238f99045ee9e4e:openstack |
| user_id     | 49be897e674a4456af937371ecfa936d           |
+-------------+--------------------------------------------+
Thu Feb  5 15:55:45 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ [0;32m<[0m
ceilometer alarm-list
[0;32m<alarm[0m
+--------------------------------------+----------------------------------+-------+---------+------------+----------------------------+------------------+
| Alarm ID                             | Name                             | State | Enabled | Continuous | Alarm condition            | Time constraints |
+--------------------------------------+----------------------------------+-------+---------+------------+----------------------------+------------------+
| c994fbd6-30b2-4964-bc80-f7c7c0fbc536 | STACK1-CPUAlarmHigh-2fxmgkzypvkz | ok    | True    | True       | vote > 60.0 during 1 x 70s | None             |
| caf9b610-8305-4d1d-92b4-615550c0b785 | STACK1-CPUAlarmLow-erbz7os4ut7t  | alarm | True    | True       | vote < 5.0 during 1 x 70s  | None             |
+--------------------------------------+----------------------------------+-------+---------+------------+----------------------------+------------------+
Thu Feb  5 15:56:16 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ [1;34m
 === going in a loop to check guest1 reached minimum cpu vale 
[0m
nova show guest1
[0;32m<guest1[0m
+--------------------------------------+----------------------------------------------------------------------------------------------------------------------------------+
| Property                             | Value                                                                                                                            |
+--------------------------------------+----------------------------------------------------------------------------------------------------------------------------------+
| OS-DCF:diskConfig                    | MANUAL                                                                                                                           |
| OS-EXT-AZ:availability_zone          | nova                                                                                                                             |
| OS-EXT-STS:power_state               | 1                                                                                                                                |
| OS-EXT-STS:task_state                | -                                                                                                                                |
| OS-EXT-STS:vm_state                  | active                                                                                                                           |
| OS-SRV-USG:launched_at               | 2015-02-05T15:54:49.000000                                                                                                       |
| OS-SRV-USG:terminated_at             | -                                                                                                                                |
| accessIPv4                           |                                                                                                                                  |
| accessIPv6                           |                                                                                                                                  |
| config_drive                         |                                                                                                                                  |
| created                              | 2015-02-05T15:52:27Z                                                                                                             |
| extended                             | {"cpuset": 24, "numanode": 0, "siblings_cpuset": null}                                                                           |
| flavor                               | vcpu4-1 (5f0d748b-1c8b-4a70-1985-4d57e25ac137)                                                                                   |
| hostId                               | 1ea8da9884e6179694739654aaa506b2817ea351d58559c80c37d716                                                                         |
| id                                   | cbb98ffb-7546-44c5-af22-7583c3c1ad4f                                                                                             |
| image                                | cgcs-guest (7aeabc04-8b05-44fa-bfe6-07d6dfbfc6ea)                                                                                |
| key_name                             | keypair-tenant1                                                                                                                  |
| metadata                             | {}                                                                                                                               |
| name                                 | guest1                                                                                                                           |
| nics                                 | {"nic1": {"vif_model": "virtio", "port_id": "6a5ee5eb-61e4-4b75-b49a-d3a683888b8e", "network": "tenant1-mgmt-net", "mtu": 1500}} |
| os-extended-volumes:volumes_attached | []                                                                                                                               |
| pinned                               | True                                                                                                                             |
| progress                             | 0                                                                                                                                |
| server_group                         |                                                                                                                                  |
| status                               | ACTIVE                                                                                                                           |
| tenant1-mgmt-net network             | 192.168.109.22                                                                                                                   |
| tenant_id                            | a4e3a58f85e344c9b238f99045ee9e4e                                                                                                 |
| updated                              | 2015-02-05T15:56:17Z                                                                                                             |
| user_id                              | 49be897e674a4456af937371ecfa936d                                                                                                 |
| vcpus (min/cur/max)                  | [1, 2, 4]                                                                                                                        |
+--------------------------------------+----------------------------------------------------------------------------------------------------------------------------------+
Thu Feb  5 15:56:17 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ [0;32m
Assigned Var:min_cpu=1
[0m
[0;32m
Assigned Var:cur_cpu=2
[0m
[0;32m
Assigned Var:max_cpu=4
[0m
[0;32m
While: expr { "2" != "1" } |result=TRUE
[0m
nova show guest1
[0;32m<guest1[0m
+--------------------------------------+----------------------------------------------------------------------------------------------------------------------------------+
| Property                             | Value                                                                                                                            |
+--------------------------------------+----------------------------------------------------------------------------------------------------------------------------------+
| OS-DCF:diskConfig                    | MANUAL                                                                                                                           |
| OS-EXT-AZ:availability_zone          | nova                                                                                                                             |
| OS-EXT-STS:power_state               | 1                                                                                                                                |
| OS-EXT-STS:task_state                | -                                                                                                                                |
| OS-EXT-STS:vm_state                  | active                                                                                                                           |
| OS-SRV-USG:launched_at               | 2015-02-05T15:54:49.000000                                                                                                       |
| OS-SRV-USG:terminated_at             | -                                                                                                                                |
| accessIPv4                           |                                                                                                                                  |
| accessIPv6                           |                                                                                                                                  |
| config_drive                         |                                                                                                                                  |
| created                              | 2015-02-05T15:52:27Z                                                                                                             |
| extended                             | {"cpuset": 24, "numanode": 0, "siblings_cpuset": null}                                                                           |
| flavor                               | vcpu4-1 (5f0d748b-1c8b-4a70-1985-4d57e25ac137)                                                                                   |
| hostId                               | 1ea8da9884e6179694739654aaa506b2817ea351d58559c80c37d716                                                                         |
| id                                   | cbb98ffb-7546-44c5-af22-7583c3c1ad4f                                                                                             |
| image                                | cgcs-guest (7aeabc04-8b05-44fa-bfe6-07d6dfbfc6ea)                                                                                |
| key_name                             | keypair-tenant1                                                                                                                  |
| metadata                             | {}                                                                                                                               |
| name                                 | guest1                                                                                                                           |
| nics                                 | {"nic1": {"vif_model": "virtio", "port_id": "6a5ee5eb-61e4-4b75-b49a-d3a683888b8e", "network": "tenant1-mgmt-net", "mtu": 1500}} |
| os-extended-volumes:volumes_attached | []                                                                                                                               |
| pinned                               | True                                                                                                                             |
| progress                             | 0                                                                                                                                |
| server_group                         |                                                                                                                                  |
| status                               | ACTIVE                                                                                                                           |
| tenant1-mgmt-net network             | 192.168.109.22                                                                                                                   |
| tenant_id                            | a4e3a58f85e344c9b238f99045ee9e4e                                                                                                 |
| updated                              | 2015-02-05T15:56:17Z                                                                                                             |
| user_id                              | 49be897e674a4456af937371ecfa936d                                                                                                 |
| vcpus (min/cur/max)                  | [1, 2, 4]                                                                                                                        |
+--------------------------------------+----------------------------------------------------------------------------------------------------------------------------------+
Thu Feb  5 15:56:19 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ [0;32m
Assigned Var:cur_cpu=2
[0m
[1;34m
 === auto scaling down
[0m
[0;32m
If: expr { "2" == "1" } |then   %BREAK_REACHED_MIN_CPU3|result=FALSE
[0m
[0;32m
While: expr { "2" != "1" } |result=TRUE
[0m
nova show guest1
[0;32m<guest1[0m
+--------------------------------------+----------------------------------------------------------------------------------------------------------------------------------+
| Property                             | Value                                                                                                                            |
+--------------------------------------+----------------------------------------------------------------------------------------------------------------------------------+
| OS-DCF:diskConfig                    | MANUAL                                                                                                                           |
| OS-EXT-AZ:availability_zone          | nova                                                                                                                             |
| OS-EXT-STS:power_state               | 1                                                                                                                                |
| OS-EXT-STS:task_state                | -                                                                                                                                |
| OS-EXT-STS:vm_state                  | active                                                                                                                           |
| OS-SRV-USG:launched_at               | 2015-02-05T15:54:49.000000                                                                                                       |
| OS-SRV-USG:terminated_at             | -                                                                                                                                |
| accessIPv4                           |                                                                                                                                  |
| accessIPv6                           |                                                                                                                                  |
| config_drive                         |                                                                                                                                  |
| created                              | 2015-02-05T15:52:27Z                                                                                                             |
| extended                             | {"cpuset": 8, "numanode": 0, "siblings_cpuset": null}                                                                            |
| flavor                               | vcpu4-1 (5f0d748b-1c8b-4a70-1985-4d57e25ac137)                                                                                   |
| hostId                               | 1ea8da9884e6179694739654aaa506b2817ea351d58559c80c37d716                                                                         |
| id                                   | cbb98ffb-7546-44c5-af22-7583c3c1ad4f                                                                                             |
| image                                | cgcs-guest (7aeabc04-8b05-44fa-bfe6-07d6dfbfc6ea)                                                                                |
| key_name                             | keypair-tenant1                                                                                                                  |
| metadata                             | {}                                                                                                                               |
| name                                 | guest1                                                                                                                           |
| nics                                 | {"nic1": {"vif_model": "virtio", "port_id": "6a5ee5eb-61e4-4b75-b49a-d3a683888b8e", "network": "tenant1-mgmt-net", "mtu": 1500}} |
| os-extended-volumes:volumes_attached | []                                                                                                                               |
| pinned                               | True                                                                                                                             |
| progress                             | 0                                                                                                                                |
| server_group                         |                                                                                                                                  |
| status                               | ACTIVE                                                                                                                           |
| tenant1-mgmt-net network             | 192.168.109.22                                                                                                                   |
| tenant_id                            | a4e3a58f85e344c9b238f99045ee9e4e                                                                                                 |
| updated                              | 2015-02-05T15:56:47Z                                                                                                             |
| user_id                              | 49be897e674a4456af937371ecfa936d                                                                                                 |
| vcpus (min/cur/max)                  | [1, 1, 4]                                                                                                                        |
+--------------------------------------+----------------------------------------------------------------------------------------------------------------------------------+
Thu Feb  5 15:56:50 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ [0;32m
Assigned Var:cur_cpu=1
[0m
[1;34m
 === auto scaling down
[0m
[0;32m
If: expr { "1" == "1" } |then   %BREAK_REACHED_MIN_CPU3|result=TRUE
[0m

Jumping to label[0;32m:%BREAK_REACHED_MIN_CPU3
[0m
[1;34m
 === check if guest1 current cpu value reached minimum cpu value:1
[0m
nova show guest1
+--------------------------------------+----------------------------------------------------------------------------------------------------------------------------------+
| Property                             | Value                                                                                                                            |
+--------------------------------------+----------------------------------------------------------------------------------------------------------------------------------+
| OS-DCF:diskConfig                    | MANUAL                                                                                                                           |
| OS-EXT-AZ:availability_zone          | nova                                                                                                                             |
| OS-EXT-STS:power_state               | 1                                                                                                                                |
| OS-EXT-STS:task_state                | -                                                                                                                                |
| OS-EXT-STS:vm_state                  | active                                                                                                                           |
| OS-SRV-USG:launched_at               | 2015-02-05T15:54:49.000000                                                                                                       |
| OS-SRV-USG:terminated_at             | -                                                                                                                                |
| accessIPv4                           |                                                                                                                                  |
| accessIPv6                           |                                                                                                                                  |
| config_drive                         |                                                                                                                                  |
| created                              | 2015-02-05T15:52:27Z                                                                                                             |
| extended                             | {"cpuset": 8, "numanode": 0, "siblings_cpuset": null}                                                                            |
| flavor                               | vcpu4-1 (5f0d748b-1c8b-4a70-1985-4d57e25ac137)                                                                                   |
| hostId                               | 1ea8da9884e6179694739654aaa506b2817ea351d58559c80c37d716                                                                         |
| id                                   | cbb98ffb-7546-44c5-af22-7583c3c1ad4f                                                                                             |
| image                                | cgcs-guest (7aeabc04-8b05-44fa-bfe6-07d6dfbfc6ea)                                                                                |
| key_name                             | keypair-tenant1                                                                                                                  |
| metadata                             | {}                                                                                                                               |
| name                                 | guest1                                                                                                                           |
| nics                                 | {"nic1": {"vif_model": "virtio", "port_id": "6a5ee5eb-61e4-4b75-b49a-d3a683888b8e", "network": "tenant1-mgmt-net", "mtu": 1500}} |
| os-extended-volumes:volumes_attached | []                                                                                                                               |
| pinned                               | True                                                                                                                             |
| progress                             | 0                                                                                                                                |
| server_group                         |                                                                                                                                  |
| status                               | ACTIVE                                                                                                                           |
| tenant1-mgmt-net network             | 192.168.109.22                                                                                                                   |
| tenant_id                            | a4e3a58f85e344c9b238f99045ee9e4e                                                                                                 |
| updated                              | 2015-02-05T15:56:47Z                                                                                                             |
| user_id                              | 49be897e674a4456af937371ecfa936d                                                                                                 |
| vcpus (min/cur/max)                  | [1, 1, 4]                                                                                                                        |
+--------------------------------------+----------------------------------------------------------------------------------------------------------------------------------+
[0;32m<min/cur/max[0m
Thu Feb  5 15:57:21 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ [0;32m
Assigned Var:min_cpu=1
[0m
[0;32m
Assigned Var:cur_cpu=1
[0m
[0;32m
Assigned Var:max_cpu=4
[0m
[0;32m
If: expr { "1" != "1" } |then   [|result=FALSE
[0m
ceilometer sample-create -r cbb98ffb-7546-44c5-af22-7583c3c1ad4f -m vote --meter-type gauge --meter-unit '%' --sample-volume 90 -- resource-metadata '{"display_name":"guest1"}'
+-------------------+--------------------------------------------+
| Property          | Value                                      |
+-------------------+--------------------------------------------+
| message_id        | abec666e-ad4f-11e4-99ab-2c44fd83b910       |
| name              | vote                                       |
| project_id        | a4e3a58f85e344c9b238f99045ee9e4e           |
| resource_id       | cbb98ffb-7546-44c5-af22-7583c3c1ad4f       |
| resource_metadata | {u'display_name': u'guest1'}               |
| source            | a4e3a58f85e344c9b238f99045ee9e4e:openstack |
| timestamp         | 2015-02-05T15:57:22.636194                 |
| type              | gauge                                      |
| unit              | %                                          |
| user_id           | 49be897e674a4456af937371ecfa936d           |
| volume            | 90.0                                       |
+-------------------+--------------------------------------------+
Thu Feb  5 15:57:22 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ ceilometer resource-show -r cbb98ffb-7546-44c5-af22-7583c3c1ad4f
+-------------+--------------------------------------------+
| Property    | Value                                      |
+-------------+--------------------------------------------+
| metadata    | {u'display_name': u'guest1'}               |
| project_id  | a4e3a58f85e344c9b238f99045ee9e4e           |
| resource_id | cbb98ffb-7546-44c5-af22-7583c3c1ad4f       |
| source      | a4e3a58f85e344c9b238f99045ee9e4e:openstack |
| user_id     | 49be897e674a4456af937371ecfa936d           |
+-------------+--------------------------------------------+
Thu Feb  5 15:57:23 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ [0;32m<[0m
ceilometer alarm-list
[0;32m<alarm[0m
+--------------------------------------+----------------------------------+-------+---------+------------+----------------------------+------------------+
| Alarm ID                             | Name                             | State | Enabled | Continuous | Alarm condition            | Time constraints |
+--------------------------------------+----------------------------------+-------+---------+------------+----------------------------+------------------+
| c994fbd6-30b2-4964-bc80-f7c7c0fbc536 | STACK1-CPUAlarmHigh-2fxmgkzypvkz | alarm | True    | True       | vote > 60.0 during 1 x 70s | None             |
| caf9b610-8305-4d1d-92b4-615550c0b785 | STACK1-CPUAlarmLow-erbz7os4ut7t  | ok    | True    | True       | vote < 5.0 during 1 x 70s  | None             |
+--------------------------------------+----------------------------------+-------+---------+------------+----------------------------+------------------+
Thu Feb  5 15:57:54 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ [1;34m
 === going in a loop to check guest1 reached maximum cpu vale 
[0m
nova show guest1
[0;32m<guest1[0m
+--------------------------------------+----------------------------------------------------------------------------------------------------------------------------------+
| Property                             | Value                                                                                                                            |
+--------------------------------------+----------------------------------------------------------------------------------------------------------------------------------+
| OS-DCF:diskConfig                    | MANUAL                                                                                                                           |
| OS-EXT-AZ:availability_zone          | nova                                                                                                                             |
| OS-EXT-STS:power_state               | 1                                                                                                                                |
| OS-EXT-STS:task_state                | -                                                                                                                                |
| OS-EXT-STS:vm_state                  | active                                                                                                                           |
| OS-SRV-USG:launched_at               | 2015-02-05T15:54:49.000000                                                                                                       |
| OS-SRV-USG:terminated_at             | -                                                                                                                                |
| accessIPv4                           |                                                                                                                                  |
| accessIPv6                           |                                                                                                                                  |
| config_drive                         |                                                                                                                                  |
| created                              | 2015-02-05T15:52:27Z                                                                                                             |
| extended                             | {"cpuset": 24, "numanode": 0, "siblings_cpuset": null}                                                                           |
| flavor                               | vcpu4-1 (5f0d748b-1c8b-4a70-1985-4d57e25ac137)                                                                                   |
| hostId                               | 1ea8da9884e6179694739654aaa506b2817ea351d58559c80c37d716                                                                         |
| id                                   | cbb98ffb-7546-44c5-af22-7583c3c1ad4f                                                                                             |
| image                                | cgcs-guest (7aeabc04-8b05-44fa-bfe6-07d6dfbfc6ea)                                                                                |
| key_name                             | keypair-tenant1                                                                                                                  |
| metadata                             | {}                                                                                                                               |
| name                                 | guest1                                                                                                                           |
| nics                                 | {"nic1": {"vif_model": "virtio", "port_id": "6a5ee5eb-61e4-4b75-b49a-d3a683888b8e", "network": "tenant1-mgmt-net", "mtu": 1500}} |
| os-extended-volumes:volumes_attached | []                                                                                                                               |
| pinned                               | True                                                                                                                             |
| progress                             | 0                                                                                                                                |
| server_group                         |                                                                                                                                  |
| status                               | ACTIVE                                                                                                                           |
| tenant1-mgmt-net network             | 192.168.109.22                                                                                                                   |
| tenant_id                            | a4e3a58f85e344c9b238f99045ee9e4e                                                                                                 |
| updated                              | 2015-02-05T15:57:47Z                                                                                                             |
| user_id                              | 49be897e674a4456af937371ecfa936d                                                                                                 |
| vcpus (min/cur/max)                  | [1, 2, 4]                                                                                                                        |
+--------------------------------------+----------------------------------------------------------------------------------------------------------------------------------+
Thu Feb  5 15:57:55 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ [0;32m
Assigned Var:min_cpu=1
[0m
[0;32m
Assigned Var:cur_cpu=2
[0m
[0;32m
Assigned Var:max_cpu=4
[0m
[0;32m
While: expr { "2" != "4" } |result=TRUE
[0m
nova show guest1
[0;32m<guest1[0m
+--------------------------------------+----------------------------------------------------------------------------------------------------------------------------------+
| Property                             | Value                                                                                                                            |
+--------------------------------------+----------------------------------------------------------------------------------------------------------------------------------+
| OS-DCF:diskConfig                    | MANUAL                                                                                                                           |
| OS-EXT-AZ:availability_zone          | nova                                                                                                                             |
| OS-EXT-STS:power_state               | 1                                                                                                                                |
| OS-EXT-STS:task_state                | -                                                                                                                                |
| OS-EXT-STS:vm_state                  | active                                                                                                                           |
| OS-SRV-USG:launched_at               | 2015-02-05T15:54:49.000000                                                                                                       |
| OS-SRV-USG:terminated_at             | -                                                                                                                                |
| accessIPv4                           |                                                                                                                                  |
| accessIPv6                           |                                                                                                                                  |
| config_drive                         |                                                                                                                                  |
| created                              | 2015-02-05T15:52:27Z                                                                                                             |
| extended                             | {"cpuset": 24, "numanode": 0, "siblings_cpuset": null}                                                                           |
| flavor                               | vcpu4-1 (5f0d748b-1c8b-4a70-1985-4d57e25ac137)                                                                                   |
| hostId                               | 1ea8da9884e6179694739654aaa506b2817ea351d58559c80c37d716                                                                         |
| id                                   | cbb98ffb-7546-44c5-af22-7583c3c1ad4f                                                                                             |
| image                                | cgcs-guest (7aeabc04-8b05-44fa-bfe6-07d6dfbfc6ea)                                                                                |
| key_name                             | keypair-tenant1                                                                                                                  |
| metadata                             | {}                                                                                                                               |
| name                                 | guest1                                                                                                                           |
| nics                                 | {"nic1": {"vif_model": "virtio", "port_id": "6a5ee5eb-61e4-4b75-b49a-d3a683888b8e", "network": "tenant1-mgmt-net", "mtu": 1500}} |
| os-extended-volumes:volumes_attached | []                                                                                                                               |
| pinned                               | True                                                                                                                             |
| progress                             | 0                                                                                                                                |
| server_group                         |                                                                                                                                  |
| status                               | ACTIVE                                                                                                                           |
| tenant1-mgmt-net network             | 192.168.109.22                                                                                                                   |
| tenant_id                            | a4e3a58f85e344c9b238f99045ee9e4e                                                                                                 |
| updated                              | 2015-02-05T15:57:47Z                                                                                                             |
| user_id                              | 49be897e674a4456af937371ecfa936d                                                                                                 |
| vcpus (min/cur/max)                  | [1, 2, 4]                                                                                                                        |
+--------------------------------------+----------------------------------------------------------------------------------------------------------------------------------+
Thu Feb  5 15:57:57 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ [0;32m
Assigned Var:cur_cpu=2
[0m
[1;34m
 === auto scaling up
[0m
[0;32m
If: expr { "2" == "4" } |then   %BREAK_REACHED_MAX_CPU3|result=FALSE
[0m
[0;32m
While: expr { "2" != "4" } |result=TRUE
[0m
nova show guest1
[0;32m<guest1[0m
+--------------------------------------+----------------------------------------------------------------------------------------------------------------------------------+
| Property                             | Value                                                                                                                            |
+--------------------------------------+----------------------------------------------------------------------------------------------------------------------------------+
| OS-DCF:diskConfig                    | MANUAL                                                                                                                           |
| OS-EXT-AZ:availability_zone          | nova                                                                                                                             |
| OS-EXT-STS:power_state               | 1                                                                                                                                |
| OS-EXT-STS:task_state                | -                                                                                                                                |
| OS-EXT-STS:vm_state                  | active                                                                                                                           |
| OS-SRV-USG:launched_at               | 2015-02-05T15:54:49.000000                                                                                                       |
| OS-SRV-USG:terminated_at             | -                                                                                                                                |
| accessIPv4                           |                                                                                                                                  |
| accessIPv6                           |                                                                                                                                  |
| config_drive                         |                                                                                                                                  |
| created                              | 2015-02-05T15:52:27Z                                                                                                             |
| extended                             | {"cpuset": 56, "numanode": 0, "siblings_cpuset": null}                                                                           |
| flavor                               | vcpu4-1 (5f0d748b-1c8b-4a70-1985-4d57e25ac137)                                                                                   |
| hostId                               | 1ea8da9884e6179694739654aaa506b2817ea351d58559c80c37d716                                                                         |
| id                                   | cbb98ffb-7546-44c5-af22-7583c3c1ad4f                                                                                             |
| image                                | cgcs-guest (7aeabc04-8b05-44fa-bfe6-07d6dfbfc6ea)                                                                                |
| key_name                             | keypair-tenant1                                                                                                                  |
| metadata                             | {}                                                                                                                               |
| name                                 | guest1                                                                                                                           |
| nics                                 | {"nic1": {"vif_model": "virtio", "port_id": "6a5ee5eb-61e4-4b75-b49a-d3a683888b8e", "network": "tenant1-mgmt-net", "mtu": 1500}} |
| os-extended-volumes:volumes_attached | []                                                                                                                               |
| pinned                               | True                                                                                                                             |
| progress                             | 0                                                                                                                                |
| server_group                         |                                                                                                                                  |
| status                               | ACTIVE                                                                                                                           |
| tenant1-mgmt-net network             | 192.168.109.22                                                                                                                   |
| tenant_id                            | a4e3a58f85e344c9b238f99045ee9e4e                                                                                                 |
| updated                              | 2015-02-05T15:58:17Z                                                                                                             |
| user_id                              | 49be897e674a4456af937371ecfa936d                                                                                                 |
| vcpus (min/cur/max)                  | [1, 3, 4]                                                                                                                        |
+--------------------------------------+----------------------------------------------------------------------------------------------------------------------------------+
Thu Feb  5 15:58:28 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ [0;32m
Assigned Var:cur_cpu=3
[0m
[1;34m
 === auto scaling up
[0m
[0;32m
If: expr { "3" == "4" } |then   %BREAK_REACHED_MAX_CPU3|result=FALSE
[0m
[0;32m
While: expr { "3" != "4" } |result=TRUE
[0m
nova show guest1
[0;32m<guest1[0m
+--------------------------------------+----------------------------------------------------------------------------------------------------------------------------------+
| Property                             | Value                                                                                                                            |
+--------------------------------------+----------------------------------------------------------------------------------------------------------------------------------+
| OS-DCF:diskConfig                    | MANUAL                                                                                                                           |
| OS-EXT-AZ:availability_zone          | nova                                                                                                                             |
| OS-EXT-STS:power_state               | 1                                                                                                                                |
| OS-EXT-STS:task_state                | -                                                                                                                                |
| OS-EXT-STS:vm_state                  | active                                                                                                                           |
| OS-SRV-USG:launched_at               | 2015-02-05T15:54:49.000000                                                                                                       |
| OS-SRV-USG:terminated_at             | -                                                                                                                                |
| accessIPv4                           |                                                                                                                                  |
| accessIPv6                           |                                                                                                                                  |
| config_drive                         |                                                                                                                                  |
| created                              | 2015-02-05T15:52:27Z                                                                                                             |
| extended                             | {"cpuset": 120, "numanode": 0, "siblings_cpuset": null}                                                                          |
| flavor                               | vcpu4-1 (5f0d748b-1c8b-4a70-1985-4d57e25ac137)                                                                                   |
| hostId                               | 1ea8da9884e6179694739654aaa506b2817ea351d58559c80c37d716                                                                         |
| id                                   | cbb98ffb-7546-44c5-af22-7583c3c1ad4f                                                                                             |
| image                                | cgcs-guest (7aeabc04-8b05-44fa-bfe6-07d6dfbfc6ea)                                                                                |
| key_name                             | keypair-tenant1                                                                                                                  |
| metadata                             | {}                                                                                                                               |
| name                                 | guest1                                                                                                                           |
| nics                                 | {"nic1": {"vif_model": "virtio", "port_id": "6a5ee5eb-61e4-4b75-b49a-d3a683888b8e", "network": "tenant1-mgmt-net", "mtu": 1500}} |
| os-extended-volumes:volumes_attached | []                                                                                                                               |
| pinned                               | True                                                                                                                             |
| progress                             | 0                                                                                                                                |
| server_group                         |                                                                                                                                  |
| status                               | ACTIVE                                                                                                                           |
| tenant1-mgmt-net network             | 192.168.109.22                                                                                                                   |
| tenant_id                            | a4e3a58f85e344c9b238f99045ee9e4e                                                                                                 |
| updated                              | 2015-02-05T15:58:47Z                                                                                                             |
| user_id                              | 49be897e674a4456af937371ecfa936d                                                                                                 |
| vcpus (min/cur/max)                  | [1, 4, 4]                                                                                                                        |
+--------------------------------------+----------------------------------------------------------------------------------------------------------------------------------+
Thu Feb  5 15:58:59 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ [0;32m
Assigned Var:cur_cpu=4
[0m
[1;34m
 === auto scaling up
[0m
[0;32m
If: expr { "4" == "4" } |then   %BREAK_REACHED_MAX_CPU3|result=TRUE
[0m

Jumping to label[0;32m:%BREAK_REACHED_MAX_CPU3
[0m
[1;34m
 === check if guest1 current cpu value reached maximum cpu value:4
[0m
nova show guest1
+--------------------------------------+----------------------------------------------------------------------------------------------------------------------------------+
| Property                             | Value                                                                                                                            |
+--------------------------------------+----------------------------------------------------------------------------------------------------------------------------------+
| OS-DCF:diskConfig                    | MANUAL                                                                                                                           |
| OS-EXT-AZ:availability_zone          | nova                                                                                                                             |
| OS-EXT-STS:power_state               | 1                                                                                                                                |
| OS-EXT-STS:task_state                | -                                                                                                                                |
| OS-EXT-STS:vm_state                  | active                                                                                                                           |
| OS-SRV-USG:launched_at               | 2015-02-05T15:54:49.000000                                                                                                       |
| OS-SRV-USG:terminated_at             | -                                                                                                                                |
| accessIPv4                           |                                                                                                                                  |
| accessIPv6                           |                                                                                                                                  |
| config_drive                         |                                                                                                                                  |
| created                              | 2015-02-05T15:52:27Z                                                                                                             |
| extended                             | {"cpuset": 120, "numanode": 0, "siblings_cpuset": null}                                                                          |
| flavor                               | vcpu4-1 (5f0d748b-1c8b-4a70-1985-4d57e25ac137)                                                                                   |
| hostId                               | 1ea8da9884e6179694739654aaa506b2817ea351d58559c80c37d716                                                                         |
| id                                   | cbb98ffb-7546-44c5-af22-7583c3c1ad4f                                                                                             |
| image                                | cgcs-guest (7aeabc04-8b05-44fa-bfe6-07d6dfbfc6ea)                                                                                |
| key_name                             | keypair-tenant1                                                                                                                  |
| metadata                             | {}                                                                                                                               |
| name                                 | guest1                                                                                                                           |
| nics                                 | {"nic1": {"vif_model": "virtio", "port_id": "6a5ee5eb-61e4-4b75-b49a-d3a683888b8e", "network": "tenant1-mgmt-net", "mtu": 1500}} |
| os-extended-volumes:volumes_attached | []                                                                                                                               |
| pinned                               | True                                                                                                                             |
| progress                             | 0                                                                                                                                |
| server_group                         |                                                                                                                                  |
| status                               | ACTIVE                                                                                                                           |
| tenant1-mgmt-net network             | 192.168.109.22                                                                                                                   |
| tenant_id                            | a4e3a58f85e344c9b238f99045ee9e4e                                                                                                 |
| updated                              | 2015-02-05T15:58:47Z                                                                                                             |
| user_id                              | 49be897e674a4456af937371ecfa936d                                                                                                 |
| vcpus (min/cur/max)                  | [1, 4, 4]                                                                                                                        |
+--------------------------------------+----------------------------------------------------------------------------------------------------------------------------------+
[0;32m<min/cur/max[0m
Thu Feb  5 15:59:31 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ [0;32m
Assigned Var:min_cpu=1
[0m
[0;32m
Assigned Var:cur_cpu=4
[0m
[0;32m
Assigned Var:max_cpu=4
[0m
[0;32m
If: expr { "4" != "4" } |then   [|result=FALSE
[0m
[1;34m
 === suspend guest1 
[0m
[1;34m
 === wait for guest1 to SUSPEND
[0m
[0;32m
While: expr { "none" != "SUSPENDED" } |result=TRUE
[0m
nova suspend cbb98ffb-7546-44c5-af22-7583c3c1ad4f
Thu Feb  5 15:59:32 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ nova list
+--------------------------------------+--------+--------+------------+-------------+---------------------------------+
| ID                                   | Name   | Status | Task State | Power State | Networks                        |
+--------------------------------------+--------+--------+------------+-------------+---------------------------------+
| cbb98ffb-7546-44c5-af22-7583c3c1ad4f | guest1 | ACTIVE | suspending | Running     | tenant1-mgmt-net=192.168.109.22 |
+--------------------------------------+--------+--------+------------+-------------+---------------------------------+
[0;32m<guest1[0m
Thu Feb  5 15:59:34 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ [0;32m
Assigned Var:vm_state=ACTIVE
[0m
[0;32m
If: expr { "ACTIVE" == "ERROR" } |then   %BREAK_VM_SUSPENDED|result=FALSE
[0m
[0;32m
If: expr { "1" > "50" } |then   %BREAK_VM_SUSPENDED|result=FALSE
[0m
[0;32m
While: expr { "ACTIVE" != "SUSPENDED" } |result=TRUE
[0m
nova list
+--------------------------------------+--------+-----------+------------+-------------+---------------------------------+
| ID                                   | Name   | Status    | Task State | Power State | Networks                        |
+--------------------------------------+--------+-----------+------------+-------------+---------------------------------+
| cbb98ffb-7546-44c5-af22-7583c3c1ad4f | guest1 | SUSPENDED | -          | Shutdown    | tenant1-mgmt-net=192.168.109.22 |
+--------------------------------------+--------+-----------+------------+-------------+---------------------------------+
[0;32m<guest1[0m
Thu Feb  5 15:59:37 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ [0;32m
Assigned Var:vm_state=SUSPENDED
[0m
[0;32m
If: expr { "SUSPENDED" == "ERROR" } |then   %BREAK_VM_SUSPENDED|result=FALSE
[0m
[0;32m
If: expr { "2" > "50" } |then   %BREAK_VM_SUSPENDED|result=FALSE
[0m
[0;32m
While: expr { "SUSPENDED" != "SUSPENDED" } |result=FALSE
[0m
nova list
+--------------------------------------+--------+-----------+------------+-------------+---------------------------------+
| ID                                   | Name   | Status    | Task State | Power State | Networks                        |
+--------------------------------------+--------+-----------+------------+-------------+---------------------------------+
| cbb98ffb-7546-44c5-af22-7583c3c1ad4f | guest1 | SUSPENDED | -          | Shutdown    | tenant1-mgmt-net=192.168.109.22 |
+--------------------------------------+--------+-----------+------------+-------------+---------------------------------+
Thu Feb  5 15:59:40 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ [1;34m
 === resume guest1 
[0m
[1;34m
 === check guest1 RESUMED
[0m
[1;34m
 === wait for guest1 to become ACTIVE
[0m
[0;32m
While: expr { "none" != "ACTIVE" } |result=TRUE
[0m
nova resume cbb98ffb-7546-44c5-af22-7583c3c1ad4f
Thu Feb  5 15:59:41 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ nova list
+--------------------------------------+--------+-----------+------------+-------------+---------------------------------+
| ID                                   | Name   | Status    | Task State | Power State | Networks                        |
+--------------------------------------+--------+-----------+------------+-------------+---------------------------------+
| cbb98ffb-7546-44c5-af22-7583c3c1ad4f | guest1 | SUSPENDED | resuming   | Shutdown    | tenant1-mgmt-net=192.168.109.22 |
+--------------------------------------+--------+-----------+------------+-------------+---------------------------------+
[0;32m<guest1[0m
Thu Feb  5 15:59:42 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ [0;32m
Assigned Var:vm_state=SUSPENDED
[0m
[0;32m
If: expr { "SUSPENDED" == "ERROR" } |then   %BREAK_VM_RESUMED|result=FALSE
[0m
[0;32m
If: expr { "1" > "50" } |then   %BREAK_VM_RESUMED|result=FALSE
[0m
[0;32m
While: expr { "SUSPENDED" != "ACTIVE" } |result=TRUE
[0m
nova list
+--------------------------------------+--------+--------+------------+-------------+---------------------------------+
| ID                                   | Name   | Status | Task State | Power State | Networks                        |
+--------------------------------------+--------+--------+------------+-------------+---------------------------------+
| cbb98ffb-7546-44c5-af22-7583c3c1ad4f | guest1 | ACTIVE | -          | Running     | tenant1-mgmt-net=192.168.109.22 |
+--------------------------------------+--------+--------+------------+-------------+---------------------------------+
[0;32m<guest1[0m
Thu Feb  5 15:59:45 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ [0;32m
Assigned Var:vm_state=ACTIVE
[0m
[0;32m
If: expr { "ACTIVE" == "ERROR" } |then   %BREAK_VM_RESUMED|result=FALSE
[0m
[0;32m
If: expr { "2" > "50" } |then   %BREAK_VM_RESUMED|result=FALSE
[0m
[0;32m
While: expr { "ACTIVE" != "ACTIVE" } |result=FALSE
[0m
[1;34m
 === check the VMs in good state
[0m
[0;32m
While: expr { "1" <= "1" } |result=TRUE
[0m
nova list
+--------------------------------------+--------+--------+------------+-------------+---------------------------------+
| ID                                   | Name   | Status | Task State | Power State | Networks                        |
+--------------------------------------+--------+--------+------------+-------------+---------------------------------+
| cbb98ffb-7546-44c5-af22-7583c3c1ad4f | guest1 | ACTIVE | -          | Running     | tenant1-mgmt-net=192.168.109.22 |
+--------------------------------------+--------+--------+------------+-------------+---------------------------------+
Thu Feb  5 15:59:48 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ nova list
+--------------------------------------+--------+--------+------------+-------------+---------------------------------+
| ID                                   | Name   | Status | Task State | Power State | Networks                        |
+--------------------------------------+--------+--------+------------+-------------+---------------------------------+
| cbb98ffb-7546-44c5-af22-7583c3c1ad4f | guest1 | ACTIVE | -          | Running     | tenant1-mgmt-net=192.168.109.22 |
+--------------------------------------+--------+--------+------------+-------------+---------------------------------+
[0;32m<guest1[0m
[0;32m<ACTIVE[0m
[0;32m
While: expr { "2" <= "1" } |result=FALSE
[0m
[1;34m
 === Do scale up/down sequentially
[0m
[0;32m

Setting Expect Timeout to: 10 

[0m
[0;32m
While: expr { "1" <= "1" } |result=TRUE
[0m
[1;34m
 === execute scale down for guest1
[0m
[1;34m
 === save the current state of guest1 cpu
[0m
Thu Feb  5 15:59:49 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ [0;32m

Setting Expect Timeout to: 5 

[0m
vm-topology -s servers
libnuma: Warning: Cannot parse sysfs meminfo (3)
vm-topology: 2015-02-05T15:59:50.538389  options: show:['servers']

SERVERS (nova view):  Legend: cpulist = [cpu_id[i], ...], S = siblings, R = reserved
+---------+--------------------------------------+-------------------+--------+-----------+----------+------------+-------------+--------------+---------+--------+-------------+-------+--------+----------+---------+------------+
| tenant  | ID                                   | instance_name     | name   | host      | vm_state | task_state | power_state | server_group | flavor  | pinned | shared_vcpu | vcpus | memory | numanode | cpulist | in_libvirt |
+---------+--------------------------------------+-------------------+--------+-----------+----------+------------+-------------+--------------+---------+--------+-------------+-------+--------+----------+---------+------------+
| tenant1 | cbb98ffb-7546-44c5-af22-7583c3c1ad4f | instance-00000073 | guest1 | compute-1 | active   | None       | Running     | -            | vcpu4-1 | pinned |        None | 1,4,4 |    512 |        0 | 3-6     |    yes     |
+---------+--------------------------------------+-------------------+--------+-----------+----------+------------+-------------+--------------+---------+--------+-------------+-------+--------+----------+---------+------------+
[0;32m<guest1[0m
Thu Feb  5 15:59:51 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ [0;32m
Assigned Var:min_cpu=1
[0m
[0;32m
Assigned Var:cur_cpu=4
[0m
[0;32m
Assigned Var:max_cpu=4
[0m
[1;34m
=== scale down guest1 cpu to the minimum value:1
[0m
[0;32m
While: expr { "1" < "4" } |result=TRUE
[0m
[0;32m

Setting Expect Timeout to: 10 

[0m
nova scale guest1 cpu down
Thu Feb  5 15:59:55 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ echo $?
0
Thu Feb  5 15:59:55 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ [0;32m<
0[0m
[0;32m
While: expr { "1" < "3" } |result=TRUE
[0m
[0;32m

Setting Expect Timeout to: 10 

[0m
nova scale guest1 cpu down
Thu Feb  5 15:59:58 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ echo $?
0
Thu Feb  5 15:59:58 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ [0;32m<
0[0m
[0;32m
While: expr { "1" < "2" } |result=TRUE
[0m
[0;32m

Setting Expect Timeout to: 10 

[0m
nova scale guest1 cpu down
Thu Feb  5 16:00:01 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ echo $?
0
Thu Feb  5 16:00:01 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ [0;32m<
0[0m
[0;32m
While: expr { "1" < "1" } |result=FALSE
[0m
[1;34m
 === check if guest1 current cpu value reached minimum cpu value:1
[0m
nova show guest1
+--------------------------------------+----------------------------------------------------------------------------------------------------------------------------------+
| Property                             | Value                                                                                                                            |
+--------------------------------------+----------------------------------------------------------------------------------------------------------------------------------+
| OS-DCF:diskConfig                    | MANUAL                                                                                                                           |
| OS-EXT-AZ:availability_zone          | nova                                                                                                                             |
| OS-EXT-STS:power_state               | 1                                                                                                                                |
| OS-EXT-STS:task_state                | -                                                                                                                                |
| OS-EXT-STS:vm_state                  | active                                                                                                                           |
| OS-SRV-USG:launched_at               | 2015-02-05T15:54:49.000000                                                                                                       |
| OS-SRV-USG:terminated_at             | -                                                                                                                                |
| accessIPv4                           |                                                                                                                                  |
| accessIPv6                           |                                                                                                                                  |
| config_drive                         |                                                                                                                                  |
| created                              | 2015-02-05T15:52:27Z                                                                                                             |
| extended                             | {"cpuset": 8, "numanode": 0, "siblings_cpuset": null}                                                                            |
| flavor                               | vcpu4-1 (5f0d748b-1c8b-4a70-1985-4d57e25ac137)                                                                                   |
| hostId                               | 1ea8da9884e6179694739654aaa506b2817ea351d58559c80c37d716                                                                         |
| id                                   | cbb98ffb-7546-44c5-af22-7583c3c1ad4f                                                                                             |
| image                                | cgcs-guest (7aeabc04-8b05-44fa-bfe6-07d6dfbfc6ea)                                                                                |
| key_name                             | keypair-tenant1                                                                                                                  |
| metadata                             | {}                                                                                                                               |
| name                                 | guest1                                                                                                                           |
| nics                                 | {"nic1": {"vif_model": "virtio", "port_id": "6a5ee5eb-61e4-4b75-b49a-d3a683888b8e", "network": "tenant1-mgmt-net", "mtu": 1500}} |
| os-extended-volumes:volumes_attached | []                                                                                                                               |
| pinned                               | True                                                                                                                             |
| progress                             | 0                                                                                                                                |
| server_group                         |                                                                                                                                  |
| status                               | ACTIVE                                                                                                                           |
| tenant1-mgmt-net network             | 192.168.109.22                                                                                                                   |
| tenant_id                            | a4e3a58f85e344c9b238f99045ee9e4e                                                                                                 |
| updated                              | 2015-02-05T16:00:00Z                                                                                                             |
| user_id                              | 49be897e674a4456af937371ecfa936d                                                                                                 |
| vcpus (min/cur/max)                  | [1, 1, 4]                                                                                                                        |
+--------------------------------------+----------------------------------------------------------------------------------------------------------------------------------+
[0;32m<min/cur/max[0m
Thu Feb  5 16:00:03 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ [0;32m
Assigned Var:min_cpu=1
[0m
[0;32m
Assigned Var:cur_cpu=1
[0m
[0;32m
Assigned Var:max_cpu=4
[0m
[0;32m
If: expr { "1" != "1" } |then   [|result=FALSE
[0m
[0;32m
While: expr { "2" <= "1" } |result=FALSE
[0m
[1;34m
 === scale down of all VMs completed
[0m
[0;32m
While: expr { "1" <= "1" } |result=TRUE
[0m
[1;34m
 === save the current state of guest1 cpu
[0m
vm-topology -s servers
libnuma: Warning: Cannot parse sysfs meminfo (3)
vm-topology: 2015-02-05T16:00:03.538074  options: show:['servers']

SERVERS (nova view):  Legend: cpulist = [cpu_id[i], ...], S = siblings, R = reserved
+---------+--------------------------------------+-------------------+--------+-----------+----------+------------+-------------+--------------+---------+--------+-------------+-------+--------+----------+---------+------------+
| tenant  | ID                                   | instance_name     | name   | host      | vm_state | task_state | power_state | server_group | flavor  | pinned | shared_vcpu | vcpus | memory | numanode | cpulist | in_libvirt |
+---------+--------------------------------------+-------------------+--------+-----------+----------+------------+-------------+--------------+---------+--------+-------------+-------+--------+----------+---------+------------+
| tenant1 | cbb98ffb-7546-44c5-af22-7583c3c1ad4f | instance-00000073 | guest1 | compute-1 | active   | None       | Running     | -            | vcpu4-1 | pinned |        None | 1,1,4 |    512 |        0 | 3       |    yes     |
+---------+--------------------------------------+-------------------+--------+-----------+----------+------------+-------------+--------------+---------+--------+-------------+-------+--------+----------+---------+------------+
[0;32m<guest1[0m
Thu Feb  5 16:00:04 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ [0;32m
Assigned Var:min_cpu=1
[0m
[0;32m
Assigned Var:cur_cpu=1
[0m
[0;32m
Assigned Var:max_cpu=4
[0m
[1;34m
=== scale up cpu to the maximum value:4
[0m
[0;32m
While: expr { "1" < "4" } |result=TRUE
[0m
[0;32m

Setting Expect Timeout to: 10 

[0m
nova scale guest1 cpu up
Thu Feb  5 16:00:08 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ echo $?
0
Thu Feb  5 16:00:08 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ [0;32m<
0[0m
[0;32m
While: expr { "2" < "4" } |result=TRUE
[0m
[0;32m

Setting Expect Timeout to: 10 

[0m
nova scale guest1 cpu up
Thu Feb  5 16:00:11 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ echo $?
0
Thu Feb  5 16:00:11 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ [0;32m<
0[0m
[0;32m
While: expr { "3" < "4" } |result=TRUE
[0m
[0;32m

Setting Expect Timeout to: 10 

[0m
nova scale guest1 cpu up
Thu Feb  5 16:00:14 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ echo $?
0
Thu Feb  5 16:00:14 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ [0;32m<
0[0m
[0;32m
While: expr { "4" < "4" } |result=FALSE
[0m
[1;34m
 === check if guest1 current cpu value reached max cpu value:4
[0m
nova show guest1
+--------------------------------------+----------------------------------------------------------------------------------------------------------------------------------+
| Property                             | Value                                                                                                                            |
+--------------------------------------+----------------------------------------------------------------------------------------------------------------------------------+
| OS-DCF:diskConfig                    | MANUAL                                                                                                                           |
| OS-EXT-AZ:availability_zone          | nova                                                                                                                             |
| OS-EXT-STS:power_state               | 1                                                                                                                                |
| OS-EXT-STS:task_state                | -                                                                                                                                |
| OS-EXT-STS:vm_state                  | active                                                                                                                           |
| OS-SRV-USG:launched_at               | 2015-02-05T15:54:49.000000                                                                                                       |
| OS-SRV-USG:terminated_at             | -                                                                                                                                |
| accessIPv4                           |                                                                                                                                  |
| accessIPv6                           |                                                                                                                                  |
| config_drive                         |                                                                                                                                  |
| created                              | 2015-02-05T15:52:27Z                                                                                                             |
| extended                             | {"cpuset": 120, "numanode": 0, "siblings_cpuset": null}                                                                          |
| flavor                               | vcpu4-1 (5f0d748b-1c8b-4a70-1985-4d57e25ac137)                                                                                   |
| hostId                               | 1ea8da9884e6179694739654aaa506b2817ea351d58559c80c37d716                                                                         |
| id                                   | cbb98ffb-7546-44c5-af22-7583c3c1ad4f                                                                                             |
| image                                | cgcs-guest (7aeabc04-8b05-44fa-bfe6-07d6dfbfc6ea)                                                                                |
| key_name                             | keypair-tenant1                                                                                                                  |
| metadata                             | {}                                                                                                                               |
| name                                 | guest1                                                                                                                           |
| nics                                 | {"nic1": {"vif_model": "virtio", "port_id": "6a5ee5eb-61e4-4b75-b49a-d3a683888b8e", "network": "tenant1-mgmt-net", "mtu": 1500}} |
| os-extended-volumes:volumes_attached | []                                                                                                                               |
| pinned                               | True                                                                                                                             |
| progress                             | 0                                                                                                                                |
| server_group                         |                                                                                                                                  |
| status                               | ACTIVE                                                                                                                           |
| tenant1-mgmt-net network             | 192.168.109.22                                                                                                                   |
| tenant_id                            | a4e3a58f85e344c9b238f99045ee9e4e                                                                                                 |
| updated                              | 2015-02-05T16:00:14Z                                                                                                             |
| user_id                              | 49be897e674a4456af937371ecfa936d                                                                                                 |
| vcpus (min/cur/max)                  | [1, 4, 4]                                                                                                                        |
+--------------------------------------+----------------------------------------------------------------------------------------------------------------------------------+
[0;32m<min/cur/max[0m
Thu Feb  5 16:00:16 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ [0;32m
Assigned Var:min_cpu=1
[0m
[0;32m
Assigned Var:cur_cpu=4
[0m
[0;32m
Assigned Var:max_cpu=4
[0m
[0;32m
If: expr { "4" != "4" } |then   [|result=FALSE
[0m
[1;34m
 === scale up of vm1 completed
[0m
[0;32m
While: expr { "2" <= "1" } |result=FALSE
[0m
[1;34m
 === Scale up of all Vms completed
[0m
[1;34m
 === reboot guest1 
[0m
nova reboot cbb98ffb-7546-44c5-af22-7583c3c1ad4f
Thu Feb  5 16:00:17 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ [1;34m
 === check guest1 rebooting
[0m
[0;32m

Setting Expect Timeout to: 15 

[0m
nova list | grep guest1
[0;32m<guest1[0m
| cbb98ffb-7546-44c5-af22-7583c3c1ad4f | guest1 | REBOOT | rebooting  | Running     | tenant1-mgmt-net=192.168.109.22 |
[0;32m<REBOOT[0m
[1;34m
 === wait for guest1 to finish rebooting
[0m
[0;32m
While: expr { "none" != "ACTIVE" } |result=TRUE
[0m
Thu Feb  5 16:00:18 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ nova list | grep guest1
[0;32m<guest1[0m
| cbb98ffb-7546-44c5-af22-7583c3c1ad4f | guest1 | REBOOT | rebooting  | Running     | tenant1-mgmt-net=192.168.109.22 |
Thu Feb  5 16:00:19 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ [0;32m
Assigned Var:vm_state=REBOOT
[0m
[0;32m
If: expr { "REBOOT" == "ERROR" } |then   %BREAK_VM_REBOOT|result=FALSE
[0m
[0;32m
If: expr { "1" > "100" } |then   %BREAK_VM_REBOOT|result=FALSE
[0m
[0;32m
While: expr { "REBOOT" != "ACTIVE" } |result=TRUE
[0m
nova list | grep guest1
[0;32m<guest1[0m
| cbb98ffb-7546-44c5-af22-7583c3c1ad4f | guest1 | REBOOT | rebooting  | Running     | tenant1-mgmt-net=192.168.109.22 |
Thu Feb  5 16:00:22 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ [0;32m
Assigned Var:vm_state=REBOOT
[0m
[0;32m
If: expr { "REBOOT" == "ERROR" } |then   %BREAK_VM_REBOOT|result=FALSE
[0m
[0;32m
If: expr { "2" > "100" } |then   %BREAK_VM_REBOOT|result=FALSE
[0m
[0;32m
While: expr { "REBOOT" != "ACTIVE" } |result=TRUE
[0m
nova list | grep guest1
[0;32m<guest1[0m
| cbb98ffb-7546-44c5-af22-7583c3c1ad4f | guest1 | REBOOT | rebooting  | Running     | tenant1-mgmt-net=192.168.109.22 |
Thu Feb  5 16:00:26 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ [0;32m
Assigned Var:vm_state=REBOOT
[0m
[0;32m
If: expr { "REBOOT" == "ERROR" } |then   %BREAK_VM_REBOOT|result=FALSE
[0m
[0;32m
If: expr { "3" > "100" } |then   %BREAK_VM_REBOOT|result=FALSE
[0m
[0;32m
While: expr { "REBOOT" != "ACTIVE" } |result=TRUE
[0m
nova list | grep guest1
[0;32m<guest1[0m
| cbb98ffb-7546-44c5-af22-7583c3c1ad4f | guest1 | REBOOT | rebooting  | Running     | tenant1-mgmt-net=192.168.109.22 |
Thu Feb  5 16:00:29 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ [0;32m
Assigned Var:vm_state=REBOOT
[0m
[0;32m
If: expr { "REBOOT" == "ERROR" } |then   %BREAK_VM_REBOOT|result=FALSE
[0m
[0;32m
If: expr { "4" > "100" } |then   %BREAK_VM_REBOOT|result=FALSE
[0m
[0;32m
While: expr { "REBOOT" != "ACTIVE" } |result=TRUE
[0m
nova list | grep guest1
[0;32m<guest1[0m
| cbb98ffb-7546-44c5-af22-7583c3c1ad4f | guest1 | ACTIVE | -          | Running     | tenant1-mgmt-net=192.168.109.22 |
Thu Feb  5 16:00:32 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ [0;32m
Assigned Var:vm_state=ACTIVE
[0m
[0;32m
If: expr { "ACTIVE" == "ERROR" } |then   %BREAK_VM_REBOOT|result=FALSE
[0m
[0;32m
If: expr { "5" > "100" } |then   %BREAK_VM_REBOOT|result=FALSE
[0m
[0;32m
While: expr { "ACTIVE" != "ACTIVE" } |result=FALSE
[0m
nova list
+--------------------------------------+--------+--------+------------+-------------+---------------------------------+
| ID                                   | Name   | Status | Task State | Power State | Networks                        |
+--------------------------------------+--------+--------+------------+-------------+---------------------------------+
| cbb98ffb-7546-44c5-af22-7583c3c1ad4f | guest1 | ACTIVE | -          | Running     | tenant1-mgmt-net=192.168.109.22 |
+--------------------------------------+--------+--------+------------+-------------+---------------------------------+
Thu Feb  5 16:00:35 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ ceilometer sample-create -r cbb98ffb-7546-44c5-af22-7583c3c1ad4f -m vote --meter-type gauge --meter-unit '%' --sample-volume 2 --r esource-metadata '{"display_name":"guest1"}'
+-------------------+--------------------------------------------+
| Property          | Value                                      |
+-------------------+--------------------------------------------+
| message_id        | 1f607e78-ad50-11e4-99ab-2c44fd83b910       |
| name              | vote                                       |
| project_id        | a4e3a58f85e344c9b238f99045ee9e4e           |
| resource_id       | cbb98ffb-7546-44c5-af22-7583c3c1ad4f       |
| resource_metadata | {u'display_name': u'guest1'}               |
| source            | a4e3a58f85e344c9b238f99045ee9e4e:openstack |
| timestamp         | 2015-02-05T16:00:36.335434                 |
| type              | gauge                                      |
| unit              | %                                          |
| user_id           | 49be897e674a4456af937371ecfa936d           |
| volume            | 2.0                                        |
+-------------------+--------------------------------------------+
Thu Feb  5 16:00:36 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ ceilometer resource-show -r cbb98ffb-7546-44c5-af22-7583c3c1ad4f
+-------------+--------------------------------------------+
| Property    | Value                                      |
+-------------+--------------------------------------------+
| metadata    | {u'display_name': u'guest1'}               |
| project_id  | a4e3a58f85e344c9b238f99045ee9e4e           |
| resource_id | cbb98ffb-7546-44c5-af22-7583c3c1ad4f       |
| source      | a4e3a58f85e344c9b238f99045ee9e4e:openstack |
| user_id     | 49be897e674a4456af937371ecfa936d           |
+-------------+--------------------------------------------+
Thu Feb  5 16:00:37 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ [0;32m<[0m
ceilometer alarm-list
[0;32m<alarm[0m
+--------------------------------------+----------------------------------+-------+---------+------------+----------------------------+------------------+
| Alarm ID                             | Name                             | State | Enabled | Continuous | Alarm condition            | Time constraints |
+--------------------------------------+----------------------------------+-------+---------+------------+----------------------------+------------------+
| c994fbd6-30b2-4964-bc80-f7c7c0fbc536 | STACK1-CPUAlarmHigh-2fxmgkzypvkz | ok    | True    | True       | vote > 60.0 during 1 x 70s | None             |
| caf9b610-8305-4d1d-92b4-615550c0b785 | STACK1-CPUAlarmLow-erbz7os4ut7t  | alarm | True    | True       | vote < 5.0 during 1 x 70s  | None             |
+--------------------------------------+----------------------------------+-------+---------+------------+----------------------------+------------------+
Thu Feb  5 16:01:08 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ [1;34m
 === going in a loop to check guest1 reached minimum cpu vale 
[0m
nova show guest1
[0;32m<guest1[0m
+--------------------------------------+----------------------------------------------------------------------------------------------------------------------------------+
| Property                             | Value                                                                                                                            |
+--------------------------------------+----------------------------------------------------------------------------------------------------------------------------------+
| OS-DCF:diskConfig                    | MANUAL                                                                                                                           |
| OS-EXT-AZ:availability_zone          | nova                                                                                                                             |
| OS-EXT-STS:power_state               | 1                                                                                                                                |
| OS-EXT-STS:task_state                | -                                                                                                                                |
| OS-EXT-STS:vm_state                  | active                                                                                                                           |
| OS-SRV-USG:launched_at               | 2015-02-05T15:54:49.000000                                                                                                       |
| OS-SRV-USG:terminated_at             | -                                                                                                                                |
| accessIPv4                           |                                                                                                                                  |
| accessIPv6                           |                                                                                                                                  |
| config_drive                         |                                                                                                                                  |
| created                              | 2015-02-05T15:52:27Z                                                                                                             |
| extended                             | {"cpuset": 56, "numanode": 0, "siblings_cpuset": null}                                                                           |
| flavor                               | vcpu4-1 (5f0d748b-1c8b-4a70-1985-4d57e25ac137)                                                                                   |
| hostId                               | 1ea8da9884e6179694739654aaa506b2817ea351d58559c80c37d716                                                                         |
| id                                   | cbb98ffb-7546-44c5-af22-7583c3c1ad4f                                                                                             |
| image                                | cgcs-guest (7aeabc04-8b05-44fa-bfe6-07d6dfbfc6ea)                                                                                |
| key_name                             | keypair-tenant1                                                                                                                  |
| metadata                             | {}                                                                                                                               |
| name                                 | guest1                                                                                                                           |
| nics                                 | {"nic1": {"vif_model": "virtio", "port_id": "6a5ee5eb-61e4-4b75-b49a-d3a683888b8e", "network": "tenant1-mgmt-net", "mtu": 1500}} |
| os-extended-volumes:volumes_attached | []                                                                                                                               |
| pinned                               | True                                                                                                                             |
| progress                             | 0                                                                                                                                |
| server_group                         |                                                                                                                                  |
| status                               | ACTIVE                                                                                                                           |
| tenant1-mgmt-net network             | 192.168.109.22                                                                                                                   |
| tenant_id                            | a4e3a58f85e344c9b238f99045ee9e4e                                                                                                 |
| updated                              | 2015-02-05T16:00:47Z                                                                                                             |
| user_id                              | 49be897e674a4456af937371ecfa936d                                                                                                 |
| vcpus (min/cur/max)                  | [1, 3, 4]                                                                                                                        |
+--------------------------------------+----------------------------------------------------------------------------------------------------------------------------------+
Thu Feb  5 16:01:09 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ [0;32m
Assigned Var:min_cpu=1
[0m
[0;32m
Assigned Var:cur_cpu=3
[0m
[0;32m
Assigned Var:max_cpu=4
[0m
[0;32m
While: expr { "3" != "1" } |result=TRUE
[0m
nova show guest1
[0;32m<guest1[0m
+--------------------------------------+----------------------------------------------------------------------------------------------------------------------------------+
| Property                             | Value                                                                                                                            |
+--------------------------------------+----------------------------------------------------------------------------------------------------------------------------------+
| OS-DCF:diskConfig                    | MANUAL                                                                                                                           |
| OS-EXT-AZ:availability_zone          | nova                                                                                                                             |
| OS-EXT-STS:power_state               | 1                                                                                                                                |
| OS-EXT-STS:task_state                | -                                                                                                                                |
| OS-EXT-STS:vm_state                  | active                                                                                                                           |
| OS-SRV-USG:launched_at               | 2015-02-05T15:54:49.000000                                                                                                       |
| OS-SRV-USG:terminated_at             | -                                                                                                                                |
| accessIPv4                           |                                                                                                                                  |
| accessIPv6                           |                                                                                                                                  |
| config_drive                         |                                                                                                                                  |
| created                              | 2015-02-05T15:52:27Z                                                                                                             |
| extended                             | {"cpuset": 56, "numanode": 0, "siblings_cpuset": null}                                                                           |
| flavor                               | vcpu4-1 (5f0d748b-1c8b-4a70-1985-4d57e25ac137)                                                                                   |
| hostId                               | 1ea8da9884e6179694739654aaa506b2817ea351d58559c80c37d716                                                                         |
| id                                   | cbb98ffb-7546-44c5-af22-7583c3c1ad4f                                                                                             |
| image                                | cgcs-guest (7aeabc04-8b05-44fa-bfe6-07d6dfbfc6ea)                                                                                |
| key_name                             | keypair-tenant1                                                                                                                  |
| metadata                             | {}                                                                                                                               |
| name                                 | guest1                                                                                                                           |
| nics                                 | {"nic1": {"vif_model": "virtio", "port_id": "6a5ee5eb-61e4-4b75-b49a-d3a683888b8e", "network": "tenant1-mgmt-net", "mtu": 1500}} |
| os-extended-volumes:volumes_attached | []                                                                                                                               |
| pinned                               | True                                                                                                                             |
| progress                             | 0                                                                                                                                |
| server_group                         |                                                                                                                                  |
| status                               | ACTIVE                                                                                                                           |
| tenant1-mgmt-net network             | 192.168.109.22                                                                                                                   |
| tenant_id                            | a4e3a58f85e344c9b238f99045ee9e4e                                                                                                 |
| updated                              | 2015-02-05T16:00:47Z                                                                                                             |
| user_id                              | 49be897e674a4456af937371ecfa936d                                                                                                 |
| vcpus (min/cur/max)                  | [1, 3, 4]                                                                                                                        |
+--------------------------------------+----------------------------------------------------------------------------------------------------------------------------------+
Thu Feb  5 16:01:11 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ [0;32m
Assigned Var:cur_cpu=3
[0m
[1;34m
 === auto scaling down
[0m
[0;32m
If: expr { "3" == "1" } |then   %BREAK_REACHED_MIN_CPU5|result=FALSE
[0m
[0;32m
While: expr { "3" != "1" } |result=TRUE
[0m
nova show guest1
[0;32m<guest1[0m
+--------------------------------------+----------------------------------------------------------------------------------------------------------------------------------+
| Property                             | Value                                                                                                                            |
+--------------------------------------+----------------------------------------------------------------------------------------------------------------------------------+
| OS-DCF:diskConfig                    | MANUAL                                                                                                                           |
| OS-EXT-AZ:availability_zone          | nova                                                                                                                             |
| OS-EXT-STS:power_state               | 1                                                                                                                                |
| OS-EXT-STS:task_state                | -                                                                                                                                |
| OS-EXT-STS:vm_state                  | active                                                                                                                           |
| OS-SRV-USG:launched_at               | 2015-02-05T15:54:49.000000                                                                                                       |
| OS-SRV-USG:terminated_at             | -                                                                                                                                |
| accessIPv4                           |                                                                                                                                  |
| accessIPv6                           |                                                                                                                                  |
| config_drive                         |                                                                                                                                  |
| created                              | 2015-02-05T15:52:27Z                                                                                                             |
| extended                             | {"cpuset": 24, "numanode": 0, "siblings_cpuset": null}                                                                           |
| flavor                               | vcpu4-1 (5f0d748b-1c8b-4a70-1985-4d57e25ac137)                                                                                   |
| hostId                               | 1ea8da9884e6179694739654aaa506b2817ea351d58559c80c37d716                                                                         |
| id                                   | cbb98ffb-7546-44c5-af22-7583c3c1ad4f                                                                                             |
| image                                | cgcs-guest (7aeabc04-8b05-44fa-bfe6-07d6dfbfc6ea)                                                                                |
| key_name                             | keypair-tenant1                                                                                                                  |
| metadata                             | {}                                                                                                                               |
| name                                 | guest1                                                                                                                           |
| nics                                 | {"nic1": {"vif_model": "virtio", "port_id": "6a5ee5eb-61e4-4b75-b49a-d3a683888b8e", "network": "tenant1-mgmt-net", "mtu": 1500}} |
| os-extended-volumes:volumes_attached | []                                                                                                                               |
| pinned                               | True                                                                                                                             |
| progress                             | 0                                                                                                                                |
| server_group                         |                                                                                                                                  |
| status                               | ACTIVE                                                                                                                           |
| tenant1-mgmt-net network             | 192.168.109.22                                                                                                                   |
| tenant_id                            | a4e3a58f85e344c9b238f99045ee9e4e                                                                                                 |
| updated                              | 2015-02-05T16:01:17Z                                                                                                             |
| user_id                              | 49be897e674a4456af937371ecfa936d                                                                                                 |
| vcpus (min/cur/max)                  | [1, 2, 4]                                                                                                                        |
+--------------------------------------+----------------------------------------------------------------------------------------------------------------------------------+
Thu Feb  5 16:01:42 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ [0;32m
Assigned Var:cur_cpu=2
[0m
[1;34m
 === auto scaling down
[0m
[0;32m
If: expr { "2" == "1" } |then   %BREAK_REACHED_MIN_CPU5|result=FALSE
[0m
[0;32m
While: expr { "2" != "1" } |result=TRUE
[0m
nova show guest1
[0;32m<guest1[0m
+--------------------------------------+----------------------------------------------------------------------------------------------------------------------------------+
| Property                             | Value                                                                                                                            |
+--------------------------------------+----------------------------------------------------------------------------------------------------------------------------------+
| OS-DCF:diskConfig                    | MANUAL                                                                                                                           |
| OS-EXT-AZ:availability_zone          | nova                                                                                                                             |
| OS-EXT-STS:power_state               | 1                                                                                                                                |
| OS-EXT-STS:task_state                | -                                                                                                                                |
| OS-EXT-STS:vm_state                  | active                                                                                                                           |
| OS-SRV-USG:launched_at               | 2015-02-05T15:54:49.000000                                                                                                       |
| OS-SRV-USG:terminated_at             | -                                                                                                                                |
| accessIPv4                           |                                                                                                                                  |
| accessIPv6                           |                                                                                                                                  |
| config_drive                         |                                                                                                                                  |
| created                              | 2015-02-05T15:52:27Z                                                                                                             |
| extended                             | {"cpuset": 8, "numanode": 0, "siblings_cpuset": null}                                                                            |
| flavor                               | vcpu4-1 (5f0d748b-1c8b-4a70-1985-4d57e25ac137)                                                                                   |
| hostId                               | 1ea8da9884e6179694739654aaa506b2817ea351d58559c80c37d716                                                                         |
| id                                   | cbb98ffb-7546-44c5-af22-7583c3c1ad4f                                                                                             |
| image                                | cgcs-guest (7aeabc04-8b05-44fa-bfe6-07d6dfbfc6ea)                                                                                |
| key_name                             | keypair-tenant1                                                                                                                  |
| metadata                             | {}                                                                                                                               |
| name                                 | guest1                                                                                                                           |
| nics                                 | {"nic1": {"vif_model": "virtio", "port_id": "6a5ee5eb-61e4-4b75-b49a-d3a683888b8e", "network": "tenant1-mgmt-net", "mtu": 1500}} |
| os-extended-volumes:volumes_attached | []                                                                                                                               |
| pinned                               | True                                                                                                                             |
| progress                             | 0                                                                                                                                |
| server_group                         |                                                                                                                                  |
| status                               | ACTIVE                                                                                                                           |
| tenant1-mgmt-net network             | 192.168.109.22                                                                                                                   |
| tenant_id                            | a4e3a58f85e344c9b238f99045ee9e4e                                                                                                 |
| updated                              | 2015-02-05T16:01:47Z                                                                                                             |
| user_id                              | 49be897e674a4456af937371ecfa936d                                                                                                 |
| vcpus (min/cur/max)                  | [1, 1, 4]                                                                                                                        |
+--------------------------------------+----------------------------------------------------------------------------------------------------------------------------------+
Thu Feb  5 16:02:13 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ [0;32m
Assigned Var:cur_cpu=1
[0m
[1;34m
 === auto scaling down
[0m
[0;32m
If: expr { "1" == "1" } |then   %BREAK_REACHED_MIN_CPU5|result=TRUE
[0m

Jumping to label[0;32m:%BREAK_REACHED_MIN_CPU5
[0m
[1;34m
 === check if guest1 current cpu value reached minimum cpu value:1
[0m
nova show guest1
+--------------------------------------+----------------------------------------------------------------------------------------------------------------------------------+
| Property                             | Value                                                                                                                            |
+--------------------------------------+----------------------------------------------------------------------------------------------------------------------------------+
| OS-DCF:diskConfig                    | MANUAL                                                                                                                           |
| OS-EXT-AZ:availability_zone          | nova                                                                                                                             |
| OS-EXT-STS:power_state               | 1                                                                                                                                |
| OS-EXT-STS:task_state                | -                                                                                                                                |
| OS-EXT-STS:vm_state                  | active                                                                                                                           |
| OS-SRV-USG:launched_at               | 2015-02-05T15:54:49.000000                                                                                                       |
| OS-SRV-USG:terminated_at             | -                                                                                                                                |
| accessIPv4                           |                                                                                                                                  |
| accessIPv6                           |                                                                                                                                  |
| config_drive                         |                                                                                                                                  |
| created                              | 2015-02-05T15:52:27Z                                                                                                             |
| extended                             | {"cpuset": 8, "numanode": 0, "siblings_cpuset": null}                                                                            |
| flavor                               | vcpu4-1 (5f0d748b-1c8b-4a70-1985-4d57e25ac137)                                                                                   |
| hostId                               | 1ea8da9884e6179694739654aaa506b2817ea351d58559c80c37d716                                                                         |
| id                                   | cbb98ffb-7546-44c5-af22-7583c3c1ad4f                                                                                             |
| image                                | cgcs-guest (7aeabc04-8b05-44fa-bfe6-07d6dfbfc6ea)                                                                                |
| key_name                             | keypair-tenant1                                                                                                                  |
| metadata                             | {}                                                                                                                               |
| name                                 | guest1                                                                                                                           |
| nics                                 | {"nic1": {"vif_model": "virtio", "port_id": "6a5ee5eb-61e4-4b75-b49a-d3a683888b8e", "network": "tenant1-mgmt-net", "mtu": 1500}} |
| os-extended-volumes:volumes_attached | []                                                                                                                               |
| pinned                               | True                                                                                                                             |
| progress                             | 0                                                                                                                                |
| server_group                         |                                                                                                                                  |
| status                               | ACTIVE                                                                                                                           |
| tenant1-mgmt-net network             | 192.168.109.22                                                                                                                   |
| tenant_id                            | a4e3a58f85e344c9b238f99045ee9e4e                                                                                                 |
| updated                              | 2015-02-05T16:01:47Z                                                                                                             |
| user_id                              | 49be897e674a4456af937371ecfa936d                                                                                                 |
| vcpus (min/cur/max)                  | [1, 1, 4]                                                                                                                        |
+--------------------------------------+----------------------------------------------------------------------------------------------------------------------------------+
[0;32m<min/cur/max[0m
Thu Feb  5 16:02:45 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ [0;32m
Assigned Var:min_cpu=1
[0m
[0;32m
Assigned Var:cur_cpu=1
[0m
[0;32m
Assigned Var:max_cpu=4
[0m
[0;32m
If: expr { "1" != "1" } |then   [|result=FALSE
[0m
ceilometer sample-create -r cbb98ffb-7546-44c5-af22-7583c3c1ad4f -m vote --meter-type gauge --meter-unit '%' --sample-volume 90 -- resource-metadata '{"display_name":"guest1"}'
+-------------------+--------------------------------------------+
| Property          | Value                                      |
+-------------------+--------------------------------------------+
| message_id        | 6cc6c3fc-ad50-11e4-99ab-2c44fd83b910       |
| name              | vote                                       |
| project_id        | a4e3a58f85e344c9b238f99045ee9e4e           |
| resource_id       | cbb98ffb-7546-44c5-af22-7583c3c1ad4f       |
| resource_metadata | {u'display_name': u'guest1'}               |
| source            | a4e3a58f85e344c9b238f99045ee9e4e:openstack |
| timestamp         | 2015-02-05T16:02:46.189866                 |
| type              | gauge                                      |
| unit              | %                                          |
| user_id           | 49be897e674a4456af937371ecfa936d           |
| volume            | 90.0                                       |
+-------------------+--------------------------------------------+
Thu Feb  5 16:02:46 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ ceilometer resource-show -r cbb98ffb-7546-44c5-af22-7583c3c1ad4f
+-------------+--------------------------------------------+
| Property    | Value                                      |
+-------------+--------------------------------------------+
| metadata    | {u'display_name': u'guest1'}               |
| project_id  | a4e3a58f85e344c9b238f99045ee9e4e           |
| resource_id | cbb98ffb-7546-44c5-af22-7583c3c1ad4f       |
| source      | a4e3a58f85e344c9b238f99045ee9e4e:openstack |
| user_id     | 49be897e674a4456af937371ecfa936d           |
+-------------+--------------------------------------------+
Thu Feb  5 16:02:47 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ [0;32m<[0m
ceilometer alarm-list
[0;32m<alarm[0m
+--------------------------------------+----------------------------------+-------+---------+------------+----------------------------+------------------+
| Alarm ID                             | Name                             | State | Enabled | Continuous | Alarm condition            | Time constraints |
+--------------------------------------+----------------------------------+-------+---------+------------+----------------------------+------------------+
| c994fbd6-30b2-4964-bc80-f7c7c0fbc536 | STACK1-CPUAlarmHigh-2fxmgkzypvkz | alarm | True    | True       | vote > 60.0 during 1 x 70s | None             |
| caf9b610-8305-4d1d-92b4-615550c0b785 | STACK1-CPUAlarmLow-erbz7os4ut7t  | ok    | True    | True       | vote < 5.0 during 1 x 70s  | None             |
+--------------------------------------+----------------------------------+-------+---------+------------+----------------------------+------------------+
Thu Feb  5 16:03:17 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ [1;34m
 === going in a loop to check guest1 reached maximum cpu vale 
[0m
nova show guest1
[0;32m<guest1[0m
+--------------------------------------+----------------------------------------------------------------------------------------------------------------------------------+
| Property                             | Value                                                                                                                            |
+--------------------------------------+----------------------------------------------------------------------------------------------------------------------------------+
| OS-DCF:diskConfig                    | MANUAL                                                                                                                           |
| OS-EXT-AZ:availability_zone          | nova                                                                                                                             |
| OS-EXT-STS:power_state               | 1                                                                                                                                |
| OS-EXT-STS:task_state                | -                                                                                                                                |
| OS-EXT-STS:vm_state                  | active                                                                                                                           |
| OS-SRV-USG:launched_at               | 2015-02-05T15:54:49.000000                                                                                                       |
| OS-SRV-USG:terminated_at             | -                                                                                                                                |
| accessIPv4                           |                                                                                                                                  |
| accessIPv6                           |                                                                                                                                  |
| config_drive                         |                                                                                                                                  |
| created                              | 2015-02-05T15:52:27Z                                                                                                             |
| extended                             | {"cpuset": 24, "numanode": 0, "siblings_cpuset": null}                                                                           |
| flavor                               | vcpu4-1 (5f0d748b-1c8b-4a70-1985-4d57e25ac137)                                                                                   |
| hostId                               | 1ea8da9884e6179694739654aaa506b2817ea351d58559c80c37d716                                                                         |
| id                                   | cbb98ffb-7546-44c5-af22-7583c3c1ad4f                                                                                             |
| image                                | cgcs-guest (7aeabc04-8b05-44fa-bfe6-07d6dfbfc6ea)                                                                                |
| key_name                             | keypair-tenant1                                                                                                                  |
| metadata                             | {}                                                                                                                               |
| name                                 | guest1                                                                                                                           |
| nics                                 | {"nic1": {"vif_model": "virtio", "port_id": "6a5ee5eb-61e4-4b75-b49a-d3a683888b8e", "network": "tenant1-mgmt-net", "mtu": 1500}} |
| os-extended-volumes:volumes_attached | []                                                                                                                               |
| pinned                               | True                                                                                                                             |
| progress                             | 0                                                                                                                                |
| server_group                         |                                                                                                                                  |
| status                               | ACTIVE                                                                                                                           |
| tenant1-mgmt-net network             | 192.168.109.22                                                                                                                   |
| tenant_id                            | a4e3a58f85e344c9b238f99045ee9e4e                                                                                                 |
| updated                              | 2015-02-05T16:03:17Z                                                                                                             |
| user_id                              | 49be897e674a4456af937371ecfa936d                                                                                                 |
| vcpus (min/cur/max)                  | [1, 2, 4]                                                                                                                        |
+--------------------------------------+----------------------------------------------------------------------------------------------------------------------------------+
Thu Feb  5 16:03:19 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ [0;32m
Assigned Var:min_cpu=1
[0m
[0;32m
Assigned Var:cur_cpu=2
[0m
[0;32m
Assigned Var:max_cpu=4
[0m
[0;32m
While: expr { "2" != "4" } |result=TRUE
[0m
nova show guest1
[0;32m<guest1[0m
+--------------------------------------+----------------------------------------------------------------------------------------------------------------------------------+
| Property                             | Value                                                                                                                            |
+--------------------------------------+----------------------------------------------------------------------------------------------------------------------------------+
| OS-DCF:diskConfig                    | MANUAL                                                                                                                           |
| OS-EXT-AZ:availability_zone          | nova                                                                                                                             |
| OS-EXT-STS:power_state               | 1                                                                                                                                |
| OS-EXT-STS:task_state                | -                                                                                                                                |
| OS-EXT-STS:vm_state                  | active                                                                                                                           |
| OS-SRV-USG:launched_at               | 2015-02-05T15:54:49.000000                                                                                                       |
| OS-SRV-USG:terminated_at             | -                                                                                                                                |
| accessIPv4                           |                                                                                                                                  |
| accessIPv6                           |                                                                                                                                  |
| config_drive                         |                                                                                                                                  |
| created                              | 2015-02-05T15:52:27Z                                                                                                             |
| extended                             | {"cpuset": 24, "numanode": 0, "siblings_cpuset": null}                                                                           |
| flavor                               | vcpu4-1 (5f0d748b-1c8b-4a70-1985-4d57e25ac137)                                                                                   |
| hostId                               | 1ea8da9884e6179694739654aaa506b2817ea351d58559c80c37d716                                                                         |
| id                                   | cbb98ffb-7546-44c5-af22-7583c3c1ad4f                                                                                             |
| image                                | cgcs-guest (7aeabc04-8b05-44fa-bfe6-07d6dfbfc6ea)                                                                                |
| key_name                             | keypair-tenant1                                                                                                                  |
| metadata                             | {}                                                                                                                               |
| name                                 | guest1                                                                                                                           |
| nics                                 | {"nic1": {"vif_model": "virtio", "port_id": "6a5ee5eb-61e4-4b75-b49a-d3a683888b8e", "network": "tenant1-mgmt-net", "mtu": 1500}} |
| os-extended-volumes:volumes_attached | []                                                                                                                               |
| pinned                               | True                                                                                                                             |
| progress                             | 0                                                                                                                                |
| server_group                         |                                                                                                                                  |
| status                               | ACTIVE                                                                                                                           |
| tenant1-mgmt-net network             | 192.168.109.22                                                                                                                   |
| tenant_id                            | a4e3a58f85e344c9b238f99045ee9e4e                                                                                                 |
| updated                              | 2015-02-05T16:03:17Z                                                                                                             |
| user_id                              | 49be897e674a4456af937371ecfa936d                                                                                                 |
| vcpus (min/cur/max)                  | [1, 2, 4]                                                                                                                        |
+--------------------------------------+----------------------------------------------------------------------------------------------------------------------------------+
Thu Feb  5 16:03:20 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ [0;32m
Assigned Var:cur_cpu=2
[0m
[1;34m
 === auto scaling up
[0m
[0;32m
If: expr { "2" == "4" } |then   %BREAK_REACHED_MAX_CPU5|result=FALSE
[0m
[0;32m
While: expr { "2" != "4" } |result=TRUE
[0m
nova show guest1
[0;32m<guest1[0m
+--------------------------------------+----------------------------------------------------------------------------------------------------------------------------------+
| Property                             | Value                                                                                                                            |
+--------------------------------------+----------------------------------------------------------------------------------------------------------------------------------+
| OS-DCF:diskConfig                    | MANUAL                                                                                                                           |
| OS-EXT-AZ:availability_zone          | nova                                                                                                                             |
| OS-EXT-STS:power_state               | 1                                                                                                                                |
| OS-EXT-STS:task_state                | -                                                                                                                                |
| OS-EXT-STS:vm_state                  | active                                                                                                                           |
| OS-SRV-USG:launched_at               | 2015-02-05T15:54:49.000000                                                                                                       |
| OS-SRV-USG:terminated_at             | -                                                                                                                                |
| accessIPv4                           |                                                                                                                                  |
| accessIPv6                           |                                                                                                                                  |
| config_drive                         |                                                                                                                                  |
| created                              | 2015-02-05T15:52:27Z                                                                                                             |
| extended                             | {"cpuset": 56, "numanode": 0, "siblings_cpuset": null}                                                                           |
| flavor                               | vcpu4-1 (5f0d748b-1c8b-4a70-1985-4d57e25ac137)                                                                                   |
| hostId                               | 1ea8da9884e6179694739654aaa506b2817ea351d58559c80c37d716                                                                         |
| id                                   | cbb98ffb-7546-44c5-af22-7583c3c1ad4f                                                                                             |
| image                                | cgcs-guest (7aeabc04-8b05-44fa-bfe6-07d6dfbfc6ea)                                                                                |
| key_name                             | keypair-tenant1                                                                                                                  |
| metadata                             | {}                                                                                                                               |
| name                                 | guest1                                                                                                                           |
| nics                                 | {"nic1": {"vif_model": "virtio", "port_id": "6a5ee5eb-61e4-4b75-b49a-d3a683888b8e", "network": "tenant1-mgmt-net", "mtu": 1500}} |
| os-extended-volumes:volumes_attached | []                                                                                                                               |
| pinned                               | True                                                                                                                             |
| progress                             | 0                                                                                                                                |
| server_group                         |                                                                                                                                  |
| status                               | ACTIVE                                                                                                                           |
| tenant1-mgmt-net network             | 192.168.109.22                                                                                                                   |
| tenant_id                            | a4e3a58f85e344c9b238f99045ee9e4e                                                                                                 |
| updated                              | 2015-02-05T16:03:47Z                                                                                                             |
| user_id                              | 49be897e674a4456af937371ecfa936d                                                                                                 |
| vcpus (min/cur/max)                  | [1, 3, 4]                                                                                                                        |
+--------------------------------------+----------------------------------------------------------------------------------------------------------------------------------+
Thu Feb  5 16:03:52 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ [0;32m
Assigned Var:cur_cpu=3
[0m
[1;34m
 === auto scaling up
[0m
[0;32m
If: expr { "3" == "4" } |then   %BREAK_REACHED_MAX_CPU5|result=FALSE
[0m
[0;32m
While: expr { "3" != "4" } |result=TRUE
[0m
nova show guest1
[0;32m<guest1[0m
+--------------------------------------+----------------------------------------------------------------------------------------------------------------------------------+
| Property                             | Value                                                                                                                            |
+--------------------------------------+----------------------------------------------------------------------------------------------------------------------------------+
| OS-DCF:diskConfig                    | MANUAL                                                                                                                           |
| OS-EXT-AZ:availability_zone          | nova                                                                                                                             |
| OS-EXT-STS:power_state               | 1                                                                                                                                |
| OS-EXT-STS:task_state                | -                                                                                                                                |
| OS-EXT-STS:vm_state                  | active                                                                                                                           |
| OS-SRV-USG:launched_at               | 2015-02-05T15:54:49.000000                                                                                                       |
| OS-SRV-USG:terminated_at             | -                                                                                                                                |
| accessIPv4                           |                                                                                                                                  |
| accessIPv6                           |                                                                                                                                  |
| config_drive                         |                                                                                                                                  |
| created                              | 2015-02-05T15:52:27Z                                                                                                             |
| extended                             | {"cpuset": 120, "numanode": 0, "siblings_cpuset": null}                                                                          |
| flavor                               | vcpu4-1 (5f0d748b-1c8b-4a70-1985-4d57e25ac137)                                                                                   |
| hostId                               | 1ea8da9884e6179694739654aaa506b2817ea351d58559c80c37d716                                                                         |
| id                                   | cbb98ffb-7546-44c5-af22-7583c3c1ad4f                                                                                             |
| image                                | cgcs-guest (7aeabc04-8b05-44fa-bfe6-07d6dfbfc6ea)                                                                                |
| key_name                             | keypair-tenant1                                                                                                                  |
| metadata                             | {}                                                                                                                               |
| name                                 | guest1                                                                                                                           |
| nics                                 | {"nic1": {"vif_model": "virtio", "port_id": "6a5ee5eb-61e4-4b75-b49a-d3a683888b8e", "network": "tenant1-mgmt-net", "mtu": 1500}} |
| os-extended-volumes:volumes_attached | []                                                                                                                               |
| pinned                               | True                                                                                                                             |
| progress                             | 0                                                                                                                                |
| server_group                         |                                                                                                                                  |
| status                               | ACTIVE                                                                                                                           |
| tenant1-mgmt-net network             | 192.168.109.22                                                                                                                   |
| tenant_id                            | a4e3a58f85e344c9b238f99045ee9e4e                                                                                                 |
| updated                              | 2015-02-05T16:04:17Z                                                                                                             |
| user_id                              | 49be897e674a4456af937371ecfa936d                                                                                                 |
| vcpus (min/cur/max)                  | [1, 4, 4]                                                                                                                        |
+--------------------------------------+----------------------------------------------------------------------------------------------------------------------------------+
Thu Feb  5 16:04:23 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ [0;32m
Assigned Var:cur_cpu=4
[0m
[1;34m
 === auto scaling up
[0m
[0;32m
If: expr { "4" == "4" } |then   %BREAK_REACHED_MAX_CPU5|result=TRUE
[0m

Jumping to label[0;32m:%BREAK_REACHED_MAX_CPU5
[0m
[1;34m
 === check if guest1 current cpu value reached maximum cpu value:4
[0m
nova show guest1
+--------------------------------------+----------------------------------------------------------------------------------------------------------------------------------+
| Property                             | Value                                                                                                                            |
+--------------------------------------+----------------------------------------------------------------------------------------------------------------------------------+
| OS-DCF:diskConfig                    | MANUAL                                                                                                                           |
| OS-EXT-AZ:availability_zone          | nova                                                                                                                             |
| OS-EXT-STS:power_state               | 1                                                                                                                                |
| OS-EXT-STS:task_state                | -                                                                                                                                |
| OS-EXT-STS:vm_state                  | active                                                                                                                           |
| OS-SRV-USG:launched_at               | 2015-02-05T15:54:49.000000                                                                                                       |
| OS-SRV-USG:terminated_at             | -                                                                                                                                |
| accessIPv4                           |                                                                                                                                  |
| accessIPv6                           |                                                                                                                                  |
| config_drive                         |                                                                                                                                  |
| created                              | 2015-02-05T15:52:27Z                                                                                                             |
| extended                             | {"cpuset": 120, "numanode": 0, "siblings_cpuset": null}                                                                          |
| flavor                               | vcpu4-1 (5f0d748b-1c8b-4a70-1985-4d57e25ac137)                                                                                   |
| hostId                               | 1ea8da9884e6179694739654aaa506b2817ea351d58559c80c37d716                                                                         |
| id                                   | cbb98ffb-7546-44c5-af22-7583c3c1ad4f                                                                                             |
| image                                | cgcs-guest (7aeabc04-8b05-44fa-bfe6-07d6dfbfc6ea)                                                                                |
| key_name                             | keypair-tenant1                                                                                                                  |
| metadata                             | {}                                                                                                                               |
| name                                 | guest1                                                                                                                           |
| nics                                 | {"nic1": {"vif_model": "virtio", "port_id": "6a5ee5eb-61e4-4b75-b49a-d3a683888b8e", "network": "tenant1-mgmt-net", "mtu": 1500}} |
| os-extended-volumes:volumes_attached | []                                                                                                                               |
| pinned                               | True                                                                                                                             |
| progress                             | 0                                                                                                                                |
| server_group                         |                                                                                                                                  |
| status                               | ACTIVE                                                                                                                           |
| tenant1-mgmt-net network             | 192.168.109.22                                                                                                                   |
| tenant_id                            | a4e3a58f85e344c9b238f99045ee9e4e                                                                                                 |
| updated                              | 2015-02-05T16:04:17Z                                                                                                             |
| user_id                              | 49be897e674a4456af937371ecfa936d                                                                                                 |
| vcpus (min/cur/max)                  | [1, 4, 4]                                                                                                                        |
+--------------------------------------+----------------------------------------------------------------------------------------------------------------------------------+
[0;32m<min/cur/max[0m
Thu Feb  5 16:04:54 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ [0;32m
Assigned Var:min_cpu=1
[0m
[0;32m
Assigned Var:cur_cpu=4
[0m
[0;32m
Assigned Var:max_cpu=4
[0m
[0;32m
If: expr { "4" != "4" } |then   [|result=FALSE
[0m
[1;34m
 === become admin to clean up
[0m
[1;34m
cleanup all setup created for this testcase
[0m
[1;34m
 === delete the stack created
[0m
source /etc/nova/openrc
Thu Feb  5 16:04:55 UTC 2015
[wrsroot@controller-0 ~(keystone_admin)]$ [1;34m
 === delete the flavor created 
[0m
nova flavor-list
+--------------------------------------+---------------------------------------+-----------+------+-----------+------+-------+-------------+-----------+-------------+
| ID                                   | Name                                  | Memory_MB | Disk | Ephemeral | Swap | VCPUs | RXTX_Factor | Is_Public | VCPU_Model  |
+--------------------------------------+---------------------------------------+-----------+------+-----------+------+-------+-------------+-----------+-------------+
| 1                                    | m1.tiny                               | 512       | 1    | 0         |      | 1     | 1.0         | True      | -           |
| 100                                  | wrl5.dpdk.big                         | 4096      | 0    | 0         |      | 3     | 1.0         | True      | -           |
| 101                                  | wrl5.dpdk.small                       | 512       | 0    | 0         |      | 2     | 1.0         | True      | -           |
| 2                                    | m1.small                              | 2048      | 20   | 0         |      | 1     | 1.0         | True      | -           |
| 200                                  | wrl5.dpdk.small.heartbeat             | 512       | 0    | 0         |      | 2     | 1.0         | True      | -           |
| 201                                  | wrl5.dpdk.big.heartbeat               | 4096      | 0    | 0         |      | 3     | 1.0         | True      | -           |
| 233                                  | wrl5.dpdk.big.heartbeat.pinToMgmtCore | 4096      | 0    | 0         |      | 3     | 1.0         | True      | -           |
| 28aa6811-d4b8-41f5-994c-db017e81511d | small                                 | 512       | 1    | 0         |      | 1     | 1.0         | True      | -           |
| 41a0c6b2-5ce1-4ff2-9d73-2a6201847cc0 | medium.dpdk                           | 512       | 1    | 0         |      | 2     | 1.0         | True      | SandyBridge |
| 5f0d748b-1c8b-4a70-1985-4d57e25ac137 | vcpu4-1                               | 512       | 0    | 0         |      | 4     | 1.0         | True      | -           |
| d3b37dcf-227b-419d-9385-7623f08b65fd | test_flavor_1431620018                | 1024      | 0    | 0         |      | 1     | 1.0         | True      | -           |
| db9b37f5-cba5-1985-a264-a6c1375a4ff7 | vcpu5-2                               | 512       | 0    | 0         |      | 5     | 1.0         | True      | -           |
| f345d0a0-54be-4ab6-a9db-ddcff6524bcb | small.float                           | 512       | 1    | 0         |      | 1     | 1.0         | True      | -           |
+--------------------------------------+---------------------------------------+-----------+------+-----------+------+-------+-------------+-----------+-------------+
Thu Feb  5 16:04:56 UTC 2015
[wrsroot@controller-0 ~(keystone_admin)]$ nova flavor-delete vcpu4-1
+--------------------------------------+---------+-----------+------+-----------+------+-------+-------------+-----------+------------+
| ID                                   | Name    | Memory_MB | Disk | Ephemeral | Swap | VCPUs | RXTX_Factor | Is_Public | VCPU_Model |
+--------------------------------------+---------+-----------+------+-----------+------+-------+-------------+-----------+------------+
| 5f0d748b-1c8b-4a70-1985-4d57e25ac137 | vcpu4-1 | 512       | 0    | 0         |      | 4     | 1.0         | True      | -          |
+--------------------------------------+---------+-----------+------+-----------+------+-------+-------------+-----------+------------+
Thu Feb  5 16:04:56 UTC 2015
[wrsroot@controller-0 ~(keystone_admin)]$ nova flavor-delete vcpu5-2
+--------------------------------------+---------+-----------+------+-----------+------+-------+-------------+-----------+------------+
| ID                                   | Name    | Memory_MB | Disk | Ephemeral | Swap | VCPUs | RXTX_Factor | Is_Public | VCPU_Model |
+--------------------------------------+---------+-----------+------+-----------+------+-------+-------------+-----------+------------+
| db9b37f5-cba5-1985-a264-a6c1375a4ff7 | vcpu5-2 | 512       | 0    | 0         |      | 5     | 1.0         | True      | -          |
+--------------------------------------+---------+-----------+------+-----------+------+-------+-------------+-----------+------------+
Thu Feb  5 16:04:57 UTC 2015
[wrsroot@controller-0 ~(keystone_admin)]$ nova flavor-list
+--------------------------------------+---------------------------------------+-----------+------+-----------+------+-------+-------------+-----------+-------------+
| ID                                   | Name                                  | Memory_MB | Disk | Ephemeral | Swap | VCPUs | RXTX_Factor | Is_Public | VCPU_Model  |
+--------------------------------------+---------------------------------------+-----------+------+-----------+------+-------+-------------+-----------+-------------+
| 1                                    | m1.tiny                               | 512       | 1    | 0         |      | 1     | 1.0         | True      | -           |
| 100                                  | wrl5.dpdk.big                         | 4096      | 0    | 0         |      | 3     | 1.0         | True      | -           |
| 101                                  | wrl5.dpdk.small                       | 512       | 0    | 0         |      | 2     | 1.0         | True      | -           |
| 2                                    | m1.small                              | 2048      | 20   | 0         |      | 1     | 1.0         | True      | -           |
| 200                                  | wrl5.dpdk.small.heartbeat             | 512       | 0    | 0         |      | 2     | 1.0         | True      | -           |
| 201                                  | wrl5.dpdk.big.heartbeat               | 4096      | 0    | 0         |      | 3     | 1.0         | True      | -           |
| 233                                  | wrl5.dpdk.big.heartbeat.pinToMgmtCore | 4096      | 0    | 0         |      | 3     | 1.0         | True      | -           |
| 28aa6811-d4b8-41f5-994c-db017e81511d | small                                 | 512       | 1    | 0         |      | 1     | 1.0         | True      | -           |
| 41a0c6b2-5ce1-4ff2-9d73-2a6201847cc0 | medium.dpdk                           | 512       | 1    | 0         |      | 2     | 1.0         | True      | SandyBridge |
| d3b37dcf-227b-419d-9385-7623f08b65fd | test_flavor_1431620018                | 1024      | 0    | 0         |      | 1     | 1.0         | True      | -           |
| f345d0a0-54be-4ab6-a9db-ddcff6524bcb | small.float                           | 512       | 1    | 0         |      | 1     | 1.0         | True      | -           |
+--------------------------------------+---------------------------------------+-----------+------+-----------+------+-------+-------------+-----------+-------------+
Thu Feb  5 16:04:59 UTC 2015
[wrsroot@controller-0 ~(keystone_admin)]$ [1;34m
 === become tenant to clean up stack
[0m
source /home/wrsroot/openrc.tenant1
Thu Feb  5 16:04:59 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ [1;34m
 === delete heat stack created
[0m
heat stack-delete STACK1
+--------------------------------------+------------+--------------------+----------------------+
| id                                   | stack_name | stack_status       | creation_time        |
+--------------------------------------+------------+--------------------+----------------------+
| f3eb1a03-bf33-4700-9660-9e3dd4387c22 | STACK1     | DELETE_IN_PROGRESS | 2015-02-05T15:52:26Z |
+--------------------------------------+------------+--------------------+----------------------+
Thu Feb  5 16:05:00 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ heat stack-list
+----+------------+--------------+---------------+
| id | stack_name | stack_status | creation_time |
+----+------------+--------------+---------------+
+----+------------+--------------+---------------+
Thu Feb  5 16:05:45 UTC 2015
[wrsroot@controller-0 ~(keystone_tenant1)]$ [0;32m

##Overall Result: PASS 

[0m
